
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Python 3 et au framework web Flask par l'exemple">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-flask-sept-2020/fonctions-internet.html">
      
      
        <link rel="prev" href="exercice-dx27application-version-5.html">
      
      
        <link rel="next" href="services-web-avec-le-framework-flask.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>21. Fonctions internet - Introduction au langage Python 3 et au framework web Flask par l'exemple</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#21-fonctions-internet" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-header__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Python 3 et au framework web Flask par l'exemple
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              21. Fonctions internet
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-nav__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Python 3 et au framework web Flask par l'exemple
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="avant-propos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Avant-propos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dx27un-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Installation d&#x27;un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-bases-de-python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Les bases de Python
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-chaines-de-caracteres.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Les chaînes de caractères
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-exceptions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Les exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fonctions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Les fonctions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fichiers-texte.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Les fichiers texte
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Exercice d&#x27;application – version 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-imports.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Les imports
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Exercice d’application : version 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Exercice d’application : version 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-et-objets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. Les classes et objets
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-generiques-baseentity-et-myexception.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. Les classes génériques [BaseEntity] et [MyException]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture-en-couches-et-programmation-par-interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. Architecture en couches et programmation par interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. Exercice d&#x27;application - version 4
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-mysql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. Utilisation du SGBD MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-postgresql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. Utilisation du SGBD PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="ecrire-du-code-independant-du-sgbd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. Ecrire du code indépendant du SGBD
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-de-lorm-sqlalchemy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. Utilisation de l’ORM SQLALCHEMY
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application-version-5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Exercice d&#x27;application : version 5
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    21. Fonctions internet
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="fonctions-internet.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Fonctions internet
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#211-les-bases-de-la-programmation-internet" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.1. Les bases de la programmation internet
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="21.1. Les bases de la programmation internet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2111-generalites" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.1.1. Généralités
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2112-les-caracteristiques-du-protocole-tcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.1.2. Les caractéristiques du protocole TCP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2113-la-relation-client-serveur" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.1.3. La relation client-serveur
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2114-architecture-dun-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.1.4. Architecture d&#x27;un client
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2115-architecture-dun-serveur" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.1.5. Architecture d&#x27;un serveur
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#212-decouvrir-les-protocoles-de-communication-de-linternet" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.2. Découvrir les protocoles de communication de l&#x27;internet
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="21.2. Découvrir les protocoles de communication de l&#39;internet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2121-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.2.1. Introduction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2122-utilitaires-tcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.2.2. Utilitaires TCP
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#213-obtenir-le-nom-ou-ladresse-ip-dune-machine-de-linternet" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.3. Obtenir le nom ou l&#x27;adresse IP d&#x27;une machine de l&#x27;Internet
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#214-le-protocole-http-hypertext-transfer-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.4. Le protocole HTTP (HyperText Transfer Protocol)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="21.4. Le protocole HTTP (HyperText Transfer Protocol)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2141-exemple-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.4.1. Exemple 1
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2142-exemple-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.4.2. Exemple 2
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2143-exemple-3" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.4.3. Exemple 3
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2144-exemple-4" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.4.4. Exemple 4
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2145-exemple-5" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.4.5. Exemple 5
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2146-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.4.6. Conclusion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#215-le-protocole-smtp-simple-mail-transfer-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.5. Le protocole SMTP (Simple Mail Transfer Protocol)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="21.5. Le protocole SMTP (Simple Mail Transfer Protocol)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2151-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.5.1. Introduction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2152-creation-dune-adresse-gmail" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.5.2. Création d’une adresse [gmail]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2153-installation-dun-serveur-smtp" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.5.3. Installation d’un serveur SMTP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2154-installation-dun-lecteur-de-courrier" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.5.4. Installation d&#x27;un lecteur de courrier
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2155-le-protocole-smtp" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.5.5. Le protocole SMTP
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2156-scripts-smtp01-un-client-smtp-basique" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.5.6. scripts [smtp/01] : un client SMTP basique
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2157-scripts-smtp02-un-lient-smtp-ecrit-avec-la-bibliotheque-smtplib" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.5.7. scripts [smtp/02] : un lient SMTP écrit avec la bibliothèque [smtplib]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2158-scripts-smtp03-gestion-des-fichiers-attaches" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.5.8. scripts [smtp/03] : gestion des fichiers attachés
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#216-le-protocole-pop3" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.6. Le protocole POP3
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="21.6. Le protocole POP3">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2161-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.6.1. Introduction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2162-decouverte-du-protocole-pop3" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.6.2. Découverte du protocole POP3
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2163-scripts-pop301-un-client-pop3-basique" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.6.3. scripts [pop3/01] : un client POP3 basique
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2164-scripts-pop302-client-pop3-avec-les-modules-poplib-et-email" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.6.4. scripts [pop3/02] : client POP3 avec les modules [poplib] et [email]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#217-le-protocole-imap" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.7. Le protocole IMAP
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="21.7. Le protocole IMAP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2171-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.7.1. Introduction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2172-script-imapmain-client-imap-avec-le-module-imaplib" class="md-nav__link">
    <span class="md-ellipsis">
      
        21.7.2. script [imap/main] : client IMAP avec le module [imaplib]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="services-web-avec-le-framework-flask.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Services web avec le framework Flask
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23. Exercice d’application : version 6
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24. Exercice d’application : version 7
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25. Exercice d’application : version 8
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="du-dictionnaire-a-xml-et-vice-versa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26. Du dictionnaire à XML et vice-versa
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-9.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27. Exercice d’application : version 9
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-10.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28. Exercice d’application : version 10
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-11.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    29. Exercice d’application : version 11
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30. Exercice d’application : version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="clients-web-pour-les-services-json-et-xml-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    31. Clients web pour les services jSON et XML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="le-mode-html-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    32. Le mode HTML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-13.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    33. Exercice d’application : version 13
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-14.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    34. Exercice d’application : version 14
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-15.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    35. Exercice d’application : version 15
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-16.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    36. Exercice d’application : version 16
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-17.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    37. Exercice d’application : version 17
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-18.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    38. Exercice d’application : version 18
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    39. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="21-fonctions-internet">21. Fonctions internet</h1>
<p>Nous abordons maintenant les fonctions internet de Python qui nous permettent de faire de la programmation TCP / IP (<strong>T</strong>ransfer <strong>C</strong>ontrol <strong>P</strong>rotocol / <strong>I</strong>nternet <strong>P</strong>rotocol).</p>
<p><img src="images/10000000000000D80000015987C8E4F7.png" style="width:2.5cm;height:3.991cm;" alt="Image" /></p>
<h2 id="211-les-bases-de-la-programmation-internet">21.1. Les bases de la programmation internet</h2>
<h3 id="2111-generalites">21.1.1. Généralités</h3>
<p>Considérons la communication entre deux machines distantes A et B :</p>
<p><img src="images/10000001000001FA000000E90533D8A3.png" style="width:6.891cm;height:3.17cm;" alt="Image" /></p>
<p>Lorsque une application AppA d&#x27;une machine A veut  communiquer avec une application AppB d&#x27;une machine B de l&#x27;Internet, elle doit connaître plusieurs choses :</p>
<ul>
<li>l&#x27;adresse IP (<strong>I</strong>nternet <strong>P</strong>rotocol) ou le nom de la machine B ;</li>
<li>le numéro du port avec lequel travaille l&#x27;application AppB. En effet la machine B peut supporter de nombreuses applications qui travaillent sur l&#x27;Internet. Lorsqu&#x27;elle reçoit des informations provenant du réseau, elle doit savoir à quelle application sont destinées ces informations. Les applications de la machine B ont accès au réseau via des guichets appelés également des <strong>ports de communication</strong>. Cette information est contenue dans le paquet reçu par la machine B afin qu&#x27;il soit délivré à la bonne application ;</li>
<li>les protocoles de communication compris par la machine B. Dans notre étude, nous utiliserons uniquement les protocoles TCP-IP ;</li>
<li>le protocole de dialogue accepté par l&#x27;application AppB. En effet, les machines A et B vont se &quot;parler&quot;. Ce qu&#x27;elles vont dire va être encapsulé dans les protocoles TCP-IP. Néanmoins, lorsqu&#x27;au bout de la chaîne, l&#x27;application AppB va recevoir l&#x27;information envoyée par l&#x27;applicaton AppA, il faut qu&#x27;elle soit capable de l&#x27;interpréter. Ceci est analogue à la situation où deux personnes A et B communiquent par téléphone : leur dialogue est transporté par le téléphone. La parole va être codée sous forme de signaux par le téléphone A, transportée par des lignes téléphoniques, arriver au téléphone B pour y être décodée. La personne B entend alors des paroles. C&#x27;est là qu&#x27;intervient la notion de protocole de dialogue : si A parle français et que B ne comprend pas cette langue, A et B ne pourront dialoguer utilement ;
Aussi les deux applications communicantes doivent-elles être d&#x27;accord sur le type de dialogue qu&#x27;elles vont adopter. Par exemple, le dialogue avec un service ftp n&#x27;est pas le même qu&#x27;avec un service pop : ces deux services n&#x27;acceptent pas les mêmes commandes.  Elles ont un protocole de dialogue différent ;</li>
</ul>
<h3 id="2112-les-caracteristiques-du-protocole-tcp">21.1.2. Les caractéristiques du protocole TCP</h3>
<p>Nous n&#x27;étudierons ici que des communications réseau utilisant le protocole de transport TCP dont voici les principales caractéristiques :</p>
<ul>
<li>le processus qui souhaite émettre établit tout d&#x27;abord une <strong>connexion</strong> avec le processus destinataire des informations qu&#x27;il va émettre. Cette connexion se fait entre un port de la machine émettrice et un port de la machine réceptrice. Il y a entre les deux ports un chemin virtuel qui est ainsi créé et qui sera réservé aux deux seuls processus ayant réalisé la connexion ;</li>
<li>tous les paquets émis par le processus source suivent ce chemin virtuel et arrivent dans l&#x27;ordre où ils ont été émis ;</li>
<li>l&#x27;information émise a un aspect continu. Le processus émetteur envoie des informations à son rythme. Celles-ci ne sont pas nécessairement envoyées tout de suite : le protocole TCP attend d&#x27;en avoir assez pour les envoyer. Elles sont stockées dans une structure appelée segment TCP. Ce segment une fois rempli sera transmis à la couche IP où il sera encapsulé dans un paquet IP ;</li>
<li>chaque segment envoyé par le protocole TCP est numéroté. Le protocole TCP destinataire vérifie qu&#x27;il reçoit bien les segments en séquence. Pour chaque segment correctement reçu, il envoie un accusé de réception à l&#x27;expéditeur ;</li>
<li>lorsque ce dernier le reçoit, il l&#x27;indique au processus émetteur. Celui-ci peut donc savoir qu&#x27;un segment est arrivé à bon port ;</li>
<li>si au bout d&#x27;un certain temps, le protocole TCP ayant émis un segment ne reçoit pas d&#x27;accusé de réception, il retransmet le segment en question, garantissant ainsi la qualité du service d&#x27;acheminement de l&#x27;information ;</li>
<li>le circuit virtuel établi entre les deux processus qui communiquent est full-duplex : cela signifie que l&#x27;information peut transiter dans les deux sens. Ainsi le processus destination peut envoyer des accusés de réception alors même que le processus source continue d&#x27;envoyer des informations. Cela permet par exemple au protocole TCP source d&#x27;envoyer plusieurs segments sans attendre d&#x27;accusé de réception. S&#x27;il réalise au bout d&#x27;un certain temps qu&#x27;il n&#x27;a pas reçu l&#x27;accusé de réception d&#x27;un certain segment n° n, il reprendra l&#x27;émission des segments à ce point ;</li>
</ul>
<h3 id="2113-la-relation-client-serveur">21.1.3. La relation client-serveur</h3>
<p>Souvent, la communication sur Internet est dissymétrique : la machine A initie une connexion pour demander un service à la machine B : il précise qu&#x27;il veut ouvrir une connexion avec le service SB1 de la machine B. Celle-ci accepte ou refuse. Si elle accepte, la machine A peut envoyer ses demandes au service SB1. Celles-ci doivent se conformer au protocole de dialogue compris par le service SB1. Un dialogue demande-réponse s&#x27;instaure ainsi entre la machine A qu&#x27;on appelle machine <strong>cliente</strong> et la machine B qu&#x27;on appelle machine <strong>serveur</strong>. L&#x27;un des deux partenaires fermera la connexion.</p>
<h3 id="2114-architecture-dun-client">21.1.4. Architecture d&#x27;un client</h3>
<p>L&#x27;architecture d&#x27;un programme réseau demandant les services d&#x27;une application serveur sera la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="n">ouvrir</span> <span class="n">la</span> <span class="n">connexion</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">service</span> <span class="n">SB1</span> <span class="n">de</span> <span class="n">la</span> <span class="n">machine</span> <span class="n">B</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="n">si</span> <span class="n">réussite</span> <span class="n">alors</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="n">tant</span> <span class="n">que</span> <span class="n">ce</span> <span class="n">n</span><span class="s1">&#39;est pas fini</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        <span class="n">préparer</span> <span class="n">une</span> <span class="n">demande</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="n">l</span><span class="s1">&#39;émettre vers la machine B</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="n">attendre</span> <span class="n">et</span> <span class="n">récupérer</span> <span class="n">la</span> <span class="n">réponse</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>        <span class="n">la</span> <span class="n">traiter</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="n">fin</span> <span class="n">tant</span> <span class="n">que</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="n">finsi</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="n">fermer</span> <span class="n">la</span> <span class="n">connexion</span>
</code></pre></div></td></tr></table></div>
<h3 id="2115-architecture-dun-serveur">21.1.5. Architecture d&#x27;un serveur</h3>
<p>L&#x27;architecture d&#x27;un programme offrant des services sera la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">ouvrir</span> <span class="n">le</span> <span class="n">service</span> <span class="n">sur</span> <span class="n">la</span> <span class="n">machine</span> <span class="n">locale</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="n">tant</span> <span class="n">que</span> <span class="n">le</span> <span class="n">service</span> <span class="n">est</span> <span class="n">ouvert</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>    <span class="n">se</span> <span class="n">mettre</span> <span class="n">à</span> <span class="n">l</span><span class="s1">&#39;écoute des demandes de connexion sur un port dit port d&#39;</span><span class="n">écoute</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>    <span class="n">lorsqu</span><span class="s1">&#39;il y a une demande, la faire traiter par une autre tâche sur un autre port dit port de service</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="n">fin</span> <span class="n">tant</span> <span class="n">que</span>
</code></pre></div></td></tr></table></div>
<p>Le programme serveur traite différemment la demande de connexion initiale d&#x27;un client de ses demandes ultérieures visant à obtenir un service. Le programme n&#x27;assure pas le service lui-même. S&#x27;il le faisait, pendant la durée du service il ne serait plus à l&#x27;écoute des demandes de connexion et des clients ne seraient alors pas servis. Il procède autrement : dès qu&#x27;une demande de connexion est reçue sur le port d&#x27;écoute puis acceptée, le serveur crée une tâche chargée de rendre le service demandé par le client. Ce service est rendu sur un autre port de la machine serveur appelé <strong>port de service</strong>. On peut ainsi servir plusieurs clients en même temps.</p>
<p>Une tâche de service aura la structure suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">tant</span> <span class="n">que</span> <span class="n">le</span> <span class="n">service</span> <span class="n">n</span><span class="s1">&#39;a pas été rendu totalement</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>    <span class="n">attendre</span> <span class="n">une</span> <span class="n">demande</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">port</span> <span class="n">de</span> <span class="n">service</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>    <span class="n">lorsqu</span><span class="s1">&#39;il y en a une, élaborer la réponse</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>    <span class="n">transmettre</span> <span class="n">la</span> <span class="n">réponse</span> <span class="n">via</span> <span class="n">le</span> <span class="n">port</span> <span class="n">de</span> <span class="n">service</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="n">fin</span> <span class="n">tant</span> <span class="n">que</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="n">libérer</span> <span class="n">le</span> <span class="n">port</span> <span class="n">de</span> <span class="n">service</span>
</code></pre></div></td></tr></table></div>
<h2 id="212-decouvrir-les-protocoles-de-communication-de-linternet">21.2. Découvrir les protocoles de communication de l&#x27;internet</h2>
<h3 id="2121-introduction">21.2.1. Introduction</h3>
<p>Lorsqu&#x27;un client s&#x27;est connecté à un serveur, s&#x27;établit ensuite un dialogue entre-eux. La nature de celui-ci forme ce qu&#x27;on appelle le protocole de communication du serveur. Parmi les protocoles les plus courants de l&#x27;internet on trouve les suivants :</p>
<ul>
<li>HTTP : <strong>H</strong>yper<strong>T</strong>ext <strong>T</strong>ransfer <strong>P</strong>rotocol - le protocole de dialogue avec un serveur web (serveur HTTP) ;</li>
<li>SMTP : <strong>S</strong>imple <strong>M</strong>ail <strong>T</strong>ransfer <strong>P</strong>rotocol - le protocole de dialogue avec un serveur d&#x27;envoi de courriers électroniques (serveur SMTP) ;</li>
<li>POP : <strong>P</strong>ost <strong>O</strong>ffice <strong>P</strong>rotocol - le protocole de dialogue avec un serveur de stockage du courrier électronique (serveur POP). Il s&#x27;agit là de récupérer les courriers électroniques reçus et non d&#x27;en envoyer ;</li>
<li>IMAP : <strong>I</strong>nternet <strong>M</strong>essage <strong>A</strong>ccess <strong>P</strong>rotocol - le protocole de dialogue avec un serveur de stockage du courrier électronique (serveur IMAP). Ce protocole a remplacé progressivement le protocole POP plus ancien ;</li>
<li>
<p>FTP : <strong>F</strong>ile <strong>T</strong>ransfer <strong>P</strong>rotocol - le protocole de dialogue avec un serveur de stockage de fichiers (serveur FTP) ;
Tous ces protocoles ont la particularité d&#x27;être des protocoles à lignes de texte : le client et le serveur s&#x27;échangent des lignes de texte. Si on a un client capable de :</p>
</li>
<li>
<p>créer une connexion avec un serveur TCP ;</p>
</li>
<li>afficher à la console les lignes de texte que le serveur lui envoie ;</li>
<li>envoyer au serveur les lignes de texte qu&#x27;un utilisateur saisirait au clavier ;
alors on est capable de dialoguer avec un serveur TCP ayant un protocole à lignes de texte pour peu qu&#x27;on connaisse les règles de ce protocole.</li>
</ul>
<h3 id="2122-utilitaires-tcp">21.2.2. Utilitaires TCP</h3>
<p><img src="images/10000000000001A0000000E5A6BD6321.png" style="width:4.791cm;height:2.65cm;" alt="Image" /></p>
<p>Dans les codes associés à ce document, on trouve deux utilitaires de communication TCP :</p>
<ul>
<li><strong>[RawTcpClient]</strong> permet de se connecter sur le port P d’un serveur S ;</li>
<li><strong>[RawTcpServer]</strong> permet de créer un serveur qui attend des clients sur un port P ;
Ce sont deux programmes C# dont les codes sources vous sont donnés. Vous pouvez donc les modifier.</li>
</ul>
<p>Le serveur TCP <strong>[RawTcpServer]</strong> s’appelle avec la syntaxe <strong>[RawTcpServeur port]</strong><strong> </strong>pour créer un service TCP sur le port <strong>[port]</strong> de la machine locale (l’ordinateur sur lequel vous travaillez) :</p>
<ul>
<li>le serveur peut servir plusieurs clients simultanément ;</li>
<li>le serveur exécute les commandes tapées par l’utilisateur tapées au clavier. Celles-ci sont les suivantes :</li>
<li><strong>list</strong> : liste les clients actuellement connectés au serveur. Ceux-ci sont affichés sous la forme <strong>[id=x-nom=y]</strong>. Le champ <strong>[id]</strong> sert à identifier les clients ;</li>
<li><strong>send x </strong><strong>[texte]</strong> : envoie <strong>texte</strong> au client n° <strong>x</strong> (id=x). Les crochets <strong>[]</strong> ne sont pas envoyés. Ils sont nécessaires dans la commande. Ils servent à délimiter visuellement le texte envoyé au client ;</li>
<li><strong>close x</strong> : ferme la connexion avec le client n° <strong>x</strong> ;</li>
<li><strong>quit</strong> : ferme toutes les connexions et arrête le service ;</li>
<li>les lignes envoyées par le client au serveur sont affichées sur la console ;</li>
<li>l’ensemble des échanges est logué dans un fichier texte portant le nom <strong>[machine-port.txt]</strong> où</li>
<li><strong>[machine]</strong> est le nom de la machine sur laquelle s’exécute le code ;</li>
<li>
<p><strong>[port]</strong> est le port de service qui répond aux demandes du client ;
Le client TCP <strong>[RawTcpClient]</strong> s’appelle avec la syntaxe <strong>[RawTcpClient serveur port]</strong><strong> </strong>pour se connecter au port <strong>[port]</strong> du serveur <strong>[serveur]</strong> :</p>
</li>
<li>
<p>les lignes tapées par l’utilisateur au clavier sont envoyées au serveur ;</p>
</li>
<li>les lignes envoyées par le serveur sont affichées sur la console ;</li>
<li>l’ensemble des échanges est logué dans un fichier texte portant le nom <strong>[serveur-port.txt]</strong> ;
Voyons un exemple. On ouvre deux fenêtres terminal PyCharm et on se positionne dans chacune d’elles sur le dossier des utilitaires :</li>
</ul>
<p><img src="images/10000000000001D80000030A050B5718.png" style="width:5.46cm;height:8.97cm;" alt="Image" /></p>
<p>Dans l’une des fenêtres on lance le serveur <strong>[RawTcpServer]</strong> sur le port 100 :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpServer</span><span class="o">.</span><span class="n">exe</span> <span class="mi">100</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Serveur</span> <span class="n">générique</span> <span class="n">lancé</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">port</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">100</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Commandes</span> <span class="n">disponibles</span> <span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">send</span> <span class="nb">id</span> <span class="p">[</span><span class="n">texte</span><span class="p">],</span> <span class="n">close</span> <span class="nb">id</span><span class="p">,</span> <span class="n">quit</span><span class="p">]</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="n">user</span> <span class="p">:</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1, nous sommes placés dans le dossier des utilitaires ;</li>
<li>ligne 1, nous lançons le serveur TCP sur le port 100 ;</li>
<li>lignes 2-4, le serveur se met en attente d’un client TCP et affiche une liste de commandes que l’utilisateur au clavier peut taper ;</li>
<li>ligne 5, le serveur attend une commande tapée par l’utilisateur au clavier ;
Dans l’autre fenêtre de commandes, on lance le client TCP :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">100</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">51173</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1, nous sommes placés dans le dossier des utilitaires ;</li>
<li>ligne 1 nous lançons le client TCP : nous lui disons de se connecter au port 100 de la machine locale (celle sur laquelle s’exécute le code de <strong>[RawTcpClient]</strong>) ;</li>
<li>ligne 2, le client a réussi à se connecter au serveur. On indique les coordonnées du client : il est sur la machine <strong>[DESKTOP-30FF5FB]</strong> (la machine locale dans cet exemple) et utilise le port <strong>[51173]</strong> pour communiquer avec le serveur :</li>
<li>ligne 3, le client attend une commande tapée par l’utilisateur au clavier ;
Revenons sur la fenêtre du serveur. Son contenu a évolué :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpServer</span><span class="o">.</span><span class="n">exe</span> <span class="mi">100</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Serveur</span> <span class="n">générique</span> <span class="n">lancé</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">port</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">100</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Commandes</span> <span class="n">disponibles</span> <span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">send</span> <span class="nb">id</span> <span class="p">[</span><span class="n">texte</span><span class="p">],</span> <span class="n">close</span> <span class="nb">id</span><span class="p">,</span> <span class="n">quit</span><span class="p">]</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="n">user</span> <span class="p">:</span> <span class="n">server</span> <span class="p">:</span> <span class="n">Client</span> <span class="mi">1</span><span class="o">-</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="o">-</span><span class="mi">51173</span> <span class="n">connecté</span><span class="o">...</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 5, un client a été détecté. Le serveur lui a donné le n° 1. Le serveur a correctement identifié le client distant (machine et port) ;</li>
<li>ligne 6, le serveur se remet en attente d’un nouveau client ;
Revenons sur la fenêtre du client et envoyons une commande au serveur :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">100</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">51173</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">client</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 4, la commande envoyée au serveur ;
Revenons sur la fenêtre du serveur. Son contenu a évolué :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span>
<span class="normal"><a href="#__codelineno-7-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpServer</span><span class="o">.</span><span class="n">exe</span> <span class="mi">100</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Serveur</span> <span class="n">générique</span> <span class="n">lancé</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">port</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">100</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Commandes</span> <span class="n">disponibles</span> <span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">send</span> <span class="nb">id</span> <span class="p">[</span><span class="n">texte</span><span class="p">],</span> <span class="n">close</span> <span class="nb">id</span><span class="p">,</span> <span class="n">quit</span><span class="p">]</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="n">user</span> <span class="p">:</span> <span class="n">server</span> <span class="p">:</span> <span class="n">Client</span> <span class="mi">1</span><span class="o">-</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="o">-</span><span class="mi">51173</span> <span class="n">connecté</span><span class="o">...</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">client</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 7, entre crochets, le message reçu par le serveur ;
Envoyons une réponse au client :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span>
<span class="normal"><a href="#__codelineno-8-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpServer</span><span class="o">.</span><span class="n">exe</span> <span class="mi">100</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Serveur</span> <span class="n">générique</span> <span class="n">lancé</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">port</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">100</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Commandes</span> <span class="n">disponibles</span> <span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">send</span> <span class="nb">id</span> <span class="p">[</span><span class="n">texte</span><span class="p">],</span> <span class="n">close</span> <span class="nb">id</span><span class="p">,</span> <span class="n">quit</span><span class="p">]</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="n">user</span> <span class="p">:</span> <span class="n">server</span> <span class="p">:</span> <span class="n">Client</span> <span class="mi">1</span><span class="o">-</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="o">-</span><span class="mi">51173</span> <span class="n">connecté</span><span class="o">...</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">client</span><span class="p">]</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="n">send</span> <span class="mi">1</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">server</span><span class="p">]</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="n">user</span> <span class="p">:</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 8, la réponse envoyée au client 1. Seul le texte entre les crochets est envoyé, pas les crochets eux-mêmes ;
Revenons à la fenêtre du client :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">100</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">51173</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">client</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">server</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 5, la réponse reçue par le client. Le texte reçu est celui entre crochets ;
Revenons à la fenêtre du serveur pour voir d’autres commandes :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpServer</span><span class="o">.</span><span class="n">exe</span> <span class="mi">100</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Serveur</span> <span class="n">générique</span> <span class="n">lancé</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">port</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">100</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Commandes</span> <span class="n">disponibles</span> <span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">send</span> <span class="nb">id</span> <span class="p">[</span><span class="n">texte</span><span class="p">],</span> <span class="n">close</span> <span class="nb">id</span><span class="p">,</span> <span class="n">quit</span><span class="p">]</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="n">user</span> <span class="p">:</span> <span class="n">server</span> <span class="p">:</span> <span class="n">Client</span> <span class="mi">1</span><span class="o">-</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="o">-</span><span class="mi">51173</span> <span class="n">connecté</span><span class="o">...</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">client</span><span class="p">]</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="n">send</span> <span class="mi">1</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">server</span><span class="p">]</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="n">user</span> <span class="p">:</span> <span class="nb">list</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="n">server</span> <span class="p">:</span> <span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">name</span><span class="o">=</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="o">-</span><span class="mi">51173</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="n">user</span> <span class="p">:</span> <span class="n">close</span> <span class="mi">1</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Connexion</span> <span class="n">client</span> <span class="mi">1</span> <span class="n">fermée</span><span class="o">...</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="n">user</span> <span class="p">:</span> <span class="n">quit</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="n">server</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">service</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9, nous demandons la liste des clients ;</li>
<li>ligne 10, la réponse ;</li>
<li>ligne 11, nous fermons la connexion avec le client n° 1 ;</li>
<li>ligne 12, la confirmation du serveur ;</li>
<li>ligne 13, nous arrêtons le serveur ;</li>
<li>ligne 14, la confirmation du serveur ;
Revenons à la fenêtre du client :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span>
<span class="normal"><a href="#__codelineno-11-4">4</a></span>
<span class="normal"><a href="#__codelineno-11-5">5</a></span>
<span class="normal"><a href="#__codelineno-11-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">100</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">51173</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">100</span><span class="p">]</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">client</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">server</span><span class="p">]</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="n">Perte</span> <span class="n">de</span> <span class="n">la</span> <span class="n">connexion</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span><span class="o">...</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 6, le client a détecté la fin du service ;
Deux fichiers de logs ont été créés, un pour le serveur, un autre pour le client :</li>
</ul>
<p><img src="images/10000000000001C70000013527E36BB1.png" style="width:5.261cm;height:3.571cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, les logs du serveur : le nom du fichier est le nom du client sous la forme <strong>[machine-port]</strong>. Cela permet d’avoir des fichiers de logs différents pour des clients différents ;</li>
<li>en <strong>[2]</strong>, les logs du client : le nom du fichier est le nom du serveur sous la forme <strong>[machine-port]</strong> ;
Les logs du serveur sont les suivants :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">client</span><span class="p">]</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">server</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>Les logs du client sont les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">client</span><span class="p">]</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">hello</span> <span class="kn">from</span><span class="w"> </span><span class="nn">server</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<h2 id="213-obtenir-le-nom-ou-ladresse-ip-dune-machine-de-linternet">21.3. Obtenir le nom ou l&#x27;adresse IP d&#x27;une machine de l&#x27;Internet</h2>
<p><img src="images/10000000000000F60000009B904B6DE3.png" style="width:2.841cm;height:1.791cm;" alt="Image" /></p>
<p>Les machines de l’internet sont identifiées par une adresse IP (IPv4 ou IPv6) et le plus souvent par un nom. Mais finalement seule l’adresse IP est utilisée par les protocoles de communication de l’internet. Il faut donc connaître l’adresse IP d’une machine identifiée par son nom.</p>
<p>Le script <strong>[ip-01.py]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span>
<span class="normal"><a href="#__codelineno-14-32">32</a></span>
<span class="normal"><a href="#__codelineno-14-33">33</a></span>
<span class="normal"><a href="#__codelineno-14-34">34</a></span>
<span class="normal"><a href="#__codelineno-14-35">35</a></span>
<span class="normal"><a href="#__codelineno-14-36">36</a></span>
<span class="normal"><a href="#__codelineno-14-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># imports</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="c1"># ------------------------------------------------</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_ip_and_name</span><span class="p">(</span><span class="n">nom_machine</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>    <span class="c1"># nom_machine : nom de la machine dont on veut l&#39;adresse IP</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>        <span class="c1"># nom_machine--&gt;adresse IP</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>        <span class="n">ip</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="n">nom_machine</span><span class="p">)</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ip[</span><span class="si">{</span><span class="n">nom_machine</span><span class="si">}</span><span class="s2">]=</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a>    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>        <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ip[</span><span class="si">{</span><span class="n">nom_machine</span><span class="si">}</span><span class="s2">]=</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a>        <span class="k">return</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a>        <span class="c1"># adresse IP --&gt; nom_machine</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a>        <span class="n">names</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;names[</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">]=</span><span class="si">{</span><span class="n">names</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a>        <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;names[</span><span class="si">{</span><span class="n">ip</span><span class="si">}</span><span class="s2">]=</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a>        <span class="k">return</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a><span class="c1"># ---------------------------------------- main</span>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a><span class="c1"># les machines internet</span>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a><span class="n">hosts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;istia.univ-angers.fr&quot;</span><span class="p">,</span> <span class="s2">&quot;www.univ-angers.fr&quot;</span><span class="p">,</span> <span class="s2">&quot;sergetahe.com&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;xx&quot;</span><span class="p">]</span>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a><span class="c1"># adresses IP des machines de HOTES</span>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a><span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">hosts</span><span class="p">:</span>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-14-35" name="__codelineno-14-35"></a>    <span class="n">get_ip_and_name</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
<a id="__codelineno-14-36" name="__codelineno-14-36"></a><span class="c1"># fin</span>
<a id="__codelineno-14-37" name="__codelineno-14-37"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Terminé...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 2 : le module <strong>[socket]</strong> fournit les fonctions nécessaires à la gestion des sockets internet. <strong>[socket]</strong> signifie prise électrique, prise de réseau ;</li>
<li>ligne 6 : la fonction <strong>[</strong><strong>get_ip_and_name</strong><strong>]</strong> permet à partir du nom internet d&#x27;une machine d&#x27;obtenir :</li>
<li>l&#x27;adresse IP de la machine ;</li>
<li>le nom de la machine obtenu à partir de l&#x27;adresse IP précédente ;</li>
<li>ligne 10 : la fonction <strong>[</strong><strong>socket</strong><strong>.gethostbyname</strong><strong>]</strong> permet d&#x27;obtenir l&#x27;adresse IP d&#x27;une machine à partir d&#x27;un de ces noms (une machine internet peut avoir un nom principal et des alias) ;</li>
<li>ligne 12 : les fonctions sur les sockets lancent l&#x27;exception <strong>[</strong><strong>socket</strong><strong>.</strong><strong>error</strong><strong>]</strong> dès qu&#x27;une erreur survient ;</li>
<li>ligne 19 : la fonction <strong>[</strong><strong>socket</strong><strong>.gethostbyaddr</strong><strong>]</strong> permet d&#x27;obtenir le nom d&#x27;une machine à partir de son adresse IP. On va voir qu&#x27;on peut obtenir un nom différent de celui passé ligne 6 ;</li>
<li>ligne 30 : une liste de noms de machines. Le dernier nom est erroné. Le nom <strong>[localhost]</strong> désigne la machine sur laquelle vous travaillez et qui exécute le script ;</li>
<li>ligne 33-35 : on affiche les IP de ces machines ;
<strong>Résultats</strong> :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">inet</span><span class="o">/</span><span class="n">ip</span><span class="o">/</span><span class="n">ip_01</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="o">-------------------------------------</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="n">ip</span><span class="p">[</span><span class="n">istia</span><span class="o">.</span><span class="n">univ</span><span class="o">-</span><span class="n">angers</span><span class="o">.</span><span class="n">fr</span><span class="p">]</span><span class="o">=</span><span class="mf">193.49.144.41</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="n">names</span><span class="p">[</span><span class="mf">193.49.144.41</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ametys-fo-2.univ-angers.fr&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="s1">&#39;193.49.144.41&#39;</span><span class="p">])</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="o">-------------------------------------</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="n">ip</span><span class="p">[</span><span class="n">www</span><span class="o">.</span><span class="n">univ</span><span class="o">-</span><span class="n">angers</span><span class="o">.</span><span class="n">fr</span><span class="p">]</span><span class="o">=</span><span class="mf">193.49.144.41</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="n">names</span><span class="p">[</span><span class="mf">193.49.144.41</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ametys-fo-2.univ-angers.fr&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="s1">&#39;193.49.144.41&#39;</span><span class="p">])</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="o">-------------------------------------</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="n">ip</span><span class="p">[</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">]</span><span class="o">=</span><span class="mf">87.98.154.146</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="n">names</span><span class="p">[</span><span class="mf">87.98.154.146</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;cluster026.hosting.ovh.net&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="s1">&#39;87.98.154.146&#39;</span><span class="p">])</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="o">-------------------------------------</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="n">ip</span><span class="p">[</span><span class="n">localhost</span><span class="p">]</span><span class="o">=</span><span class="mf">127.0.0.1</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="n">names</span><span class="p">[</span><span class="mf">127.0.0.1</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;DESKTOP-30FF5FB&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">])</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="o">-------------------------------------</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="n">ip</span><span class="p">[</span><span class="n">xx</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">Errno</span> <span class="mi">11001</span><span class="p">]</span> <span class="n">getaddrinfo</span> <span class="n">failed</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="n">Terminé</span><span class="o">...</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<h2 id="214-le-protocole-http-hypertext-transfer-protocol">21.4. Le protocole HTTP (HyperText Transfer Protocol)</h2>
<h3 id="2141-exemple-1">21.4.1. Exemple 1</h3>
<p>Lorsqu’un navigateur affiche une URL, il est le client d’un serveur web ou dit autrement d’un serveur HTTP. C’est lui qui prend l’initiative et il commence par envoyer un certain nombre de commandes au serveur. Pour ce premier exemple :</p>
<ul>
<li>le serveur sera l’utilitaire <strong>[RawTcpServer]</strong> ;</li>
<li>le client sera un navigateur ;
Nous lançons d’abord le serveur sur le port 100 :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpServer</span><span class="o">.</span><span class="n">exe</span> <span class="mi">100</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Serveur</span> <span class="n">générique</span> <span class="n">lancé</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">port</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">100</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Commandes</span> <span class="n">disponibles</span> <span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">send</span> <span class="nb">id</span> <span class="p">[</span><span class="n">texte</span><span class="p">],</span> <span class="n">close</span> <span class="nb">id</span><span class="p">,</span> <span class="n">quit</span><span class="p">]</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="n">user</span> <span class="p">:</span>
</code></pre></div></td></tr></table></div>
<p>Puis avec un navigateur, nous demandons l’URL <strong>[http://localhost:100]</strong>, ç-a-d que nous disons que le serveur HTTP interrogé travaille sur le port 100 de la machine locale :</p>
<p><img src="images/100000010000022B000000B3CC9E4C4F.png" style="width:9.381cm;height:3.021cm;" alt="Image" /></p>
<p>Revenons sur la fenêtre du serveur :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpServer</span><span class="o">.</span><span class="n">exe</span> <span class="mi">100</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Serveur</span> <span class="n">générique</span> <span class="n">lancé</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">port</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">100</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Commandes</span> <span class="n">disponibles</span> <span class="p">:</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="n">send</span> <span class="nb">id</span> <span class="p">[</span><span class="n">texte</span><span class="p">],</span> <span class="n">close</span> <span class="nb">id</span><span class="p">,</span> <span class="n">quit</span><span class="p">]</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="n">user</span> <span class="p">:</span> <span class="n">server</span> <span class="p">:</span> <span class="n">Client</span> <span class="mi">1</span><span class="o">-</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="o">-</span><span class="mi">51438</span> <span class="n">connecté</span><span class="o">...</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Client</span> <span class="mi">2</span><span class="o">-</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="o">-</span><span class="mi">51439</span> <span class="n">connecté</span><span class="o">...</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span><span class="p">]</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">100</span><span class="p">]</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span><span class="p">]</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">DNT</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">Upgrade</span><span class="o">-</span><span class="n">Insecure</span><span class="o">-</span><span class="n">Requests</span><span class="p">:</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="n">Windows</span> <span class="n">NT</span> <span class="mf">10.0</span><span class="p">;</span> <span class="n">Win64</span><span class="p">;</span> <span class="n">x64</span><span class="p">)</span> <span class="n">AppleWebKit</span><span class="o">/</span><span class="mf">537.36</span> <span class="p">(</span><span class="n">KHTML</span><span class="p">,</span> <span class="n">like</span> <span class="n">Gecko</span><span class="p">)</span> <span class="n">Chrome</span><span class="o">/</span><span class="mf">83.0.4103.116</span> <span class="n">Safari</span><span class="o">/</span><span class="mf">537.36</span><span class="p">]</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">Accept</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">,</span><span class="n">application</span><span class="o">/</span><span class="n">xhtml</span><span class="o">+</span><span class="n">xml</span><span class="p">,</span><span class="n">application</span><span class="o">/</span><span class="n">xml</span><span class="p">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">image</span><span class="o">/</span><span class="n">webp</span><span class="p">,</span><span class="n">image</span><span class="o">/</span><span class="n">apng</span><span class="p">,</span><span class="o">*/*</span><span class="p">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">application</span><span class="o">/</span><span class="n">signed</span><span class="o">-</span><span class="n">exchange</span><span class="p">;</span><span class="n">v</span><span class="o">=</span><span class="n">b3</span><span class="p">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.9</span><span class="p">]</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">Sec</span><span class="o">-</span><span class="n">Fetch</span><span class="o">-</span><span class="n">Site</span><span class="p">:</span> <span class="n">none</span><span class="p">]</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">Sec</span><span class="o">-</span><span class="n">Fetch</span><span class="o">-</span><span class="n">Mode</span><span class="p">:</span> <span class="n">navigate</span><span class="p">]</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">Sec</span><span class="o">-</span><span class="n">Fetch</span><span class="o">-</span><span class="n">User</span><span class="p">:</span> <span class="err">?</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">Sec</span><span class="o">-</span><span class="n">Fetch</span><span class="o">-</span><span class="n">Dest</span><span class="p">:</span> <span class="n">document</span><span class="p">]</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span><span class="p">]</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[</span><span class="n">Accept</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span> <span class="n">fr</span><span class="o">-</span><span class="n">FR</span><span class="p">,</span><span class="n">fr</span><span class="p">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span><span class="n">en</span><span class="o">-</span><span class="n">US</span><span class="p">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">en</span><span class="p">;</span><span class="n">q</span><span class="o">=</span><span class="mf">0.7</span><span class="p">]</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[]</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Client</span> <span class="mi">3</span><span class="o">-</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="o">-</span><span class="mi">51441</span> <span class="n">connecté</span><span class="o">...</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 5, le client qui s’est connecté ;</li>
<li>lignes 9-22 : la série de lignes de texte qu’il a envoyées :</li>
<li>ligne 9 : cette ligne a le format <strong>[GET URL HTTP/1.1]</strong>. Elle demande l’URL / et demande au serveur d’utiliser le protocole HTTP 1.1 ;</li>
<li>ligne 10 : cette ligne a le format <strong>[Host: serveur:port]</strong>. La casse de la commande <strong>[Host]</strong> n’importe pas. On rappelle ici que le client interroge un serveur local opérant sur le port 100 ;</li>
<li>ligne 14 : la commande <strong>[User-Agent]</strong> donne l’identité du client ;</li>
<li>ligne 15 : la commande <strong>[Accept]</strong> indique quels types de document sont acceptés par le client ;</li>
<li>ligne 21 : la commande <strong>[Accept-Language]</strong> indique dans quelle langue sont souhaités les documents demandés s’ils existent en plusieurs langues ;</li>
<li>ligne 11 : la commande <strong>[Connection]</strong> indique le mode de connexion souhaité : <strong>[keep-alive]</strong> indique que la connexion doit être maintenue jusqu’à ce que les échanges soient terminés ;</li>
<li>ligne 22 : le client termine ses commandes par une ligne vide ;
 Nous terminons la connexion en terminant le serveur :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="n">client</span> <span class="mi">1</span> <span class="p">:</span> <span class="p">[]</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Client</span> <span class="mi">3</span><span class="o">-</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="o">-</span><span class="mi">51441</span> <span class="n">connecté</span><span class="o">...</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="n">server</span> <span class="p">:</span> <span class="n">Attente</span> <span class="n">d</span><span class="s1">&#39;un client...</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="n">quit</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="n">server</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">service</span>
</code></pre></div></td></tr></table></div>
<h3 id="2142-exemple-2">21.4.2. Exemple 2</h3>
<p>Maintenant que nous connaissons les commandes envoyées par un navigateur pour réclamer une URL, nous allons réclamer cette URL avec notre client TCP <strong>[RawTcpClient]</strong>. Le serveur Apache de Laragon (paragraphe |<a href="#_Installation_de_Laragon"><u><u>Installation de Laragon</u></u></a>|) sera notre serveur web.</p>
<p>Lançons Laragon puis le serveur web Apache :</p>
<p><img src="images/10000001000002A3000001625A18E210.png" style="width:11.431cm;height:5.991cm;" alt="Image" /></p>
<p><img src="images/10000001000002C3000000ACE307F335.png" style="width:11.941cm;height:2.901cm;" alt="Image" /></p>
<p>Maintenant avec un navigateur, demandons l’URL <strong>[http://localhost:80]</strong>. Ici nous ne précisons que le serveur <strong>[localhost:80]</strong> et pas d’URL de document. Dans ce cas c’est l’URL / qui est demandée, ç-à-d la racine du serveur web :</p>
<p><img src="images/10000001000002410000018DD566FA0E.png" style="width:9.741cm;height:6.7cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, l’URL demandée. On a tapé initialement <strong>[http://localhost:80]</strong> et le navigateur (Firefox ici) l’a transformée simplement en <strong>[localhost]</strong> car le protocole <strong>[http]</strong> est implicite lorsqu’aucun protocole n’est mentionné et le port <strong>[80]</strong> est implicite lorsque le port n’est pas précisé ;</li>
<li>en <strong>[2]</strong>, la page racine / du serveur web interrogé ;
Maintenant, visualisons le texte reçu par le navigateur :</li>
</ul>
<p><img src="images/10000001000001920000017587DD152E.png" style="width:6.741cm;height:6.25cm;" alt="Image" /></p>
<ul>
<li>on clique droit sur la page reçue et on choisit l’option <strong>[2]</strong>. On obtient le code source suivant :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span>
<span class="normal"><a href="#__codelineno-19-29">29</a></span>
<span class="normal"><a href="#__codelineno-19-30">30</a></span>
<span class="normal"><a href="#__codelineno-19-31">31</a></span>
<span class="normal"><a href="#__codelineno-19-32">32</a></span>
<span class="normal"><a href="#__codelineno-19-33">33</a></span>
<span class="normal"><a href="#__codelineno-19-34">34</a></span>
<span class="normal"><a href="#__codelineno-19-35">35</a></span>
<span class="normal"><a href="#__codelineno-19-36">36</a></span>
<span class="normal"><a href="#__codelineno-19-37">37</a></span>
<span class="normal"><a href="#__codelineno-19-38">38</a></span>
<span class="normal"><a href="#__codelineno-19-39">39</a></span>
<span class="normal"><a href="#__codelineno-19-40">40</a></span>
<span class="normal"><a href="#__codelineno-19-41">41</a></span>
<span class="normal"><a href="#__codelineno-19-42">42</a></span>
<span class="normal"><a href="#__codelineno-19-43">43</a></span>
<span class="normal"><a href="#__codelineno-19-44">44</a></span>
<span class="normal"><a href="#__codelineno-19-45">45</a></span>
<span class="normal"><a href="#__codelineno-19-46">46</a></span>
<span class="normal"><a href="#__codelineno-19-47">47</a></span>
<span class="normal"><a href="#__codelineno-19-48">48</a></span>
<span class="normal"><a href="#__codelineno-19-49">49</a></span>
<span class="normal"><a href="#__codelineno-19-50">50</a></span>
<span class="normal"><a href="#__codelineno-19-51">51</a></span>
<span class="normal"><a href="#__codelineno-19-52">52</a></span>
<span class="normal"><a href="#__codelineno-19-53">53</a></span>
<span class="normal"><a href="#__codelineno-19-54">54</a></span>
<span class="normal"><a href="#__codelineno-19-55">55</a></span>
<span class="normal"><a href="#__codelineno-19-56">56</a></span>
<span class="normal"><a href="#__codelineno-19-57">57</a></span>
<span class="normal"><a href="#__codelineno-19-58">58</a></span>
<span class="normal"><a href="#__codelineno-19-59">59</a></span>
<span class="normal"><a href="#__codelineno-19-60">60</a></span>
<span class="normal"><a href="#__codelineno-19-61">61</a></span>
<span class="normal"><a href="#__codelineno-19-62">62</a></span>
<span class="normal"><a href="#__codelineno-19-63">63</a></span>
<span class="normal"><a href="#__codelineno-19-64">64</a></span>
<span class="normal"><a href="#__codelineno-19-65">65</a></span>
<span class="normal"><a href="#__codelineno-19-66">66</a></span>
<span class="normal"><a href="#__codelineno-19-67">67</a></span>
<span class="normal"><a href="#__codelineno-19-68">68</a></span>
<span class="normal"><a href="#__codelineno-19-69">69</a></span>
<span class="normal"><a href="#__codelineno-19-70">70</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Laragon</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>    <span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://fonts.googleapis.com/css?family=Karla:400&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>    <span class="o">&lt;</span><span class="n">style</span><span class="o">&gt;</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>        <span class="n">html</span><span class="p">,</span> <span class="n">body</span> <span class="p">{</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>            <span class="n">height</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>        <span class="p">}</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>        <span class="n">body</span> <span class="p">{</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a>            <span class="n">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a>            <span class="n">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a>            <span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a>            <span class="n">display</span><span class="p">:</span> <span class="n">table</span><span class="p">;</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a>            <span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="mi">100</span><span class="p">;</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a>            <span class="n">font</span><span class="o">-</span><span class="n">family</span><span class="p">:</span> <span class="s1">&#39;Karla&#39;</span><span class="p">;</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a>        <span class="p">}</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a>        <span class="o">.</span><span class="n">container</span> <span class="p">{</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a>            <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a>            <span class="n">display</span><span class="p">:</span> <span class="n">table</span><span class="o">-</span><span class="n">cell</span><span class="p">;</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a>            <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">middle</span><span class="p">;</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a>        <span class="p">}</span>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a>        <span class="o">.</span><span class="n">content</span> <span class="p">{</span>
<a id="__codelineno-19-29" name="__codelineno-19-29"></a>            <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
<a id="__codelineno-19-30" name="__codelineno-19-30"></a>            <span class="n">display</span><span class="p">:</span> <span class="n">inline</span><span class="o">-</span><span class="n">block</span><span class="p">;</span>
<a id="__codelineno-19-31" name="__codelineno-19-31"></a>        <span class="p">}</span>
<a id="__codelineno-19-32" name="__codelineno-19-32"></a>
<a id="__codelineno-19-33" name="__codelineno-19-33"></a>        <span class="o">.</span><span class="n">title</span> <span class="p">{</span>
<a id="__codelineno-19-34" name="__codelineno-19-34"></a>            <span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">96</span><span class="n">px</span><span class="p">;</span>
<a id="__codelineno-19-35" name="__codelineno-19-35"></a>        <span class="p">}</span>
<a id="__codelineno-19-36" name="__codelineno-19-36"></a>
<a id="__codelineno-19-37" name="__codelineno-19-37"></a>        <span class="o">.</span><span class="n">opt</span> <span class="p">{</span>
<a id="__codelineno-19-38" name="__codelineno-19-38"></a>            <span class="n">margin</span><span class="o">-</span><span class="n">top</span><span class="p">:</span> <span class="mi">30</span><span class="n">px</span><span class="p">;</span>
<a id="__codelineno-19-39" name="__codelineno-19-39"></a>        <span class="p">}</span>
<a id="__codelineno-19-40" name="__codelineno-19-40"></a>
<a id="__codelineno-19-41" name="__codelineno-19-41"></a>            <span class="o">.</span><span class="n">opt</span> <span class="n">a</span> <span class="p">{</span>
<a id="__codelineno-19-42" name="__codelineno-19-42"></a>                <span class="n">text</span><span class="o">-</span><span class="n">decoration</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a id="__codelineno-19-43" name="__codelineno-19-43"></a>                <span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">150</span><span class="o">%</span><span class="p">;</span>
<a id="__codelineno-19-44" name="__codelineno-19-44"></a>            <span class="p">}</span>
<a id="__codelineno-19-45" name="__codelineno-19-45"></a>
<a id="__codelineno-19-46" name="__codelineno-19-46"></a>        <span class="n">a</span><span class="p">:</span><span class="n">hover</span> <span class="p">{</span>
<a id="__codelineno-19-47" name="__codelineno-19-47"></a>            <span class="n">color</span><span class="p">:</span> <span class="n">red</span><span class="p">;</span>
<a id="__codelineno-19-48" name="__codelineno-19-48"></a>        <span class="p">}</span>
<a id="__codelineno-19-49" name="__codelineno-19-49"></a>    <span class="o">&lt;/</span><span class="n">style</span><span class="o">&gt;</span>
<a id="__codelineno-19-50" name="__codelineno-19-50"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-19-51" name="__codelineno-19-51"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-19-52" name="__codelineno-19-52"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-19-53" name="__codelineno-19-53"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-19-54" name="__codelineno-19-54"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;title&quot;</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Laragon&quot;</span><span class="o">&gt;</span><span class="n">Laragon</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-19-55" name="__codelineno-19-55"></a>
<a id="__codelineno-19-56" name="__codelineno-19-56"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-19-57" name="__codelineno-19-57"></a>                <span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-19-58" name="__codelineno-19-58"></a>                <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.35</span> <span class="p">(</span><span class="n">Win64</span><span class="p">)</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">b</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-19-59" name="__codelineno-19-59"></a>                <span class="n">PHP</span> <span class="n">version</span><span class="p">:</span> <span class="mf">7.2.19</span>   <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;phpinfo()&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/?q=info&quot;</span><span class="o">&gt;</span><span class="n">info</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-19-60" name="__codelineno-19-60"></a>                <span class="n">Document</span> <span class="n">Root</span><span class="p">:</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">MyPrograms</span><span class="o">/</span><span class="n">laragon</span><span class="o">/</span><span class="n">www</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-19-61" name="__codelineno-19-61"></a>
<a id="__codelineno-19-62" name="__codelineno-19-62"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-19-63" name="__codelineno-19-63"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;opt&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-19-64" name="__codelineno-19-64"></a>                <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Getting Started&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://laragon.org/docs&quot;</span><span class="o">&gt;</span><span class="n">Getting</span> <span class="n">Started</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-19-65" name="__codelineno-19-65"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-19-66" name="__codelineno-19-66"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-19-67" name="__codelineno-19-67"></a>
<a id="__codelineno-19-68" name="__codelineno-19-68"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-19-69" name="__codelineno-19-69"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-19-70" name="__codelineno-19-70"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Maintenant demandons l’URL <strong>[http://localhost:80]</strong> avec notre client TCP :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">80</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">51541</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">80</span><span class="p">]</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1, nous nous connectons au port 80 du serveur localhost. C’est là qu’opère le serveur web de Laragon ;
Nous tapons maintenant les commandes que nous avons découvertes dans le paragraphe précédent :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span>
<span class="normal"><a href="#__codelineno-21-21">21</a></span>
<span class="normal"><a href="#__codelineno-21-22">22</a></span>
<span class="normal"><a href="#__codelineno-21-23">23</a></span>
<span class="normal"><a href="#__codelineno-21-24">24</a></span>
<span class="normal"><a href="#__codelineno-21-25">25</a></span>
<span class="normal"><a href="#__codelineno-21-26">26</a></span>
<span class="normal"><a href="#__codelineno-21-27">27</a></span>
<span class="normal"><a href="#__codelineno-21-28">28</a></span>
<span class="normal"><a href="#__codelineno-21-29">29</a></span>
<span class="normal"><a href="#__codelineno-21-30">30</a></span>
<span class="normal"><a href="#__codelineno-21-31">31</a></span>
<span class="normal"><a href="#__codelineno-21-32">32</a></span>
<span class="normal"><a href="#__codelineno-21-33">33</a></span>
<span class="normal"><a href="#__codelineno-21-34">34</a></span>
<span class="normal"><a href="#__codelineno-21-35">35</a></span>
<span class="normal"><a href="#__codelineno-21-36">36</a></span>
<span class="normal"><a href="#__codelineno-21-37">37</a></span>
<span class="normal"><a href="#__codelineno-21-38">38</a></span>
<span class="normal"><a href="#__codelineno-21-39">39</a></span>
<span class="normal"><a href="#__codelineno-21-40">40</a></span>
<span class="normal"><a href="#__codelineno-21-41">41</a></span>
<span class="normal"><a href="#__codelineno-21-42">42</a></span>
<span class="normal"><a href="#__codelineno-21-43">43</a></span>
<span class="normal"><a href="#__codelineno-21-44">44</a></span>
<span class="normal"><a href="#__codelineno-21-45">45</a></span>
<span class="normal"><a href="#__codelineno-21-46">46</a></span>
<span class="normal"><a href="#__codelineno-21-47">47</a></span>
<span class="normal"><a href="#__codelineno-21-48">48</a></span>
<span class="normal"><a href="#__codelineno-21-49">49</a></span>
<span class="normal"><a href="#__codelineno-21-50">50</a></span>
<span class="normal"><a href="#__codelineno-21-51">51</a></span>
<span class="normal"><a href="#__codelineno-21-52">52</a></span>
<span class="normal"><a href="#__codelineno-21-53">53</a></span>
<span class="normal"><a href="#__codelineno-21-54">54</a></span>
<span class="normal"><a href="#__codelineno-21-55">55</a></span>
<span class="normal"><a href="#__codelineno-21-56">56</a></span>
<span class="normal"><a href="#__codelineno-21-57">57</a></span>
<span class="normal"><a href="#__codelineno-21-58">58</a></span>
<span class="normal"><a href="#__codelineno-21-59">59</a></span>
<span class="normal"><a href="#__codelineno-21-60">60</a></span>
<span class="normal"><a href="#__codelineno-21-61">61</a></span>
<span class="normal"><a href="#__codelineno-21-62">62</a></span>
<span class="normal"><a href="#__codelineno-21-63">63</a></span>
<span class="normal"><a href="#__codelineno-21-64">64</a></span>
<span class="normal"><a href="#__codelineno-21-65">65</a></span>
<span class="normal"><a href="#__codelineno-21-66">66</a></span>
<span class="normal"><a href="#__codelineno-21-67">67</a></span>
<span class="normal"><a href="#__codelineno-21-68">68</a></span>
<span class="normal"><a href="#__codelineno-21-69">69</a></span>
<span class="normal"><a href="#__codelineno-21-70">70</a></span>
<span class="normal"><a href="#__codelineno-21-71">71</a></span>
<span class="normal"><a href="#__codelineno-21-72">72</a></span>
<span class="normal"><a href="#__codelineno-21-73">73</a></span>
<span class="normal"><a href="#__codelineno-21-74">74</a></span>
<span class="normal"><a href="#__codelineno-21-75">75</a></span>
<span class="normal"><a href="#__codelineno-21-76">76</a></span>
<span class="normal"><a href="#__codelineno-21-77">77</a></span>
<span class="normal"><a href="#__codelineno-21-78">78</a></span>
<span class="normal"><a href="#__codelineno-21-79">79</a></span>
<span class="normal"><a href="#__codelineno-21-80">80</a></span>
<span class="normal"><a href="#__codelineno-21-81">81</a></span>
<span class="normal"><a href="#__codelineno-21-82">82</a></span>
<span class="normal"><a href="#__codelineno-21-83">83</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">80</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">51544</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">80</span><span class="p">]</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">80</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span><span class="p">]</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">12</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">14</span> <span class="n">GMT</span><span class="p">]</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.35</span> <span class="p">(</span><span class="n">Win64</span><span class="p">)</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">b</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span><span class="p">]</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">X</span><span class="o">-</span><span class="n">Powered</span><span class="o">-</span><span class="n">By</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span><span class="p">]</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">1776</span><span class="p">]</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="o">&lt;--</span> <span class="p">[</span>    <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Laragon</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://fonts.googleapis.com/css?family=Karla:400&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;</span><span class="n">style</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="n">html</span><span class="p">,</span> <span class="n">body</span> <span class="p">{]</span>
<a id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">height</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;]</span>
<a id="__codelineno-21-24" name="__codelineno-21-24"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-21-25" name="__codelineno-21-25"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-26" name="__codelineno-21-26"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="n">body</span> <span class="p">{]</span>
<a id="__codelineno-21-27" name="__codelineno-21-27"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;]</span>
<a id="__codelineno-21-28" name="__codelineno-21-28"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;]</span>
<a id="__codelineno-21-29" name="__codelineno-21-29"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;]</span>
<a id="__codelineno-21-30" name="__codelineno-21-30"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">display</span><span class="p">:</span> <span class="n">table</span><span class="p">;]</span>
<a id="__codelineno-21-31" name="__codelineno-21-31"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="mi">100</span><span class="p">;]</span>
<a id="__codelineno-21-32" name="__codelineno-21-32"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">font</span><span class="o">-</span><span class="n">family</span><span class="p">:</span> <span class="s1">&#39;Karla&#39;</span><span class="p">;]</span>
<a id="__codelineno-21-33" name="__codelineno-21-33"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-21-34" name="__codelineno-21-34"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-35" name="__codelineno-21-35"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">.</span><span class="n">container</span> <span class="p">{]</span>
<a id="__codelineno-21-36" name="__codelineno-21-36"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;]</span>
<a id="__codelineno-21-37" name="__codelineno-21-37"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">display</span><span class="p">:</span> <span class="n">table</span><span class="o">-</span><span class="n">cell</span><span class="p">;]</span>
<a id="__codelineno-21-38" name="__codelineno-21-38"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">middle</span><span class="p">;]</span>
<a id="__codelineno-21-39" name="__codelineno-21-39"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-21-40" name="__codelineno-21-40"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-41" name="__codelineno-21-41"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">.</span><span class="n">content</span> <span class="p">{]</span>
<a id="__codelineno-21-42" name="__codelineno-21-42"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;]</span>
<a id="__codelineno-21-43" name="__codelineno-21-43"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">display</span><span class="p">:</span> <span class="n">inline</span><span class="o">-</span><span class="n">block</span><span class="p">;]</span>
<a id="__codelineno-21-44" name="__codelineno-21-44"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-21-45" name="__codelineno-21-45"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-46" name="__codelineno-21-46"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">.</span><span class="n">title</span> <span class="p">{]</span>
<a id="__codelineno-21-47" name="__codelineno-21-47"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">96</span><span class="n">px</span><span class="p">;]</span>
<a id="__codelineno-21-48" name="__codelineno-21-48"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-21-49" name="__codelineno-21-49"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-50" name="__codelineno-21-50"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">.</span><span class="n">opt</span> <span class="p">{]</span>
<a id="__codelineno-21-51" name="__codelineno-21-51"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">margin</span><span class="o">-</span><span class="n">top</span><span class="p">:</span> <span class="mi">30</span><span class="n">px</span><span class="p">;]</span>
<a id="__codelineno-21-52" name="__codelineno-21-52"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-21-53" name="__codelineno-21-53"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-54" name="__codelineno-21-54"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">.</span><span class="n">opt</span> <span class="n">a</span> <span class="p">{]</span>
<a id="__codelineno-21-55" name="__codelineno-21-55"></a><span class="o">&lt;--</span> <span class="p">[</span>              <span class="n">text</span><span class="o">-</span><span class="n">decoration</span><span class="p">:</span> <span class="n">none</span><span class="p">;]</span>
<a id="__codelineno-21-56" name="__codelineno-21-56"></a><span class="o">&lt;--</span> <span class="p">[</span>              <span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">150</span><span class="o">%</span><span class="p">;]</span>
<a id="__codelineno-21-57" name="__codelineno-21-57"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-21-58" name="__codelineno-21-58"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">]</span>
<a id="__codelineno-21-59" name="__codelineno-21-59"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="n">a</span><span class="p">:</span><span class="n">hover</span> <span class="p">{]</span>
<a id="__codelineno-21-60" name="__codelineno-21-60"></a><span class="o">&lt;--</span> <span class="p">[</span>              <span class="n">color</span><span class="p">:</span> <span class="n">red</span><span class="p">;]</span>
<a id="__codelineno-21-61" name="__codelineno-21-61"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-21-62" name="__codelineno-21-62"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;/</span><span class="n">style</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-63" name="__codelineno-21-63"></a><span class="o">&lt;--</span> <span class="p">[</span>    <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-64" name="__codelineno-21-64"></a><span class="o">&lt;--</span> <span class="p">[</span>    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-65" name="__codelineno-21-65"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-66" name="__codelineno-21-66"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-67" name="__codelineno-21-67"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;title&quot;</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Laragon&quot;</span><span class="o">&gt;</span><span class="n">Laragon</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-68" name="__codelineno-21-68"></a><span class="o">&lt;--</span> <span class="p">[</span>     <span class="p">]</span>
<a id="__codelineno-21-69" name="__codelineno-21-69"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="p">]</span>
<a id="__codelineno-21-70" name="__codelineno-21-70"></a><span class="o">&lt;--</span> <span class="p">[</span>                      <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.35</span> <span class="p">(</span><span class="n">Win64</span><span class="p">)</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">b</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="p">]</span>
<a id="__codelineno-21-71" name="__codelineno-21-71"></a><span class="o">&lt;--</span> <span class="p">[</span>                      <span class="n">PHP</span> <span class="n">version</span><span class="p">:</span> <span class="mf">7.2.19</span>   <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;phpinfo()&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/?q=info&quot;</span><span class="o">&gt;</span><span class="n">info</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="p">]</span>
<a id="__codelineno-21-72" name="__codelineno-21-72"></a><span class="o">&lt;--</span> <span class="p">[</span>                      <span class="n">Document</span> <span class="n">Root</span><span class="p">:</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">MyPrograms</span><span class="o">/</span><span class="n">laragon</span><span class="o">/</span><span class="n">www</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="p">]</span>
<a id="__codelineno-21-73" name="__codelineno-21-73"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-74" name="__codelineno-21-74"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-75" name="__codelineno-21-75"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;opt&quot;</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-76" name="__codelineno-21-76"></a><span class="o">&lt;--</span> <span class="p">[</span>                  <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Getting Started&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://laragon.org/docs&quot;</span><span class="o">&gt;</span><span class="n">Getting</span> <span class="n">Started</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-77" name="__codelineno-21-77"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-78" name="__codelineno-21-78"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-79" name="__codelineno-21-79"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-21-80" name="__codelineno-21-80"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-81" name="__codelineno-21-81"></a><span class="o">&lt;--</span> <span class="p">[</span>    <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-82" name="__codelineno-21-82"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-21-83" name="__codelineno-21-83"></a><span class="n">Perte</span> <span class="n">de</span> <span class="n">la</span> <span class="n">connexion</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span><span class="o">...</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 4, la commande <strong>[GET]</strong>. On demande la racine / du serveur web ;</li>
<li>ligne 5, la commande <strong>[Host]</strong> ;</li>
<li>ce sont les deux seules commandes indispensables. Pour les autres commandes, le serveur web prendra des valeurs par défaut ;</li>
<li>ligne 6, la ligne vide qui doit terminer les commandes du client ;</li>
<li>dessous la ligne 6, vient la réponse du serveur web ;</li>
<li>lignes 7-12 : les entêtes HTTP de la réponse du serveur ;</li>
<li>ligne 13 : la ligne vide qui signale la fin des entêtes http ;</li>
<li>lignes 14-82, le document HTML demandé ligne 4 ;
Nous chargeons le fichier de logs <strong>[localhost-80.txt]</strong> :</li>
</ul>
<p><img src="images/100000000000016C0000019E18C10C23.png" style="width:4.211cm;height:4.781cm;" alt="Image" /></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span>
<span class="normal"><a href="#__codelineno-22-27">27</a></span>
<span class="normal"><a href="#__codelineno-22-28">28</a></span>
<span class="normal"><a href="#__codelineno-22-29">29</a></span>
<span class="normal"><a href="#__codelineno-22-30">30</a></span>
<span class="normal"><a href="#__codelineno-22-31">31</a></span>
<span class="normal"><a href="#__codelineno-22-32">32</a></span>
<span class="normal"><a href="#__codelineno-22-33">33</a></span>
<span class="normal"><a href="#__codelineno-22-34">34</a></span>
<span class="normal"><a href="#__codelineno-22-35">35</a></span>
<span class="normal"><a href="#__codelineno-22-36">36</a></span>
<span class="normal"><a href="#__codelineno-22-37">37</a></span>
<span class="normal"><a href="#__codelineno-22-38">38</a></span>
<span class="normal"><a href="#__codelineno-22-39">39</a></span>
<span class="normal"><a href="#__codelineno-22-40">40</a></span>
<span class="normal"><a href="#__codelineno-22-41">41</a></span>
<span class="normal"><a href="#__codelineno-22-42">42</a></span>
<span class="normal"><a href="#__codelineno-22-43">43</a></span>
<span class="normal"><a href="#__codelineno-22-44">44</a></span>
<span class="normal"><a href="#__codelineno-22-45">45</a></span>
<span class="normal"><a href="#__codelineno-22-46">46</a></span>
<span class="normal"><a href="#__codelineno-22-47">47</a></span>
<span class="normal"><a href="#__codelineno-22-48">48</a></span>
<span class="normal"><a href="#__codelineno-22-49">49</a></span>
<span class="normal"><a href="#__codelineno-22-50">50</a></span>
<span class="normal"><a href="#__codelineno-22-51">51</a></span>
<span class="normal"><a href="#__codelineno-22-52">52</a></span>
<span class="normal"><a href="#__codelineno-22-53">53</a></span>
<span class="normal"><a href="#__codelineno-22-54">54</a></span>
<span class="normal"><a href="#__codelineno-22-55">55</a></span>
<span class="normal"><a href="#__codelineno-22-56">56</a></span>
<span class="normal"><a href="#__codelineno-22-57">57</a></span>
<span class="normal"><a href="#__codelineno-22-58">58</a></span>
<span class="normal"><a href="#__codelineno-22-59">59</a></span>
<span class="normal"><a href="#__codelineno-22-60">60</a></span>
<span class="normal"><a href="#__codelineno-22-61">61</a></span>
<span class="normal"><a href="#__codelineno-22-62">62</a></span>
<span class="normal"><a href="#__codelineno-22-63">63</a></span>
<span class="normal"><a href="#__codelineno-22-64">64</a></span>
<span class="normal"><a href="#__codelineno-22-65">65</a></span>
<span class="normal"><a href="#__codelineno-22-66">66</a></span>
<span class="normal"><a href="#__codelineno-22-67">67</a></span>
<span class="normal"><a href="#__codelineno-22-68">68</a></span>
<span class="normal"><a href="#__codelineno-22-69">69</a></span>
<span class="normal"><a href="#__codelineno-22-70">70</a></span>
<span class="normal"><a href="#__codelineno-22-71">71</a></span>
<span class="normal"><a href="#__codelineno-22-72">72</a></span>
<span class="normal"><a href="#__codelineno-22-73">73</a></span>
<span class="normal"><a href="#__codelineno-22-74">74</a></span>
<span class="normal"><a href="#__codelineno-22-75">75</a></span>
<span class="normal"><a href="#__codelineno-22-76">76</a></span>
<span class="normal"><a href="#__codelineno-22-77">77</a></span>
<span class="normal"><a href="#__codelineno-22-78">78</a></span>
<span class="normal"><a href="#__codelineno-22-79">79</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span><span class="p">]</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">80</span><span class="p">]</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="o">--&gt;</span> <span class="p">[]</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span><span class="p">]</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">12</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">14</span> <span class="n">GMT</span><span class="p">]</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.35</span> <span class="p">(</span><span class="n">Win64</span><span class="p">)</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">b</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span><span class="p">]</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">X</span><span class="o">-</span><span class="n">Powered</span><span class="o">-</span><span class="n">By</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span><span class="p">]</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">1776</span><span class="p">]</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="o">&lt;--</span> <span class="p">[</span>    <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Laragon</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://fonts.googleapis.com/css?family=Karla:400&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;</span><span class="n">style</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="n">html</span><span class="p">,</span> <span class="n">body</span> <span class="p">{]</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">height</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;]</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="n">body</span> <span class="p">{]</span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;]</span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;]</span>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;]</span>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">display</span><span class="p">:</span> <span class="n">table</span><span class="p">;]</span>
<a id="__codelineno-22-28" name="__codelineno-22-28"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="mi">100</span><span class="p">;]</span>
<a id="__codelineno-22-29" name="__codelineno-22-29"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">font</span><span class="o">-</span><span class="n">family</span><span class="p">:</span> <span class="s1">&#39;Karla&#39;</span><span class="p">;]</span>
<a id="__codelineno-22-30" name="__codelineno-22-30"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-22-31" name="__codelineno-22-31"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-32" name="__codelineno-22-32"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">.</span><span class="n">container</span> <span class="p">{]</span>
<a id="__codelineno-22-33" name="__codelineno-22-33"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;]</span>
<a id="__codelineno-22-34" name="__codelineno-22-34"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">display</span><span class="p">:</span> <span class="n">table</span><span class="o">-</span><span class="n">cell</span><span class="p">;]</span>
<a id="__codelineno-22-35" name="__codelineno-22-35"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">middle</span><span class="p">;]</span>
<a id="__codelineno-22-36" name="__codelineno-22-36"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-22-37" name="__codelineno-22-37"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-38" name="__codelineno-22-38"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">.</span><span class="n">content</span> <span class="p">{]</span>
<a id="__codelineno-22-39" name="__codelineno-22-39"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;]</span>
<a id="__codelineno-22-40" name="__codelineno-22-40"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">display</span><span class="p">:</span> <span class="n">inline</span><span class="o">-</span><span class="n">block</span><span class="p">;]</span>
<a id="__codelineno-22-41" name="__codelineno-22-41"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-22-42" name="__codelineno-22-42"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-43" name="__codelineno-22-43"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">.</span><span class="n">title</span> <span class="p">{]</span>
<a id="__codelineno-22-44" name="__codelineno-22-44"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">96</span><span class="n">px</span><span class="p">;]</span>
<a id="__codelineno-22-45" name="__codelineno-22-45"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-22-46" name="__codelineno-22-46"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-47" name="__codelineno-22-47"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">.</span><span class="n">opt</span> <span class="p">{]</span>
<a id="__codelineno-22-48" name="__codelineno-22-48"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="n">margin</span><span class="o">-</span><span class="n">top</span><span class="p">:</span> <span class="mi">30</span><span class="n">px</span><span class="p">;]</span>
<a id="__codelineno-22-49" name="__codelineno-22-49"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-22-50" name="__codelineno-22-50"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-51" name="__codelineno-22-51"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">.</span><span class="n">opt</span> <span class="n">a</span> <span class="p">{]</span>
<a id="__codelineno-22-52" name="__codelineno-22-52"></a><span class="o">&lt;--</span> <span class="p">[</span>              <span class="n">text</span><span class="o">-</span><span class="n">decoration</span><span class="p">:</span> <span class="n">none</span><span class="p">;]</span>
<a id="__codelineno-22-53" name="__codelineno-22-53"></a><span class="o">&lt;--</span> <span class="p">[</span>              <span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">150</span><span class="o">%</span><span class="p">;]</span>
<a id="__codelineno-22-54" name="__codelineno-22-54"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-22-55" name="__codelineno-22-55"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">]</span>
<a id="__codelineno-22-56" name="__codelineno-22-56"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="n">a</span><span class="p">:</span><span class="n">hover</span> <span class="p">{]</span>
<a id="__codelineno-22-57" name="__codelineno-22-57"></a><span class="o">&lt;--</span> <span class="p">[</span>              <span class="n">color</span><span class="p">:</span> <span class="n">red</span><span class="p">;]</span>
<a id="__codelineno-22-58" name="__codelineno-22-58"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="p">}]</span>
<a id="__codelineno-22-59" name="__codelineno-22-59"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;/</span><span class="n">style</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-60" name="__codelineno-22-60"></a><span class="o">&lt;--</span> <span class="p">[</span>    <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-61" name="__codelineno-22-61"></a><span class="o">&lt;--</span> <span class="p">[</span>    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-62" name="__codelineno-22-62"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-63" name="__codelineno-22-63"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-64" name="__codelineno-22-64"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;title&quot;</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Laragon&quot;</span><span class="o">&gt;</span><span class="n">Laragon</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-65" name="__codelineno-22-65"></a><span class="o">&lt;--</span> <span class="p">[</span>     <span class="p">]</span>
<a id="__codelineno-22-66" name="__codelineno-22-66"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="p">]</span>
<a id="__codelineno-22-67" name="__codelineno-22-67"></a><span class="o">&lt;--</span> <span class="p">[</span>                      <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.35</span> <span class="p">(</span><span class="n">Win64</span><span class="p">)</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">b</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="p">]</span>
<a id="__codelineno-22-68" name="__codelineno-22-68"></a><span class="o">&lt;--</span> <span class="p">[</span>                      <span class="n">PHP</span> <span class="n">version</span><span class="p">:</span> <span class="mf">7.2.19</span>   <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;phpinfo()&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/?q=info&quot;</span><span class="o">&gt;</span><span class="n">info</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="p">]</span>
<a id="__codelineno-22-69" name="__codelineno-22-69"></a><span class="o">&lt;--</span> <span class="p">[</span>                      <span class="n">Document</span> <span class="n">Root</span><span class="p">:</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">MyPrograms</span><span class="o">/</span><span class="n">laragon</span><span class="o">/</span><span class="n">www</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span><span class="p">]</span>
<a id="__codelineno-22-70" name="__codelineno-22-70"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-71" name="__codelineno-22-71"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-72" name="__codelineno-22-72"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;opt&quot;</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-73" name="__codelineno-22-73"></a><span class="o">&lt;--</span> <span class="p">[</span>                  <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Getting Started&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://laragon.org/docs&quot;</span><span class="o">&gt;</span><span class="n">Getting</span> <span class="n">Started</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-74" name="__codelineno-22-74"></a><span class="o">&lt;--</span> <span class="p">[</span>                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-75" name="__codelineno-22-75"></a><span class="o">&lt;--</span> <span class="p">[</span>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-76" name="__codelineno-22-76"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-22-77" name="__codelineno-22-77"></a><span class="o">&lt;--</span> <span class="p">[</span>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-78" name="__codelineno-22-78"></a><span class="o">&lt;--</span> <span class="p">[</span>    <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-22-79" name="__codelineno-22-79"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 11-79 : le document HTML reçu. Dans l’exemple précédent, Firefox avait reçu le même ;
Nous avons désormais les bases pour programmer un client TCP qui demanderait une URL.</li>
</ul>
<h3 id="2143-exemple-3">21.4.3. Exemple 3</h3>
<p><img src="images/10000000000001340000014D64AA422E.png" style="width:3.56cm;height:3.841cm;" alt="Image" /></p>
<p>Le script <strong>[http/01/main.py]</strong> est un client HTTP configuré par le fichier <strong>[config.py]</strong>. Le contenu de celui-ci est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span>
<span class="normal"><a href="#__codelineno-23-44">44</a></span>
<span class="normal"><a href="#__codelineno-23-45">45</a></span>
<span class="normal"><a href="#__codelineno-23-46">46</a></span>
<span class="normal"><a href="#__codelineno-23-47">47</a></span>
<span class="normal"><a href="#__codelineno-23-48">48</a></span>
<span class="normal"><a href="#__codelineno-23-49">49</a></span>
<span class="normal"><a href="#__codelineno-23-50">50</a></span>
<span class="normal"><a href="#__codelineno-23-51">51</a></span>
<span class="normal"><a href="#__codelineno-23-52">52</a></span>
<span class="normal"><a href="#__codelineno-23-53">53</a></span>
<span class="normal"><a href="#__codelineno-23-54">54</a></span>
<span class="normal"><a href="#__codelineno-23-55">55</a></span>
<span class="normal"><a href="#__codelineno-23-56">56</a></span>
<span class="normal"><a href="#__codelineno-23-57">57</a></span>
<span class="normal"><a href="#__codelineno-23-58">58</a></span>
<span class="normal"><a href="#__codelineno-23-59">59</a></span>
<span class="normal"><a href="#__codelineno-23-60">60</a></span>
<span class="normal"><a href="#__codelineno-23-61">61</a></span>
<span class="normal"><a href="#__codelineno-23-62">62</a></span>
<span class="normal"><a href="#__codelineno-23-63">63</a></span>
<span class="normal"><a href="#__codelineno-23-64">64</a></span>
<span class="normal"><a href="#__codelineno-23-65">65</a></span>
<span class="normal"><a href="#__codelineno-23-66">66</a></span>
<span class="normal"><a href="#__codelineno-23-67">67</a></span>
<span class="normal"><a href="#__codelineno-23-68">68</a></span>
<span class="normal"><a href="#__codelineno-23-69">69</a></span>
<span class="normal"><a href="#__codelineno-23-70">70</a></span>
<span class="normal"><a href="#__codelineno-23-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">():</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>    <span class="c1"># URLs à interroger</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>        <span class="c1"># site : nom du site auquel se connecter</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>        <span class="c1"># port : port du service web</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>        <span class="c1"># GET : URL demandée</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>        <span class="c1"># headers : entêtes HTTP à envoyer dans la requête</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>        <span class="c1"># endOfLine : marque de fin de ligne dans les entêtes HTTP envoyés</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>        <span class="c1"># encoding : encodage de la réponse du serveur</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>        <span class="c1"># timeout : temps d&#39;attente maximum d&#39;une réponse du serveur</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>        <span class="p">{</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>            <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a>            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>            <span class="s2">&quot;GET&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a>            <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>                <span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost:80&quot;</span><span class="p">,</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;client Python&quot;</span><span class="p">,</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/HTML&quot;</span><span class="p">,</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a>                <span class="s2">&quot;Accept-Language&quot;</span><span class="p">:</span> <span class="s2">&quot;fr&quot;</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a>            <span class="p">},</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a>            <span class="s2">&quot;endOfLine&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a>            <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a>            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mf">0.5</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a>        <span class="p">},</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a>        <span class="p">{</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a>            <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;sergetahe.com&quot;</span><span class="p">,</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a>            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a>            <span class="s2">&quot;GET&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a>            <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a>                <span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="s2">&quot;sergetahe.com:80&quot;</span><span class="p">,</span>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a>                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;client Python&quot;</span><span class="p">,</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a>                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/HTML&quot;</span><span class="p">,</span>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>                <span class="s2">&quot;Accept-Language&quot;</span><span class="p">:</span> <span class="s2">&quot;fr&quot;</span>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a>            <span class="p">},</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a>            <span class="s2">&quot;endOfLine&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a>            <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a>            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">5</span>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a>        <span class="p">},</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a>        <span class="p">{</span>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a>            <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;tahe.developpez.com&quot;</span><span class="p">,</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a>            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a>            <span class="s2">&quot;GET&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a>            <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-23-44" name="__codelineno-23-44"></a>                <span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="s2">&quot;tahe.developpez.com:443&quot;</span><span class="p">,</span>
<a id="__codelineno-23-45" name="__codelineno-23-45"></a>                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;client Python&quot;</span><span class="p">,</span>
<a id="__codelineno-23-46" name="__codelineno-23-46"></a>                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/HTML&quot;</span><span class="p">,</span>
<a id="__codelineno-23-47" name="__codelineno-23-47"></a>                <span class="s2">&quot;Accept-Language&quot;</span><span class="p">:</span> <span class="s2">&quot;fr&quot;</span>
<a id="__codelineno-23-48" name="__codelineno-23-48"></a>            <span class="p">},</span>
<a id="__codelineno-23-49" name="__codelineno-23-49"></a>            <span class="s2">&quot;endOfLine&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-23-50" name="__codelineno-23-50"></a>            <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
<a id="__codelineno-23-51" name="__codelineno-23-51"></a>            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">2</span>
<a id="__codelineno-23-52" name="__codelineno-23-52"></a>        <span class="p">},</span>
<a id="__codelineno-23-53" name="__codelineno-23-53"></a>        <span class="p">{</span>
<a id="__codelineno-23-54" name="__codelineno-23-54"></a>            <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;www.sergetahe.com&quot;</span><span class="p">,</span>
<a id="__codelineno-23-55" name="__codelineno-23-55"></a>            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
<a id="__codelineno-23-56" name="__codelineno-23-56"></a>            <span class="s2">&quot;GET&quot;</span><span class="p">:</span> <span class="s2">&quot;/cours-tutoriels-de-programmation/&quot;</span><span class="p">,</span>
<a id="__codelineno-23-57" name="__codelineno-23-57"></a>            <span class="s2">&quot;headers&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-23-58" name="__codelineno-23-58"></a>                <span class="s2">&quot;Host&quot;</span><span class="p">:</span> <span class="s2">&quot;sergetahe.com:80&quot;</span><span class="p">,</span>
<a id="__codelineno-23-59" name="__codelineno-23-59"></a>                <span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;client Python&quot;</span><span class="p">,</span>
<a id="__codelineno-23-60" name="__codelineno-23-60"></a>                <span class="s2">&quot;Accept&quot;</span><span class="p">:</span> <span class="s2">&quot;text/HTML&quot;</span><span class="p">,</span>
<a id="__codelineno-23-61" name="__codelineno-23-61"></a>                <span class="s2">&quot;Accept-Language&quot;</span><span class="p">:</span> <span class="s2">&quot;fr&quot;</span>
<a id="__codelineno-23-62" name="__codelineno-23-62"></a>            <span class="p">},</span>
<a id="__codelineno-23-63" name="__codelineno-23-63"></a>            <span class="s2">&quot;endOfLine&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-23-64" name="__codelineno-23-64"></a>            <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
<a id="__codelineno-23-65" name="__codelineno-23-65"></a>            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">5</span>
<a id="__codelineno-23-66" name="__codelineno-23-66"></a>        <span class="p">}</span>
<a id="__codelineno-23-67" name="__codelineno-23-67"></a>    <span class="p">]</span>
<a id="__codelineno-23-68" name="__codelineno-23-68"></a>    <span class="c1"># on rend la configuration</span>
<a id="__codelineno-23-69" name="__codelineno-23-69"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-23-70" name="__codelineno-23-70"></a>        <span class="s2">&quot;urls&quot;</span><span class="p">:</span> <span class="n">urls</span>
<a id="__codelineno-23-71" name="__codelineno-23-71"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>le contenu du fichier est une liste d’URL, chaque élément de la liste étant un dictionnaire. Ce dictionnaire indique comment se connecter au sité désigné par la clé <strong>[site]</strong> ;</li>
<li>lignes 4-10 : la signification des clés de chaque dictionnaire ;
Le script <strong>[http/01/main.py]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">  1</a></span>
<span class="normal"><a href="#__codelineno-24-2">  2</a></span>
<span class="normal"><a href="#__codelineno-24-3">  3</a></span>
<span class="normal"><a href="#__codelineno-24-4">  4</a></span>
<span class="normal"><a href="#__codelineno-24-5">  5</a></span>
<span class="normal"><a href="#__codelineno-24-6">  6</a></span>
<span class="normal"><a href="#__codelineno-24-7">  7</a></span>
<span class="normal"><a href="#__codelineno-24-8">  8</a></span>
<span class="normal"><a href="#__codelineno-24-9">  9</a></span>
<span class="normal"><a href="#__codelineno-24-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-24-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-24-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-24-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-24-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-24-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-24-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-24-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-24-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-24-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-24-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-24-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-24-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-24-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-24-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-24-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-24-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-24-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-24-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-24-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-24-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-24-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-24-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-24-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-24-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-24-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-24-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-24-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-24-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-24-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-24-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-24-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-24-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-24-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-24-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-24-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-24-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-24-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-24-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-24-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-24-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-24-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-24-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-24-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-24-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-24-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-24-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-24-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-24-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-24-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-24-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-24-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-24-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-24-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-24-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-24-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-24-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-24-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-24-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-24-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-24-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-24-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-24-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-24-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-24-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-24-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-24-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-24-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-24-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-24-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-24-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-24-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-24-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-24-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-24-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-24-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-24-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-24-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-24-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-24-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-24-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-24-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-24-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-24-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-24-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-24-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-24-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-24-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-24-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-24-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-24-100">100</a></span>
<span class="normal"><a href="#__codelineno-24-101">101</a></span>
<span class="normal"><a href="#__codelineno-24-102">102</a></span>
<span class="normal"><a href="#__codelineno-24-103">103</a></span>
<span class="normal"><a href="#__codelineno-24-104">104</a></span>
<span class="normal"><a href="#__codelineno-24-105">105</a></span>
<span class="normal"><a href="#__codelineno-24-106">106</a></span>
<span class="normal"><a href="#__codelineno-24-107">107</a></span>
<span class="normal"><a href="#__codelineno-24-108">108</a></span>
<span class="normal"><a href="#__codelineno-24-109">109</a></span>
<span class="normal"><a href="#__codelineno-24-110">110</a></span>
<span class="normal"><a href="#__codelineno-24-111">111</a></span>
<span class="normal"><a href="#__codelineno-24-112">112</a></span>
<span class="normal"><a href="#__codelineno-24-113">113</a></span>
<span class="normal"><a href="#__codelineno-24-114">114</a></span>
<span class="normal"><a href="#__codelineno-24-115">115</a></span>
<span class="normal"><a href="#__codelineno-24-116">116</a></span>
<span class="normal"><a href="#__codelineno-24-117">117</a></span>
<span class="normal"><a href="#__codelineno-24-118">118</a></span>
<span class="normal"><a href="#__codelineno-24-119">119</a></span>
<span class="normal"><a href="#__codelineno-24-120">120</a></span>
<span class="normal"><a href="#__codelineno-24-121">121</a></span>
<span class="normal"><a href="#__codelineno-24-122">122</a></span>
<span class="normal"><a href="#__codelineno-24-123">123</a></span>
<span class="normal"><a href="#__codelineno-24-124">124</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1"># imports</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">codecs</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="c1"># -----------------------------------------------------------------------</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">suivi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>    <span class="c1"># lit l&#39;URL url[&quot;GET&quot;] du site url[site] et la stocke dans le fichier url[site].html</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a>    <span class="c1"># le dialogue client /serveur se fait selon le protocole HTTP indiqué dans le dictionnaire [url]</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a>    <span class="c1"># on laisse remonter les exceptions</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a>    <span class="n">sock</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a>    <span class="n">html</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a>        <span class="c1"># connexion à [site] sur le port 80 avec un timeout</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a>        <span class="n">site</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a>        <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">site</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">])),</span> <span class="nb">float</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;timeout&#39;</span><span class="p">]))</span>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a>        <span class="c1"># connexion représente un flux de communication bidirectionnel</span>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a>        <span class="c1"># entre le client (ce programme) et le serveur web contacté</span>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a>        <span class="c1"># ce canal est utilisé pour les échanges de commandes et d&#39;informations</span>
<a id="__codelineno-24-22" name="__codelineno-24-22"></a>        <span class="c1"># le protocole de dialogue est HTTP</span>
<a id="__codelineno-24-23" name="__codelineno-24-23"></a>
<a id="__codelineno-24-24" name="__codelineno-24-24"></a>        <span class="c1"># création du fichier site.html - on change les caractères gênants pour un nom de fichier</span>
<a id="__codelineno-24-25" name="__codelineno-24-25"></a>        <span class="n">site2</span> <span class="o">=</span> <span class="n">site</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
<a id="__codelineno-24-26" name="__codelineno-24-26"></a>        <span class="n">site2</span> <span class="o">=</span> <span class="n">site2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
<a id="__codelineno-24-27" name="__codelineno-24-27"></a>        <span class="n">html_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">site2</span><span class="si">}</span><span class="s1">.html&#39;</span>
<a id="__codelineno-24-28" name="__codelineno-24-28"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;output/</span><span class="si">{</span><span class="n">html_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<a id="__codelineno-24-29" name="__codelineno-24-29"></a>
<a id="__codelineno-24-30" name="__codelineno-24-30"></a>        <span class="c1"># le client va commencer le dialogue HTTP avec le serveur</span>
<a id="__codelineno-24-31" name="__codelineno-24-31"></a>        <span class="k">if</span> <span class="n">suivi</span><span class="p">:</span>
<a id="__codelineno-24-32" name="__codelineno-24-32"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Client : début de la communication avec le serveur [</span><span class="si">{</span><span class="n">site</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-24-33" name="__codelineno-24-33"></a>
<a id="__codelineno-24-34" name="__codelineno-24-34"></a>        <span class="c1"># selon les serveurs, les lignes du client doivent se terminer par \n ou \r\n</span>
<a id="__codelineno-24-35" name="__codelineno-24-35"></a>        <span class="n">end_of_line</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="s2">&quot;endOfLine&quot;</span><span class="p">]</span>
<a id="__codelineno-24-36" name="__codelineno-24-36"></a>        <span class="c1"># le client envoie la commande GET pour demander l&#39;URL config[&quot;GET&quot;]</span>
<a id="__codelineno-24-37" name="__codelineno-24-37"></a>        <span class="c1"># syntaxe GET URL HTTP/1.1</span>
<a id="__codelineno-24-38" name="__codelineno-24-38"></a>        <span class="n">commande</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;GET </span><span class="si">{</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> HTTP/1.1</span><span class="si">{</span><span class="n">end_of_line</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-24-39" name="__codelineno-24-39"></a>        <span class="c1"># suivi ?</span>
<a id="__codelineno-24-40" name="__codelineno-24-40"></a>        <span class="k">if</span> <span class="n">suivi</span><span class="p">:</span>
<a id="__codelineno-24-41" name="__codelineno-24-41"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; </span><span class="si">{</span><span class="n">commande</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-24-42" name="__codelineno-24-42"></a>        <span class="c1"># on envoie la commande au serveur</span>
<a id="__codelineno-24-43" name="__codelineno-24-43"></a>        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">commande</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<a id="__codelineno-24-44" name="__codelineno-24-44"></a>        <span class="c1"># émission des entêtes HTTP</span>
<a id="__codelineno-24-45" name="__codelineno-24-45"></a>        <span class="k">for</span> <span class="n">verb</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">url</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-24-46" name="__codelineno-24-46"></a>            <span class="c1"># on construit la commande à envoyer</span>
<a id="__codelineno-24-47" name="__codelineno-24-47"></a>            <span class="n">commande</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">verb</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}{</span><span class="n">end_of_line</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-24-48" name="__codelineno-24-48"></a>            <span class="c1"># suivi ?</span>
<a id="__codelineno-24-49" name="__codelineno-24-49"></a>            <span class="k">if</span> <span class="n">suivi</span><span class="p">:</span>
<a id="__codelineno-24-50" name="__codelineno-24-50"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; </span><span class="si">{</span><span class="n">commande</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<a id="__codelineno-24-51" name="__codelineno-24-51"></a>            <span class="c1"># on envoie la commande au serveur</span>
<a id="__codelineno-24-52" name="__codelineno-24-52"></a>            <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">commande</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<a id="__codelineno-24-53" name="__codelineno-24-53"></a>        <span class="c1"># on envoie l&#39;entête HTTP [Connection: close] pour demander au serveur web</span>
<a id="__codelineno-24-54" name="__codelineno-24-54"></a>        <span class="c1"># de fermer la connexion lorsqu&#39;il aura envoyé le document demandé</span>
<a id="__codelineno-24-55" name="__codelineno-24-55"></a>        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection: close</span><span class="si">{</span><span class="n">end_of_line</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<a id="__codelineno-24-56" name="__codelineno-24-56"></a>        <span class="c1"># les entêtes (headers) du protocole HTTP doivent se terminer par une ligne vide</span>
<a id="__codelineno-24-57" name="__codelineno-24-57"></a>        <span class="n">sock</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="n">end_of_line</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<a id="__codelineno-24-58" name="__codelineno-24-58"></a>        <span class="c1">#</span>
<a id="__codelineno-24-59" name="__codelineno-24-59"></a>        <span class="c1"># le serveur va maintenant répondre sur le canal sock. Il va envoyer toutes</span>
<a id="__codelineno-24-60" name="__codelineno-24-60"></a>        <span class="c1"># ses données puis fermer le canal. Le client lit donc tout ce qui arrive de sock</span>
<a id="__codelineno-24-61" name="__codelineno-24-61"></a>        <span class="c1"># jusqu&#39;à la fermeture du canal</span>
<a id="__codelineno-24-62" name="__codelineno-24-62"></a>        <span class="c1">#</span>
<a id="__codelineno-24-63" name="__codelineno-24-63"></a>        <span class="c1"># on lit tout d&#39;abord les entêtes HTTP envoyés par le serveur</span>
<a id="__codelineno-24-64" name="__codelineno-24-64"></a>        <span class="c1"># ils se terminent eux-aussi par une ligne vide</span>
<a id="__codelineno-24-65" name="__codelineno-24-65"></a>        <span class="k">if</span> <span class="n">suivi</span><span class="p">:</span>
<a id="__codelineno-24-66" name="__codelineno-24-66"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Réponse du serveur [</span><span class="si">{</span><span class="n">site</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-24-67" name="__codelineno-24-67"></a>
<a id="__codelineno-24-68" name="__codelineno-24-68"></a>        <span class="c1"># lecture de la socket comme si elle était un fichier texte</span>
<a id="__codelineno-24-69" name="__codelineno-24-69"></a>        <span class="n">encoding</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">url</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-24-70" name="__codelineno-24-70"></a>        <span class="k">if</span> <span class="n">encoding</span><span class="p">:</span>
<a id="__codelineno-24-71" name="__codelineno-24-71"></a>            <span class="n">file</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">makefile</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
<a id="__codelineno-24-72" name="__codelineno-24-72"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-24-73" name="__codelineno-24-73"></a>            <span class="n">file</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">makefile</span><span class="p">()</span>
<a id="__codelineno-24-74" name="__codelineno-24-74"></a>        <span class="c1"># on exploite ce fichier ligne par ligne</span>
<a id="__codelineno-24-75" name="__codelineno-24-75"></a>        <span class="n">fini</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-24-76" name="__codelineno-24-76"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">fini</span><span class="p">:</span>
<a id="__codelineno-24-77" name="__codelineno-24-77"></a>            <span class="c1"># lecture ligne courante</span>
<a id="__codelineno-24-78" name="__codelineno-24-78"></a>            <span class="n">ligne</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-24-79" name="__codelineno-24-79"></a>            <span class="c1"># a-t-on une ligne non vide ?</span>
<a id="__codelineno-24-80" name="__codelineno-24-80"></a>            <span class="k">if</span> <span class="n">ligne</span><span class="p">:</span>
<a id="__codelineno-24-81" name="__codelineno-24-81"></a>                <span class="k">if</span> <span class="n">suivi</span><span class="p">:</span>
<a id="__codelineno-24-82" name="__codelineno-24-82"></a>                    <span class="c1"># on affiche l&#39;entête HTTP</span>
<a id="__codelineno-24-83" name="__codelineno-24-83"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;-- </span><span class="si">{</span><span class="n">ligne</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-24-84" name="__codelineno-24-84"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-24-85" name="__codelineno-24-85"></a>                <span class="c1"># c&#39;était la ligne vide - les entêtes HTTP sont terminés</span>
<a id="__codelineno-24-86" name="__codelineno-24-86"></a>                <span class="n">fini</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-24-87" name="__codelineno-24-87"></a>        <span class="c1"># on lit le document HTML qui va suivre la ligne vide</span>
<a id="__codelineno-24-88" name="__codelineno-24-88"></a>        <span class="c1"># lecture ligne courante</span>
<a id="__codelineno-24-89" name="__codelineno-24-89"></a>        <span class="n">ligne</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<a id="__codelineno-24-90" name="__codelineno-24-90"></a>        <span class="k">while</span> <span class="n">ligne</span><span class="p">:</span>
<a id="__codelineno-24-91" name="__codelineno-24-91"></a>            <span class="c1"># enregistrement dans le fichier de logs</span>
<a id="__codelineno-24-92" name="__codelineno-24-92"></a>            <span class="n">html</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ligne</span><span class="p">))</span>
<a id="__codelineno-24-93" name="__codelineno-24-93"></a>            <span class="c1"># ligne suivante</span>
<a id="__codelineno-24-94" name="__codelineno-24-94"></a>            <span class="n">ligne</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<a id="__codelineno-24-95" name="__codelineno-24-95"></a>            <span class="c1"># la boucle se finit lorsque le serveur ferme la connexion</span>
<a id="__codelineno-24-96" name="__codelineno-24-96"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-24-97" name="__codelineno-24-97"></a>        <span class="c1"># le client ferme la connexion</span>
<a id="__codelineno-24-98" name="__codelineno-24-98"></a>        <span class="k">if</span> <span class="n">sock</span><span class="p">:</span>
<a id="__codelineno-24-99" name="__codelineno-24-99"></a>            <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-24-100" name="__codelineno-24-100"></a>        <span class="c1"># fermeture du fichier html</span>
<a id="__codelineno-24-101" name="__codelineno-24-101"></a>        <span class="k">if</span> <span class="n">html</span><span class="p">:</span>
<a id="__codelineno-24-102" name="__codelineno-24-102"></a>            <span class="n">html</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-24-103" name="__codelineno-24-103"></a>
<a id="__codelineno-24-104" name="__codelineno-24-104"></a>
<a id="__codelineno-24-105" name="__codelineno-24-105"></a><span class="c1"># -------------------main</span>
<a id="__codelineno-24-106" name="__codelineno-24-106"></a>
<a id="__codelineno-24-107" name="__codelineno-24-107"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-24-108" name="__codelineno-24-108"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-24-109" name="__codelineno-24-109"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-24-110" name="__codelineno-24-110"></a>
<a id="__codelineno-24-111" name="__codelineno-24-111"></a><span class="c1"># obtenir les URL du fichier de configuration</span>
<a id="__codelineno-24-112" name="__codelineno-24-112"></a><span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">]:</span>
<a id="__codelineno-24-113" name="__codelineno-24-113"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-24-114" name="__codelineno-24-114"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">])</span>
<a id="__codelineno-24-115" name="__codelineno-24-115"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-24-116" name="__codelineno-24-116"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-24-117" name="__codelineno-24-117"></a>        <span class="c1"># lecture URL du site [site]</span>
<a id="__codelineno-24-118" name="__codelineno-24-118"></a>        <span class="n">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-24-119" name="__codelineno-24-119"></a>    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-24-120" name="__codelineno-24-120"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-24-121" name="__codelineno-24-121"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-24-122" name="__codelineno-24-122"></a>        <span class="k">pass</span>
<a id="__codelineno-24-123" name="__codelineno-24-123"></a><span class="c1"># fin</span>
<a id="__codelineno-24-124" name="__codelineno-24-124"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Terminé...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires du code :</strong></p>
<ul>
<li>lignes 108-109 : le dictionnaire <strong>[config]</strong> du module <strong>[config.py]</strong> est récupéré ;</li>
<li>ligne 111-122 : ce dictionnaire est exploité ;</li>
<li>ligne 118, 7 : la fonction <strong>[</strong><strong>get_url</strong><strong>(url)]</strong> demande un document du site web url<strong>[site]</strong> et le stocke dans le fichier texte url<strong>[site]</strong>.HTML. Par défaut, les échanges client/serveur sont logués sur la console (suivi=True) ;</li>
<li>on fait tout dans un <strong>[try / finally]</strong> (lignes 14-96). Il n&#x27;y a pas de clause <strong>[except]</strong>. Les exceptions vont remonter au code appelant et c&#x27;est celui-ci qui les arrête et les affiche (lignes 119-120) ;</li>
<li>lignes 16-17 : ouverture d&#x27;une connexion vers le serveur web. La fonction <strong>[</strong><strong>socket</strong><strong>.create_connection</strong><strong>]</strong> admet trois paramètres :</li>
<li><strong>[param1]</strong> : est le nom de la machine de l&#x27;internet qu&#x27;on veut atteindre ;</li>
<li><strong>[param2]</strong> : est le n° du port du service auquel on veut se connecter ;</li>
<li><strong>[param3]</strong> : <strong>[</strong><strong>socket</strong><strong>.create_connection</strong><strong>]</strong> rend un socket et <strong>[param3]</strong>, s&#x27;il est présent, désigne le timeout du socket créé. Le timeout est le délai maximal d&#x27;attente du socket lorsqu&#x27;il attend une réponse de la machine distante ;</li>
<li>lignes 27-28 : création du fichier <strong>[site.html]</strong> dans lequel on stockera le document HTML reçu ;</li>
<li>lignes 34-43 : la première commande du client doit être la commande <strong>[GET URL HTTP/1.1]</strong> ;</li>
<li>ligne 43 : la fonction <strong>[</strong><strong>sock.send</strong><strong>]</strong> permet au client d&#x27;envoyer des données au serveur. Ici la ligne de texte envoyée a la signification suivante : &quot;Je veux (GET) la page <strong>[URL]</strong> du site web auquel je suis connecté. Je travaille avec le protocole HTTP version 1.1&quot; ;</li>
<li>ligne 43 : l&#x27;instruction <strong>[</strong><strong>sock.send(</strong><strong>bytearray</strong><strong>(commande, </strong><strong>&#x27;utf-8&#x27;</strong><strong>))</strong><strong>]</strong> envoie un tableau d&#x27;octets octets (bytearray). Ce tableau est obtenu par conversion de la chaîne <strong>[commande]</strong> en une suite d&#x27;octets codés en UTF-8 ;</li>
<li>lignes 44-52 : on envoie les autres lignes du protocole HTTP <strong>[Host, User-Agent, Accept, Accept-Language…]</strong>. Leur ordre n’importe pas ;</li>
<li>lignes 53-55 : on envoie l&#x27;entête HTTP <strong>[Connection: close]</strong> pour demander au serveur de fermer sa connexion lorsqu&#x27;il aura envoyé le document demandé. Par défaut il ne le fait pas. Il faut donc le lui demander explicitement. L&#x27;intérêt est que cette fermeture va être détectée côté client et c&#x27;est comme cela que celui-ci saura qu&#x27;il aura reçu tout le document demandé ;</li>
<li>lignes 56-57 : on envoie une ligne vide au serveur pour signifier que le client a terminé d’envoyer ses entêtes HTTP et qu’il attend désormais le document demandé ;</li>
<li>lignes 68-86 : le serveur va tout d’abord envoyer une série d’entêtes HTTP qui vont donner diverses informations sur le document demandé. Ces entêtes se terminent par une ligne vide ;</li>
<li>lignes 69-73 : pour pouvoir lire la réponse du serveur, ligne par ligne, on utilise la méthode <strong>[</strong><strong>sock.makefile(encoding=encoding)</strong><strong>]</strong>. Le paramètre facultatif <strong>[encoding]</strong> précise l&#x27;encodage du texte attendu. Après cette opération, le flux de lignes envoyées par le serveur va pouvoir être lu comme un fichiet texte classique ;</li>
<li>ligne 78 : on lit une ligne envoyée par le serveur avec la méthode <strong>[readline]</strong>. On la débarrasse de ses espaces (blancs, marque de fin de ligne) de début et fin de ligne ;</li>
<li>lignes 81-83 : si la ligne n&#x27;est pas vide et que le suivi a été demandé, la ligne reçue est affichée sur la console ;</li>
<li>lignes 84-86 : si on a récupéré la ligne vide qui marque la fin des entêtes HTTP envoyés par le serveur alors on arrête la boucle de la ligne 76 ;</li>
<li>lignes 90-95 : les lignes de texte de la réponse du serveur peuvent être lues ligne par ligne avec une boucle while et enregistrées dans le fichier texte <strong>[html]</strong>. Lorsque le serveur web a envoyé la totalité de la page qu&#x27;on lui a demandée, il ferme sa connexion avec le client. Côté client, cela sera détecté comme une fin de fichier et on sortira de la boucle des lignes 90-95 ;</li>
<li>lignes 96-102 : erreur ou pas, on libère toutes les ressources utilisées par le code ;
<strong>Résultats</strong> :</li>
</ul>
<p>La console affiche les logs suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span>
<span class="normal"><a href="#__codelineno-25-20">20</a></span>
<span class="normal"><a href="#__codelineno-25-21">21</a></span>
<span class="normal"><a href="#__codelineno-25-22">22</a></span>
<span class="normal"><a href="#__codelineno-25-23">23</a></span>
<span class="normal"><a href="#__codelineno-25-24">24</a></span>
<span class="normal"><a href="#__codelineno-25-25">25</a></span>
<span class="normal"><a href="#__codelineno-25-26">26</a></span>
<span class="normal"><a href="#__codelineno-25-27">27</a></span>
<span class="normal"><a href="#__codelineno-25-28">28</a></span>
<span class="normal"><a href="#__codelineno-25-29">29</a></span>
<span class="normal"><a href="#__codelineno-25-30">30</a></span>
<span class="normal"><a href="#__codelineno-25-31">31</a></span>
<span class="normal"><a href="#__codelineno-25-32">32</a></span>
<span class="normal"><a href="#__codelineno-25-33">33</a></span>
<span class="normal"><a href="#__codelineno-25-34">34</a></span>
<span class="normal"><a href="#__codelineno-25-35">35</a></span>
<span class="normal"><a href="#__codelineno-25-36">36</a></span>
<span class="normal"><a href="#__codelineno-25-37">37</a></span>
<span class="normal"><a href="#__codelineno-25-38">38</a></span>
<span class="normal"><a href="#__codelineno-25-39">39</a></span>
<span class="normal"><a href="#__codelineno-25-40">40</a></span>
<span class="normal"><a href="#__codelineno-25-41">41</a></span>
<span class="normal"><a href="#__codelineno-25-42">42</a></span>
<span class="normal"><a href="#__codelineno-25-43">43</a></span>
<span class="normal"><a href="#__codelineno-25-44">44</a></span>
<span class="normal"><a href="#__codelineno-25-45">45</a></span>
<span class="normal"><a href="#__codelineno-25-46">46</a></span>
<span class="normal"><a href="#__codelineno-25-47">47</a></span>
<span class="normal"><a href="#__codelineno-25-48">48</a></span>
<span class="normal"><a href="#__codelineno-25-49">49</a></span>
<span class="normal"><a href="#__codelineno-25-50">50</a></span>
<span class="normal"><a href="#__codelineno-25-51">51</a></span>
<span class="normal"><a href="#__codelineno-25-52">52</a></span>
<span class="normal"><a href="#__codelineno-25-53">53</a></span>
<span class="normal"><a href="#__codelineno-25-54">54</a></span>
<span class="normal"><a href="#__codelineno-25-55">55</a></span>
<span class="normal"><a href="#__codelineno-25-56">56</a></span>
<span class="normal"><a href="#__codelineno-25-57">57</a></span>
<span class="normal"><a href="#__codelineno-25-58">58</a></span>
<span class="normal"><a href="#__codelineno-25-59">59</a></span>
<span class="normal"><a href="#__codelineno-25-60">60</a></span>
<span class="normal"><a href="#__codelineno-25-61">61</a></span>
<span class="normal"><a href="#__codelineno-25-62">62</a></span>
<span class="normal"><a href="#__codelineno-25-63">63</a></span>
<span class="normal"><a href="#__codelineno-25-64">64</a></span>
<span class="normal"><a href="#__codelineno-25-65">65</a></span>
<span class="normal"><a href="#__codelineno-25-66">66</a></span>
<span class="normal"><a href="#__codelineno-25-67">67</a></span>
<span class="normal"><a href="#__codelineno-25-68">68</a></span>
<span class="normal"><a href="#__codelineno-25-69">69</a></span>
<span class="normal"><a href="#__codelineno-25-70">70</a></span>
<span class="normal"><a href="#__codelineno-25-71">71</a></span>
<span class="normal"><a href="#__codelineno-25-72">72</a></span>
<span class="normal"><a href="#__codelineno-25-73">73</a></span>
<span class="normal"><a href="#__codelineno-25-74">74</a></span>
<span class="normal"><a href="#__codelineno-25-75">75</a></span>
<span class="normal"><a href="#__codelineno-25-76">76</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">inet</span><span class="o">/</span><span class="n">http</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="o">-------------------------</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="n">localhost</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="o">-------------------------</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="n">Client</span> <span class="p">:</span> <span class="n">début</span> <span class="n">de</span> <span class="n">la</span> <span class="n">communication</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="o">--&gt;</span> <span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="o">--&gt;</span> <span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">80</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="o">--&gt;</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">client</span> <span class="n">Python</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="o">--&gt;</span> <span class="n">Accept</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">HTML</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="o">--&gt;</span> <span class="n">Accept</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span> <span class="n">fr</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="n">Réponse</span> <span class="n">du</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="o">&lt;--</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="o">&lt;--</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">16</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">46</span> <span class="n">GMT</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="o">&lt;--</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.35</span> <span class="p">(</span><span class="n">Win64</span><span class="p">)</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">b</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="o">&lt;--</span> <span class="n">X</span><span class="o">-</span><span class="n">Powered</span><span class="o">-</span><span class="n">By</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a><span class="o">&lt;--</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">1776</span>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a><span class="o">&lt;--</span> <span class="n">Connection</span><span class="p">:</span> <span class="n">close</span>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="o">&lt;--</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a><span class="o">-------------------------</span>
<a id="__codelineno-25-20" name="__codelineno-25-20"></a><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-25-21" name="__codelineno-25-21"></a><span class="o">-------------------------</span>
<a id="__codelineno-25-22" name="__codelineno-25-22"></a><span class="n">Client</span> <span class="p">:</span> <span class="n">début</span> <span class="n">de</span> <span class="n">la</span> <span class="n">communication</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-25-23" name="__codelineno-25-23"></a><span class="o">--&gt;</span> <span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-25-24" name="__codelineno-25-24"></a><span class="o">--&gt;</span> <span class="n">Host</span><span class="p">:</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">80</span>
<a id="__codelineno-25-25" name="__codelineno-25-25"></a><span class="o">--&gt;</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">client</span> <span class="n">Python</span>
<a id="__codelineno-25-26" name="__codelineno-25-26"></a><span class="o">--&gt;</span> <span class="n">Accept</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">HTML</span>
<a id="__codelineno-25-27" name="__codelineno-25-27"></a><span class="o">--&gt;</span> <span class="n">Accept</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span> <span class="n">fr</span>
<a id="__codelineno-25-28" name="__codelineno-25-28"></a><span class="n">Réponse</span> <span class="n">du</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-25-29" name="__codelineno-25-29"></a><span class="o">&lt;--</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">302</span> <span class="n">Found</span>
<a id="__codelineno-25-30" name="__codelineno-25-30"></a><span class="o">&lt;--</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">16</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">45</span> <span class="n">GMT</span>
<a id="__codelineno-25-31" name="__codelineno-25-31"></a><span class="o">&lt;--</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-25-32" name="__codelineno-25-32"></a><span class="o">&lt;--</span> <span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">chunked</span>
<a id="__codelineno-25-33" name="__codelineno-25-33"></a><span class="o">&lt;--</span> <span class="n">Connection</span><span class="p">:</span> <span class="n">close</span>
<a id="__codelineno-25-34" name="__codelineno-25-34"></a><span class="o">&lt;--</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span>
<a id="__codelineno-25-35" name="__codelineno-25-35"></a><span class="o">&lt;--</span> <span class="n">X</span><span class="o">-</span><span class="n">Powered</span><span class="o">-</span><span class="n">By</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.3</span>
<a id="__codelineno-25-36" name="__codelineno-25-36"></a><span class="o">&lt;--</span> <span class="n">Location</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">80</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span>
<a id="__codelineno-25-37" name="__codelineno-25-37"></a><span class="o">&lt;--</span> <span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">SERVERID68971</span><span class="o">=</span><span class="mi">2620178</span><span class="o">|</span><span class="n">XwH</span><span class="o">/</span><span class="n">h</span><span class="o">|</span><span class="n">XwH</span><span class="o">/</span><span class="n">h</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span>
<a id="__codelineno-25-38" name="__codelineno-25-38"></a><span class="o">&lt;--</span> <span class="n">X</span><span class="o">-</span><span class="n">IPLB</span><span class="o">-</span><span class="n">Instance</span><span class="p">:</span> <span class="mi">17106</span>
<a id="__codelineno-25-39" name="__codelineno-25-39"></a><span class="o">-------------------------</span>
<a id="__codelineno-25-40" name="__codelineno-25-40"></a><span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-25-41" name="__codelineno-25-41"></a><span class="o">-------------------------</span>
<a id="__codelineno-25-42" name="__codelineno-25-42"></a><span class="n">Client</span> <span class="p">:</span> <span class="n">début</span> <span class="n">de</span> <span class="n">la</span> <span class="n">communication</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-25-43" name="__codelineno-25-43"></a><span class="o">--&gt;</span> <span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-25-44" name="__codelineno-25-44"></a><span class="o">--&gt;</span> <span class="n">Host</span><span class="p">:</span> <span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">443</span>
<a id="__codelineno-25-45" name="__codelineno-25-45"></a><span class="o">--&gt;</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">client</span> <span class="n">Python</span>
<a id="__codelineno-25-46" name="__codelineno-25-46"></a><span class="o">--&gt;</span> <span class="n">Accept</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">HTML</span>
<a id="__codelineno-25-47" name="__codelineno-25-47"></a><span class="o">--&gt;</span> <span class="n">Accept</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span> <span class="n">fr</span>
<a id="__codelineno-25-48" name="__codelineno-25-48"></a><span class="n">Réponse</span> <span class="n">du</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-25-49" name="__codelineno-25-49"></a><span class="o">&lt;--</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">400</span> <span class="n">Bad</span> <span class="n">Request</span>
<a id="__codelineno-25-50" name="__codelineno-25-50"></a><span class="o">&lt;--</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">16</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">45</span> <span class="n">GMT</span>
<a id="__codelineno-25-51" name="__codelineno-25-51"></a><span class="o">&lt;--</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.38</span> <span class="p">(</span><span class="n">Debian</span><span class="p">)</span>
<a id="__codelineno-25-52" name="__codelineno-25-52"></a><span class="o">&lt;--</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">453</span>
<a id="__codelineno-25-53" name="__codelineno-25-53"></a><span class="o">&lt;--</span> <span class="n">Connection</span><span class="p">:</span> <span class="n">close</span>
<a id="__codelineno-25-54" name="__codelineno-25-54"></a><span class="o">&lt;--</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">iso</span><span class="o">-</span><span class="mi">8859</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-25-55" name="__codelineno-25-55"></a><span class="o">-------------------------</span>
<a id="__codelineno-25-56" name="__codelineno-25-56"></a><span class="n">www</span><span class="o">.</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-25-57" name="__codelineno-25-57"></a><span class="o">-------------------------</span>
<a id="__codelineno-25-58" name="__codelineno-25-58"></a><span class="n">Client</span> <span class="p">:</span> <span class="n">début</span> <span class="n">de</span> <span class="n">la</span> <span class="n">communication</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">www</span><span class="o">.</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-25-59" name="__codelineno-25-59"></a><span class="o">--&gt;</span> <span class="n">GET</span> <span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-25-60" name="__codelineno-25-60"></a><span class="o">--&gt;</span> <span class="n">Host</span><span class="p">:</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">80</span>
<a id="__codelineno-25-61" name="__codelineno-25-61"></a><span class="o">--&gt;</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">client</span> <span class="n">Python</span>
<a id="__codelineno-25-62" name="__codelineno-25-62"></a><span class="o">--&gt;</span> <span class="n">Accept</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">HTML</span>
<a id="__codelineno-25-63" name="__codelineno-25-63"></a><span class="o">--&gt;</span> <span class="n">Accept</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span> <span class="n">fr</span>
<a id="__codelineno-25-64" name="__codelineno-25-64"></a><span class="n">Réponse</span> <span class="n">du</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">www</span><span class="o">.</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-25-65" name="__codelineno-25-65"></a><span class="o">&lt;--</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">301</span> <span class="n">Moved</span> <span class="n">Permanently</span>
<a id="__codelineno-25-66" name="__codelineno-25-66"></a><span class="o">&lt;--</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">16</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">45</span> <span class="n">GMT</span>
<a id="__codelineno-25-67" name="__codelineno-25-67"></a><span class="o">&lt;--</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">iso</span><span class="o">-</span><span class="mi">8859</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-25-68" name="__codelineno-25-68"></a><span class="o">&lt;--</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">263</span>
<a id="__codelineno-25-69" name="__codelineno-25-69"></a><span class="o">&lt;--</span> <span class="n">Connection</span><span class="p">:</span> <span class="n">close</span>
<a id="__codelineno-25-70" name="__codelineno-25-70"></a><span class="o">&lt;--</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span>
<a id="__codelineno-25-71" name="__codelineno-25-71"></a><span class="o">&lt;--</span> <span class="n">Location</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span>
<a id="__codelineno-25-72" name="__codelineno-25-72"></a><span class="o">&lt;--</span> <span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">SERVERID68971</span><span class="o">=</span><span class="mi">2620178</span><span class="o">|</span><span class="n">XwH</span><span class="o">/</span><span class="n">h</span><span class="o">|</span><span class="n">XwH</span><span class="o">/</span><span class="n">h</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span>
<a id="__codelineno-25-73" name="__codelineno-25-73"></a><span class="o">&lt;--</span> <span class="n">X</span><span class="o">-</span><span class="n">IPLB</span><span class="o">-</span><span class="n">Instance</span><span class="p">:</span> <span class="mi">17095</span>
<a id="__codelineno-25-74" name="__codelineno-25-74"></a><span class="n">Terminé</span><span class="o">...</span>
<a id="__codelineno-25-75" name="__codelineno-25-75"></a>
<a id="__codelineno-25-76" name="__codelineno-25-76"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 12 : l&#x27;URL <strong>[http://localhost/]</strong> a été trouvée (code 200) ;</li>
<li>ligne 29 : l&#x27;URL <strong>[http://sergetahe.com/]</strong> n&#x27;a pas été trouvée (code 302). Le code 302 signifie que la page demandée a changé d&#x27;URL. La nouvelle URL est indiquée par l&#x27;entête HTTP <strong>[Location]</strong> de la ligne 36 ;</li>
<li>ligne 49 : la requête qui a été faite au serveur <strong>[http://tahe.developpez.com]</strong> est incorrecte (code 400) ;</li>
<li>ligne 65 : l&#x27;URL <strong>[http://www.sergetahe.com/]</strong> n&#x27;a pas été trouvée (code 301). Le code 301 signifie que la page demandée a changé d&#x27;URL et ce de façon définitive. La nouvelle URL est indiquée par l&#x27;entête HTTP <strong>[Location]</strong> de la ligne 71 ;
De façon générale les codes 3xx, 4xx et 5xx d’un serveur HTTP sont des codes d’erreur.</li>
</ul>
<p>L&#x27;exécution a produit fichiers :</p>
<p><img src="images/10000000000001FA0000019DB3A8B5DF.png" style="width:5.841cm;height:4.762cm;" alt="Image" /></p>
<p>Le fichier <strong>[output/localhost.HTML]</strong> reçu est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span>
<span class="normal"><a href="#__codelineno-26-20">20</a></span>
<span class="normal"><a href="#__codelineno-26-21">21</a></span>
<span class="normal"><a href="#__codelineno-26-22">22</a></span>
<span class="normal"><a href="#__codelineno-26-23">23</a></span>
<span class="normal"><a href="#__codelineno-26-24">24</a></span>
<span class="normal"><a href="#__codelineno-26-25">25</a></span>
<span class="normal"><a href="#__codelineno-26-26">26</a></span>
<span class="normal"><a href="#__codelineno-26-27">27</a></span>
<span class="normal"><a href="#__codelineno-26-28">28</a></span>
<span class="normal"><a href="#__codelineno-26-29">29</a></span>
<span class="normal"><a href="#__codelineno-26-30">30</a></span>
<span class="normal"><a href="#__codelineno-26-31">31</a></span>
<span class="normal"><a href="#__codelineno-26-32">32</a></span>
<span class="normal"><a href="#__codelineno-26-33">33</a></span>
<span class="normal"><a href="#__codelineno-26-34">34</a></span>
<span class="normal"><a href="#__codelineno-26-35">35</a></span>
<span class="normal"><a href="#__codelineno-26-36">36</a></span>
<span class="normal"><a href="#__codelineno-26-37">37</a></span>
<span class="normal"><a href="#__codelineno-26-38">38</a></span>
<span class="normal"><a href="#__codelineno-26-39">39</a></span>
<span class="normal"><a href="#__codelineno-26-40">40</a></span>
<span class="normal"><a href="#__codelineno-26-41">41</a></span>
<span class="normal"><a href="#__codelineno-26-42">42</a></span>
<span class="normal"><a href="#__codelineno-26-43">43</a></span>
<span class="normal"><a href="#__codelineno-26-44">44</a></span>
<span class="normal"><a href="#__codelineno-26-45">45</a></span>
<span class="normal"><a href="#__codelineno-26-46">46</a></span>
<span class="normal"><a href="#__codelineno-26-47">47</a></span>
<span class="normal"><a href="#__codelineno-26-48">48</a></span>
<span class="normal"><a href="#__codelineno-26-49">49</a></span>
<span class="normal"><a href="#__codelineno-26-50">50</a></span>
<span class="normal"><a href="#__codelineno-26-51">51</a></span>
<span class="normal"><a href="#__codelineno-26-52">52</a></span>
<span class="normal"><a href="#__codelineno-26-53">53</a></span>
<span class="normal"><a href="#__codelineno-26-54">54</a></span>
<span class="normal"><a href="#__codelineno-26-55">55</a></span>
<span class="normal"><a href="#__codelineno-26-56">56</a></span>
<span class="normal"><a href="#__codelineno-26-57">57</a></span>
<span class="normal"><a href="#__codelineno-26-58">58</a></span>
<span class="normal"><a href="#__codelineno-26-59">59</a></span>
<span class="normal"><a href="#__codelineno-26-60">60</a></span>
<span class="normal"><a href="#__codelineno-26-61">61</a></span>
<span class="normal"><a href="#__codelineno-26-62">62</a></span>
<span class="normal"><a href="#__codelineno-26-63">63</a></span>
<span class="normal"><a href="#__codelineno-26-64">64</a></span>
<span class="normal"><a href="#__codelineno-26-65">65</a></span>
<span class="normal"><a href="#__codelineno-26-66">66</a></span>
<span class="normal"><a href="#__codelineno-26-67">67</a></span>
<span class="normal"><a href="#__codelineno-26-68">68</a></span>
<span class="normal"><a href="#__codelineno-26-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a>    <span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>        <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Laragon</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a>        <span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://fonts.googleapis.com/css?family=Karla:400&quot;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/css&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a>        <span class="o">&lt;</span><span class="n">style</span><span class="o">&gt;</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>            <span class="n">html</span><span class="p">,</span> <span class="n">body</span> <span class="p">{</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a>                <span class="n">height</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a>            <span class="p">}</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a>            <span class="n">body</span> <span class="p">{</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a>                <span class="n">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a>                <span class="n">padding</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a>                <span class="n">width</span><span class="p">:</span> <span class="mi">100</span><span class="o">%</span><span class="p">;</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a>                <span class="n">display</span><span class="p">:</span> <span class="n">table</span><span class="p">;</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a>                <span class="n">font</span><span class="o">-</span><span class="n">weight</span><span class="p">:</span> <span class="mi">100</span><span class="p">;</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a>                <span class="n">font</span><span class="o">-</span><span class="n">family</span><span class="p">:</span> <span class="s1">&#39;Karla&#39;</span><span class="p">;</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a>            <span class="p">}</span>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a>            <span class="o">.</span><span class="n">container</span> <span class="p">{</span>
<a id="__codelineno-26-23" name="__codelineno-26-23"></a>                <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
<a id="__codelineno-26-24" name="__codelineno-26-24"></a>                <span class="n">display</span><span class="p">:</span> <span class="n">table</span><span class="o">-</span><span class="n">cell</span><span class="p">;</span>
<a id="__codelineno-26-25" name="__codelineno-26-25"></a>                <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">middle</span><span class="p">;</span>
<a id="__codelineno-26-26" name="__codelineno-26-26"></a>            <span class="p">}</span>
<a id="__codelineno-26-27" name="__codelineno-26-27"></a>
<a id="__codelineno-26-28" name="__codelineno-26-28"></a>            <span class="o">.</span><span class="n">content</span> <span class="p">{</span>
<a id="__codelineno-26-29" name="__codelineno-26-29"></a>                <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">center</span><span class="p">;</span>
<a id="__codelineno-26-30" name="__codelineno-26-30"></a>                <span class="n">display</span><span class="p">:</span> <span class="n">inline</span><span class="o">-</span><span class="n">block</span><span class="p">;</span>
<a id="__codelineno-26-31" name="__codelineno-26-31"></a>            <span class="p">}</span>
<a id="__codelineno-26-32" name="__codelineno-26-32"></a>
<a id="__codelineno-26-33" name="__codelineno-26-33"></a>            <span class="o">.</span><span class="n">title</span> <span class="p">{</span>
<a id="__codelineno-26-34" name="__codelineno-26-34"></a>                <span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">96</span><span class="n">px</span><span class="p">;</span>
<a id="__codelineno-26-35" name="__codelineno-26-35"></a>            <span class="p">}</span>
<a id="__codelineno-26-36" name="__codelineno-26-36"></a>
<a id="__codelineno-26-37" name="__codelineno-26-37"></a>            <span class="o">.</span><span class="n">opt</span> <span class="p">{</span>
<a id="__codelineno-26-38" name="__codelineno-26-38"></a>                <span class="n">margin</span><span class="o">-</span><span class="n">top</span><span class="p">:</span> <span class="mi">30</span><span class="n">px</span><span class="p">;</span>
<a id="__codelineno-26-39" name="__codelineno-26-39"></a>            <span class="p">}</span>
<a id="__codelineno-26-40" name="__codelineno-26-40"></a>
<a id="__codelineno-26-41" name="__codelineno-26-41"></a>            <span class="o">.</span><span class="n">opt</span> <span class="n">a</span> <span class="p">{</span>
<a id="__codelineno-26-42" name="__codelineno-26-42"></a>              <span class="n">text</span><span class="o">-</span><span class="n">decoration</span><span class="p">:</span> <span class="n">none</span><span class="p">;</span>
<a id="__codelineno-26-43" name="__codelineno-26-43"></a>              <span class="n">font</span><span class="o">-</span><span class="n">size</span><span class="p">:</span> <span class="mi">150</span><span class="o">%</span><span class="p">;</span>
<a id="__codelineno-26-44" name="__codelineno-26-44"></a>            <span class="p">}</span>
<a id="__codelineno-26-45" name="__codelineno-26-45"></a>
<a id="__codelineno-26-46" name="__codelineno-26-46"></a>            <span class="n">a</span><span class="p">:</span><span class="n">hover</span> <span class="p">{</span>
<a id="__codelineno-26-47" name="__codelineno-26-47"></a>              <span class="n">color</span><span class="p">:</span> <span class="n">red</span><span class="p">;</span>
<a id="__codelineno-26-48" name="__codelineno-26-48"></a>            <span class="p">}</span>
<a id="__codelineno-26-49" name="__codelineno-26-49"></a>        <span class="o">&lt;/</span><span class="n">style</span><span class="o">&gt;</span>
<a id="__codelineno-26-50" name="__codelineno-26-50"></a>    <span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-26-51" name="__codelineno-26-51"></a>    <span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-26-52" name="__codelineno-26-52"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-53" name="__codelineno-26-53"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;content&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-54" name="__codelineno-26-54"></a>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;title&quot;</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Laragon&quot;</span><span class="o">&gt;</span><span class="n">Laragon</span><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-55" name="__codelineno-26-55"></a>
<a id="__codelineno-26-56" name="__codelineno-26-56"></a>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-26-57" name="__codelineno-26-57"></a>                      <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.35</span> <span class="p">(</span><span class="n">Win64</span><span class="p">)</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">b</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-26-58" name="__codelineno-26-58"></a>                      <span class="n">PHP</span> <span class="n">version</span><span class="p">:</span> <span class="mf">7.2.19</span>   <span class="o">&lt;</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;phpinfo()&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/?q=info&quot;</span><span class="o">&gt;</span><span class="n">info</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">span</span><span class="o">&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-26-59" name="__codelineno-26-59"></a>                      <span class="n">Document</span> <span class="n">Root</span><span class="p">:</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">MyPrograms</span><span class="o">/</span><span class="n">laragon</span><span class="o">/</span><span class="n">www</span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-26-60" name="__codelineno-26-60"></a>
<a id="__codelineno-26-61" name="__codelineno-26-61"></a>                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-62" name="__codelineno-26-62"></a>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;opt&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-63" name="__codelineno-26-63"></a>                  <span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Getting Started&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://laragon.org/docs&quot;</span><span class="o">&gt;</span><span class="n">Getting</span> <span class="n">Started</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-64" name="__codelineno-26-64"></a>                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-65" name="__codelineno-26-65"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-66" name="__codelineno-26-66"></a>
<a id="__codelineno-26-67" name="__codelineno-26-67"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-68" name="__codelineno-26-68"></a>    <span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-26-69" name="__codelineno-26-69"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Nous avons bien obtenu le même document qu’avec le navigateur Firefox.</p>
<p>Le document <strong>[output/sergetahe_com.html]</strong> reçu est le suivant :</p>
<p><img src="images/10000001000000E8000000775DC7BB4E.png" style="width:3.92cm;height:2.012cm;" alt="Image" /></p>
<p>La plupart des serveurs http envoient par morceaux leurs réponses aux requêtes qui leur sont faites. Chaque morceau envoyé est précédé d&#x27;une ligne indiquant le nombre d&#x27;octets du morceau qui suit. Cela permet au client de lire ce nombre exact d&#x27;octets pour avoir le morceau. Ici le 0 indique que le morceau qui suit a zéro octet. On rappelle que le serveur avait indiqué le document <strong>[http://sergetahe.com/]</strong> avait changé d&#x27;URL. Il n&#x27;a donc pas envoyé de document.</p>
<p>Le document <strong>[output/tahe_developpez_com.html]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">HTML</span> <span class="n">PUBLIC</span> <span class="s2">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="mi">400</span> <span class="n">Bad</span> <span class="n">Request</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Bad</span> <span class="n">Request</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">Your</span> <span class="n">browser</span> <span class="n">sent</span> <span class="n">a</span> <span class="n">request</span> <span class="n">that</span> <span class="n">this</span> <span class="n">server</span> <span class="n">could</span> <span class="ow">not</span> <span class="n">understand</span><span class="o">.&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="n">Reason</span><span class="p">:</span> <span class="n">You</span><span class="s1">&#39;re speaking plain HTTP to an SSL-enabled server port.&lt;br /&gt;</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a> <span class="n">Instead</span> <span class="n">use</span> <span class="n">the</span> <span class="n">HTTPS</span> <span class="n">scheme</span> <span class="n">to</span> <span class="n">access</span> <span class="n">this</span> <span class="n">URL</span><span class="p">,</span> <span class="n">please</span><span class="o">.&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="o">&lt;</span><span class="n">hr</span><span class="o">&gt;</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="o">&lt;</span><span class="n">address</span><span class="o">&gt;</span><span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.38</span> <span class="p">(</span><span class="n">Debian</span><span class="p">)</span> <span class="n">Server</span> <span class="n">at</span> <span class="mi">2</span><span class="n">eurocents</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span> <span class="n">Port</span> <span class="mi">80</span><span class="o">&lt;/</span><span class="n">address</span><span class="o">&gt;</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 1-12 : le serveur a envoyé un document HTML malgré le fait que la requête était incorrecte (ligne 49 des résultats). Le document HTML permet au serveur de préciser la cause de l’erreur. Celle-ci est indiquée aux lignes 6 et 7 :</li>
<li>ligne 7 : notre client a utilisé le protocole HTTP ;</li>
<li>ligne 8 : le serveur travaille avec le protocole HTTPS (S=sécurisé) et n’accepte pas le protocole HTTP ;
Le document <strong>[output/www_sergetahe_com.html]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span>
<span class="normal"><a href="#__codelineno-28-5">5</a></span>
<span class="normal"><a href="#__codelineno-28-6">6</a></span>
<span class="normal"><a href="#__codelineno-28-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">HTML</span> <span class="n">PUBLIC</span> <span class="s2">&quot;-//IETF//DTD HTML 2.0//EN&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="o">&lt;</span><span class="n">html</span><span class="o">&gt;&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="mi">301</span> <span class="n">Moved</span> <span class="n">Permanently</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Moved</span> <span class="n">Permanently</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">The</span> <span class="n">document</span> <span class="n">has</span> <span class="n">moved</span> <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://sergetahe.com/cours-tutoriels-de-programmation/&quot;</span><span class="o">&gt;</span><span class="n">here</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;.&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Là également, il s’est produit une erreur (ligne 3). Néanmoins, le serveur prend soin d’envoyer un document HTML détaillant celle-ci (lignes 1-7).</p>
<h3 id="2144-exemple-4">21.4.4. Exemple 4</h3>
<p>Les exemples précédents nous ont montré que notre client HTTP était insuffisant. Nous allons maintenant présenter un outil appelé <strong>[curl]</strong> qui permet de récupérer des documents web en gérant les difficultés mentionnées : protocole HTTPS, document envoyé par morceaux, redirections… L’outil <strong>[curl]</strong> a été installé avec <a href="#_Installation_de_Laragon"><u><u>Laragon</u></u></a> :</p>
<p><img src="images/10000001000001D400000132261162F3.png" style="width:7.951cm;height:5.201cm;" alt="Image" /></p>
<p>Ouvrons un terminal PyCharm <strong>[1]</strong> :</p>
<p><img src="images/10000000000004730000020E7F96F69A.png" style="width:13.14cm;height:6.061cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, l’accès aux terminaux de PyCharm ;</li>
<li>en <strong>[2-3]</strong>, les terminaux déjà actifs ;</li>
<li>en <strong>[4]</strong>, le dossier dans lequel vous êtes. Dans ce qui suit il n’importe pas ;
Dans le terminal nous tapons la commande suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span>
<span class="normal"><a href="#__codelineno-29-4">4</a></span>
<span class="normal"><a href="#__codelineno-29-5">5</a></span>
<span class="normal"><a href="#__codelineno-29-6">6</a></span>
<span class="normal"><a href="#__codelineno-29-7">7</a></span>
<span class="normal"><a href="#__codelineno-29-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">curl</span> <span class="o">--</span><span class="n">help</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="n">Usage</span><span class="p">:</span> <span class="n">curl</span> <span class="p">[</span><span class="n">options</span><span class="o">...</span><span class="p">]</span> <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a>     <span class="o">--</span><span class="n">abstract</span><span class="o">-</span><span class="n">unix</span><span class="o">-</span><span class="n">socket</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">&gt;</span> <span class="n">Connect</span> <span class="n">via</span> <span class="n">abstract</span> <span class="n">Unix</span> <span class="n">domain</span> <span class="n">socket</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a>     <span class="o">--</span><span class="n">anyauth</span>       <span class="n">Pick</span> <span class="nb">any</span> <span class="n">authentication</span> <span class="n">method</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">--</span><span class="n">append</span>        <span class="n">Append</span> <span class="n">to</span> <span class="n">target</span> <span class="n">file</span> <span class="n">when</span> <span class="n">uploading</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a>     <span class="o">--</span><span class="n">basic</span>         <span class="n">Use</span> <span class="n">HTTP</span> <span class="n">Basic</span> <span class="n">Authentication</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a>     <span class="o">--</span><span class="n">cacert</span> <span class="o">&lt;</span><span class="n">CA</span> <span class="n">certificate</span><span class="o">&gt;</span> <span class="n">CA</span> <span class="n">certificate</span> <span class="n">to</span> <span class="n">verify</span> <span class="n">peer</span> <span class="n">against</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="err">…</span>
</code></pre></div></td></tr></table></div>
<p>Le fait que la commande <strong>[curl –help]</strong> ait produit des résultats montre que la commande <strong>[curl]</strong> est dans le PATH du terminal. Sous Windows, le PATH est l’ensemble des dossiers explorés lorsque l’utilisateur tape une commande exécutable, ici <strong>[curl]</strong>. La valeur du PATH peut être connue :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">echo</span> <span class="o">%</span><span class="n">PATH</span><span class="o">%</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span><span class="p">;</span><span class="n">C</span><span class="p">:</span>\<span class="n">Program</span> <span class="n">Files</span> <span class="p">(</span><span class="n">x86</span><span class="p">)</span>\<span class="n">Common</span> <span class="n">Files</span>\<span class="n">Oracle</span>\<span class="n">Java</span>\<span class="n">javapath</span><span class="p">;</span><span class="n">C</span><span class="p">:</span>\<span class="n">Program</span> <span class="n">Files</span>\<span class="n">Python38</span>\<span class="n">Scripts</span>\<span class="p">;</span><span class="n">C</span><span class="p">:</span>\<span class="n">Program</span> <span class="n">Files</span>\<span class="n">Python38</span>\<span class="p">;</span><span class="n">C</span><span class="p">:</span>\<span class="n">windows</span>\<span class="n">system32</span><span class="p">;</span><span class="n">C</span><span class="p">:</span>\<span class="n">windows</span><span class="p">;</span><span class="n">C</span><span class="p">:</span>\<span class="n">windows</span>\<span class="n">System32</span>\<span class="n">Wbem</span><span class="p">;</span><span class="n">C</span><span class="p">:</span>\<span class="n">windows</span>\<span class="n">System32</span>\<span class="n">WindowsPowerShell</span>\<span class="n">v1</span><span class="mf">.0</span>\<span class="p">;</span><span class="n">C</span><span class="p">:</span>\<span class="n">windows</span>\<span class="n">System32</span>\<span class="n">OpenSSH</span>\<span class="p">;</span><span class="n">C</span><span class="p">:</span>\<span class="n">Program</span> <span class="n">Files</span>\<span class="n">Git</span>\<span class="n">cmd</span><span class="p">;</span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">serge</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Microsoft</span>\<span class="n">WindowsApps</span><span class="p">;;</span><span class="n">C</span><span class="p">:</span>\<span class="n">Program</span> <span class="n">Files</span>\<span class="n">JetBrains</span>\<span class="n">PyCharm</span> <span class="n">Community</span> <span class="n">Edition</span> <span class="mf">2020.1.2</span>\<span class="nb">bin</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>Ligne 2, les dossiers du PATH séparés par des points-virgules. Dans cette liste n’apparaît pas de dossier lié à Laragon. Si on enquête un peu, on trouve qu’il y a un <strong>[curl]</strong> dans le dossier <strong>[c:\windows\system32]</strong>. C’est celui-ci qui a répondu auparavant.</p>
<p>Si on veut utiliser l’outil <strong>[curl]</strong> livré avec Laragon, on pourra procéder comme suit :</p>
<p><img src="images/1000000000000355000002339802FF5D.png" style="width:9.85cm;height:6.501cm;" alt="Image" /></p>
<p><img src="images/1000000000000557000001A4753C0ABE.png" style="width:15.781cm;height:4.851cm;" alt="Image" /></p>
<ul>
<li>en <strong>[2]</strong>, le terminal Laragon ;</li>
<li>en <strong>[3]</strong>, ce bouton permet de créer de nouveaux terminaux, chacun s’installant dans un onglet de la fenêtre ci-dessus ;</li>
<li>en <strong>[4]</strong>, on demande le PATH du terminal Laragon ;</li>
<li>on obtient quelque chose de très différent de ce qui avait été obtenu dans un terminal PyCharm. Ce PATH contient de nombreux dossiers créés lors de l’installation de Laragon. Le dossier contenant l’outil <strong>[curl]</strong> en fait partie :</li>
</ul>
<p><img src="images/100000000000041B0000014A3AB0BF24.png" style="width:12.112cm;height:3.811cm;" alt="Image" /></p>
<p>Par la suite, utilisez le terminal de votre choix. Sachez simplement que lorsque vous voulez utiliser un outil amené par Laragon, le terminal Laragon est à préférer.</p>
<p>La commande <strong>[curl --help]</strong> fait afficher toutes les options de configuration de <strong>[curl]</strong>. Il y en a plusieurs dizaines. Nous en utiliserons très peu. Pour demander une URL il suffit de taper la commande <strong>[curl URL]</strong>. Cette commande affichera sur la console le document demandé. Si on veut de plus les échanges HTTP entre le client et le serveur on écrira <strong>[curl --verbose URL]</strong>. Enfin pour enregistrer le document HTML demandé dans un fichier on écrira <strong>[curl --verbose --output fichier URL]</strong>.</p>
<p>Pour éviter de polluer le système de fichiers de notre machine, déplaçons-nous à un autre endroit (j’utilise ici un terminal Laragon) :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="n">λ</span> <span class="n">cd</span> \<span class="n">Temp</span>\
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Temp</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="n">λ</span> <span class="n">mkdir</span> <span class="n">curl</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Temp</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="n">λ</span> <span class="n">cd</span> <span class="n">curl</span>\
<a id="__codelineno-31-8" name="__codelineno-31-8"></a>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Temp</span>\<span class="n">curl</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="n">λ</span> <span class="nb">dir</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a> <span class="n">Le</span> <span class="n">volume</span> <span class="n">dans</span> <span class="n">le</span> <span class="n">lecteur</span> <span class="n">C</span> <span class="n">s</span><span class="err">’</span><span class="n">appelle</span> <span class="n">Local</span> <span class="n">Disk</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a> <span class="n">Le</span> <span class="n">numéro</span> <span class="n">de</span> <span class="n">série</span> <span class="n">du</span> <span class="n">volume</span> <span class="n">est</span> <span class="n">B84C</span><span class="o">-</span><span class="n">D958</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a> <span class="n">Répertoire</span> <span class="n">de</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Temp</span>\<span class="n">curl</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a><span class="mi">05</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">2020</span>  <span class="mi">19</span><span class="p">:</span><span class="mi">31</span>    <span class="o">&lt;</span><span class="n">DIR</span><span class="o">&gt;</span>          <span class="o">.</span>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="mi">05</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">2020</span>  <span class="mi">19</span><span class="p">:</span><span class="mi">31</span>    <span class="o">&lt;</span><span class="n">DIR</span><span class="o">&gt;</span>          <span class="o">..</span>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a>               <span class="mi">0</span> <span class="n">fichier</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>                <span class="mi">0</span> <span class="n">octets</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a>               <span class="mi">2</span> <span class="n">Rép</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="mi">892</span> <span class="mi">388</span> <span class="mi">098</span> <span class="mi">048</span> <span class="n">octets</span> <span class="n">libres</span>                                          
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 3, on se déplace dans le dossier <strong>[c:\temp]</strong>. Si ce dossier n’existe pas, vous pouvez le créer ou en choisir un autre ;</li>
<li>ligne 6, on crée un dossier appelé <strong>[curl]</strong> ;</li>
<li>ligne 9, on se positionne dessus ;</li>
<li>ligne 12, on liste son contenu. Il est vide (ligne 20);
Assurez-vous que le serveur Apache de Laragon est lancé et avec <strong>[curl]</strong> demandez l’URL <strong>[http://localhost/]</strong> avec la commande <strong>[curl –verbose –output localhost.html http://localhost/]</strong>. On obtient les résultats suivants :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span>
<span class="normal"><a href="#__codelineno-32-14">14</a></span>
<span class="normal"><a href="#__codelineno-32-15">15</a></span>
<span class="normal"><a href="#__codelineno-32-16">16</a></span>
<span class="normal"><a href="#__codelineno-32-17">17</a></span>
<span class="normal"><a href="#__codelineno-32-18">18</a></span>
<span class="normal"><a href="#__codelineno-32-19">19</a></span>
<span class="normal"><a href="#__codelineno-32-20">20</a></span>
<span class="normal"><a href="#__codelineno-32-21">21</a></span>
<span class="normal"><a href="#__codelineno-32-22">22</a></span>
<span class="normal"><a href="#__codelineno-32-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="n">λ</span> <span class="n">curl</span> <span class="o">--</span><span class="n">verbose</span> <span class="o">--</span><span class="n">output</span> <span class="n">localhost</span><span class="o">.</span><span class="n">html</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="o">/</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>  <span class="o">%</span> <span class="n">Total</span>    <span class="o">%</span> <span class="n">Received</span> <span class="o">%</span> <span class="n">Xferd</span>  <span class="n">Average</span> <span class="n">Speed</span>   <span class="n">Time</span>    <span class="n">Time</span>     <span class="n">Time</span>  <span class="n">Current</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a>                                 <span class="n">Dload</span>  <span class="n">Upload</span>   <span class="n">Total</span>   <span class="n">Spent</span>    <span class="n">Left</span>  <span class="n">Speed</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>  <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>      <span class="mi">0</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>     <span class="mi">0</span><span class="o">*</span>   <span class="n">Trying</span> <span class="p">::</span><span class="mf">1.</span><span class="o">..</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="o">*</span> <span class="n">TCP_NODELAY</span> <span class="nb">set</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="o">*</span>   <span class="n">Trying</span> <span class="mf">127.0.0.1</span><span class="o">...</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="o">*</span> <span class="n">TCP_NODELAY</span> <span class="nb">set</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>  <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>      <span class="mi">0</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>     <span class="mi">0</span><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">localhost</span> <span class="p">(::</span><span class="mi">1</span><span class="p">)</span> <span class="n">port</span> <span class="mi">80</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a>  <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>      <span class="mi">0</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>     <span class="mi">0</span><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="o">&gt;</span> <span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span>
<a id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="o">&gt;</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">curl</span><span class="o">/</span><span class="mf">7.63.0</span>
<a id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="o">&gt;</span> <span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="o">&gt;</span>
<a id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">17</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">43</span> <span class="n">GMT</span>
<a id="__codelineno-32-16" name="__codelineno-32-16"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.35</span> <span class="p">(</span><span class="n">Win64</span><span class="p">)</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">b</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span>
<a id="__codelineno-32-17" name="__codelineno-32-17"></a><span class="o">&lt;</span> <span class="n">X</span><span class="o">-</span><span class="n">Powered</span><span class="o">-</span><span class="n">By</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span>
<a id="__codelineno-32-18" name="__codelineno-32-18"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">1776</span>
<a id="__codelineno-32-19" name="__codelineno-32-19"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-32-20" name="__codelineno-32-20"></a><span class="o">&lt;</span>
<a id="__codelineno-32-21" name="__codelineno-32-21"></a><span class="p">{</span> <span class="p">[</span><span class="mi">1776</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-32-22" name="__codelineno-32-22"></a><span class="mi">100</span>  <span class="mi">1776</span>  <span class="mi">100</span>  <span class="mi">1776</span>    <span class="mi">0</span>     <span class="mi">0</span>   <span class="mi">1062</span>      <span class="mi">0</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>  <span class="mi">1062</span>
<a id="__codelineno-32-23" name="__codelineno-32-23"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host localhost left intact</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 10-13 : lignes envoyées par <strong>[curl]</strong> au serveur <strong>[localhost]</strong>. On reconnaît le protocole HTTP ;</li>
<li>lignes 14-20 : lignes envoyées en réponse par le serveur ;</li>
<li>ligne 14 : indique qu’on a bien eu le document demandé ;
Le fichier <strong>[localhost.html]</strong> contient le document demandé. Vous pouvez le vérifier en chargeant le fichier dans un éditeur de texte.</li>
</ul>
<p>Maintenant demandons l’URL <strong>[https://tahe.developpez.com:443/]</strong>. Pour avoir cette URL, le client HTTP doit savoir parler HTTPS. C’est le cas du client <strong>[curl]</strong>.</p>
<p>Les résultats console sont les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span>
<span class="normal"><a href="#__codelineno-33-17">17</a></span>
<span class="normal"><a href="#__codelineno-33-18">18</a></span>
<span class="normal"><a href="#__codelineno-33-19">19</a></span>
<span class="normal"><a href="#__codelineno-33-20">20</a></span>
<span class="normal"><a href="#__codelineno-33-21">21</a></span>
<span class="normal"><a href="#__codelineno-33-22">22</a></span>
<span class="normal"><a href="#__codelineno-33-23">23</a></span>
<span class="normal"><a href="#__codelineno-33-24">24</a></span>
<span class="normal"><a href="#__codelineno-33-25">25</a></span>
<span class="normal"><a href="#__codelineno-33-26">26</a></span>
<span class="normal"><a href="#__codelineno-33-27">27</a></span>
<span class="normal"><a href="#__codelineno-33-28">28</a></span>
<span class="normal"><a href="#__codelineno-33-29">29</a></span>
<span class="normal"><a href="#__codelineno-33-30">30</a></span>
<span class="normal"><a href="#__codelineno-33-31">31</a></span>
<span class="normal"><a href="#__codelineno-33-32">32</a></span>
<span class="normal"><a href="#__codelineno-33-33">33</a></span>
<span class="normal"><a href="#__codelineno-33-34">34</a></span>
<span class="normal"><a href="#__codelineno-33-35">35</a></span>
<span class="normal"><a href="#__codelineno-33-36">36</a></span>
<span class="normal"><a href="#__codelineno-33-37">37</a></span>
<span class="normal"><a href="#__codelineno-33-38">38</a></span>
<span class="normal"><a href="#__codelineno-33-39">39</a></span>
<span class="normal"><a href="#__codelineno-33-40">40</a></span>
<span class="normal"><a href="#__codelineno-33-41">41</a></span>
<span class="normal"><a href="#__codelineno-33-42">42</a></span>
<span class="normal"><a href="#__codelineno-33-43">43</a></span>
<span class="normal"><a href="#__codelineno-33-44">44</a></span>
<span class="normal"><a href="#__codelineno-33-45">45</a></span>
<span class="normal"><a href="#__codelineno-33-46">46</a></span>
<span class="normal"><a href="#__codelineno-33-47">47</a></span>
<span class="normal"><a href="#__codelineno-33-48">48</a></span>
<span class="normal"><a href="#__codelineno-33-49">49</a></span>
<span class="normal"><a href="#__codelineno-33-50">50</a></span>
<span class="normal"><a href="#__codelineno-33-51">51</a></span>
<span class="normal"><a href="#__codelineno-33-52">52</a></span>
<span class="normal"><a href="#__codelineno-33-53">53</a></span>
<span class="normal"><a href="#__codelineno-33-54">54</a></span>
<span class="normal"><a href="#__codelineno-33-55">55</a></span>
<span class="normal"><a href="#__codelineno-33-56">56</a></span>
<span class="normal"><a href="#__codelineno-33-57">57</a></span>
<span class="normal"><a href="#__codelineno-33-58">58</a></span>
<span class="normal"><a href="#__codelineno-33-59">59</a></span>
<span class="normal"><a href="#__codelineno-33-60">60</a></span>
<span class="normal"><a href="#__codelineno-33-61">61</a></span>
<span class="normal"><a href="#__codelineno-33-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Temp</span>\<span class="n">curl</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="n">λ</span> <span class="n">curl</span> <span class="o">--</span><span class="n">verbose</span> <span class="o">--</span><span class="n">output</span> <span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">html</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="mi">443</span><span class="o">/</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a>  <span class="o">%</span> <span class="n">Total</span>    <span class="o">%</span> <span class="n">Received</span> <span class="o">%</span> <span class="n">Xferd</span>  <span class="n">Average</span> <span class="n">Speed</span>   <span class="n">Time</span>    <span class="n">Time</span>     <span class="n">Time</span>  <span class="n">Current</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>                                 <span class="n">Dload</span>  <span class="n">Upload</span>   <span class="n">Total</span>   <span class="n">Spent</span>    <span class="n">Left</span>  <span class="n">Speed</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a>  <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>      <span class="mi">0</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>     <span class="mi">0</span><span class="o">*</span>   <span class="n">Trying</span> <span class="mf">87.98.130.52</span><span class="o">...</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="o">*</span> <span class="n">TCP_NODELAY</span> <span class="nb">set</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a>  <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>      <span class="mi">0</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>     <span class="mi">0</span><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span> <span class="p">(</span><span class="mf">87.98.130.52</span><span class="p">)</span> <span class="n">port</span> <span class="mi">443</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="o">*</span> <span class="n">ALPN</span><span class="p">,</span> <span class="n">offering</span> <span class="n">h2</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="o">*</span> <span class="n">ALPN</span><span class="p">,</span> <span class="n">offering</span> <span class="n">http</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="o">*</span> <span class="n">successfully</span> <span class="nb">set</span> <span class="n">certificate</span> <span class="n">verify</span> <span class="n">locations</span><span class="p">:</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="o">*</span>   <span class="n">CAfile</span><span class="p">:</span> <span class="n">C</span><span class="p">:</span>\<span class="n">MyPrograms</span>\<span class="n">laragon</span>\<span class="nb">bin</span>\<span class="n">laragon</span>\<span class="n">utils</span>\<span class="n">curl</span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">bundle</span><span class="o">.</span><span class="n">crt</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a>  <span class="n">CApath</span><span class="p">:</span> <span class="n">none</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="p">}</span> <span class="p">[</span><span class="mi">5</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">OUT</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Client</span> <span class="n">hello</span> <span class="p">(</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="p">}</span> <span class="p">[</span><span class="mi">512</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Server</span> <span class="n">hello</span> <span class="p">(</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="p">{</span> <span class="p">[</span><span class="mi">122</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Encrypted</span> <span class="n">Extensions</span> <span class="p">(</span><span class="mi">8</span><span class="p">):</span>
<a id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="p">{</span> <span class="p">[</span><span class="mi">25</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Certificate</span> <span class="p">(</span><span class="mi">11</span><span class="p">):</span>
<a id="__codelineno-33-21" name="__codelineno-33-21"></a><span class="p">{</span> <span class="p">[</span><span class="mi">2563</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-22" name="__codelineno-33-22"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">CERT</span> <span class="n">verify</span> <span class="p">(</span><span class="mi">15</span><span class="p">):</span>
<a id="__codelineno-33-23" name="__codelineno-33-23"></a><span class="p">{</span> <span class="p">[</span><span class="mi">264</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-24" name="__codelineno-33-24"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Finished</span> <span class="p">(</span><span class="mi">20</span><span class="p">):</span>
<a id="__codelineno-33-25" name="__codelineno-33-25"></a><span class="p">{</span> <span class="p">[</span><span class="mi">52</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-26" name="__codelineno-33-26"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">OUT</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">change</span> <span class="n">cipher</span><span class="p">,</span> <span class="n">Change</span> <span class="n">cipher</span> <span class="n">spec</span> <span class="p">(</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-33-27" name="__codelineno-33-27"></a><span class="p">}</span> <span class="p">[</span><span class="mi">1</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-28" name="__codelineno-33-28"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">OUT</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Finished</span> <span class="p">(</span><span class="mi">20</span><span class="p">):</span>
<a id="__codelineno-33-29" name="__codelineno-33-29"></a><span class="p">}</span> <span class="p">[</span><span class="mi">52</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-30" name="__codelineno-33-30"></a><span class="o">*</span> <span class="n">SSL</span> <span class="n">connection</span> <span class="n">using</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="o">/</span> <span class="n">TLS_AES_256_GCM_SHA384</span>
<a id="__codelineno-33-31" name="__codelineno-33-31"></a><span class="o">*</span> <span class="n">ALPN</span><span class="p">,</span> <span class="n">server</span> <span class="n">accepted</span> <span class="n">to</span> <span class="n">use</span> <span class="n">http</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-33-32" name="__codelineno-33-32"></a><span class="o">*</span> <span class="n">Server</span> <span class="n">certificate</span><span class="p">:</span>
<a id="__codelineno-33-33" name="__codelineno-33-33"></a><span class="o">*</span>  <span class="n">subject</span><span class="p">:</span> <span class="n">CN</span><span class="o">=*.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-33-34" name="__codelineno-33-34"></a><span class="o">*</span>  <span class="n">start</span> <span class="n">date</span><span class="p">:</span> <span class="n">Jul</span>  <span class="mi">1</span> <span class="mi">15</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">30</span> <span class="mi">2020</span> <span class="n">GMT</span>
<a id="__codelineno-33-35" name="__codelineno-33-35"></a><span class="o">*</span>  <span class="n">expire</span> <span class="n">date</span><span class="p">:</span> <span class="n">Sep</span> <span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">30</span> <span class="mi">2020</span> <span class="n">GMT</span>
<a id="__codelineno-33-36" name="__codelineno-33-36"></a><span class="o">*</span>  <span class="n">subjectAltName</span><span class="p">:</span> <span class="n">host</span> <span class="s2">&quot;tahe.developpez.com&quot;</span> <span class="n">matched</span> <span class="n">cert</span><span class="s1">&#39;s &quot;*.developpez.com&quot;</span>
<a id="__codelineno-33-37" name="__codelineno-33-37"></a><span class="o">*</span>  <span class="n">issuer</span><span class="p">:</span> <span class="n">C</span><span class="o">=</span><span class="n">US</span><span class="p">;</span> <span class="n">O</span><span class="o">=</span><span class="n">Let</span><span class="s1">&#39;s Encrypt; CN=Let&#39;</span><span class="n">s</span> <span class="n">Encrypt</span> <span class="n">Authority</span> <span class="n">X3</span>
<a id="__codelineno-33-38" name="__codelineno-33-38"></a><span class="o">*</span>  <span class="n">SSL</span> <span class="n">certificate</span> <span class="n">verify</span> <span class="n">ok</span><span class="o">.</span>
<a id="__codelineno-33-39" name="__codelineno-33-39"></a><span class="p">}</span> <span class="p">[</span><span class="mi">5</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-40" name="__codelineno-33-40"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-33-41" name="__codelineno-33-41"></a><span class="o">&gt;</span> <span class="n">Host</span><span class="p">:</span> <span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-33-42" name="__codelineno-33-42"></a><span class="o">&gt;</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">curl</span><span class="o">/</span><span class="mf">7.63.0</span>
<a id="__codelineno-33-43" name="__codelineno-33-43"></a><span class="o">&gt;</span> <span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-33-44" name="__codelineno-33-44"></a><span class="o">&gt;</span>
<a id="__codelineno-33-45" name="__codelineno-33-45"></a><span class="p">{</span> <span class="p">[</span><span class="mi">5</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-46" name="__codelineno-33-46"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Newsession</span> <span class="n">Ticket</span> <span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-33-47" name="__codelineno-33-47"></a><span class="p">{</span> <span class="p">[</span><span class="mi">281</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-48" name="__codelineno-33-48"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Newsession</span> <span class="n">Ticket</span> <span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-33-49" name="__codelineno-33-49"></a><span class="p">{</span> <span class="p">[</span><span class="mi">297</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-50" name="__codelineno-33-50"></a><span class="o">*</span> <span class="n">old</span> <span class="n">SSL</span> <span class="n">session</span> <span class="n">ID</span> <span class="ow">is</span> <span class="n">stale</span><span class="p">,</span> <span class="n">removing</span>
<a id="__codelineno-33-51" name="__codelineno-33-51"></a><span class="p">{</span> <span class="p">[</span><span class="mi">5</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-52" name="__codelineno-33-52"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-33-53" name="__codelineno-33-53"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">17</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">53</span> <span class="n">GMT</span>
<a id="__codelineno-33-54" name="__codelineno-33-54"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.38</span> <span class="p">(</span><span class="n">Debian</span><span class="p">)</span>
<a id="__codelineno-33-55" name="__codelineno-33-55"></a><span class="o">&lt;</span> <span class="n">X</span><span class="o">-</span><span class="n">Powered</span><span class="o">-</span><span class="n">By</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">5.3.29</span>
<a id="__codelineno-33-56" name="__codelineno-33-56"></a><span class="o">&lt;</span> <span class="n">Vary</span><span class="p">:</span> <span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span>
<a id="__codelineno-33-57" name="__codelineno-33-57"></a><span class="o">&lt;</span> <span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">chunked</span>
<a id="__codelineno-33-58" name="__codelineno-33-58"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span>
<a id="__codelineno-33-59" name="__codelineno-33-59"></a><span class="o">&lt;</span>
<a id="__codelineno-33-60" name="__codelineno-33-60"></a><span class="p">{</span> <span class="p">[</span><span class="mi">6</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-33-61" name="__codelineno-33-61"></a><span class="mi">100</span>   <span class="mi">99</span><span class="n">k</span>    <span class="mi">0</span>   <span class="mi">99</span><span class="n">k</span>    <span class="mi">0</span>     <span class="mi">0</span>  <span class="mi">79343</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="mi">79343</span>
<a id="__codelineno-33-62" name="__codelineno-33-62"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host tahe.developpez.com left intact</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 10-39 : les échanges client / serveur pour sécuriser la connexion : celle-ci sera chiffrée ;</li>
<li>lignes 41-44 : les entêtes HTTP envoyés par le client <strong>[curl]</strong> au serveur ;</li>
<li>ligne 52 : le document demandé a bien été trouvé ;</li>
<li>ligne 57 : le document est envoyé par morceaux ;
<strong>[curl]</strong> gère correctement à la fois le protocole sécurisé HTTPS et le fait que le document soit envoyé par morceaux. Le document envoyé sera trouvé ici dans le fichier <strong>[tahe.developpez.com.html]</strong>.</li>
</ul>
<p>Demandons maintenant l’URL <strong>[http://sergetahe.com/cours-tutoriels-de-programmation]</strong>. Nous avions vu que pour cette URL, il y avait une redirection vers l’URL <strong>[http://sergetahe.com/cours-tutoriels-de-programmation/]</strong> (avec un / à la fin).</p>
<p>Les résultats console sont alors les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">  1</a></span>
<span class="normal"><a href="#__codelineno-34-2">  2</a></span>
<span class="normal"><a href="#__codelineno-34-3">  3</a></span>
<span class="normal"><a href="#__codelineno-34-4">  4</a></span>
<span class="normal"><a href="#__codelineno-34-5">  5</a></span>
<span class="normal"><a href="#__codelineno-34-6">  6</a></span>
<span class="normal"><a href="#__codelineno-34-7">  7</a></span>
<span class="normal"><a href="#__codelineno-34-8">  8</a></span>
<span class="normal"><a href="#__codelineno-34-9">  9</a></span>
<span class="normal"><a href="#__codelineno-34-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-34-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-34-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-34-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-34-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-34-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-34-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-34-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-34-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-34-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-34-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-34-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-34-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-34-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-34-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-34-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-34-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-34-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-34-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-34-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-34-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-34-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-34-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-34-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-34-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-34-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-34-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-34-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-34-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-34-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-34-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-34-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-34-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-34-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-34-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-34-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-34-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-34-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-34-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-34-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-34-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-34-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-34-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-34-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-34-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-34-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-34-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-34-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-34-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-34-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-34-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-34-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-34-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-34-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-34-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-34-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-34-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-34-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-34-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-34-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-34-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-34-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-34-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-34-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-34-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-34-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-34-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-34-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-34-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-34-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-34-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-34-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-34-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-34-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-34-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-34-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-34-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-34-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-34-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-34-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-34-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-34-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-34-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-34-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-34-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-34-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-34-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-34-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-34-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-34-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-34-100">100</a></span>
<span class="normal"><a href="#__codelineno-34-101">101</a></span>
<span class="normal"><a href="#__codelineno-34-102">102</a></span>
<span class="normal"><a href="#__codelineno-34-103">103</a></span>
<span class="normal"><a href="#__codelineno-34-104">104</a></span>
<span class="normal"><a href="#__codelineno-34-105">105</a></span>
<span class="normal"><a href="#__codelineno-34-106">106</a></span>
<span class="normal"><a href="#__codelineno-34-107">107</a></span>
<span class="normal"><a href="#__codelineno-34-108">108</a></span>
<span class="normal"><a href="#__codelineno-34-109">109</a></span>
<span class="normal"><a href="#__codelineno-34-110">110</a></span>
<span class="normal"><a href="#__codelineno-34-111">111</a></span>
<span class="normal"><a href="#__codelineno-34-112">112</a></span>
<span class="normal"><a href="#__codelineno-34-113">113</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Temp</span>\<span class="n">curl</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="n">λ</span> <span class="n">curl</span> <span class="o">--</span><span class="n">verbose</span> <span class="o">--</span><span class="n">output</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">html</span> <span class="o">--</span><span class="n">location</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a>  <span class="o">%</span> <span class="n">Total</span>    <span class="o">%</span> <span class="n">Received</span> <span class="o">%</span> <span class="n">Xferd</span>  <span class="n">Average</span> <span class="n">Speed</span>   <span class="n">Time</span>    <span class="n">Time</span>     <span class="n">Time</span>  <span class="n">Current</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a>                                 <span class="n">Dload</span>  <span class="n">Upload</span>   <span class="n">Total</span>   <span class="n">Spent</span>    <span class="n">Left</span>  <span class="n">Speed</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a>  <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>      <span class="mi">0</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>     <span class="mi">0</span><span class="o">*</span>   <span class="n">Trying</span> <span class="mf">87.98.154.146</span><span class="o">...</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="o">*</span> <span class="n">TCP_NODELAY</span> <span class="nb">set</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span> <span class="p">(</span><span class="mf">87.98.154.146</span><span class="p">)</span> <span class="n">port</span> <span class="mi">80</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="o">&gt;</span> <span class="n">Host</span><span class="p">:</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="o">&gt;</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">curl</span><span class="o">/</span><span class="mf">7.63.0</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="o">&gt;</span> <span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a><span class="o">&gt;</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">301</span> <span class="n">Moved</span> <span class="n">Permanently</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">17</span> <span class="n">GMT</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">iso</span><span class="o">-</span><span class="mi">8859</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">262</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span>
<a id="__codelineno-34-18" name="__codelineno-34-18"></a><span class="o">&lt;</span> <span class="n">Location</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span>
<a id="__codelineno-34-19" name="__codelineno-34-19"></a><span class="o">&lt;</span> <span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">SERVERID68971</span><span class="o">=</span><span class="mi">2620178</span><span class="o">|</span><span class="n">XwIRd</span><span class="o">|</span><span class="n">XwIRd</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span>
<a id="__codelineno-34-20" name="__codelineno-34-20"></a><span class="o">&lt;</span> <span class="n">X</span><span class="o">-</span><span class="n">IPLB</span><span class="o">-</span><span class="n">Instance</span><span class="p">:</span> <span class="mi">17095</span>
<a id="__codelineno-34-21" name="__codelineno-34-21"></a><span class="o">&lt;</span>
<a id="__codelineno-34-22" name="__codelineno-34-22"></a><span class="o">*</span> <span class="n">Ignoring</span> <span class="n">the</span> <span class="n">response</span><span class="o">-</span><span class="n">body</span>
<a id="__codelineno-34-23" name="__codelineno-34-23"></a><span class="p">{</span> <span class="p">[</span><span class="mi">262</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-24" name="__codelineno-34-24"></a><span class="mi">100</span>   <span class="mi">262</span>  <span class="mi">100</span>   <span class="mi">262</span>    <span class="mi">0</span>     <span class="mi">0</span>   <span class="mi">1858</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>  <span class="mi">1858</span>
<a id="__codelineno-34-25" name="__codelineno-34-25"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host sergetahe.com left intact</span>
<a id="__codelineno-34-26" name="__codelineno-34-26"></a><span class="o">*</span> <span class="n">Issue</span> <span class="n">another</span> <span class="n">request</span> <span class="n">to</span> <span class="n">this</span> <span class="n">URL</span><span class="p">:</span> <span class="s1">&#39;http://sergetahe.com/cours-tutoriels-de-programmation/&#39;</span>
<a id="__codelineno-34-27" name="__codelineno-34-27"></a><span class="o">*</span> <span class="n">Found</span> <span class="n">bundle</span> <span class="k">for</span> <span class="n">host</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">:</span> <span class="mh">0x14385f8</span> <span class="p">[</span><span class="n">can</span> <span class="n">pipeline</span><span class="p">]</span>
<a id="__codelineno-34-28" name="__codelineno-34-28"></a><span class="o">*</span> <span class="n">Could</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">asked</span> <span class="n">to</span><span class="err">!</span>
<a id="__codelineno-34-29" name="__codelineno-34-29"></a><span class="o">*</span> <span class="n">Re</span><span class="o">-</span><span class="n">using</span> <span class="n">existing</span> <span class="n">connection</span><span class="err">!</span> <span class="p">(</span><span class="c1">#0) with host sergetahe.com</span>
<a id="__codelineno-34-30" name="__codelineno-34-30"></a><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span> <span class="p">(</span><span class="mf">87.98.154.146</span><span class="p">)</span> <span class="n">port</span> <span class="mi">80</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-34-31" name="__codelineno-34-31"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-34-32" name="__codelineno-34-32"></a><span class="o">&gt;</span> <span class="n">Host</span><span class="p">:</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-34-33" name="__codelineno-34-33"></a><span class="o">&gt;</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">curl</span><span class="o">/</span><span class="mf">7.63.0</span>
<a id="__codelineno-34-34" name="__codelineno-34-34"></a><span class="o">&gt;</span> <span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-34-35" name="__codelineno-34-35"></a><span class="o">&gt;</span>
<a id="__codelineno-34-36" name="__codelineno-34-36"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">301</span> <span class="n">Moved</span> <span class="n">Permanently</span>
<a id="__codelineno-34-37" name="__codelineno-34-37"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">17</span> <span class="n">GMT</span>
<a id="__codelineno-34-38" name="__codelineno-34-38"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">iso</span><span class="o">-</span><span class="mi">8859</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-34-39" name="__codelineno-34-39"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">263</span>
<a id="__codelineno-34-40" name="__codelineno-34-40"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span>
<a id="__codelineno-34-41" name="__codelineno-34-41"></a><span class="o">&lt;</span> <span class="n">Location</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span>
<a id="__codelineno-34-42" name="__codelineno-34-42"></a><span class="o">&lt;</span> <span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">SERVERID68971</span><span class="o">=</span><span class="mi">2620178</span><span class="o">|</span><span class="n">XwIRd</span><span class="o">|</span><span class="n">XwIRd</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span>
<a id="__codelineno-34-43" name="__codelineno-34-43"></a><span class="o">&lt;</span> <span class="n">X</span><span class="o">-</span><span class="n">IPLB</span><span class="o">-</span><span class="n">Instance</span><span class="p">:</span> <span class="mi">17095</span>
<a id="__codelineno-34-44" name="__codelineno-34-44"></a><span class="o">&lt;</span>
<a id="__codelineno-34-45" name="__codelineno-34-45"></a><span class="o">*</span> <span class="n">Ignoring</span> <span class="n">the</span> <span class="n">response</span><span class="o">-</span><span class="n">body</span>
<a id="__codelineno-34-46" name="__codelineno-34-46"></a><span class="p">{</span> <span class="p">[</span><span class="mi">263</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-47" name="__codelineno-34-47"></a><span class="mi">100</span>   <span class="mi">263</span>  <span class="mi">100</span>   <span class="mi">263</span>    <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">764</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>   <span class="mi">764</span>
<a id="__codelineno-34-48" name="__codelineno-34-48"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host sergetahe.com left intact</span>
<a id="__codelineno-34-49" name="__codelineno-34-49"></a><span class="o">*</span> <span class="n">Issue</span> <span class="n">another</span> <span class="n">request</span> <span class="n">to</span> <span class="n">this</span> <span class="n">URL</span><span class="p">:</span> <span class="s1">&#39;https://sergetahe.com/cours-tutoriels-de-programmation/&#39;</span>
<a id="__codelineno-34-50" name="__codelineno-34-50"></a><span class="o">*</span>   <span class="n">Trying</span> <span class="mf">87.98.154.146</span><span class="o">...</span>
<a id="__codelineno-34-51" name="__codelineno-34-51"></a><span class="o">*</span> <span class="n">TCP_NODELAY</span> <span class="nb">set</span>
<a id="__codelineno-34-52" name="__codelineno-34-52"></a><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span> <span class="p">(</span><span class="mf">87.98.154.146</span><span class="p">)</span> <span class="n">port</span> <span class="mi">443</span> <span class="p">(</span><span class="c1">#1)</span>
<a id="__codelineno-34-53" name="__codelineno-34-53"></a><span class="o">*</span> <span class="n">ALPN</span><span class="p">,</span> <span class="n">offering</span> <span class="n">h2</span>
<a id="__codelineno-34-54" name="__codelineno-34-54"></a><span class="o">*</span> <span class="n">ALPN</span><span class="p">,</span> <span class="n">offering</span> <span class="n">http</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-34-55" name="__codelineno-34-55"></a><span class="o">*</span> <span class="n">successfully</span> <span class="nb">set</span> <span class="n">certificate</span> <span class="n">verify</span> <span class="n">locations</span><span class="p">:</span>
<a id="__codelineno-34-56" name="__codelineno-34-56"></a><span class="o">*</span>   <span class="n">CAfile</span><span class="p">:</span> <span class="n">C</span><span class="p">:</span>\<span class="n">MyPrograms</span>\<span class="n">laragon</span>\<span class="nb">bin</span>\<span class="n">laragon</span>\<span class="n">utils</span>\<span class="n">curl</span><span class="o">-</span><span class="n">ca</span><span class="o">-</span><span class="n">bundle</span><span class="o">.</span><span class="n">crt</span>
<a id="__codelineno-34-57" name="__codelineno-34-57"></a>  <span class="n">CApath</span><span class="p">:</span> <span class="n">none</span>
<a id="__codelineno-34-58" name="__codelineno-34-58"></a><span class="p">}</span> <span class="p">[</span><span class="mi">5</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-59" name="__codelineno-34-59"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">OUT</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Client</span> <span class="n">hello</span> <span class="p">(</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-34-60" name="__codelineno-34-60"></a><span class="p">}</span> <span class="p">[</span><span class="mi">512</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-61" name="__codelineno-34-61"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Server</span> <span class="n">hello</span> <span class="p">(</span><span class="mi">2</span><span class="p">):</span>
<a id="__codelineno-34-62" name="__codelineno-34-62"></a><span class="p">{</span> <span class="p">[</span><span class="mi">102</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-63" name="__codelineno-34-63"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.2</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Certificate</span> <span class="p">(</span><span class="mi">11</span><span class="p">):</span>
<a id="__codelineno-34-64" name="__codelineno-34-64"></a><span class="p">{</span> <span class="p">[</span><span class="mi">2572</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-65" name="__codelineno-34-65"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.2</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Server</span> <span class="n">key</span> <span class="n">exchange</span> <span class="p">(</span><span class="mi">12</span><span class="p">):</span>
<a id="__codelineno-34-66" name="__codelineno-34-66"></a><span class="p">{</span> <span class="p">[</span><span class="mi">333</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-67" name="__codelineno-34-67"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.2</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Server</span> <span class="n">finished</span> <span class="p">(</span><span class="mi">14</span><span class="p">):</span>
<a id="__codelineno-34-68" name="__codelineno-34-68"></a><span class="p">{</span> <span class="p">[</span><span class="mi">4</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-69" name="__codelineno-34-69"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.2</span> <span class="p">(</span><span class="n">OUT</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Client</span> <span class="n">key</span> <span class="n">exchange</span> <span class="p">(</span><span class="mi">16</span><span class="p">):</span>
<a id="__codelineno-34-70" name="__codelineno-34-70"></a><span class="p">}</span> <span class="p">[</span><span class="mi">70</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-71" name="__codelineno-34-71"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.2</span> <span class="p">(</span><span class="n">OUT</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">change</span> <span class="n">cipher</span><span class="p">,</span> <span class="n">Change</span> <span class="n">cipher</span> <span class="n">spec</span> <span class="p">(</span><span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-34-72" name="__codelineno-34-72"></a><span class="p">}</span> <span class="p">[</span><span class="mi">1</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-73" name="__codelineno-34-73"></a><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.2</span> <span class="p">(</span><span class="n">OUT</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Finished</span> <span class="p">(</span><span class="mi">20</span><span class="p">):</span>
<a id="__codelineno-34-74" name="__codelineno-34-74"></a><span class="p">}</span> <span class="p">[</span><span class="mi">16</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-75" name="__codelineno-34-75"></a>  <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>      <span class="mi">0</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>     <span class="mi">0</span><span class="o">*</span> <span class="n">TLSv1</span><span class="mf">.2</span> <span class="p">(</span><span class="n">IN</span><span class="p">),</span> <span class="n">TLS</span> <span class="n">handshake</span><span class="p">,</span> <span class="n">Finished</span> <span class="p">(</span><span class="mi">20</span><span class="p">):</span>
<a id="__codelineno-34-76" name="__codelineno-34-76"></a><span class="p">{</span> <span class="p">[</span><span class="mi">16</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-77" name="__codelineno-34-77"></a><span class="o">*</span> <span class="n">SSL</span> <span class="n">connection</span> <span class="n">using</span> <span class="n">TLSv1</span><span class="mf">.2</span> <span class="o">/</span> <span class="n">ECDHE</span><span class="o">-</span><span class="n">RSA</span><span class="o">-</span><span class="n">AES128</span><span class="o">-</span><span class="n">GCM</span><span class="o">-</span><span class="n">SHA256</span>
<a id="__codelineno-34-78" name="__codelineno-34-78"></a><span class="o">*</span> <span class="n">ALPN</span><span class="p">,</span> <span class="n">server</span> <span class="n">accepted</span> <span class="n">to</span> <span class="n">use</span> <span class="n">h2</span>
<a id="__codelineno-34-79" name="__codelineno-34-79"></a><span class="o">*</span> <span class="n">Server</span> <span class="n">certificate</span><span class="p">:</span>
<a id="__codelineno-34-80" name="__codelineno-34-80"></a><span class="o">*</span>  <span class="n">subject</span><span class="p">:</span> <span class="n">CN</span><span class="o">=</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-34-81" name="__codelineno-34-81"></a><span class="o">*</span>  <span class="n">start</span> <span class="n">date</span><span class="p">:</span> <span class="n">May</span> <span class="mi">10</span> <span class="mi">01</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">15</span> <span class="mi">2020</span> <span class="n">GMT</span>
<a id="__codelineno-34-82" name="__codelineno-34-82"></a><span class="o">*</span>  <span class="n">expire</span> <span class="n">date</span><span class="p">:</span> <span class="n">Aug</span>  <span class="mi">8</span> <span class="mi">01</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">15</span> <span class="mi">2020</span> <span class="n">GMT</span>
<a id="__codelineno-34-83" name="__codelineno-34-83"></a><span class="o">*</span>  <span class="n">subjectAltName</span><span class="p">:</span> <span class="n">host</span> <span class="s2">&quot;sergetahe.com&quot;</span> <span class="n">matched</span> <span class="n">cert</span><span class="s1">&#39;s &quot;sergetahe.com&quot;</span>
<a id="__codelineno-34-84" name="__codelineno-34-84"></a><span class="o">*</span>  <span class="n">issuer</span><span class="p">:</span> <span class="n">C</span><span class="o">=</span><span class="n">US</span><span class="p">;</span> <span class="n">O</span><span class="o">=</span><span class="n">Let</span><span class="s1">&#39;s Encrypt; CN=Let&#39;</span><span class="n">s</span> <span class="n">Encrypt</span> <span class="n">Authority</span> <span class="n">X3</span>
<a id="__codelineno-34-85" name="__codelineno-34-85"></a><span class="o">*</span>  <span class="n">SSL</span> <span class="n">certificate</span> <span class="n">verify</span> <span class="n">ok</span><span class="o">.</span>
<a id="__codelineno-34-86" name="__codelineno-34-86"></a><span class="o">*</span> <span class="n">Using</span> <span class="n">HTTP2</span><span class="p">,</span> <span class="n">server</span> <span class="n">supports</span> <span class="n">multi</span><span class="o">-</span><span class="n">use</span>
<a id="__codelineno-34-87" name="__codelineno-34-87"></a><span class="o">*</span> <span class="n">Connection</span> <span class="n">state</span> <span class="n">changed</span> <span class="p">(</span><span class="n">HTTP</span><span class="o">/</span><span class="mi">2</span> <span class="n">confirmed</span><span class="p">)</span>
<a id="__codelineno-34-88" name="__codelineno-34-88"></a><span class="o">*</span> <span class="n">Copying</span> <span class="n">HTTP</span><span class="o">/</span><span class="mi">2</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">stream</span> <span class="n">buffer</span> <span class="n">to</span> <span class="n">connection</span> <span class="n">buffer</span> <span class="n">after</span> <span class="n">upgrade</span><span class="p">:</span> <span class="nb">len</span><span class="o">=</span><span class="mi">0</span>
<a id="__codelineno-34-89" name="__codelineno-34-89"></a><span class="p">}</span> <span class="p">[</span><span class="mi">5</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-90" name="__codelineno-34-90"></a><span class="o">*</span> <span class="n">Using</span> <span class="n">Stream</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">1</span> <span class="p">(</span><span class="n">easy</span> <span class="n">handle</span> <span class="mh">0x2bee870</span><span class="p">)</span>
<a id="__codelineno-34-91" name="__codelineno-34-91"></a><span class="p">}</span> <span class="p">[</span><span class="mi">5</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-92" name="__codelineno-34-92"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mi">2</span>
<a id="__codelineno-34-93" name="__codelineno-34-93"></a><span class="o">&gt;</span> <span class="n">Host</span><span class="p">:</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-34-94" name="__codelineno-34-94"></a><span class="o">&gt;</span> <span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">curl</span><span class="o">/</span><span class="mf">7.63.0</span>
<a id="__codelineno-34-95" name="__codelineno-34-95"></a><span class="o">&gt;</span> <span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-34-96" name="__codelineno-34-96"></a><span class="o">&gt;</span>
<a id="__codelineno-34-97" name="__codelineno-34-97"></a><span class="p">{</span> <span class="p">[</span><span class="mi">5</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-98" name="__codelineno-34-98"></a><span class="o">*</span> <span class="n">Connection</span> <span class="n">state</span> <span class="n">changed</span> <span class="p">(</span><span class="n">MAX_CONCURRENT_STREAMS</span> <span class="o">==</span> <span class="mi">128</span><span class="p">)</span><span class="err">!</span>
<a id="__codelineno-34-99" name="__codelineno-34-99"></a><span class="p">}</span> <span class="p">[</span><span class="mi">5</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-100" name="__codelineno-34-100"></a>  <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>    <span class="mi">0</span>     <span class="mi">0</span>      <span class="mi">0</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>     <span class="mi">0</span><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mi">2</span> <span class="mi">200</span>
<a id="__codelineno-34-101" name="__codelineno-34-101"></a><span class="o">&lt;</span> <span class="n">date</span><span class="p">:</span> <span class="n">Sun</span><span class="p">,</span> <span class="mi">05</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">17</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">19</span> <span class="n">GMT</span>
<a id="__codelineno-34-102" name="__codelineno-34-102"></a><span class="o">&lt;</span> <span class="n">content</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-34-103" name="__codelineno-34-103"></a><span class="o">&lt;</span> <span class="n">server</span><span class="p">:</span> <span class="n">Apache</span>
<a id="__codelineno-34-104" name="__codelineno-34-104"></a><span class="o">&lt;</span> <span class="n">x</span><span class="o">-</span><span class="n">powered</span><span class="o">-</span><span class="n">by</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.3</span>
<a id="__codelineno-34-105" name="__codelineno-34-105"></a><span class="o">&lt;</span> <span class="n">link</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span><span class="n">wp</span><span class="o">-</span><span class="n">json</span><span class="o">/&gt;</span><span class="p">;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;https://api.w.org/&quot;</span>
<a id="__codelineno-34-106" name="__codelineno-34-106"></a><span class="o">&lt;</span> <span class="n">link</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/&gt;</span><span class="p">;</span> <span class="n">rel</span><span class="o">=</span><span class="n">shortlink</span>
<a id="__codelineno-34-107" name="__codelineno-34-107"></a><span class="o">&lt;</span> <span class="n">vary</span><span class="p">:</span> <span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span>
<a id="__codelineno-34-108" name="__codelineno-34-108"></a><span class="o">&lt;</span> <span class="n">x</span><span class="o">-</span><span class="n">iplb</span><span class="o">-</span><span class="n">instance</span><span class="p">:</span> <span class="mi">17080</span>
<a id="__codelineno-34-109" name="__codelineno-34-109"></a><span class="o">&lt;</span> <span class="nb">set</span><span class="o">-</span><span class="n">cookie</span><span class="p">:</span> <span class="n">SERVERID68971</span><span class="o">=</span><span class="mi">2620178</span><span class="o">|</span><span class="n">XwIRd</span><span class="o">|</span><span class="n">XwIRd</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span>
<a id="__codelineno-34-110" name="__codelineno-34-110"></a><span class="o">&lt;</span>
<a id="__codelineno-34-111" name="__codelineno-34-111"></a><span class="p">{</span> <span class="p">[</span><span class="mi">5</span> <span class="nb">bytes</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-34-112" name="__codelineno-34-112"></a><span class="mi">100</span> <span class="mi">49634</span>    <span class="mi">0</span> <span class="mi">49634</span>    <span class="mi">0</span>     <span class="mi">0</span>  <span class="mi">26040</span>      <span class="mi">0</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span>  <span class="mi">0</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">01</span> <span class="o">--</span><span class="p">:</span><span class="o">--</span><span class="p">:</span><span class="o">--</span> <span class="mi">37830</span>
<a id="__codelineno-34-113" name="__codelineno-34-113"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#1 to host sergetahe.com left intact</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 2 : on utilise l’option <strong>[--location]</strong> pour indiquer qu’on veut suivre les redirections envoyées par le serveur ;</li>
<li>ligne 13 : le serveur indique que le document demandé a changé d’URL ;</li>
<li>ligne 18 : il indique la nouvelle URL du document demandé ;</li>
<li>ligne 31 : <strong>[curl]</strong> émet une nouvelle requête vers cette fois la nouvelle URL ;</li>
<li>ligne 36 : le serveur répond de nouveau que l’URL a changé ;</li>
<li>ligne 41 : la nouvelle URL est exactement la même que celle qui a été redirigée à un détail près : le procole a changé. Il est devenu HTTPS (ligne 41) alors qu’il était http auparavant (ligne 31) ;</li>
<li>ligne 49 : une nouvelle requête st émise vers la nouvelle URL. Celle-ci est chiffrée. Aussi tout un dialogue de mise en place de la sécurité se met en place, lignes 53-91 ;</li>
<li>ligne 92 : la nouvelle URL est demandée avec cette fois le protocole HTTP/2 ;</li>
<li>ligne 100 : le document a été trouvé ;
Le document demandé sera trouvé dans le fichier <strong>[sergetahe.com.html]</strong>.</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Temp</span>\<span class="n">curl</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="n">λ</span> <span class="nb">dir</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a> <span class="n">Le</span> <span class="n">volume</span> <span class="n">dans</span> <span class="n">le</span> <span class="n">lecteur</span> <span class="n">C</span> <span class="n">s</span><span class="err">’</span><span class="n">appelle</span> <span class="n">Local</span> <span class="n">Disk</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a> <span class="n">Le</span> <span class="n">numéro</span> <span class="n">de</span> <span class="n">série</span> <span class="n">du</span> <span class="n">volume</span> <span class="n">est</span> <span class="n">B84C</span><span class="o">-</span><span class="n">D958</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a> <span class="n">Répertoire</span> <span class="n">de</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Temp</span>\<span class="n">curl</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="mi">05</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">2020</span>  <span class="mi">19</span><span class="p">:</span><span class="mi">44</span>    <span class="o">&lt;</span><span class="n">DIR</span><span class="o">&gt;</span>          <span class="o">.</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="mi">05</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">2020</span>  <span class="mi">19</span><span class="p">:</span><span class="mi">44</span>    <span class="o">&lt;</span><span class="n">DIR</span><span class="o">&gt;</span>          <span class="o">..</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="mi">05</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">2020</span>  <span class="mi">19</span><span class="p">:</span><span class="mi">35</span>             <span class="mi">1</span> <span class="mi">776</span> <span class="n">localhost</span><span class="o">.</span><span class="n">html</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="mi">05</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">2020</span>  <span class="mi">19</span><span class="p">:</span><span class="mi">44</span>            <span class="mi">49</span> <span class="mi">634</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">html</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="mi">05</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">2020</span>  <span class="mi">19</span><span class="p">:</span><span class="mi">39</span>           <span class="mi">101</span> <span class="mi">639</span> <span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span><span class="o">.</span><span class="n">html</span>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a>               <span class="mi">3</span> <span class="n">fichier</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>          <span class="mi">153</span> <span class="mi">049</span> <span class="n">octets</span>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a>               <span class="mi">2</span> <span class="n">Rép</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="mi">892</span> <span class="mi">385</span> <span class="mi">628</span> <span class="mi">160</span> <span class="n">octets</span> <span class="n">libres</span>
</code></pre></div></td></tr></table></div>
<h3 id="2145-exemple-5">21.4.5. Exemple 5</h3>
<p>Python possède un module appelé <strong>[pyccurl]</strong> qui permet d’utiliser les capacités de l’outil <strong>[curl]</strong> dans un programme Python. Nous installons ce module :</p>
<p><img src="images/100000000000055500000198AD4257EA.png" style="width:15.77cm;height:4.71cm;" alt="Image" /></p>
<p>Nous allons écrire un nouveau script <strong>[http/02/main.py]</strong> :</p>
<p><img src="images/100000000000013A00000112A23438A9.png" style="width:3.631cm;height:3.16cm;" alt="Image" /></p>
<p>Le fichier <strong>[http/02/config]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span>
<span class="normal"><a href="#__codelineno-36-19">19</a></span>
<span class="normal"><a href="#__codelineno-36-20">20</a></span>
<span class="normal"><a href="#__codelineno-36-21">21</a></span>
<span class="normal"><a href="#__codelineno-36-22">22</a></span>
<span class="normal"><a href="#__codelineno-36-23">23</a></span>
<span class="normal"><a href="#__codelineno-36-24">24</a></span>
<span class="normal"><a href="#__codelineno-36-25">25</a></span>
<span class="normal"><a href="#__codelineno-36-26">26</a></span>
<span class="normal"><a href="#__codelineno-36-27">27</a></span>
<span class="normal"><a href="#__codelineno-36-28">28</a></span>
<span class="normal"><a href="#__codelineno-36-29">29</a></span>
<span class="normal"><a href="#__codelineno-36-30">30</a></span>
<span class="normal"><a href="#__codelineno-36-31">31</a></span>
<span class="normal"><a href="#__codelineno-36-32">32</a></span>
<span class="normal"><a href="#__codelineno-36-33">33</a></span>
<span class="normal"><a href="#__codelineno-36-34">34</a></span>
<span class="normal"><a href="#__codelineno-36-35">35</a></span>
<span class="normal"><a href="#__codelineno-36-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">():</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>    <span class="c1"># liste des URL à interroger</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a>    <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a>        <span class="c1"># site : serveur auquel se connecter</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a>        <span class="c1"># timeout : délai maximal d&#39;attente d&#39;une réponse du serveur</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>        <span class="c1"># target : url à demander</span>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a>        <span class="c1"># encoding : encodage de la réponse du serveur</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>        <span class="p">{</span>
<a id="__codelineno-36-9" name="__codelineno-36-9"></a>            <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;sergetahe.com&quot;</span><span class="p">,</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a>            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a>            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;http://sergetahe.com&quot;</span><span class="p">,</span>
<a id="__codelineno-36-12" name="__codelineno-36-12"></a>            <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-8&quot;</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a>        <span class="p">},</span>
<a id="__codelineno-36-14" name="__codelineno-36-14"></a>        <span class="p">{</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a>            <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;tahe.developpez.com&quot;</span><span class="p">,</span>
<a id="__codelineno-36-16" name="__codelineno-36-16"></a>            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a>            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;https://tahe.developpez.com&quot;</span><span class="p">,</span>
<a id="__codelineno-36-18" name="__codelineno-36-18"></a>            <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;iso-8859-1&quot;</span>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a>        <span class="p">},</span>
<a id="__codelineno-36-20" name="__codelineno-36-20"></a>        <span class="p">{</span>
<a id="__codelineno-36-21" name="__codelineno-36-21"></a>            <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;www.polytech-angers.fr&quot;</span><span class="p">,</span>
<a id="__codelineno-36-22" name="__codelineno-36-22"></a>            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-36-23" name="__codelineno-36-23"></a>            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;http://www.polytech-angers.fr&quot;</span><span class="p">,</span>
<a id="__codelineno-36-24" name="__codelineno-36-24"></a>            <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-8&quot;</span>
<a id="__codelineno-36-25" name="__codelineno-36-25"></a>        <span class="p">},</span>
<a id="__codelineno-36-26" name="__codelineno-36-26"></a>        <span class="p">{</span>
<a id="__codelineno-36-27" name="__codelineno-36-27"></a>            <span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-36-28" name="__codelineno-36-28"></a>            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-36-29" name="__codelineno-36-29"></a>            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-36-30" name="__codelineno-36-30"></a>            <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-8&quot;</span>
<a id="__codelineno-36-31" name="__codelineno-36-31"></a>        <span class="p">}</span>
<a id="__codelineno-36-32" name="__codelineno-36-32"></a>    <span class="p">]</span>
<a id="__codelineno-36-33" name="__codelineno-36-33"></a>    <span class="c1"># on rend la configuration</span>
<a id="__codelineno-36-34" name="__codelineno-36-34"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-36-35" name="__codelineno-36-35"></a>        <span class="s1">&#39;urls&#39;</span><span class="p">:</span> <span class="n">urls</span>
<a id="__codelineno-36-36" name="__codelineno-36-36"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Le fichier contient une liste de dictionnaires où chacun d&#x27;eux a la structure suivante :</p>
<ul>
<li>site : le nom d’un serveur web ;</li>
<li>encoding : le type d&#x27;encodage du document attendu ;</li>
<li>timeout : durée maximale d’attente de la réponse du serveur exprimée en <strong>millisecondes</strong>. Au-delà, le client se déconnectera ;</li>
<li>url : URL du document demandé ;
Le code du script <strong>[http/02/main.py]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span>
<span class="normal"><a href="#__codelineno-37-22">22</a></span>
<span class="normal"><a href="#__codelineno-37-23">23</a></span>
<span class="normal"><a href="#__codelineno-37-24">24</a></span>
<span class="normal"><a href="#__codelineno-37-25">25</a></span>
<span class="normal"><a href="#__codelineno-37-26">26</a></span>
<span class="normal"><a href="#__codelineno-37-27">27</a></span>
<span class="normal"><a href="#__codelineno-37-28">28</a></span>
<span class="normal"><a href="#__codelineno-37-29">29</a></span>
<span class="normal"><a href="#__codelineno-37-30">30</a></span>
<span class="normal"><a href="#__codelineno-37-31">31</a></span>
<span class="normal"><a href="#__codelineno-37-32">32</a></span>
<span class="normal"><a href="#__codelineno-37-33">33</a></span>
<span class="normal"><a href="#__codelineno-37-34">34</a></span>
<span class="normal"><a href="#__codelineno-37-35">35</a></span>
<span class="normal"><a href="#__codelineno-37-36">36</a></span>
<span class="normal"><a href="#__codelineno-37-37">37</a></span>
<span class="normal"><a href="#__codelineno-37-38">38</a></span>
<span class="normal"><a href="#__codelineno-37-39">39</a></span>
<span class="normal"><a href="#__codelineno-37-40">40</a></span>
<span class="normal"><a href="#__codelineno-37-41">41</a></span>
<span class="normal"><a href="#__codelineno-37-42">42</a></span>
<span class="normal"><a href="#__codelineno-37-43">43</a></span>
<span class="normal"><a href="#__codelineno-37-44">44</a></span>
<span class="normal"><a href="#__codelineno-37-45">45</a></span>
<span class="normal"><a href="#__codelineno-37-46">46</a></span>
<span class="normal"><a href="#__codelineno-37-47">47</a></span>
<span class="normal"><a href="#__codelineno-37-48">48</a></span>
<span class="normal"><a href="#__codelineno-37-49">49</a></span>
<span class="normal"><a href="#__codelineno-37-50">50</a></span>
<span class="normal"><a href="#__codelineno-37-51">51</a></span>
<span class="normal"><a href="#__codelineno-37-52">52</a></span>
<span class="normal"><a href="#__codelineno-37-53">53</a></span>
<span class="normal"><a href="#__codelineno-37-54">54</a></span>
<span class="normal"><a href="#__codelineno-37-55">55</a></span>
<span class="normal"><a href="#__codelineno-37-56">56</a></span>
<span class="normal"><a href="#__codelineno-37-57">57</a></span>
<span class="normal"><a href="#__codelineno-37-58">58</a></span>
<span class="normal"><a href="#__codelineno-37-59">59</a></span>
<span class="normal"><a href="#__codelineno-37-60">60</a></span>
<span class="normal"><a href="#__codelineno-37-61">61</a></span>
<span class="normal"><a href="#__codelineno-37-62">62</a></span>
<span class="normal"><a href="#__codelineno-37-63">63</a></span>
<span class="normal"><a href="#__codelineno-37-64">64</a></span>
<span class="normal"><a href="#__codelineno-37-65">65</a></span>
<span class="normal"><a href="#__codelineno-37-66">66</a></span>
<span class="normal"><a href="#__codelineno-37-67">67</a></span>
<span class="normal"><a href="#__codelineno-37-68">68</a></span>
<span class="normal"><a href="#__codelineno-37-69">69</a></span>
<span class="normal"><a href="#__codelineno-37-70">70</a></span>
<span class="normal"><a href="#__codelineno-37-71">71</a></span>
<span class="normal"><a href="#__codelineno-37-72">72</a></span>
<span class="normal"><a href="#__codelineno-37-73">73</a></span>
<span class="normal"><a href="#__codelineno-37-74">74</a></span>
<span class="normal"><a href="#__codelineno-37-75">75</a></span>
<span class="normal"><a href="#__codelineno-37-76">76</a></span>
<span class="normal"><a href="#__codelineno-37-77">77</a></span>
<span class="normal"><a href="#__codelineno-37-78">78</a></span>
<span class="normal"><a href="#__codelineno-37-79">79</a></span>
<span class="normal"><a href="#__codelineno-37-80">80</a></span>
<span class="normal"><a href="#__codelineno-37-81">81</a></span>
<span class="normal"><a href="#__codelineno-37-82">82</a></span>
<span class="normal"><a href="#__codelineno-37-83">83</a></span>
<span class="normal"><a href="#__codelineno-37-84">84</a></span>
<span class="normal"><a href="#__codelineno-37-85">85</a></span>
<span class="normal"><a href="#__codelineno-37-86">86</a></span>
<span class="normal"><a href="#__codelineno-37-87">87</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1"># imports</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">codecs</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pycurl</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="c1"># -----------------------------------------------------------------------</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">suivi</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a>    <span class="c1"># lit l&#39;URL url[url] et la stocke dans le fichier output/url[&#39;site&#39;].html</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a>    <span class="c1"># si [suivi=True] alors il y a un suivi console de l&#39;échange client / serveur</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a>    <span class="c1"># url[timeout] est le timeout des appels client;</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a>    <span class="c1"># url [encoding] est l&#39;encodage du document demandé</span>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a>
<a id="__codelineno-37-15" name="__codelineno-37-15"></a>    <span class="c1"># on récupère les données de configuration</span>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a>    <span class="n">server</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span>
<a id="__codelineno-37-17" name="__codelineno-37-17"></a>    <span class="n">timeout</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="s1">&#39;timeout&#39;</span><span class="p">]</span>
<a id="__codelineno-37-18" name="__codelineno-37-18"></a>    <span class="n">target</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span>
<a id="__codelineno-37-19" name="__codelineno-37-19"></a>    <span class="n">encoding</span> <span class="o">=</span> <span class="n">url</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span>
<a id="__codelineno-37-20" name="__codelineno-37-20"></a>    <span class="c1"># suivi</span>
<a id="__codelineno-37-21" name="__codelineno-37-21"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Client : début de la communication avec le serveur [</span><span class="si">{</span><span class="n">server</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-37-22" name="__codelineno-37-22"></a>
<a id="__codelineno-37-23" name="__codelineno-37-23"></a>    <span class="c1"># on laisse remonter les exceptions</span>
<a id="__codelineno-37-24" name="__codelineno-37-24"></a>    <span class="n">html</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-37-25" name="__codelineno-37-25"></a>    <span class="n">curl</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-37-26" name="__codelineno-37-26"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-37-27" name="__codelineno-37-27"></a>        <span class="c1"># Initialisation d&#39;une session cURL</span>
<a id="__codelineno-37-28" name="__codelineno-37-28"></a>        <span class="n">curl</span> <span class="o">=</span> <span class="n">pycurl</span><span class="o">.</span><span class="n">Curl</span><span class="p">()</span>
<a id="__codelineno-37-29" name="__codelineno-37-29"></a>        <span class="c1"># flux binaire</span>
<a id="__codelineno-37-30" name="__codelineno-37-30"></a>        <span class="n">flux</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
<a id="__codelineno-37-31" name="__codelineno-37-31"></a>        <span class="c1"># options de curl</span>
<a id="__codelineno-37-32" name="__codelineno-37-32"></a>        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-37-33" name="__codelineno-37-33"></a>            <span class="c1"># URL</span>
<a id="__codelineno-37-34" name="__codelineno-37-34"></a>            <span class="n">curl</span><span class="o">.</span><span class="n">URL</span><span class="p">:</span> <span class="n">target</span><span class="p">,</span>
<a id="__codelineno-37-35" name="__codelineno-37-35"></a>            <span class="c1"># WRITEDATA : là où les données reçues seront stockées</span>
<a id="__codelineno-37-36" name="__codelineno-37-36"></a>            <span class="n">curl</span><span class="o">.</span><span class="n">WRITEDATA</span><span class="p">:</span> <span class="n">flux</span><span class="p">,</span>
<a id="__codelineno-37-37" name="__codelineno-37-37"></a>            <span class="c1"># mode verbose</span>
<a id="__codelineno-37-38" name="__codelineno-37-38"></a>            <span class="n">curl</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span> <span class="n">suivi</span><span class="p">,</span>
<a id="__codelineno-37-39" name="__codelineno-37-39"></a>            <span class="c1"># nouvelle connexion - pas de cache</span>
<a id="__codelineno-37-40" name="__codelineno-37-40"></a>            <span class="n">curl</span><span class="o">.</span><span class="n">FRESH_CONNECT</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-37-41" name="__codelineno-37-41"></a>            <span class="c1"># timeout de la requête (en secondes)</span>
<a id="__codelineno-37-42" name="__codelineno-37-42"></a>            <span class="n">curl</span><span class="o">.</span><span class="n">TIMEOUT</span><span class="p">:</span> <span class="n">timeout</span><span class="p">,</span>
<a id="__codelineno-37-43" name="__codelineno-37-43"></a>            <span class="n">curl</span><span class="o">.</span><span class="n">CONNECTTIMEOUT</span><span class="p">:</span> <span class="n">timeout</span><span class="p">,</span>
<a id="__codelineno-37-44" name="__codelineno-37-44"></a>            <span class="c1"># ne pas vérifier la validité des certificats SSL</span>
<a id="__codelineno-37-45" name="__codelineno-37-45"></a>            <span class="n">curl</span><span class="o">.</span><span class="n">SSL_VERIFYPEER</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-37-46" name="__codelineno-37-46"></a>            <span class="c1"># suivre les redirections</span>
<a id="__codelineno-37-47" name="__codelineno-37-47"></a>            <span class="n">curl</span><span class="o">.</span><span class="n">FOLLOWLOCATION</span><span class="p">:</span> <span class="kc">True</span>
<a id="__codelineno-37-48" name="__codelineno-37-48"></a>        <span class="p">}</span>
<a id="__codelineno-37-49" name="__codelineno-37-49"></a>        <span class="c1"># paramétrage de curl</span>
<a id="__codelineno-37-50" name="__codelineno-37-50"></a>        <span class="k">for</span> <span class="n">option</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-37-51" name="__codelineno-37-51"></a>            <span class="n">curl</span><span class="o">.</span><span class="n">setopt</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<a id="__codelineno-37-52" name="__codelineno-37-52"></a>        <span class="c1"># Execution de la requête CURL ainsi paramétrée</span>
<a id="__codelineno-37-53" name="__codelineno-37-53"></a>        <span class="n">curl</span><span class="o">.</span><span class="n">perform</span><span class="p">()</span>
<a id="__codelineno-37-54" name="__codelineno-37-54"></a>        <span class="c1"># création du fichier server.html - on change les caractères gênants pour un nom de fichier</span>
<a id="__codelineno-37-55" name="__codelineno-37-55"></a>        <span class="n">server2</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
<a id="__codelineno-37-56" name="__codelineno-37-56"></a>        <span class="n">server2</span> <span class="o">=</span> <span class="n">server2</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
<a id="__codelineno-37-57" name="__codelineno-37-57"></a>        <span class="n">html_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">server2</span><span class="si">}</span><span class="s1">.html&#39;</span>
<a id="__codelineno-37-58" name="__codelineno-37-58"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;output/</span><span class="si">{</span><span class="n">html_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
<a id="__codelineno-37-59" name="__codelineno-37-59"></a>        <span class="c1"># enregistrement du document reçu dans le fichier HTML</span>
<a id="__codelineno-37-60" name="__codelineno-37-60"></a>        <span class="n">html</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">flux</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">))</span>
<a id="__codelineno-37-61" name="__codelineno-37-61"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-37-62" name="__codelineno-37-62"></a>        <span class="c1"># libération des ressources</span>
<a id="__codelineno-37-63" name="__codelineno-37-63"></a>        <span class="k">if</span> <span class="n">curl</span><span class="p">:</span>
<a id="__codelineno-37-64" name="__codelineno-37-64"></a>            <span class="n">curl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-37-65" name="__codelineno-37-65"></a>        <span class="k">if</span> <span class="n">html</span><span class="p">:</span>
<a id="__codelineno-37-66" name="__codelineno-37-66"></a>            <span class="n">html</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-37-67" name="__codelineno-37-67"></a>
<a id="__codelineno-37-68" name="__codelineno-37-68"></a>
<a id="__codelineno-37-69" name="__codelineno-37-69"></a><span class="c1"># -------------------main</span>
<a id="__codelineno-37-70" name="__codelineno-37-70"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-37-71" name="__codelineno-37-71"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-37-72" name="__codelineno-37-72"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-37-73" name="__codelineno-37-73"></a>
<a id="__codelineno-37-74" name="__codelineno-37-74"></a><span class="c1"># obtenir les URL du fichier de configuration</span>
<a id="__codelineno-37-75" name="__codelineno-37-75"></a><span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;urls&#39;</span><span class="p">]:</span>
<a id="__codelineno-37-76" name="__codelineno-37-76"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-37-77" name="__codelineno-37-77"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">])</span>
<a id="__codelineno-37-78" name="__codelineno-37-78"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-37-79" name="__codelineno-37-79"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-37-80" name="__codelineno-37-80"></a>        <span class="c1"># lecture URL du site [site]</span>
<a id="__codelineno-37-81" name="__codelineno-37-81"></a>        <span class="n">get_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-37-82" name="__codelineno-37-82"></a>    <span class="c1"># except BaseException as erreur:</span>
<a id="__codelineno-37-83" name="__codelineno-37-83"></a>    <span class="c1">#     print(f&quot;L&#39;erreur suivante s&#39;est produite : {erreur}&quot;)</span>
<a id="__codelineno-37-84" name="__codelineno-37-84"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-37-85" name="__codelineno-37-85"></a>        <span class="k">pass</span>
<a id="__codelineno-37-86" name="__codelineno-37-86"></a><span class="c1"># fin</span>
<a id="__codelineno-37-87" name="__codelineno-37-87"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Terminé...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 5 : on importe le module <strong>[</strong><strong>pycurl</strong><strong>]</strong> ;</li>
<li>ligne 3 : on importe la classe <strong>[</strong><strong>BytesIO</strong><strong>]</strong> qui va nous permettre de stocker les données reçues du serveur dans un flux binaire ;</li>
<li>lignes 70-72 : on récupère la configuration de l’application ;</li>
<li>lignes 75-85 : on boucle sur la liste des URL trouvées dans la configuration ;</li>
<li>ligne 81 : pour chacune des URL, on appelle la fonction <strong>[get_url]</strong> qui va télécharger l’URL url<strong>[‘target’]</strong> avec un timeout url<strong>[</strong><strong>&#x27;timeout&#x27;</strong><strong>]</strong> ;</li>
<li>ligne 9 : la fonction <strong>[</strong><strong>get_url</strong><strong>]</strong> reçoit la configuration de l’URL à interroger ;</li>
<li>lignes 16-19 : on récupère la configuration de l’URL dans des variables séparées ;</li>
<li>lignes 26, 61 : on fait toutes les opérations au sein d&#x27;un try / finally. On n&#x27;arrête pas les exceptions qui remonteront alors au code appelant qui lui les arrête ;</li>
<li>ligne 28 : on prépare une session <strong>[curl]</strong>. <strong>[</strong><strong>pycurl</strong><strong>.</strong><strong>Curl</strong><strong>()</strong><strong>]</strong> rend une ressource <strong>[curl]</strong> qui va opérer la transaction avec un serveur ;</li>
<li>ligne 30 : instanciation du flux binaire qui va stocker les données reçues ;</li>
<li>lignes 32-48 : le dictionnaire <strong>[options]</strong> va paramétrer la connexion <strong>[curl]</strong> au serveur. leur rôle est indiqué dans les commentaires ;</li>
<li>lignes 49-51 : les options de la connexion sont transmises à la ressource <strong>[curl]</strong> ;</li>
<li>ligne 53 : connexion à l’URL demandée avec les options définies. A cause de l’option <strong>[</strong><strong>curl.WRITEDATA: flux</strong><strong>]</strong> (ligne 36), la fonction <strong>[</strong><strong>curl.perform()</strong><strong>]</strong> va stocker les données reçues dans <strong>[flux]</strong> ;</li>
<li>lignes 54-60 : on crée le fichier HTML qui va stocker le document HTML reçu ;</li>
<li>ligne 60 : le flux binaire <strong>[</strong><strong>flux.getvalue()</strong><strong>]</strong> va être stocké comme une chaîne de caractères dans le fichier HTML. L&#x27;encodage de cette chaîne est précisé dans la méthode <strong>[</strong><strong>decode(encoding)</strong><strong>]</strong>. Il faut donc connaître l&#x27;encodage du document envoyé par le serveur. Si on se trompe, l&#x27;opération de décodage du flux binaire va échouer. L&#x27;encodage est précisé dans le fichier de configuration de l’URL (ligne 12 par exemple). On aurait pu gérer dynamiquement cette information car le serveur l&#x27;envoie dans ces entêtes HTTP. Cela aurait été préférable. Pour garder un code simple, nous ne l&#x27;avons pas fait. Pour connaître le type d&#x27;encodage du document, il suffit de demander l&#x27;URL désirée avec un navigateur et regarder les entêtes HTTP envoyés par celui-ci en mode débogage du navigateur (F12) ou bien le document lui-même car celui-ci précise également l&#x27;encodage :</li>
</ul>
<p><img src="images/10000001000002B7000000C5271DE47D.png" style="width:11.93cm;height:3.38cm;" alt="Image" /></p>
<p><img src="images/100000010000029C000000E77D8D42BF.png" style="width:11.431cm;height:3.95cm;" alt="Image" /></p>
<ul>
<li>ligne 61-66 : les ressources allouées sont libérées ;
Lorsqu’on exécute le script <strong>[main.py]</strong> on obtient les résultats console suivants :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">  1</a></span>
<span class="normal"><a href="#__codelineno-38-2">  2</a></span>
<span class="normal"><a href="#__codelineno-38-3">  3</a></span>
<span class="normal"><a href="#__codelineno-38-4">  4</a></span>
<span class="normal"><a href="#__codelineno-38-5">  5</a></span>
<span class="normal"><a href="#__codelineno-38-6">  6</a></span>
<span class="normal"><a href="#__codelineno-38-7">  7</a></span>
<span class="normal"><a href="#__codelineno-38-8">  8</a></span>
<span class="normal"><a href="#__codelineno-38-9">  9</a></span>
<span class="normal"><a href="#__codelineno-38-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-38-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-38-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-38-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-38-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-38-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-38-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-38-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-38-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-38-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-38-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-38-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-38-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-38-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-38-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-38-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-38-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-38-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-38-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-38-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-38-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-38-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-38-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-38-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-38-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-38-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-38-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-38-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-38-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-38-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-38-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-38-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-38-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-38-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-38-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-38-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-38-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-38-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-38-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-38-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-38-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-38-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-38-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-38-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-38-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-38-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-38-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-38-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-38-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-38-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-38-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-38-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-38-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-38-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-38-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-38-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-38-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-38-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-38-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-38-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-38-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-38-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-38-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-38-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-38-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-38-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-38-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-38-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-38-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-38-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-38-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-38-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-38-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-38-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-38-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-38-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-38-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-38-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-38-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-38-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-38-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-38-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-38-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-38-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-38-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-38-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-38-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-38-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-38-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-38-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-38-100">100</a></span>
<span class="normal"><a href="#__codelineno-38-101">101</a></span>
<span class="normal"><a href="#__codelineno-38-102">102</a></span>
<span class="normal"><a href="#__codelineno-38-103">103</a></span>
<span class="normal"><a href="#__codelineno-38-104">104</a></span>
<span class="normal"><a href="#__codelineno-38-105">105</a></span>
<span class="normal"><a href="#__codelineno-38-106">106</a></span>
<span class="normal"><a href="#__codelineno-38-107">107</a></span>
<span class="normal"><a href="#__codelineno-38-108">108</a></span>
<span class="normal"><a href="#__codelineno-38-109">109</a></span>
<span class="normal"><a href="#__codelineno-38-110">110</a></span>
<span class="normal"><a href="#__codelineno-38-111">111</a></span>
<span class="normal"><a href="#__codelineno-38-112">112</a></span>
<span class="normal"><a href="#__codelineno-38-113">113</a></span>
<span class="normal"><a href="#__codelineno-38-114">114</a></span>
<span class="normal"><a href="#__codelineno-38-115">115</a></span>
<span class="normal"><a href="#__codelineno-38-116">116</a></span>
<span class="normal"><a href="#__codelineno-38-117">117</a></span>
<span class="normal"><a href="#__codelineno-38-118">118</a></span>
<span class="normal"><a href="#__codelineno-38-119">119</a></span>
<span class="normal"><a href="#__codelineno-38-120">120</a></span>
<span class="normal"><a href="#__codelineno-38-121">121</a></span>
<span class="normal"><a href="#__codelineno-38-122">122</a></span>
<span class="normal"><a href="#__codelineno-38-123">123</a></span>
<span class="normal"><a href="#__codelineno-38-124">124</a></span>
<span class="normal"><a href="#__codelineno-38-125">125</a></span>
<span class="normal"><a href="#__codelineno-38-126">126</a></span>
<span class="normal"><a href="#__codelineno-38-127">127</a></span>
<span class="normal"><a href="#__codelineno-38-128">128</a></span>
<span class="normal"><a href="#__codelineno-38-129">129</a></span>
<span class="normal"><a href="#__codelineno-38-130">130</a></span>
<span class="normal"><a href="#__codelineno-38-131">131</a></span>
<span class="normal"><a href="#__codelineno-38-132">132</a></span>
<span class="normal"><a href="#__codelineno-38-133">133</a></span>
<span class="normal"><a href="#__codelineno-38-134">134</a></span>
<span class="normal"><a href="#__codelineno-38-135">135</a></span>
<span class="normal"><a href="#__codelineno-38-136">136</a></span>
<span class="normal"><a href="#__codelineno-38-137">137</a></span>
<span class="normal"><a href="#__codelineno-38-138">138</a></span>
<span class="normal"><a href="#__codelineno-38-139">139</a></span>
<span class="normal"><a href="#__codelineno-38-140">140</a></span>
<span class="normal"><a href="#__codelineno-38-141">141</a></span>
<span class="normal"><a href="#__codelineno-38-142">142</a></span>
<span class="normal"><a href="#__codelineno-38-143">143</a></span>
<span class="normal"><a href="#__codelineno-38-144">144</a></span>
<span class="normal"><a href="#__codelineno-38-145">145</a></span>
<span class="normal"><a href="#__codelineno-38-146">146</a></span>
<span class="normal"><a href="#__codelineno-38-147">147</a></span>
<span class="normal"><a href="#__codelineno-38-148">148</a></span>
<span class="normal"><a href="#__codelineno-38-149">149</a></span>
<span class="normal"><a href="#__codelineno-38-150">150</a></span>
<span class="normal"><a href="#__codelineno-38-151">151</a></span>
<span class="normal"><a href="#__codelineno-38-152">152</a></span>
<span class="normal"><a href="#__codelineno-38-153">153</a></span>
<span class="normal"><a href="#__codelineno-38-154">154</a></span>
<span class="normal"><a href="#__codelineno-38-155">155</a></span>
<span class="normal"><a href="#__codelineno-38-156">156</a></span>
<span class="normal"><a href="#__codelineno-38-157">157</a></span>
<span class="normal"><a href="#__codelineno-38-158">158</a></span>
<span class="normal"><a href="#__codelineno-38-159">159</a></span>
<span class="normal"><a href="#__codelineno-38-160">160</a></span>
<span class="normal"><a href="#__codelineno-38-161">161</a></span>
<span class="normal"><a href="#__codelineno-38-162">162</a></span>
<span class="normal"><a href="#__codelineno-38-163">163</a></span>
<span class="normal"><a href="#__codelineno-38-164">164</a></span>
<span class="normal"><a href="#__codelineno-38-165">165</a></span>
<span class="normal"><a href="#__codelineno-38-166">166</a></span>
<span class="normal"><a href="#__codelineno-38-167">167</a></span>
<span class="normal"><a href="#__codelineno-38-168">168</a></span>
<span class="normal"><a href="#__codelineno-38-169">169</a></span>
<span class="normal"><a href="#__codelineno-38-170">170</a></span>
<span class="normal"><a href="#__codelineno-38-171">171</a></span>
<span class="normal"><a href="#__codelineno-38-172">172</a></span>
<span class="normal"><a href="#__codelineno-38-173">173</a></span>
<span class="normal"><a href="#__codelineno-38-174">174</a></span>
<span class="normal"><a href="#__codelineno-38-175">175</a></span>
<span class="normal"><a href="#__codelineno-38-176">176</a></span>
<span class="normal"><a href="#__codelineno-38-177">177</a></span>
<span class="normal"><a href="#__codelineno-38-178">178</a></span>
<span class="normal"><a href="#__codelineno-38-179">179</a></span>
<span class="normal"><a href="#__codelineno-38-180">180</a></span>
<span class="normal"><a href="#__codelineno-38-181">181</a></span>
<span class="normal"><a href="#__codelineno-38-182">182</a></span>
<span class="normal"><a href="#__codelineno-38-183">183</a></span>
<span class="normal"><a href="#__codelineno-38-184">184</a></span>
<span class="normal"><a href="#__codelineno-38-185">185</a></span>
<span class="normal"><a href="#__codelineno-38-186">186</a></span>
<span class="normal"><a href="#__codelineno-38-187">187</a></span>
<span class="normal"><a href="#__codelineno-38-188">188</a></span>
<span class="normal"><a href="#__codelineno-38-189">189</a></span>
<span class="normal"><a href="#__codelineno-38-190">190</a></span>
<span class="normal"><a href="#__codelineno-38-191">191</a></span>
<span class="normal"><a href="#__codelineno-38-192">192</a></span>
<span class="normal"><a href="#__codelineno-38-193">193</a></span>
<span class="normal"><a href="#__codelineno-38-194">194</a></span>
<span class="normal"><a href="#__codelineno-38-195">195</a></span>
<span class="normal"><a href="#__codelineno-38-196">196</a></span>
<span class="normal"><a href="#__codelineno-38-197">197</a></span>
<span class="normal"><a href="#__codelineno-38-198">198</a></span>
<span class="normal"><a href="#__codelineno-38-199">199</a></span>
<span class="normal"><a href="#__codelineno-38-200">200</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">inet</span><span class="o">/</span><span class="n">http</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="o">-------------------------</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="o">-------------------------</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a><span class="n">Client</span> <span class="p">:</span> <span class="n">début</span> <span class="n">de</span> <span class="n">la</span> <span class="n">communication</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a><span class="o">*</span>   <span class="n">Trying</span> <span class="mf">87.98.154.146</span><span class="p">:</span><span class="mf">80.</span><span class="o">..</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a><span class="o">*</span> <span class="n">TCP_NODELAY</span> <span class="nb">set</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span> <span class="p">(</span><span class="mf">87.98.154.146</span><span class="p">)</span> <span class="n">port</span> <span class="mi">80</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a><span class="n">Host</span><span class="p">:</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PycURL</span><span class="o">/</span><span class="mf">7.43.0.5</span> <span class="n">libcurl</span><span class="o">/</span><span class="mf">7.68.0</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">d</span> <span class="n">zlib</span><span class="o">/</span><span class="mf">1.2.11</span> <span class="n">c</span><span class="o">-</span><span class="n">ares</span><span class="o">/</span><span class="mf">1.15.0</span> <span class="n">WinIDN</span> <span class="n">libssh2</span><span class="o">/</span><span class="mf">1.9.0</span> <span class="n">nghttp2</span><span class="o">/</span><span class="mf">1.40.0</span>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a><span class="o">*</span> <span class="n">Mark</span> <span class="n">bundle</span> <span class="k">as</span> <span class="ow">not</span> <span class="n">supporting</span> <span class="n">multiuse</span>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">302</span> <span class="n">Found</span>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">52</span> <span class="n">GMT</span>
<a id="__codelineno-38-17" name="__codelineno-38-17"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-38-18" name="__codelineno-38-18"></a><span class="o">&lt;</span> <span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">chunked</span>
<a id="__codelineno-38-19" name="__codelineno-38-19"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span>
<a id="__codelineno-38-20" name="__codelineno-38-20"></a><span class="o">&lt;</span> <span class="n">X</span><span class="o">-</span><span class="n">Powered</span><span class="o">-</span><span class="n">By</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.3</span>
<a id="__codelineno-38-21" name="__codelineno-38-21"></a><span class="o">&lt;</span> <span class="n">Location</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span>
<a id="__codelineno-38-22" name="__codelineno-38-22"></a><span class="o">&lt;</span> <span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">SERVERID68971</span><span class="o">=</span><span class="mi">26218</span><span class="o">|</span><span class="n">XwLIo</span><span class="o">|</span><span class="n">XwLIo</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span>
<a id="__codelineno-38-23" name="__codelineno-38-23"></a><span class="o">&lt;</span> <span class="n">X</span><span class="o">-</span><span class="n">IPLB</span><span class="o">-</span><span class="n">Instance</span><span class="p">:</span> <span class="mi">17102</span>
<a id="__codelineno-38-24" name="__codelineno-38-24"></a><span class="o">&lt;</span> 
<a id="__codelineno-38-25" name="__codelineno-38-25"></a><span class="o">*</span> <span class="n">Ignoring</span> <span class="n">the</span> <span class="n">response</span><span class="o">-</span><span class="n">body</span>
<a id="__codelineno-38-26" name="__codelineno-38-26"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host sergetahe.com left intact</span>
<a id="__codelineno-38-27" name="__codelineno-38-27"></a><span class="o">*</span> <span class="n">Issue</span> <span class="n">another</span> <span class="n">request</span> <span class="n">to</span> <span class="n">this</span> <span class="n">URL</span><span class="p">:</span> <span class="s1">&#39;http://sergetahe.com/cours-tutoriels-de-programmation&#39;</span>
<a id="__codelineno-38-28" name="__codelineno-38-28"></a><span class="o">*</span> <span class="n">Found</span> <span class="n">bundle</span> <span class="k">for</span> <span class="n">host</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">:</span> <span class="mh">0x25eacafb5d0</span> <span class="p">[</span><span class="n">serially</span><span class="p">]</span>
<a id="__codelineno-38-29" name="__codelineno-38-29"></a><span class="o">*</span> <span class="n">Can</span> <span class="ow">not</span> <span class="n">multiplex</span><span class="p">,</span> <span class="n">even</span> <span class="k">if</span> <span class="n">we</span> <span class="n">wanted</span> <span class="n">to</span><span class="err">!</span>
<a id="__codelineno-38-30" name="__codelineno-38-30"></a><span class="o">*</span> <span class="n">Re</span><span class="o">-</span><span class="n">using</span> <span class="n">existing</span> <span class="n">connection</span><span class="err">!</span> <span class="p">(</span><span class="c1">#0) with host sergetahe.com</span>
<a id="__codelineno-38-31" name="__codelineno-38-31"></a><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span> <span class="p">(</span><span class="mf">87.98.154.146</span><span class="p">)</span> <span class="n">port</span> <span class="mi">80</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-38-32" name="__codelineno-38-32"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-38-33" name="__codelineno-38-33"></a><span class="n">Host</span><span class="p">:</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-38-34" name="__codelineno-38-34"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PycURL</span><span class="o">/</span><span class="mf">7.43.0.5</span> <span class="n">libcurl</span><span class="o">/</span><span class="mf">7.68.0</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">d</span> <span class="n">zlib</span><span class="o">/</span><span class="mf">1.2.11</span> <span class="n">c</span><span class="o">-</span><span class="n">ares</span><span class="o">/</span><span class="mf">1.15.0</span> <span class="n">WinIDN</span> <span class="n">libssh2</span><span class="o">/</span><span class="mf">1.9.0</span> <span class="n">nghttp2</span><span class="o">/</span><span class="mf">1.40.0</span>
<a id="__codelineno-38-35" name="__codelineno-38-35"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-38-36" name="__codelineno-38-36"></a>
<a id="__codelineno-38-37" name="__codelineno-38-37"></a><span class="o">*</span> <span class="n">Mark</span> <span class="n">bundle</span> <span class="k">as</span> <span class="ow">not</span> <span class="n">supporting</span> <span class="n">multiuse</span>
<a id="__codelineno-38-38" name="__codelineno-38-38"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">301</span> <span class="n">Moved</span> <span class="n">Permanently</span>
<a id="__codelineno-38-39" name="__codelineno-38-39"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">52</span> <span class="n">GMT</span>
<a id="__codelineno-38-40" name="__codelineno-38-40"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">iso</span><span class="o">-</span><span class="mi">8859</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-38-41" name="__codelineno-38-41"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">262</span>
<a id="__codelineno-38-42" name="__codelineno-38-42"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span>
<a id="__codelineno-38-43" name="__codelineno-38-43"></a><span class="o">&lt;</span> <span class="n">Location</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span>
<a id="__codelineno-38-44" name="__codelineno-38-44"></a><span class="o">&lt;</span> <span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">SERVERID68971</span><span class="o">=</span><span class="mi">26218</span><span class="o">|</span><span class="n">XwLIo</span><span class="o">|</span><span class="n">XwLIo</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span>
<a id="__codelineno-38-45" name="__codelineno-38-45"></a><span class="o">&lt;</span> <span class="n">X</span><span class="o">-</span><span class="n">IPLB</span><span class="o">-</span><span class="n">Instance</span><span class="p">:</span> <span class="mi">17102</span>
<a id="__codelineno-38-46" name="__codelineno-38-46"></a><span class="o">&lt;</span> 
<a id="__codelineno-38-47" name="__codelineno-38-47"></a><span class="o">*</span> <span class="n">Ignoring</span> <span class="n">the</span> <span class="n">response</span><span class="o">-</span><span class="n">body</span>
<a id="__codelineno-38-48" name="__codelineno-38-48"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host sergetahe.com left intact</span>
<a id="__codelineno-38-49" name="__codelineno-38-49"></a><span class="o">*</span> <span class="n">Issue</span> <span class="n">another</span> <span class="n">request</span> <span class="n">to</span> <span class="n">this</span> <span class="n">URL</span><span class="p">:</span> <span class="s1">&#39;http://sergetahe.com/cours-tutoriels-de-programmation/&#39;</span>
<a id="__codelineno-38-50" name="__codelineno-38-50"></a><span class="o">*</span> <span class="n">Found</span> <span class="n">bundle</span> <span class="k">for</span> <span class="n">host</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="p">:</span> <span class="mh">0x25eacafb5d0</span> <span class="p">[</span><span class="n">serially</span><span class="p">]</span>
<a id="__codelineno-38-51" name="__codelineno-38-51"></a><span class="o">*</span> <span class="n">Can</span> <span class="ow">not</span> <span class="n">multiplex</span><span class="p">,</span> <span class="n">even</span> <span class="k">if</span> <span class="n">we</span> <span class="n">wanted</span> <span class="n">to</span><span class="err">!</span>
<a id="__codelineno-38-52" name="__codelineno-38-52"></a><span class="o">*</span> <span class="n">Re</span><span class="o">-</span><span class="n">using</span> <span class="n">existing</span> <span class="n">connection</span><span class="err">!</span> <span class="p">(</span><span class="c1">#0) with host sergetahe.com</span>
<a id="__codelineno-38-53" name="__codelineno-38-53"></a><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span> <span class="p">(</span><span class="mf">87.98.154.146</span><span class="p">)</span> <span class="n">port</span> <span class="mi">80</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-38-54" name="__codelineno-38-54"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-38-55" name="__codelineno-38-55"></a><span class="n">Host</span><span class="p">:</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-38-56" name="__codelineno-38-56"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PycURL</span><span class="o">/</span><span class="mf">7.43.0.5</span> <span class="n">libcurl</span><span class="o">/</span><span class="mf">7.68.0</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">d</span> <span class="n">zlib</span><span class="o">/</span><span class="mf">1.2.11</span> <span class="n">c</span><span class="o">-</span><span class="n">ares</span><span class="o">/</span><span class="mf">1.15.0</span> <span class="n">WinIDN</span> <span class="n">libssh2</span><span class="o">/</span><span class="mf">1.9.0</span> <span class="n">nghttp2</span><span class="o">/</span><span class="mf">1.40.0</span>
<a id="__codelineno-38-57" name="__codelineno-38-57"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-38-58" name="__codelineno-38-58"></a>
<a id="__codelineno-38-59" name="__codelineno-38-59"></a><span class="o">*</span> <span class="n">Mark</span> <span class="n">bundle</span> <span class="k">as</span> <span class="ow">not</span> <span class="n">supporting</span> <span class="n">multiuse</span>
<a id="__codelineno-38-60" name="__codelineno-38-60"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">301</span> <span class="n">Moved</span> <span class="n">Permanently</span>
<a id="__codelineno-38-61" name="__codelineno-38-61"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">52</span> <span class="n">GMT</span>
<a id="__codelineno-38-62" name="__codelineno-38-62"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">iso</span><span class="o">-</span><span class="mi">8859</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-38-63" name="__codelineno-38-63"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">263</span>
<a id="__codelineno-38-64" name="__codelineno-38-64"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span>
<a id="__codelineno-38-65" name="__codelineno-38-65"></a><span class="o">&lt;</span> <span class="n">Location</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span>
<a id="__codelineno-38-66" name="__codelineno-38-66"></a><span class="o">&lt;</span> <span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">SERVERID68971</span><span class="o">=</span><span class="mi">26218</span><span class="o">|</span><span class="n">XwLIo</span><span class="o">|</span><span class="n">XwLIo</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span>
<a id="__codelineno-38-67" name="__codelineno-38-67"></a><span class="o">&lt;</span> <span class="n">X</span><span class="o">-</span><span class="n">IPLB</span><span class="o">-</span><span class="n">Instance</span><span class="p">:</span> <span class="mi">17102</span>
<a id="__codelineno-38-68" name="__codelineno-38-68"></a><span class="o">&lt;</span> 
<a id="__codelineno-38-69" name="__codelineno-38-69"></a><span class="o">*</span> <span class="n">Ignoring</span> <span class="n">the</span> <span class="n">response</span><span class="o">-</span><span class="n">body</span>
<a id="__codelineno-38-70" name="__codelineno-38-70"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host sergetahe.com left intact</span>
<a id="__codelineno-38-71" name="__codelineno-38-71"></a><span class="o">*</span> <span class="n">Issue</span> <span class="n">another</span> <span class="n">request</span> <span class="n">to</span> <span class="n">this</span> <span class="n">URL</span><span class="p">:</span> <span class="s1">&#39;https://sergetahe.com/cours-tutoriels-de-programmation/&#39;</span>
<a id="__codelineno-38-72" name="__codelineno-38-72"></a><span class="o">*</span>   <span class="n">Trying</span> <span class="mf">87.98.154.146</span><span class="p">:</span><span class="mf">443.</span><span class="o">..</span>
<a id="__codelineno-38-73" name="__codelineno-38-73"></a><span class="o">*</span> <span class="n">TCP_NODELAY</span> <span class="nb">set</span>
<a id="__codelineno-38-74" name="__codelineno-38-74"></a><span class="o">*</span> <span class="err">…</span><span class="o">.</span>
<a id="__codelineno-38-75" name="__codelineno-38-75"></a><span class="o">*</span> <span class="n">Using</span> <span class="n">Stream</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">1</span> <span class="p">(</span><span class="n">easy</span> <span class="n">handle</span> <span class="mh">0x25eaec77010</span><span class="p">)</span>
<a id="__codelineno-38-76" name="__codelineno-38-76"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mi">2</span>
<a id="__codelineno-38-77" name="__codelineno-38-77"></a><span class="n">Host</span><span class="p">:</span> <span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-38-78" name="__codelineno-38-78"></a><span class="n">user</span><span class="o">-</span><span class="n">agent</span><span class="p">:</span> <span class="n">PycURL</span><span class="o">/</span><span class="mf">7.43.0.5</span> <span class="n">libcurl</span><span class="o">/</span><span class="mf">7.68.0</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">d</span> <span class="n">zlib</span><span class="o">/</span><span class="mf">1.2.11</span> <span class="n">c</span><span class="o">-</span><span class="n">ares</span><span class="o">/</span><span class="mf">1.15.0</span> <span class="n">WinIDN</span> <span class="n">libssh2</span><span class="o">/</span><span class="mf">1.9.0</span> <span class="n">nghttp2</span><span class="o">/</span><span class="mf">1.40.0</span>
<a id="__codelineno-38-79" name="__codelineno-38-79"></a><span class="n">accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-38-80" name="__codelineno-38-80"></a>
<a id="__codelineno-38-81" name="__codelineno-38-81"></a><span class="o">*</span> <span class="n">Connection</span> <span class="n">state</span> <span class="n">changed</span> <span class="p">(</span><span class="n">MAX_CONCURRENT_STREAMS</span> <span class="o">==</span> <span class="mi">128</span><span class="p">)</span><span class="err">!</span>
<a id="__codelineno-38-82" name="__codelineno-38-82"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mi">2</span> <span class="mi">200</span> 
<a id="__codelineno-38-83" name="__codelineno-38-83"></a><span class="o">&lt;</span> <span class="n">date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">53</span> <span class="n">GMT</span>
<a id="__codelineno-38-84" name="__codelineno-38-84"></a><span class="o">&lt;</span> <span class="n">content</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-38-85" name="__codelineno-38-85"></a><span class="o">&lt;</span> <span class="n">server</span><span class="p">:</span> <span class="n">Apache</span>
<a id="__codelineno-38-86" name="__codelineno-38-86"></a><span class="o">&lt;</span> <span class="n">x</span><span class="o">-</span><span class="n">powered</span><span class="o">-</span><span class="n">by</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.3</span>
<a id="__codelineno-38-87" name="__codelineno-38-87"></a><span class="o">&lt;</span> <span class="n">link</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/</span><span class="n">wp</span><span class="o">-</span><span class="n">json</span><span class="o">/&gt;</span><span class="p">;</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;https://api.w.org/&quot;</span>
<a id="__codelineno-38-88" name="__codelineno-38-88"></a><span class="o">&lt;</span> <span class="n">link</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">sergetahe</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="n">tutoriels</span><span class="o">-</span><span class="n">de</span><span class="o">-</span><span class="n">programmation</span><span class="o">/&gt;</span><span class="p">;</span> <span class="n">rel</span><span class="o">=</span><span class="n">shortlink</span>
<a id="__codelineno-38-89" name="__codelineno-38-89"></a><span class="o">&lt;</span> <span class="n">vary</span><span class="p">:</span> <span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span>
<a id="__codelineno-38-90" name="__codelineno-38-90"></a><span class="o">&lt;</span> <span class="n">x</span><span class="o">-</span><span class="n">iplb</span><span class="o">-</span><span class="n">instance</span><span class="p">:</span> <span class="mi">17080</span>
<a id="__codelineno-38-91" name="__codelineno-38-91"></a><span class="o">&lt;</span> <span class="nb">set</span><span class="o">-</span><span class="n">cookie</span><span class="p">:</span> <span class="n">SERVERID68971</span><span class="o">=</span><span class="mi">26218</span><span class="o">|</span><span class="n">XwLIp</span><span class="o">|</span><span class="n">XwLIp</span><span class="p">;</span> <span class="n">path</span><span class="o">=/</span>
<a id="__codelineno-38-92" name="__codelineno-38-92"></a><span class="o">&lt;</span> 
<a id="__codelineno-38-93" name="__codelineno-38-93"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#1 to host sergetahe.com left intact</span>
<a id="__codelineno-38-94" name="__codelineno-38-94"></a><span class="o">-------------------------</span>
<a id="__codelineno-38-95" name="__codelineno-38-95"></a><span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-38-96" name="__codelineno-38-96"></a><span class="o">-------------------------</span>
<a id="__codelineno-38-97" name="__codelineno-38-97"></a><span class="n">Client</span> <span class="p">:</span> <span class="n">début</span> <span class="n">de</span> <span class="n">la</span> <span class="n">communication</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-38-98" name="__codelineno-38-98"></a><span class="o">*</span>   <span class="n">Trying</span> <span class="mf">87.98.130.52</span><span class="p">:</span><span class="mf">443.</span><span class="o">..</span>
<a id="__codelineno-38-99" name="__codelineno-38-99"></a><span class="o">*</span> <span class="n">TCP_NODELAY</span> <span class="nb">set</span>
<a id="__codelineno-38-100" name="__codelineno-38-100"></a><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span> <span class="p">(</span><span class="mf">87.98.130.52</span><span class="p">)</span> <span class="n">port</span> <span class="mi">443</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-38-101" name="__codelineno-38-101"></a><span class="o">*</span> <span class="n">ALPN</span><span class="p">,</span> <span class="n">offering</span> <span class="n">h2</span>
<a id="__codelineno-38-102" name="__codelineno-38-102"></a><span class="o">*</span> <span class="n">ALPN</span><span class="p">,</span> <span class="n">offering</span> <span class="n">http</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-38-103" name="__codelineno-38-103"></a><span class="o">*</span> <span class="n">SSL</span> <span class="n">connection</span> <span class="n">using</span> <span class="n">TLSv1</span><span class="mf">.3</span> <span class="o">/</span> <span class="n">TLS_AES_256_GCM_SHA384</span>
<a id="__codelineno-38-104" name="__codelineno-38-104"></a><span class="o">*</span> <span class="n">ALPN</span><span class="p">,</span> <span class="n">server</span> <span class="n">accepted</span> <span class="n">to</span> <span class="n">use</span> <span class="n">http</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-38-105" name="__codelineno-38-105"></a><span class="o">*</span> <span class="n">Server</span> <span class="n">certificate</span><span class="p">:</span>
<a id="__codelineno-38-106" name="__codelineno-38-106"></a><span class="o">*</span>  <span class="n">subject</span><span class="p">:</span> <span class="n">CN</span><span class="o">=*.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-38-107" name="__codelineno-38-107"></a><span class="o">*</span>  <span class="n">start</span> <span class="n">date</span><span class="p">:</span> <span class="n">Jul</span>  <span class="mi">1</span> <span class="mi">15</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">30</span> <span class="mi">2020</span> <span class="n">GMT</span>
<a id="__codelineno-38-108" name="__codelineno-38-108"></a><span class="o">*</span>  <span class="n">expire</span> <span class="n">date</span><span class="p">:</span> <span class="n">Sep</span> <span class="mi">29</span> <span class="mi">15</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">30</span> <span class="mi">2020</span> <span class="n">GMT</span>
<a id="__codelineno-38-109" name="__codelineno-38-109"></a><span class="o">*</span>  <span class="n">subjectAltName</span><span class="p">:</span> <span class="n">host</span> <span class="s2">&quot;tahe.developpez.com&quot;</span> <span class="n">matched</span> <span class="n">cert</span><span class="s1">&#39;s &quot;*.developpez.com&quot;</span>
<a id="__codelineno-38-110" name="__codelineno-38-110"></a><span class="o">*</span>  <span class="n">issuer</span><span class="p">:</span> <span class="n">C</span><span class="o">=</span><span class="n">US</span><span class="p">;</span> <span class="n">O</span><span class="o">=</span><span class="n">Let</span><span class="s1">&#39;s Encrypt; CN=Let&#39;</span><span class="n">s</span> <span class="n">Encrypt</span> <span class="n">Authority</span> <span class="n">X3</span>
<a id="__codelineno-38-111" name="__codelineno-38-111"></a><span class="o">*</span>  <span class="n">SSL</span> <span class="n">certificate</span> <span class="n">verify</span> <span class="n">result</span><span class="p">:</span> <span class="n">unable</span> <span class="n">to</span> <span class="n">get</span> <span class="n">local</span> <span class="n">issuer</span> <span class="n">certificate</span> <span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">continuing</span> <span class="n">anyway</span><span class="o">.</span>
<a id="__codelineno-38-112" name="__codelineno-38-112"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-38-113" name="__codelineno-38-113"></a><span class="n">Host</span><span class="p">:</span> <span class="n">tahe</span><span class="o">.</span><span class="n">developpez</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-38-114" name="__codelineno-38-114"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PycURL</span><span class="o">/</span><span class="mf">7.43.0.5</span> <span class="n">libcurl</span><span class="o">/</span><span class="mf">7.68.0</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">d</span> <span class="n">zlib</span><span class="o">/</span><span class="mf">1.2.11</span> <span class="n">c</span><span class="o">-</span><span class="n">ares</span><span class="o">/</span><span class="mf">1.15.0</span> <span class="n">WinIDN</span> <span class="n">libssh2</span><span class="o">/</span><span class="mf">1.9.0</span> <span class="n">nghttp2</span><span class="o">/</span><span class="mf">1.40.0</span>
<a id="__codelineno-38-115" name="__codelineno-38-115"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-38-116" name="__codelineno-38-116"></a>
<a id="__codelineno-38-117" name="__codelineno-38-117"></a><span class="o">*</span> <span class="n">old</span> <span class="n">SSL</span> <span class="n">session</span> <span class="n">ID</span> <span class="ow">is</span> <span class="n">stale</span><span class="p">,</span> <span class="n">removing</span>
<a id="__codelineno-38-118" name="__codelineno-38-118"></a><span class="o">*</span> <span class="n">Mark</span> <span class="n">bundle</span> <span class="k">as</span> <span class="ow">not</span> <span class="n">supporting</span> <span class="n">multiuse</span>
<a id="__codelineno-38-119" name="__codelineno-38-119"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-38-120" name="__codelineno-38-120"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">53</span> <span class="n">GMT</span>
<a id="__codelineno-38-121" name="__codelineno-38-121"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.38</span> <span class="p">(</span><span class="n">Debian</span><span class="p">)</span>
<a id="__codelineno-38-122" name="__codelineno-38-122"></a><span class="o">&lt;</span> <span class="n">X</span><span class="o">-</span><span class="n">Powered</span><span class="o">-</span><span class="n">By</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">5.3.29</span>
<a id="__codelineno-38-123" name="__codelineno-38-123"></a><span class="o">&lt;</span> <span class="n">Vary</span><span class="p">:</span> <span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span>
<a id="__codelineno-38-124" name="__codelineno-38-124"></a><span class="o">&lt;</span> <span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">chunked</span>
<a id="__codelineno-38-125" name="__codelineno-38-125"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span>
<a id="__codelineno-38-126" name="__codelineno-38-126"></a><span class="o">&lt;</span> 
<a id="__codelineno-38-127" name="__codelineno-38-127"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host tahe.developpez.com left intact</span>
<a id="__codelineno-38-128" name="__codelineno-38-128"></a><span class="o">-------------------------</span>
<a id="__codelineno-38-129" name="__codelineno-38-129"></a><span class="n">www</span><span class="o">.</span><span class="n">polytech</span><span class="o">-</span><span class="n">angers</span><span class="o">.</span><span class="n">fr</span>
<a id="__codelineno-38-130" name="__codelineno-38-130"></a><span class="o">-------------------------</span>
<a id="__codelineno-38-131" name="__codelineno-38-131"></a><span class="n">Client</span> <span class="p">:</span> <span class="n">début</span> <span class="n">de</span> <span class="n">la</span> <span class="n">communication</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">www</span><span class="o">.</span><span class="n">polytech</span><span class="o">-</span><span class="n">angers</span><span class="o">.</span><span class="n">fr</span><span class="p">]</span>
<a id="__codelineno-38-132" name="__codelineno-38-132"></a><span class="o">*</span>   <span class="n">Trying</span> <span class="mf">193.49.144.41</span><span class="p">:</span><span class="mf">80.</span><span class="o">..</span>
<a id="__codelineno-38-133" name="__codelineno-38-133"></a><span class="o">*</span> <span class="n">TCP_NODELAY</span> <span class="nb">set</span>
<a id="__codelineno-38-134" name="__codelineno-38-134"></a><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">www</span><span class="o">.</span><span class="n">polytech</span><span class="o">-</span><span class="n">angers</span><span class="o">.</span><span class="n">fr</span> <span class="p">(</span><span class="mf">193.49.144.41</span><span class="p">)</span> <span class="n">port</span> <span class="mi">80</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-38-135" name="__codelineno-38-135"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-38-136" name="__codelineno-38-136"></a><span class="n">Host</span><span class="p">:</span> <span class="n">www</span><span class="o">.</span><span class="n">polytech</span><span class="o">-</span><span class="n">angers</span><span class="o">.</span><span class="n">fr</span>
<a id="__codelineno-38-137" name="__codelineno-38-137"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PycURL</span><span class="o">/</span><span class="mf">7.43.0.5</span> <span class="n">libcurl</span><span class="o">/</span><span class="mf">7.68.0</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">d</span> <span class="n">zlib</span><span class="o">/</span><span class="mf">1.2.11</span> <span class="n">c</span><span class="o">-</span><span class="n">ares</span><span class="o">/</span><span class="mf">1.15.0</span> <span class="n">WinIDN</span> <span class="n">libssh2</span><span class="o">/</span><span class="mf">1.9.0</span> <span class="n">nghttp2</span><span class="o">/</span><span class="mf">1.40.0</span>
<a id="__codelineno-38-138" name="__codelineno-38-138"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-38-139" name="__codelineno-38-139"></a>
<a id="__codelineno-38-140" name="__codelineno-38-140"></a><span class="o">*</span> <span class="n">Mark</span> <span class="n">bundle</span> <span class="k">as</span> <span class="ow">not</span> <span class="n">supporting</span> <span class="n">multiuse</span>
<a id="__codelineno-38-141" name="__codelineno-38-141"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">301</span> <span class="n">Moved</span> <span class="n">Permanently</span>
<a id="__codelineno-38-142" name="__codelineno-38-142"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">54</span> <span class="n">GMT</span>
<a id="__codelineno-38-143" name="__codelineno-38-143"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.29</span> <span class="p">(</span><span class="n">Ubuntu</span><span class="p">)</span>
<a id="__codelineno-38-144" name="__codelineno-38-144"></a><span class="o">&lt;</span> <span class="n">Location</span><span class="p">:</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">polytech</span><span class="o">-</span><span class="n">angers</span><span class="o">.</span><span class="n">fr</span><span class="o">/</span><span class="n">fr</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
<a id="__codelineno-38-145" name="__codelineno-38-145"></a><span class="o">&lt;</span> <span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="nb">max</span><span class="o">-</span><span class="n">age</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-38-146" name="__codelineno-38-146"></a><span class="o">&lt;</span> <span class="n">Expires</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">55</span> <span class="n">GMT</span>
<a id="__codelineno-38-147" name="__codelineno-38-147"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">339</span>
<a id="__codelineno-38-148" name="__codelineno-38-148"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">iso</span><span class="o">-</span><span class="mi">8859</span><span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-38-149" name="__codelineno-38-149"></a><span class="o">&lt;</span> 
<a id="__codelineno-38-150" name="__codelineno-38-150"></a><span class="o">*</span> <span class="n">Ignoring</span> <span class="n">the</span> <span class="n">response</span><span class="o">-</span><span class="n">body</span>
<a id="__codelineno-38-151" name="__codelineno-38-151"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host www.polytech-angers.fr left intact</span>
<a id="__codelineno-38-152" name="__codelineno-38-152"></a><span class="o">*</span> <span class="n">Issue</span> <span class="n">another</span> <span class="n">request</span> <span class="n">to</span> <span class="n">this</span> <span class="n">URL</span><span class="p">:</span> <span class="s1">&#39;http://www.polytech-angers.fr/fr/index.html&#39;</span>
<a id="__codelineno-38-153" name="__codelineno-38-153"></a><span class="o">*</span> <span class="n">Found</span> <span class="n">bundle</span> <span class="k">for</span> <span class="n">host</span> <span class="n">www</span><span class="o">.</span><span class="n">polytech</span><span class="o">-</span><span class="n">angers</span><span class="o">.</span><span class="n">fr</span><span class="p">:</span> <span class="mh">0x25eacafb490</span> <span class="p">[</span><span class="n">serially</span><span class="p">]</span>
<a id="__codelineno-38-154" name="__codelineno-38-154"></a><span class="o">*</span> <span class="n">Can</span> <span class="ow">not</span> <span class="n">multiplex</span><span class="p">,</span> <span class="n">even</span> <span class="k">if</span> <span class="n">we</span> <span class="n">wanted</span> <span class="n">to</span><span class="err">!</span>
<a id="__codelineno-38-155" name="__codelineno-38-155"></a><span class="o">*</span> <span class="n">Re</span><span class="o">-</span><span class="n">using</span> <span class="n">existing</span> <span class="n">connection</span><span class="err">!</span> <span class="p">(</span><span class="c1">#0) with host www.polytech-angers.fr</span>
<a id="__codelineno-38-156" name="__codelineno-38-156"></a><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">www</span><span class="o">.</span><span class="n">polytech</span><span class="o">-</span><span class="n">angers</span><span class="o">.</span><span class="n">fr</span> <span class="p">(</span><span class="mf">193.49.144.41</span><span class="p">)</span> <span class="n">port</span> <span class="mi">80</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-38-157" name="__codelineno-38-157"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span><span class="n">fr</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-38-158" name="__codelineno-38-158"></a><span class="n">Host</span><span class="p">:</span> <span class="n">www</span><span class="o">.</span><span class="n">polytech</span><span class="o">-</span><span class="n">angers</span><span class="o">.</span><span class="n">fr</span>
<a id="__codelineno-38-159" name="__codelineno-38-159"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PycURL</span><span class="o">/</span><span class="mf">7.43.0.5</span> <span class="n">libcurl</span><span class="o">/</span><span class="mf">7.68.0</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">d</span> <span class="n">zlib</span><span class="o">/</span><span class="mf">1.2.11</span> <span class="n">c</span><span class="o">-</span><span class="n">ares</span><span class="o">/</span><span class="mf">1.15.0</span> <span class="n">WinIDN</span> <span class="n">libssh2</span><span class="o">/</span><span class="mf">1.9.0</span> <span class="n">nghttp2</span><span class="o">/</span><span class="mf">1.40.0</span>
<a id="__codelineno-38-160" name="__codelineno-38-160"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-38-161" name="__codelineno-38-161"></a>
<a id="__codelineno-38-162" name="__codelineno-38-162"></a><span class="o">*</span> <span class="n">Mark</span> <span class="n">bundle</span> <span class="k">as</span> <span class="ow">not</span> <span class="n">supporting</span> <span class="n">multiuse</span>
<a id="__codelineno-38-163" name="__codelineno-38-163"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-38-164" name="__codelineno-38-164"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">54</span> <span class="n">GMT</span>
<a id="__codelineno-38-165" name="__codelineno-38-165"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.29</span> <span class="p">(</span><span class="n">Ubuntu</span><span class="p">)</span>
<a id="__codelineno-38-166" name="__codelineno-38-166"></a><span class="o">&lt;</span> <span class="n">Last</span><span class="o">-</span><span class="n">Modified</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">04</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">09</span> <span class="n">GMT</span>
<a id="__codelineno-38-167" name="__codelineno-38-167"></a><span class="o">&lt;</span> <span class="n">ETag</span><span class="p">:</span> <span class="s2">&quot;85be-5a9be9bfcf228&quot;</span>
<a id="__codelineno-38-168" name="__codelineno-38-168"></a><span class="o">&lt;</span> <span class="n">Accept</span><span class="o">-</span><span class="n">Ranges</span><span class="p">:</span> <span class="nb">bytes</span>
<a id="__codelineno-38-169" name="__codelineno-38-169"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">34238</span>
<a id="__codelineno-38-170" name="__codelineno-38-170"></a><span class="o">&lt;</span> <span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="nb">max</span><span class="o">-</span><span class="n">age</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-38-171" name="__codelineno-38-171"></a><span class="o">&lt;</span> <span class="n">Expires</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">55</span> <span class="n">GMT</span>
<a id="__codelineno-38-172" name="__codelineno-38-172"></a><span class="o">&lt;</span> <span class="n">Vary</span><span class="p">:</span> <span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span>
<a id="__codelineno-38-173" name="__codelineno-38-173"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-38-174" name="__codelineno-38-174"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span> <span class="n">fr</span>
<a id="__codelineno-38-175" name="__codelineno-38-175"></a><span class="o">&lt;</span> 
<a id="__codelineno-38-176" name="__codelineno-38-176"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host www.polytech-angers.fr left intact</span>
<a id="__codelineno-38-177" name="__codelineno-38-177"></a><span class="o">-------------------------</span>
<a id="__codelineno-38-178" name="__codelineno-38-178"></a><span class="n">localhost</span>
<a id="__codelineno-38-179" name="__codelineno-38-179"></a><span class="o">-------------------------</span>
<a id="__codelineno-38-180" name="__codelineno-38-180"></a><span class="n">Client</span> <span class="p">:</span> <span class="n">début</span> <span class="n">de</span> <span class="n">la</span> <span class="n">communication</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="p">]</span>
<a id="__codelineno-38-181" name="__codelineno-38-181"></a><span class="o">*</span>   <span class="n">Trying</span> <span class="p">::</span><span class="mi">1</span><span class="p">:</span><span class="mf">80.</span><span class="o">..</span>
<a id="__codelineno-38-182" name="__codelineno-38-182"></a><span class="o">*</span> <span class="n">TCP_NODELAY</span> <span class="nb">set</span>
<a id="__codelineno-38-183" name="__codelineno-38-183"></a><span class="o">*</span> <span class="n">Connected</span> <span class="n">to</span> <span class="n">localhost</span> <span class="p">(::</span><span class="mi">1</span><span class="p">)</span> <span class="n">port</span> <span class="mi">80</span> <span class="p">(</span><span class="c1">#0)</span>
<a id="__codelineno-38-184" name="__codelineno-38-184"></a><span class="o">&gt;</span> <span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-38-185" name="__codelineno-38-185"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span>
<a id="__codelineno-38-186" name="__codelineno-38-186"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PycURL</span><span class="o">/</span><span class="mf">7.43.0.5</span> <span class="n">libcurl</span><span class="o">/</span><span class="mf">7.68.0</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">d</span> <span class="n">zlib</span><span class="o">/</span><span class="mf">1.2.11</span> <span class="n">c</span><span class="o">-</span><span class="n">ares</span><span class="o">/</span><span class="mf">1.15.0</span> <span class="n">WinIDN</span> <span class="n">libssh2</span><span class="o">/</span><span class="mf">1.9.0</span> <span class="n">nghttp2</span><span class="o">/</span><span class="mf">1.40.0</span>
<a id="__codelineno-38-187" name="__codelineno-38-187"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-38-188" name="__codelineno-38-188"></a>
<a id="__codelineno-38-189" name="__codelineno-38-189"></a><span class="o">*</span> <span class="n">Mark</span> <span class="n">bundle</span> <span class="k">as</span> <span class="ow">not</span> <span class="n">supporting</span> <span class="n">multiuse</span>
<a id="__codelineno-38-190" name="__codelineno-38-190"></a><span class="o">&lt;</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-38-191" name="__codelineno-38-191"></a><span class="o">&lt;</span> <span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">06</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">54</span> <span class="n">GMT</span>
<a id="__codelineno-38-192" name="__codelineno-38-192"></a><span class="o">&lt;</span> <span class="n">Server</span><span class="p">:</span> <span class="n">Apache</span><span class="o">/</span><span class="mf">2.4.35</span> <span class="p">(</span><span class="n">Win64</span><span class="p">)</span> <span class="n">OpenSSL</span><span class="o">/</span><span class="mf">1.1.1</span><span class="n">b</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span>
<a id="__codelineno-38-193" name="__codelineno-38-193"></a><span class="o">&lt;</span> <span class="n">X</span><span class="o">-</span><span class="n">Powered</span><span class="o">-</span><span class="n">By</span><span class="p">:</span> <span class="n">PHP</span><span class="o">/</span><span class="mf">7.2.19</span>
<a id="__codelineno-38-194" name="__codelineno-38-194"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">1776</span>
<a id="__codelineno-38-195" name="__codelineno-38-195"></a><span class="o">&lt;</span> <span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-38-196" name="__codelineno-38-196"></a><span class="o">&lt;</span> 
<a id="__codelineno-38-197" name="__codelineno-38-197"></a><span class="o">*</span> <span class="n">Connection</span> <span class="c1">#0 to host localhost left intact</span>
<a id="__codelineno-38-198" name="__codelineno-38-198"></a><span class="n">Terminé</span><span class="o">...</span>
<a id="__codelineno-38-199" name="__codelineno-38-199"></a>
<a id="__codelineno-38-200" name="__codelineno-38-200"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>en bleu, les commandes http envoyées au serveur ;</li>
<li>en vert, les données reçues en réponse par le client ;</li>
<li>on obtient les mêmes échanges qu’avec l’outil <strong>[curl]</strong> ;</li>
<li>ligne 9 : l&#x27;URL <strong>[http://sergetahe.com/]</strong> est demandée ;</li>
<li>ligne 15 : le serveur répond que la page a bougé. Ligne 21, la nouvelle URL ;</li>
<li>ligne 32 : l&#x27;URL <strong>[</strong><strong>http://sergetahe.com/cours-tutoriels-de-programmation</strong><strong>]</strong> est demandée ;</li>
<li>ligne 38 : le serveur répond que la page a bougé. Ligne 43, la nouvelle URL ;</li>
<li>ligne 54 : l&#x27;URL <strong>[</strong><strong>http://sergetahe.com/cours-tutoriels-de-programmation/</strong><strong>]</strong> est demandée ;</li>
<li>ligne 60 : le serveur répond que la page a bougé. Ligne 65, la nouvelle URL. Elle utilise le protocole sécurisé <strong>[HTTPS]</strong> ;</li>
<li>lignes 71-75 : le protocole sécurisé est mis en place avec le serveur ;</li>
<li>ligne 76 : l&#x27;URL <strong>[</strong><strong>https://sergetahe.com/cours-tutoriels-de-programmation/</strong><strong>]</strong> est demandée ;</li>
<li>ligne 82 : le document demandé a été trouvé ;</li>
</ul>
<h3 id="2146-conclusion">21.4.6. Conclusion</h3>
<p>Nous avons, dans cette section, découvert le protocole HTTP et avons écrit un script <strong>[http/02/main.py]</strong> capable de télécharger une URL du web.</p>
<h2 id="215-le-protocole-smtp-simple-mail-transfer-protocol">21.5. Le protocole SMTP (Simple Mail Transfer Protocol)</h2>
<h3 id="2151-introduction">21.5.1. Introduction</h3>
<p>Dans ce chapitre :</p>
<ul>
<li><strong>[Serveur B]</strong> sera un serveur SMTP local que nous installerons ;</li>
<li><strong>[Client A]</strong> sera un client SMTP de diverses formes :</li>
<li>le client <strong>[RawTcpClient]</strong> pour découvrir le protocole SMTP ;</li>
<li>un script Python rejouant le protocole SMTP du client <strong>[RawTcpClient]</strong> ;</li>
<li>un script Python utilisant le moduke <strong>[smtplib]</strong> permettant d’envoyer toutes sortes de mails ;</li>
</ul>
<h3 id="2152-creation-dune-adresse-gmail">21.5.2. Création d’une adresse [gmail]</h3>
<p>Pour faire nos tests SMTP, nous aurons besoin d’une adresse mail à qui écrire. Nous allons créer pour cela une adresse Gmail [<a href="https://www.google.com/intl/fr/gmail/about/"><u><u>https://www.google.com/intl/fr/gmail/about/</u></u></a>] :</p>
<p><img src="images/1000000000000260000002E4CDEBD503.png" style="width:7.01cm;height:8.542cm;" alt="Image" /></p>
<p><strong>Note</strong> : Envoyez quelques mails à l&#x27;adresse que vous avez créée. Ne passez à la suite que lorsque vous êtes sûr que le compte créé est capable de recevoir des mails.</p>
<h3 id="2153-installation-dun-serveur-smtp">21.5.3. Installation d’un serveur SMTP</h3>
<p>Pour nos tests, nous installerons le serveur de mail <strong>[hMailServer]</strong> qui est à la fois un serveur SMTP permettant d’envoyer des mails, un serveur POP3 (Post Office Protocol) permettant de lire les mails stockés sur le serveur, un serveur IMAP (Internet Message Access Protocol) qui lui aussi permet de  lire les mails stockés sur le serveur mais va au-delà. Il permet notamment de gérer le stockage des mails sur le serveur.</p>
<p>Le serveur de mail <strong>[hMailServer]</strong> est disponible à l’URL <strong>[https://www.hmailserver.com/]</strong> (mai 2019).</p>
<p><img src="images/1000000100000396000001451FC20FFE.png" style="width:15.47cm;height:5.471cm;" alt="Image" /></p>
<p>Au cours de l’installation, certains renseignements vous seront demandés :</p>
<p><img src="images/100000010000020A00000187F99E2ED0.png" style="width:8.76cm;height:6.561cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1-2]</strong>, sélectionnez à la fois le serveur de mails et les outils pour l’administrer ;</li>
<li>
<p>durant l’installation le mot de l’administrateur vous sera demandé : <strong>notez l</strong>e, car il vous sera nécessaire ;
<strong>[hMailServer]</strong> s’installe comme un service Windows lancé automatiquement au démarrage de la machine. Il est préférable de choisir un démarrage manuel :</p>
</li>
<li>
<p>en <strong>[3]</strong>, on tape <strong>[services]</strong> dans la zone de saisie de la barre d’état ;</p>
</li>
</ul>
<p><img src="images/100000010000039900000245395C60BE.png" style="width:15.461cm;height:9.741cm;" alt="Image" /></p>
<ul>
<li>en <strong>[4-8]</strong>, on met le service en mode <strong>[manuel]</strong> (6), on le lance (7) ;
Une fois démarré, le serveur <strong>[hMailServer]</strong> doit être configuré. Le serveur a été installé avec un programme d’administration <strong>[hMailServer Administrator]</strong> :</li>
</ul>
<p><img src="images/10000001000003C300000236F27F0FCB.png" style="width:16.431cm;height:9.651cm;" alt="Image" /></p>
<ul>
<li>en <strong>[2]</strong>, dans la zone de saisie de la barre d’état, taper <strong>[hmailserver]</strong> ;</li>
<li>en <strong>[3]</strong>, lancer l’administrateur ;</li>
<li>en <strong>[4]</strong>, connecter l’administrateur au serveur <strong>[hMailServer]</strong> ;</li>
<li>
<p>en <strong>[5]</strong>, taper le mot de passe saisi lors de l’installation de <strong>[hMailServer]</strong> ;
Si vous avez oublié le mot de passe, procédez comme suit :</p>
</li>
<li>
<p>arrêtez le serveur <strong>[hMailServer]</strong> ;</p>
</li>
<li>ouvrez le fichier <strong>[&lt;hmailserver&gt;/bin/hmailserver.ini]</strong> où &lt;hmailserver&gt; est le dossier d&#x27;installation du serveur :</li>
</ul>
<p><img src="images/10000001000003180000015981780B38.png" style="width:14.742cm;height:6.421cm;" alt="Image" /></p>
<ul>
<li>en <strong>[100]</strong>, enlevez le mot de passe de la ligne <strong>[AdministratorPassword]</strong>. Cela aura pour effet que l&#x27;administrateur n&#x27;aura plus de mot de passe. Tapez simplement <strong>[Entrée]</strong> lorsque celui-ci vous sera demandé ;
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1">1</a></span>
<span class="normal"><a href="#__codelineno-39-2">2</a></span>
<span class="normal"><a href="#__codelineno-39-3">3</a></span>
<span class="normal"><a href="#__codelineno-39-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="n">ValidLanguages</span><span class="o">=</span><span class="n">english</span><span class="p">,</span><span class="n">swedish</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="p">[</span><span class="n">Security</span><span class="p">]</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="n">AdministratorPassword</span><span class="o">=</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="p">[</span><span class="n">Database</span><span class="p">]</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Continuons la configuration du serveur :</p>
<p><img src="images/10000000000004700000013BABC05ED4.png" style="width:13.131cm;height:3.641cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1-2]</strong>, ajoutez un domaine (s’il n’existe pas déjà) ;</li>
</ul>
<p><img src="images/10000000000002F7000002DAC92FD6C8.png" style="width:8.76cm;height:8.43cm;" alt="Image" /></p>
<ul>
<li>en <strong>[3]</strong>, on peut mettre à peu près n’importe quoi pour les tests que nous allons opérer. Dans la réalité, il faudrait mettre le nom d’un domaine existant ;</li>
</ul>
<p><img src="images/10000000000004FD000002843377431B.png" style="width:14.75cm;height:7.441cm;" alt="Image" /></p>
<p>Nous allons créer un compte utilisateur :</p>
<ul>
<li>cliquer droit sur <strong>[Accounts]</strong> (7) puis (8) pour ajouter un nouvel utilisateur ;</li>
<li>dans l’onglet <strong>[General]</strong> (9), nous définissons un utilisateur <strong>[guest]</strong> (10) avec le mot de passe <strong>[guest]</strong> (11). Il aura l’adresse mail <strong>[guest@localhost]</strong> (10) ;</li>
<li>en <strong>[12]</strong>, l’utilisateur <strong>[guest]</strong> est activé ;</li>
</ul>
<p><img src="images/100000000000036C0000013A11F2B9CF.png" style="width:10.111cm;height:3.62cm;" alt="Image" /></p>
<ul>
<li>en <strong>[13-14]</strong>, l’utilisateur créé ;</li>
</ul>
<p><img src="images/10000000000004460000033A7ACAA40B.png" style="width:12.63cm;height:9.531cm;" alt="Image" /></p>
<ul>
<li>en <strong>[27]</strong> le port du service SMTP ;</li>
<li>en <strong>[28]</strong>, ce service ne nécessite pas d’authentification ;</li>
<li>en <strong>[30]</strong>, mettez le message de bienvenue que le serveur SMTP enverra à ses clients ;</li>
</ul>
<p><img src="images/1000000000000472000002582DCD75E2.png" style="width:13.14cm;height:6.921cm;" alt="Image" /></p>
<p>On fait de même avec le serveur POP3 :</p>
<p><img src="images/10000000000003F300000213673E1A41.png" style="width:11.651cm;height:6.121cm;" alt="Image" /></p>
<p>On refait la même chose pour le serveur IMAP :</p>
<p><img src="images/10000000000004740000022177C01FA7.png" style="width:13.151cm;height:6.291cm;" alt="Image" /></p>
<p>Nous indiquons le domaine par défaut du serveur <strong>[hMailServer]</strong> (il peut y en avoir plusieurs) :</p>
<p><img src="images/100000000000038D00000260826E0925.png" style="width:10.51cm;height:7.032cm;" alt="Image" /></p>
<ul>
<li>en <strong>[37]</strong>, indiquez que le domaine par défaut du serveur SMTP est celui que vous avez créé en <strong>[38]</strong> ;
Après avoir sauvegardé cette configuration, vous pouvez la tester de la façon suivante. Ouvrez un terminal PyCharm dans le dossier des utilitaires :</li>
</ul>
<p><img src="images/10000000000001D3000002958C43B4AC.png" style="width:5.391cm;height:7.64cm;" alt="Image" /></p>
<p>Puis tapez la commande suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span>
<span class="normal"><a href="#__codelineno-40-2">2</a></span>
<span class="normal"><a href="#__codelineno-40-3">3</a></span>
<span class="normal"><a href="#__codelineno-40-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">25</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">50170</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">25</span><span class="p">]</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">220</span> <span class="n">Bienvenue</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">serveur</span> <span class="n">SMTP</span> <span class="n">localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : on se connecte au port 25 de la machine <strong>[localhost]</strong>. C’est là qu’officie un serveur SMTP non sécurisé du serveur <strong>[hMailServer]</strong> ;</li>
<li>ligne 4 : on reçoit le message de bienvenue que nous avons configuré à l’étape 30 précédente ;
Le serveur SMTP est donc bien en place. Tapez la commande <strong>[quit]</strong> pour terminer le dialogue avec le serveur SMTP 25.</li>
</ul>
<p>Maintenant faisons la même chose avec le port 587 qui est le port par défaut du service SMTP sécurisé de relève du courrier :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span>
<span class="normal"><a href="#__codelineno-41-2">2</a></span>
<span class="normal"><a href="#__codelineno-41-3">3</a></span>
<span class="normal"><a href="#__codelineno-41-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">587</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">50217</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">587</span><span class="p">]</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">220</span> <span class="n">Bienvenue</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">serveur</span> <span class="n">SMTP</span> <span class="n">localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 4, la réponse du serveur SMTP officiant sur le port 587 ;
Maintenant faisons la même chose avec le port 110 qui est le port par défaut du service POP3 de relève du courrier :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">1</a></span>
<span class="normal"><a href="#__codelineno-42-2">2</a></span>
<span class="normal"><a href="#__codelineno-42-3">3</a></span>
<span class="normal"><a href="#__codelineno-42-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">110</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">50210</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">110</span><span class="p">]</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="n">Bienvenue</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">serveur</span> <span class="n">POP3</span> <span class="n">localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 4, on a reçu le message de bienvenue du serveur POP3 ;
Maintenant faisons la même chose avec le port 143 qui est le port par défaut du service IMAP de relève du courrier :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1">1</a></span>
<span class="normal"><a href="#__codelineno-43-2">2</a></span>
<span class="normal"><a href="#__codelineno-43-3">3</a></span>
<span class="normal"><a href="#__codelineno-43-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">143</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">50212</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">143</span><span class="p">]</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">*</span> <span class="n">OK</span> <span class="n">Bienvenue</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">serveur</span> <span class="n">IMAP</span> <span class="n">localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 4, on a reçu le message de bienvenue du serveur IMAP ;</li>
</ul>
<h3 id="2154-installation-dun-lecteur-de-courrier">21.5.4. Installation d&#x27;un lecteur de courrier</h3>
<p>Pour lire le courrier que nous allons envoyer, il nous faut un lecteur de courrier. Pour ceux qui n&#x27;en ont pas, nous montrons l&#x27;installation et la configuration du lecteur <strong>[Thunderbird]</strong> :</p>
<ul>
<li>en <strong>[1]</strong> : téléchargez <strong>[thunderbird]</strong> puis installez-le ;</li>
</ul>
<p><img src="images/10000001000003D60000015D8D230377.png" style="width:16.421cm;height:5.83cm;" alt="Image" /></p>
<ul>
<li>lancez le serveur de mail <strong>[hMailServer]</strong> s&#x27;il ne l&#x27;est pas déjà ;</li>
<li>en <strong>[2-3]</strong> : une fois Thunderbird lancé,  nous allons créer un compte de messagerie pour l&#x27;utilisateur <strong>[guest@localhost]</strong> du serveur de mail <strong>[hMailServer]</strong> ;</li>
</ul>
<p><img src="images/10000000000002F9000001B9DAEB5A27.png" style="width:8.771cm;height:5.1cm;" alt="Image" /></p>
<p><img src="images/1000000000000310000002109FB497DD.png" style="width:9.06cm;height:6.1cm;" alt="Image" /></p>
<p><img src="images/1000000000000436000002049CB5FE0B.png" style="width:12.431cm;height:5.95cm;" alt="Image" /></p>
<ul>
<li>en <strong>[7-11]</strong> : le serveur POP3 qui va nous permettre de lire le courrier du serveur de mail <strong>[hMailServer]</strong> est à l&#x27;adresse <strong>[localhost]</strong> et officie sur le port 110 ;</li>
<li>en <strong>[12-16]</strong> : le serveur SMTP qui va nous permettre d&#x27;envoyer du courrier de la part des utilisateurs du serveur de mail <strong>[hMailServer]</strong> est à l&#x27;adresse <strong>[localhost]</strong> et officie sur le port 25 ;</li>
<li><strong>[18]</strong> : on peut tester la validation de cette configuration ;</li>
</ul>
<p><img src="images/100000000000035600000233F318A147.png" style="width:9.861cm;height:6.501cm;" alt="Image" /></p>
<p><img src="images/100000000000038E000001A3DFA940FB.png" style="width:10.51cm;height:4.841cm;" alt="Image" /></p>
<ul>
<li>en <strong>[26]</strong> : parce qu&#x27;on n&#x27;a pas de chiffrement SSL, Thunderbird nous avertit que notre configuration comporte des risques ;</li>
<li>
<p>en <strong>[28]</strong> : le compte a été créé ;
Pour tester le compte créé, nous allons avec Thunderbird :</p>
</li>
<li>
<p>envoyer un mail à l&#x27;utilisateur <strong>[guest@localhost.com]</strong> (protocole SMTP) ;</p>
</li>
<li>lire le courrier reçu par cet utilisateur (protocole POP3) ;</li>
</ul>
<p><img src="images/1000000000000513000001A4E9868A24.png" style="width:15.02cm;height:4.851cm;" alt="Image" /></p>
<ul>
<li>en <strong>[3]</strong> : l&#x27;expéditeur ;</li>
<li>en <strong>[4]</strong> : le destinataire ;</li>
<li>en <strong>[5]</strong> : le sujet du mail ;</li>
<li>en <strong>[6]</strong> : le contenu du mail ;</li>
<li>en <strong>[7]</strong> : pour envoyer le mail ;</li>
</ul>
<p><img src="images/10000000000003FA0000020A702F0635.png" style="width:11.741cm;height:6.021cm;" alt="Image" /></p>
<ul>
<li>en <strong>[8-9]</strong> : on relève le courrier de l&#x27;utilisateur <strong>[guest@localhost]</strong> ;</li>
<li>en <strong>[10-15]</strong> : le message reçu ;
Nous allons envoyer également du courrier à l&#x27;utilisateur <strong>[pymailparlexemple@gmail.com]</strong>. Créons-lui un compte dans Thunderbird pour lire le courrier qu&#x27;il recevra :</li>
</ul>
<p><img src="images/100000010000035C0000015BF8CF4408.png" style="width:11.711cm;height:4.721cm;" alt="Image" /></p>
<p><img src="images/10000000000002F7000001FFE87A005F.png" style="width:8.771cm;height:5.901cm;" alt="Image" /></p>
<ul>
<li>en <strong>[4]</strong> : mettez ce que vous voulez ;</li>
<li>en <strong>[5]</strong> : l&#x27;adresse est <strong>[pymailparlexemple@gmail.com]</strong> ;</li>
<li>en <strong>[6]</strong> : tapez le mot de passe que vous avez donné à cet utilisateur lorsque vous l&#x27;avez créé ;</li>
<li>en <strong>[7]</strong> : validez cette configuration ;</li>
</ul>
<p><img src="images/10000000000002F7000001FFEE979301.png" style="width:8.771cm;height:5.901cm;" alt="Image" /></p>
<ul>
<li>en <strong>[8]</strong> : Thunderbird a récupéré les informations suivantes dans sa base de données ;</li>
<li>en <strong>[9]</strong> : le protocole de lecture du courrier n&#x27;est plus POP3 mais IMAP. La principale différence entre les deux est que <strong>[POP3]</strong> ramène le courrier lu sur la machine locale où se trouve le lecteur de courrier et le supprime du serveur distant, alors que <strong>[IMAP]</strong> conserve le courrier sur le serveur distant ;</li>
<li>en <strong>[10]</strong> : identification du serveur SMTP ;</li>
<li>en <strong>[13]</strong> : pour avoir davantage d&#x27;informations sur les serveurs IMAP et SMTP, on passe en configuration manuelle ;</li>
</ul>
<p><img src="images/100000000000047100000204B3850357.png" style="width:13.131cm;height:5.95cm;" alt="Image" /></p>
<ul>
<li>en <strong>[14-17]</strong> : les caractéristiques du serveur IMAP ;</li>
<li>en <strong>[18-21]</strong> : les caractéristiques du serveur SMTP ;</li>
<li>en <strong>[22]</strong> : on termine la configuration ;</li>
</ul>
<p><img src="images/10000000000003CF00000232CE1983EA.png" style="width:11.261cm;height:6.49cm;" alt="Image" /></p>
<ul>
<li>en <strong>[23-24]</strong> : le nouveau compte Thunderbird ;</li>
<li>en <strong>[26]</strong> : on écrit un nouveau message ;</li>
</ul>
<p><img src="images/1000000000000472000002322BB05469.png" style="width:13.151cm;height:6.501cm;" alt="Image" /></p>
<ul>
<li>en <strong>[27]</strong> : l&#x27;expéditeur est <strong>[pymailparlexemple@gmail.com]</strong> ;</li>
<li>en <strong>[28]</strong> : le destinataire est <strong>[pymailparlexemple@gmail.com]</strong> ;</li>
<li>en <strong>[29-30]</strong> : le message ;</li>
<li>en <strong>[31]</strong> : pour l&#x27;envoyer ;</li>
</ul>
<p><img src="images/100000000000033D000002044E96C583.png" style="width:9.561cm;height:5.972cm;" alt="Image" /></p>
<ul>
<li>en <strong>[32]</strong> : on relève le courrier des différents comptes ;</li>
</ul>
<p><img src="images/10000000000005130000030D9609084C.png" style="width:15.02cm;height:9.021cm;" alt="Image" /></p>
<ul>
<li>
<p>en <strong>[33-36]</strong> : le courrier reçu par l&#x27;utilisateur <strong>[pymailparlexemple@gmail.com]</strong>
Nous créons de même :</p>
</li>
<li>
<p>un nouveau compte Gmail <strong>[pymail2parlexemple@gmail.com]</strong> ;</p>
</li>
<li>un nouverau compte Thunderbird <strong>[pymail2parlexemple@gmail.com]</strong> pour relever les messages de l’utilisateur de même nom :</li>
</ul>
<p><img src="images/10000000000002DC0000030A140C6FF8.png" style="width:8.43cm;height:8.97cm;" alt="Image" /></p>
<p><img src="images/10000000000005140000029F88008B07.png" style="width:15.02cm;height:7.741cm;" alt="Image" /></p>
<p>Nous avons désormais les outils pour explorer les protocoles SMTP, POP3 et IMAP. Nous commençons par le protocole SMTP.</p>
<h3 id="2155-le-protocole-smtp">21.5.5. Le protocole SMTP</h3>
<p><img src="images/1000000100000206000000DD0A3D926A.png" style="width:8.751cm;height:3.731cm;" alt="Image" /></p>
<p>Nous allons découvrir le protocole SMTP en examinant les logs du serveur <strong>[hMailServer]</strong>. Pour cela, nous les activons avec l’outl <strong>[hmailServerAdministrator]</strong> :</p>
<p><img src="images/10000000000001E00000010F6C6270EA.png" style="width:5.539cm;height:3.13cm;" alt="Image" /></p>
<p><img src="images/100000000000030800000350369EC782.png" style="width:8.951cm;height:9.78cm;" alt="Image" /></p>
<ul>
<li>en <strong>[2]</strong>, les logs sont activés ;</li>
<li>en <strong>[3-5]</strong> : on les active pour les protocoles SMTP, POP3, IMAP ;</li>
<li>en <strong>[7]</strong>, on demande à les voir ;</li>
<li>en <strong>[8]</strong>, ouvre le fichier de logs avec un éditeur de texte quelconque ;</li>
</ul>
<p><img src="images/1000000100000206000000DD0A3D926A.png" style="width:8.751cm;height:3.731cm;" alt="Image" /></p>
<p>Dans l’exemple qui suit, le client sera <strong>[Thunderbird]</strong> et le serveur sera <strong>[hMailServer]</strong>. Avec Thunderbird, faites en sorte que l’utilisateur <strong>[guest@localhost.com]</strong> s’envoie un message à lui-même :</p>
<p><img src="images/10000000000003F500000220AF6FEB49.png" style="width:11.681cm;height:6.271cm;" alt="Image" /></p>
<p>Les logs sont alors les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">5828</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.263&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: 220 Bienvenue sur le serveur SMTP localhost.com&quot;</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">21956</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.360&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: EHLO [127.0.0.1]&quot;</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">21956</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.362&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: 250-DESKTOP-30FF5FB[nl]250-SIZE 20480000[nl]250-AUTH LOGIN[nl]250 HELP&quot;</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">5828</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.381&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: MAIL FROM:&lt;guest@localhost.com&gt; SIZE=433&quot;</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">5828</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.386&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: 250 OK&quot;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">21956</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.470&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: RCPT TO:&lt;guest@localhost.com&gt;&quot;</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">21956</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.473&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: 250 OK&quot;</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">21956</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.478&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: DATA&quot;</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">21956</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.479&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: 354 OK, send.&quot;</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">21860</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.496&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: 250 Queued (0.016 seconds)&quot;</span>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">21568</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.505&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: QUIT&quot;</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="s2">&quot;SMTPD&quot;</span>    <span class="mi">21568</span>    <span class="mi">22</span>    <span class="s2">&quot;2020-07-07 10:02:54.506&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: 221 goodbye&quot;</span>
</code></pre></div></td></tr></table></div>
<p>Les lignes ci-dessus décrivent le dialogue qui a eu lieu entre le client SMTP (le gestionnaire de courrier Thunderbird) et le serveur SMTP (hMailServer). Les lignes <strong>[SENT]</strong> indiquent ce que le serveur SMTP a envoyé à son client. Les lignes <strong>[RECEIVED]</strong> indiquent ce que le serveur SMTP a reçu de son client.</p>
<ul>
<li>ligne 1 : juste après la connexion du client au serveur SMTP, celui-ci envoie le message de bienvenue à son client ;</li>
<li>ligne 2 : le client envoie la commande <strong>[EHLO]</strong> pour d’identifier. Ici, il donne son adresse IP <strong>[127.0.0.1]</strong> qui désigne la machine <strong>[localhost]</strong>, ç-à-d la machine qui exécute le client SMTP ;</li>
<li>ligne 3 : le serveur envoie une série de réponses <strong>[250]</strong>. <strong>[nl]</strong> signifie <strong>[newline]</strong> ç-à-d le caractère \n. Les réponses ont la forme <strong>[250-]</strong> sauf la dernière qui a la forme <strong>[250 ]</strong>. C’est ainsi que le client SMTP sait que la réponse du serveur SMTP est terminée et qu’il peut envoyer une commande. La série de commandes <strong>[250]</strong> avait pour but d’indiquer au client SMTP une série de commandes qu’il pouvait utiliser ;</li>
<li>ligne 4 : le client SMTP envoie la commande <strong>[MAIL FROM : adresse_mail_expéditeur]</strong> qui indique qui envoie le message ;</li>
<li>ligne 5 : le serveur SMTP répond par <strong>[250 OK]</strong> indiquant qu’il a compris la commande ;</li>
<li>ligne 6 : le client SMTP envoie la commande <strong>[RCPT TO : adresse_mail_destinataire]</strong> pour indiquer l’adresse du destinataire ;</li>
<li>ligne 7 : de nouveau le serveur SMTP indique qu’il a compris la commande ;</li>
<li>ligne 8 : le serveur SMTP envoie la commande <strong>[DATA]</strong>. Cela veut dire qu’il va envoyer le contenu du message ;</li>
<li>ligne 9 : le serveur SMTP indique par la réponse <strong>[354 OK]</strong> qu’il est prêt à recevoir le message. Le texte <strong>[send .]</strong> indique que le client SMTP doit terminer son message par une ligne ne contenant qu’un unique point ;</li>
<li>ce qu’on ne vois pas ensuite, c’est que le client SMTP envoie son message. Les logs ne l’affichent pas ;</li>
<li>ligne 10 : le client SMTP a envoyé le point qui indique la fin du message. Le serveur SMTP lui répond qu’il a mis le message en file d’attente (queued) ;</li>
<li>le client SMTP lui envoie la comande <strong>[QUIT]</strong> pour indiquer qu’il va fermer la connexion ;</li>
<li>ligne 12 : le serveur lui répond ;
Maintenant que nous connaissons le dialogue client / serveur du protocole SMTP, essayons de le reproduire avec notre client <strong>[RawTcpClient]</strong>. Nous utilisons un terminal PyCharm :</li>
</ul>
<p><img src="images/10000000000002190000034E550CCF2C.png" style="width:6.201cm;height:9.782cm;" alt="Image" /></p>
<p>Etudions un nouvel exemple :</p>
<p><img src="images/1000000100000206000000DD0A3D926A.png" style="width:8.751cm;height:3.731cm;" alt="Image" /></p>
<ul>
<li>le client A sera le client TCP générique <strong>[RawTcpClient]</strong> ;</li>
<li>le serveur B sera le serveur de mails <strong>[hMailServer]</strong> ;</li>
<li>le client A demandera au serveur B de distribuer un courrier envoyé par l’utilisateur <strong>[guest@localhost.com]</strong> pour lui-même ;</li>
<li>nous vérifierons que le destinataire a bien reçu le mail envoyé ;
Nous lançons le client de la façon suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1">1</a></span>
<span class="normal"><a href="#__codelineno-45-2">2</a></span>
<span class="normal"><a href="#__codelineno-45-3">3</a></span>
<span class="normal"><a href="#__codelineno-45-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">25</span> <span class="o">--</span><span class="n">quit</span> <span class="n">bye</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">53122</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">25</span><span class="p">]</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">220</span> <span class="n">Bienvenue</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">serveur</span> <span class="n">SMTP</span> <span class="n">localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne <strong>[1]</strong>, on se connecte sur le port 25 de la machine locale, là où opère le service SMTP de <strong>[hMailServer]</strong>. l’argument <strong>[--quit bye]</strong> indique que l’utilisateur quittera le programme en tapant la commande <strong>[bye]</strong>. Sans cet argument, la commande de fin du programme est <strong>[quit]</strong>. Or <strong>[quit]</strong> est également une commande du protocole SMTP. Il nous faut donc éviter cette ambiguïté ;</li>
<li>ligne <strong>[2]</strong>, le client est bien connecté ;</li>
<li>ligne <strong>[3]</strong>, le client attend des commandes tapées au clavier ;</li>
<li>ligne <strong>[4]</strong>, le serveur lui envoie son message de bienvenue ;
Nous continuons le dialogue de la façon suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span>
<span class="normal"><a href="#__codelineno-46-12">12</a></span>
<span class="normal"><a href="#__codelineno-46-13">13</a></span>
<span class="normal"><a href="#__codelineno-46-14">14</a></span>
<span class="normal"><a href="#__codelineno-46-15">15</a></span>
<span class="normal"><a href="#__codelineno-46-16">16</a></span>
<span class="normal"><a href="#__codelineno-46-17">17</a></span>
<span class="normal"><a href="#__codelineno-46-18">18</a></span>
<span class="normal"><a href="#__codelineno-46-19">19</a></span>
<span class="normal"><a href="#__codelineno-46-20">20</a></span>
<span class="normal"><a href="#__codelineno-46-21">21</a></span>
<span class="normal"><a href="#__codelineno-46-22">22</a></span>
<span class="normal"><a href="#__codelineno-46-23">23</a></span>
<span class="normal"><a href="#__codelineno-46-24">24</a></span>
<span class="normal"><a href="#__codelineno-46-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">25</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">53155</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">25</span><span class="p">]</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">220</span> <span class="n">Bienvenue</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">serveur</span> <span class="n">SMTP</span> <span class="n">localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="n">EHLO</span> <span class="n">localhost</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">]</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">SIZE</span> <span class="mi">20480000</span><span class="p">]</span>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">AUTH</span> <span class="n">LOGIN</span><span class="p">]</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span> <span class="n">HELP</span><span class="p">]</span>
<a id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="n">MAIL</span> <span class="n">FROM</span><span class="p">:</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span> <span class="n">OK</span><span class="p">]</span>
<a id="__codelineno-46-12" name="__codelineno-46-12"></a><span class="n">RCPT</span> <span class="n">TO</span><span class="p">:</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span> <span class="n">OK</span><span class="p">]</span>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a><span class="n">DATA</span>
<a id="__codelineno-46-15" name="__codelineno-46-15"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">354</span> <span class="n">OK</span><span class="p">,</span> <span class="n">send</span><span class="o">.</span><span class="p">]</span>
<a id="__codelineno-46-16" name="__codelineno-46-16"></a><span class="n">from</span><span class="p">:</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-46-17" name="__codelineno-46-17"></a><span class="n">to</span><span class="p">:</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-46-18" name="__codelineno-46-18"></a><span class="n">subject</span><span class="p">:</span> <span class="n">ceci</span> <span class="n">est</span> <span class="n">un</span> <span class="n">test</span>
<a id="__codelineno-46-19" name="__codelineno-46-19"></a>
<a id="__codelineno-46-20" name="__codelineno-46-20"></a><span class="n">ligne1</span>
<a id="__codelineno-46-21" name="__codelineno-46-21"></a><span class="n">ligne2</span>
<a id="__codelineno-46-22" name="__codelineno-46-22"></a><span class="o">.</span>
<a id="__codelineno-46-23" name="__codelineno-46-23"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span> <span class="n">Queued</span> <span class="p">(</span><span class="mf">37.824</span> <span class="n">seconds</span><span class="p">)]</span>
<a id="__codelineno-46-24" name="__codelineno-46-24"></a><span class="n">QUIT</span>
<a id="__codelineno-46-25" name="__codelineno-46-25"></a><span class="n">Fin</span> <span class="n">de</span> <span class="n">la</span> <span class="n">connexion</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>en <strong>[5]</strong>, le client envoie la commande <strong>[EHLO nom-de-la-machine-client]</strong>. Le serveur lui répond par une suite de messages de la forme <strong>[250-xx]</strong> (6). Le code <strong>[250]</strong> indique le succès de la commande envoyée par le client ;</li>
<li>en <strong>[10]</strong>, le client indique l’expéditeur du message, ici <strong>[guest@localhost.com]</strong> ;</li>
<li>en <strong>[11]</strong>, la réponse du serveur ;</li>
<li>en <strong>[12]</strong>, on indique le destinataire du message, ici l’utilisateur <strong>[guest@localhost.com]</strong> ;</li>
<li>en <strong>[13]</strong>, la réponse du serveur ;</li>
<li>en <strong>[14]</strong>, la commande <strong>[DATA]</strong> indique au serveur que le client va envoyer le contenu du message ;</li>
<li>en <strong>[15]</strong>, la réponse du serveur ;</li>
<li>en <strong>[16-22]</strong>, le client doit envoyer une liste de lignes de texte terminée par une ligne ne contenant qu’un unique point. Le message peut contenir des lignes <strong>[Subject:, From:, To:]</strong> (16-18) pour définir respectivement le sujet du message, l’expéditeur, le destinataire ;</li>
<li>en <strong>[19]</strong>, les entêtes précédents doivent être suivis d’une ligne vide ;</li>
<li>en <strong>[20-21]</strong>, le texte du message ;</li>
<li>en <strong>[22]</strong>,  la ligne ne contenant qu’un unique point qui indique la fin du message ;</li>
<li>en <strong>[23]</strong>, une fois que le serveur a reçu la ligne ne contenant qu’un unique point, il met le message en file d’attente ;</li>
<li>en <strong>[24]</strong>, le client indique au serveur qu’il a fini ;</li>
<li>en <strong>[25]</strong>, on constate que le serveur a fermé la connexion qui le liait au client ;
Maintenant vérifions avec Thunderbird que l’utilisateur <strong>[guest@localhost.com]</strong> a bien reçu le message :</li>
</ul>
<p><img src="images/10000000000003F7000002E761A5914D.png" style="width:11.701cm;height:8.561cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1-6]</strong>, on voit  que l’utilisateur <strong>[guest@localhost.com]</strong> a bien reçu le message ;
Finalement, notre client <strong>[RawTcpClient]</strong> a réussi à envoyer un message via le serveur SMTP <strong>[localhost]</strong>. Maintenant, utilisons la même méthode pour envoyer un message à <strong>[pymailparlexemple@gmail.com]</strong> :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span>
<span class="normal"><a href="#__codelineno-47-16">16</a></span>
<span class="normal"><a href="#__codelineno-47-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">smtp</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">com</span> <span class="mi">587</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">53210</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">smtp</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">com</span><span class="o">-</span><span class="mi">587</span><span class="p">]</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">220</span> <span class="n">smtp</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">com</span> <span class="n">ESMTP</span> <span class="n">w13sm643278wrr</span><span class="mf">.67</span> <span class="o">-</span> <span class="n">gsmtp</span><span class="p">]</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="n">EHLO</span> <span class="n">localhost</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">smtp</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">com</span> <span class="n">at</span> <span class="n">your</span> <span class="n">service</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="n">a01</span><span class="p">:</span><span class="n">cb05</span><span class="p">:</span><span class="mf">80e8</span><span class="p">:</span><span class="n">b500</span><span class="p">:</span><span class="mi">3</span><span class="n">c4b</span><span class="p">:</span><span class="mi">2203</span><span class="p">:</span><span class="mi">91</span><span class="n">fa</span><span class="p">:</span><span class="mi">9</span><span class="n">b00</span><span class="p">]]</span>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">SIZE</span> <span class="mi">35882577</span><span class="p">]</span>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="mi">8</span><span class="n">BITMIME</span><span class="p">]</span>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">STARTTLS</span><span class="p">]</span>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">ENHANCEDSTATUSCODES</span><span class="p">]</span>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">PIPELINING</span><span class="p">]</span>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">CHUNKING</span><span class="p">]</span>
<a id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span> <span class="n">SMTPUTF8</span><span class="p">]</span>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a><span class="n">MAIL</span> <span class="n">FROM</span><span class="p">:</span> <span class="n">pymailparlexemple</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-47-15" name="__codelineno-47-15"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">530</span> <span class="mf">5.7.0</span> <span class="n">Must</span> <span class="n">issue</span> <span class="n">a</span> <span class="n">STARTTLS</span> <span class="n">command</span> <span class="n">first</span><span class="o">.</span> <span class="n">w13sm643278wrr</span><span class="mf">.67</span> <span class="o">-</span> <span class="n">gsmtp</span><span class="p">]</span>
<a id="__codelineno-47-16" name="__codelineno-47-16"></a><span class="n">QUIT</span>
<a id="__codelineno-47-17" name="__codelineno-47-17"></a><span class="n">Fin</span> <span class="n">de</span> <span class="n">la</span> <span class="n">connexion</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : on utilise le serveur SMTP de Gmail qui opère sur le port 587 ;</li>
<li>ligne 15 : on est bloqués parce que le serveur SMTP nous demande de démarrer une connexion sécurisée ce qu’on ne sait pas faire. Contrairement à l’exemple précédent, le serveur <strong>[smtp.gmail.com]</strong> (ligne 1) demande une authentification. Il n’accepte comme clients que les utilisateurs enregistrés dans le domaine <strong>[gmail.com]</strong>. Cette authentification est sécurisée et a lieu au sein d’une connexion cryptée.
Le premier exemple nous a donné les bases pour construire un client SMTP basique en Python. Le deuxième nous a montré que certains serveurs SMTP (la plupart en fait) nécessitent une authentification faite avec une connexion chiffrée.</li>
</ul>
<h3 id="2156-scripts-smtp01-un-client-smtp-basique">21.5.6. scripts [smtp/01] : un client SMTP basique</h3>
<p>Nous allons reproduire en Python ce que nous avons appris précédemment du protocole SMTP.</p>
<p><img src="images/100000000000012800000166A0353B31.png" style="width:3.421cm;height:4.141cm;" alt="Image" /></p>
<p>Le fichier <strong>[smtp/01/config]</strong> configure l’application de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-48-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-48-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-48-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-48-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-48-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-48-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-48-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-48-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-48-10">10</a></span>
<span class="normal"><a href="#__codelineno-48-11">11</a></span>
<span class="normal"><a href="#__codelineno-48-12">12</a></span>
<span class="normal"><a href="#__codelineno-48-13">13</a></span>
<span class="normal"><a href="#__codelineno-48-14">14</a></span>
<span class="normal"><a href="#__codelineno-48-15">15</a></span>
<span class="normal"><a href="#__codelineno-48-16">16</a></span>
<span class="normal"><a href="#__codelineno-48-17">17</a></span>
<span class="normal"><a href="#__codelineno-48-18">18</a></span>
<span class="normal"><a href="#__codelineno-48-19">19</a></span>
<span class="normal"><a href="#__codelineno-48-20">20</a></span>
<span class="normal"><a href="#__codelineno-48-21">21</a></span>
<span class="normal"><a href="#__codelineno-48-22">22</a></span>
<span class="normal"><a href="#__codelineno-48-23">23</a></span>
<span class="normal"><a href="#__codelineno-48-24">24</a></span>
<span class="normal"><a href="#__codelineno-48-25">25</a></span>
<span class="normal"><a href="#__codelineno-48-26">26</a></span>
<span class="normal"><a href="#__codelineno-48-27">27</a></span>
<span class="normal"><a href="#__codelineno-48-28">28</a></span>
<span class="normal"><a href="#__codelineno-48-29">29</a></span>
<span class="normal"><a href="#__codelineno-48-30">30</a></span>
<span class="normal"><a href="#__codelineno-48-31">31</a></span>
<span class="normal"><a href="#__codelineno-48-32">32</a></span>
<span class="normal"><a href="#__codelineno-48-33">33</a></span>
<span class="normal"><a href="#__codelineno-48-34">34</a></span>
<span class="normal"><a href="#__codelineno-48-35">35</a></span>
<span class="normal"><a href="#__codelineno-48-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a>        <span class="c1"># description : description du mail envoyé</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a>        <span class="c1"># smtp-server : serveur SMTP</span>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a>        <span class="c1"># smtp-port : port du serveur SMTP</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a>        <span class="c1"># from : expéditeur</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a>        <span class="c1"># to : destinataire</span>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a>        <span class="c1"># subject : sujet du mail</span>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a>        <span class="c1"># message : message du mail</span>
<a id="__codelineno-48-10" name="__codelineno-48-10"></a>        <span class="s2">&quot;mails&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a>            <span class="p">{</span>
<a id="__codelineno-48-12" name="__codelineno-48-12"></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;mail to localhost via localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-48-13" name="__codelineno-48-13"></a>                <span class="s2">&quot;smtp-server&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-48-14" name="__codelineno-48-14"></a>                <span class="s2">&quot;smtp-port&quot;</span><span class="p">:</span> <span class="s2">&quot;25&quot;</span><span class="p">,</span>
<a id="__codelineno-48-15" name="__codelineno-48-15"></a>                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;guest@localhost.com&quot;</span><span class="p">,</span>
<a id="__codelineno-48-16" name="__codelineno-48-16"></a>                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;guest@localhost.com&quot;</span><span class="p">,</span>
<a id="__codelineno-48-17" name="__codelineno-48-17"></a>                <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;to localhost via localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-48-18" name="__codelineno-48-18"></a>                <span class="c1"># on envoie de l&#39;UTF-8</span>
<a id="__codelineno-48-19" name="__codelineno-48-19"></a>                <span class="s2">&quot;content-type&quot;</span><span class="p">:</span> <span class="s1">&#39;text/plain; charset=&quot;utf-8&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-48-20" name="__codelineno-48-20"></a>                <span class="c1"># on teste les caractères accentués</span>
<a id="__codelineno-48-21" name="__codelineno-48-21"></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;aglaë séléné</span><span class="se">\n</span><span class="s2">va au marché</span><span class="se">\n</span><span class="s2">acheter des fleurs&quot;</span>
<a id="__codelineno-48-22" name="__codelineno-48-22"></a>            <span class="p">},</span>
<a id="__codelineno-48-23" name="__codelineno-48-23"></a>            <span class="p">{</span>
<a id="__codelineno-48-24" name="__codelineno-48-24"></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;mail to gmail via gmail&quot;</span><span class="p">,</span>
<a id="__codelineno-48-25" name="__codelineno-48-25"></a>                <span class="s2">&quot;smtp-server&quot;</span><span class="p">:</span> <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-48-26" name="__codelineno-48-26"></a>                <span class="s2">&quot;smtp-port&quot;</span><span class="p">:</span> <span class="s2">&quot;587&quot;</span><span class="p">,</span>
<a id="__codelineno-48-27" name="__codelineno-48-27"></a>                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;pymailparlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-48-28" name="__codelineno-48-28"></a>                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;pymailparlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-48-29" name="__codelineno-48-29"></a>                <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;to gmail via gmail&quot;</span><span class="p">,</span>
<a id="__codelineno-48-30" name="__codelineno-48-30"></a>                <span class="c1"># on envoie de l&#39;UTF-8</span>
<a id="__codelineno-48-31" name="__codelineno-48-31"></a>                <span class="s2">&quot;Content-type&quot;</span><span class="p">:</span> <span class="s1">&#39;text/plain; charset=&quot;utf-8&quot;&#39;</span><span class="p">,</span>
<a id="__codelineno-48-32" name="__codelineno-48-32"></a>                <span class="c1"># on teste les caractères accentués</span>
<a id="__codelineno-48-33" name="__codelineno-48-33"></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;aglaë séléné</span><span class="se">\n</span><span class="s2">va au marché</span><span class="se">\n</span><span class="s2">acheter des fleurs&quot;</span>
<a id="__codelineno-48-34" name="__codelineno-48-34"></a>            <span class="p">}</span>
<a id="__codelineno-48-35" name="__codelineno-48-35"></a>        <span class="p">]</span>
<a id="__codelineno-48-36" name="__codelineno-48-36"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 10-35 : une liste de mails à envoyer. Pour chacun d’eux on précise les informations suivantes :</li>
<li><strong>[description]</strong> : un texte décrivant le mail ;</li>
<li><strong>[smtp-server]</strong> : le serveur SMTP à utiliser ;</li>
<li><strong>[smtp-port]</strong> : son port de service ;</li>
<li><strong>[from]</strong> : l’expéditeur du mail ;</li>
<li><strong>[to]</strong> : le destinataire du mail ;</li>
<li><strong>[subject]</strong> : le sujet du mail ;</li>
<li><strong>[content-type]</strong> : l’encodage du mail ;</li>
<li><strong>[message]</strong> : le message du mail ;
Le code <strong>[01/main]</strong> du client SMTP est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">  1</a></span>
<span class="normal"><a href="#__codelineno-49-2">  2</a></span>
<span class="normal"><a href="#__codelineno-49-3">  3</a></span>
<span class="normal"><a href="#__codelineno-49-4">  4</a></span>
<span class="normal"><a href="#__codelineno-49-5">  5</a></span>
<span class="normal"><a href="#__codelineno-49-6">  6</a></span>
<span class="normal"><a href="#__codelineno-49-7">  7</a></span>
<span class="normal"><a href="#__codelineno-49-8">  8</a></span>
<span class="normal"><a href="#__codelineno-49-9">  9</a></span>
<span class="normal"><a href="#__codelineno-49-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-49-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-49-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-49-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-49-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-49-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-49-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-49-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-49-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-49-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-49-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-49-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-49-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-49-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-49-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-49-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-49-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-49-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-49-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-49-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-49-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-49-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-49-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-49-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-49-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-49-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-49-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-49-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-49-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-49-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-49-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-49-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-49-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-49-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-49-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-49-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-49-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-49-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-49-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-49-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-49-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-49-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-49-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-49-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-49-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-49-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-49-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-49-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-49-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-49-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-49-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-49-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-49-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-49-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-49-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-49-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-49-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-49-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-49-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-49-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-49-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-49-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-49-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-49-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-49-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-49-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-49-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-49-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-49-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-49-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-49-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-49-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-49-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-49-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-49-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-49-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-49-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-49-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-49-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-49-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-49-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-49-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-49-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-49-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-49-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-49-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-49-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-49-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-49-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-49-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-49-100">100</a></span>
<span class="normal"><a href="#__codelineno-49-101">101</a></span>
<span class="normal"><a href="#__codelineno-49-102">102</a></span>
<span class="normal"><a href="#__codelineno-49-103">103</a></span>
<span class="normal"><a href="#__codelineno-49-104">104</a></span>
<span class="normal"><a href="#__codelineno-49-105">105</a></span>
<span class="normal"><a href="#__codelineno-49-106">106</a></span>
<span class="normal"><a href="#__codelineno-49-107">107</a></span>
<span class="normal"><a href="#__codelineno-49-108">108</a></span>
<span class="normal"><a href="#__codelineno-49-109">109</a></span>
<span class="normal"><a href="#__codelineno-49-110">110</a></span>
<span class="normal"><a href="#__codelineno-49-111">111</a></span>
<span class="normal"><a href="#__codelineno-49-112">112</a></span>
<span class="normal"><a href="#__codelineno-49-113">113</a></span>
<span class="normal"><a href="#__codelineno-49-114">114</a></span>
<span class="normal"><a href="#__codelineno-49-115">115</a></span>
<span class="normal"><a href="#__codelineno-49-116">116</a></span>
<span class="normal"><a href="#__codelineno-49-117">117</a></span>
<span class="normal"><a href="#__codelineno-49-118">118</a></span>
<span class="normal"><a href="#__codelineno-49-119">119</a></span>
<span class="normal"><a href="#__codelineno-49-120">120</a></span>
<span class="normal"><a href="#__codelineno-49-121">121</a></span>
<span class="normal"><a href="#__codelineno-49-122">122</a></span>
<span class="normal"><a href="#__codelineno-49-123">123</a></span>
<span class="normal"><a href="#__codelineno-49-124">124</a></span>
<span class="normal"><a href="#__codelineno-49-125">125</a></span>
<span class="normal"><a href="#__codelineno-49-126">126</a></span>
<span class="normal"><a href="#__codelineno-49-127">127</a></span>
<span class="normal"><a href="#__codelineno-49-128">128</a></span>
<span class="normal"><a href="#__codelineno-49-129">129</a></span>
<span class="normal"><a href="#__codelineno-49-130">130</a></span>
<span class="normal"><a href="#__codelineno-49-131">131</a></span>
<span class="normal"><a href="#__codelineno-49-132">132</a></span>
<span class="normal"><a href="#__codelineno-49-133">133</a></span>
<span class="normal"><a href="#__codelineno-49-134">134</a></span>
<span class="normal"><a href="#__codelineno-49-135">135</a></span>
<span class="normal"><a href="#__codelineno-49-136">136</a></span>
<span class="normal"><a href="#__codelineno-49-137">137</a></span>
<span class="normal"><a href="#__codelineno-49-138">138</a></span>
<span class="normal"><a href="#__codelineno-49-139">139</a></span>
<span class="normal"><a href="#__codelineno-49-140">140</a></span>
<span class="normal"><a href="#__codelineno-49-141">141</a></span>
<span class="normal"><a href="#__codelineno-49-142">142</a></span>
<span class="normal"><a href="#__codelineno-49-143">143</a></span>
<span class="normal"><a href="#__codelineno-49-144">144</a></span>
<span class="normal"><a href="#__codelineno-49-145">145</a></span>
<span class="normal"><a href="#__codelineno-49-146">146</a></span>
<span class="normal"><a href="#__codelineno-49-147">147</a></span>
<span class="normal"><a href="#__codelineno-49-148">148</a></span>
<span class="normal"><a href="#__codelineno-49-149">149</a></span>
<span class="normal"><a href="#__codelineno-49-150">150</a></span>
<span class="normal"><a href="#__codelineno-49-151">151</a></span>
<span class="normal"><a href="#__codelineno-49-152">152</a></span>
<span class="normal"><a href="#__codelineno-49-153">153</a></span>
<span class="normal"><a href="#__codelineno-49-154">154</a></span>
<span class="normal"><a href="#__codelineno-49-155">155</a></span>
<span class="normal"><a href="#__codelineno-49-156">156</a></span>
<span class="normal"><a href="#__codelineno-49-157">157</a></span>
<span class="normal"><a href="#__codelineno-49-158">158</a></span>
<span class="normal"><a href="#__codelineno-49-159">159</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="c1"># imports</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="c1"># -----------------------------------------------------------------------</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">sendmail</span><span class="p">(</span><span class="n">mail</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a>    <span class="c1"># envoie message au serveur smtp smtpserver de la part de expéditeur</span>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a>    <span class="c1"># pour destinataire. Si verbose=True, fait un suivi des échanges client-serveur</span>
<a id="__codelineno-49-9" name="__codelineno-49-9"></a>
<a id="__codelineno-49-10" name="__codelineno-49-10"></a>    <span class="c1"># on laisse remonter les erreurs système</span>
<a id="__codelineno-49-11" name="__codelineno-49-11"></a>    <span class="n">connexion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-49-12" name="__codelineno-49-12"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-49-13" name="__codelineno-49-13"></a>        <span class="c1"># nom de la machine locale (nécessaire au protocole SMTP)</span>
<a id="__codelineno-49-14" name="__codelineno-49-14"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostbyaddr</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostbyname</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-49-15" name="__codelineno-49-15"></a>        <span class="c1"># ouverture d&#39;une connexion sur le port 25 de smtpServer</span>
<a id="__codelineno-49-16" name="__codelineno-49-16"></a>        <span class="n">connexion</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">mail</span><span class="p">[</span><span class="s2">&quot;smtp-server&quot;</span><span class="p">],</span> <span class="mi">25</span><span class="p">))</span>
<a id="__codelineno-49-17" name="__codelineno-49-17"></a>
<a id="__codelineno-49-18" name="__codelineno-49-18"></a>        <span class="c1"># connexion représente un flux de communication bidirectionnel</span>
<a id="__codelineno-49-19" name="__codelineno-49-19"></a>        <span class="c1"># entre le client (ce programme) et le serveur smtp contacté</span>
<a id="__codelineno-49-20" name="__codelineno-49-20"></a>        <span class="c1"># ce canal est utilisé pour les échanges de commandes et d&#39;informations</span>
<a id="__codelineno-49-21" name="__codelineno-49-21"></a>
<a id="__codelineno-49-22" name="__codelineno-49-22"></a>        <span class="c1"># après la connexion le serveur envoie un message de bienvenue qu&#39;on lit</span>
<a id="__codelineno-49-23" name="__codelineno-49-23"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-49-24" name="__codelineno-49-24"></a>        <span class="c1"># cmde ehlo:</span>
<a id="__codelineno-49-25" name="__codelineno-49-25"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;EHLO </span><span class="si">{</span><span class="n">client</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-49-26" name="__codelineno-49-26"></a>        <span class="c1"># cmde mail from:</span>
<a id="__codelineno-49-27" name="__codelineno-49-27"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;MAIL FROM: &lt;</span><span class="si">{</span><span class="n">mail</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&gt;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-49-28" name="__codelineno-49-28"></a>        <span class="c1"># cmde rcpt to:</span>
<a id="__codelineno-49-29" name="__codelineno-49-29"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;RCPT TO: &lt;</span><span class="si">{</span><span class="n">mail</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&gt;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-49-30" name="__codelineno-49-30"></a>        <span class="c1"># cmde data</span>
<a id="__codelineno-49-31" name="__codelineno-49-31"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="s2">&quot;DATA&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-49-32" name="__codelineno-49-32"></a>        <span class="c1"># préparation message à envoyer</span>
<a id="__codelineno-49-33" name="__codelineno-49-33"></a>        <span class="c1"># il doit contenir les lignes</span>
<a id="__codelineno-49-34" name="__codelineno-49-34"></a>        <span class="c1"># From: expéditeur</span>
<a id="__codelineno-49-35" name="__codelineno-49-35"></a>        <span class="c1"># To: destinataire</span>
<a id="__codelineno-49-36" name="__codelineno-49-36"></a>        <span class="c1"># ligne vide</span>
<a id="__codelineno-49-37" name="__codelineno-49-37"></a>        <span class="c1"># Message</span>
<a id="__codelineno-49-38" name="__codelineno-49-38"></a>        <span class="c1"># .</span>
<a id="__codelineno-49-39" name="__codelineno-49-39"></a>        <span class="n">data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mail</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-49-40" name="__codelineno-49-40"></a>        <span class="c1"># envoi message</span>
<a id="__codelineno-49-41" name="__codelineno-49-41"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-49-42" name="__codelineno-49-42"></a>        <span class="c1"># envoi .</span>
<a id="__codelineno-49-43" name="__codelineno-49-43"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">.</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-49-44" name="__codelineno-49-44"></a>        <span class="c1"># cmde quit</span>
<a id="__codelineno-49-45" name="__codelineno-49-45"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="s2">&quot;QUIT&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-49-46" name="__codelineno-49-46"></a>        <span class="c1"># fin</span>
<a id="__codelineno-49-47" name="__codelineno-49-47"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-49-48" name="__codelineno-49-48"></a>        <span class="c1"># fermeture connexion</span>
<a id="__codelineno-49-49" name="__codelineno-49-49"></a>        <span class="k">if</span> <span class="n">connexion</span><span class="p">:</span>
<a id="__codelineno-49-50" name="__codelineno-49-50"></a>            <span class="n">connexion</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-49-51" name="__codelineno-49-51"></a>
<a id="__codelineno-49-52" name="__codelineno-49-52"></a>
<a id="__codelineno-49-53" name="__codelineno-49-53"></a><span class="c1"># --------------------------------------------------------------------------</span>
<a id="__codelineno-49-54" name="__codelineno-49-54"></a><span class="k">def</span><span class="w"> </span><span class="nf">send_command</span><span class="p">(</span><span class="n">connexion</span><span class="p">:</span> <span class="n">socket</span><span class="p">,</span> <span class="n">commande</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">with_rclf</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-49-55" name="__codelineno-49-55"></a>    <span class="c1"># envoie commande dans le canal connexion</span>
<a id="__codelineno-49-56" name="__codelineno-49-56"></a>    <span class="c1"># mode verbeux si verbose=True</span>
<a id="__codelineno-49-57" name="__codelineno-49-57"></a>    <span class="c1"># si with_rclf=True, ajoute la séquence rclf à commande</span>
<a id="__codelineno-49-58" name="__codelineno-49-58"></a>
<a id="__codelineno-49-59" name="__codelineno-49-59"></a>    <span class="c1"># données</span>
<a id="__codelineno-49-60" name="__codelineno-49-60"></a>    <span class="n">rclf</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">with_rclf</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-49-61" name="__codelineno-49-61"></a>    <span class="c1"># envoi cmde si commande non vide</span>
<a id="__codelineno-49-62" name="__codelineno-49-62"></a>    <span class="k">if</span> <span class="n">commande</span><span class="p">:</span>
<a id="__codelineno-49-63" name="__codelineno-49-63"></a>        <span class="c1"># on laisse remonter les erreurs système</span>
<a id="__codelineno-49-64" name="__codelineno-49-64"></a>        <span class="c1">#</span>
<a id="__codelineno-49-65" name="__codelineno-49-65"></a>        <span class="c1"># envoi commande</span>
<a id="__codelineno-49-66" name="__codelineno-49-66"></a>        <span class="n">connexion</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">commande</span><span class="si">}{</span><span class="n">rclf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<a id="__codelineno-49-67" name="__codelineno-49-67"></a>        <span class="c1"># écho éventuel</span>
<a id="__codelineno-49-68" name="__codelineno-49-68"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-49-69" name="__codelineno-49-69"></a>            <span class="n">affiche</span><span class="p">(</span><span class="n">commande</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-49-70" name="__codelineno-49-70"></a>        <span class="c1"># lecture réponse de moins de 1000 caractères</span>
<a id="__codelineno-49-71" name="__codelineno-49-71"></a>        <span class="n">reponse</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">connexion</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<a id="__codelineno-49-72" name="__codelineno-49-72"></a>        <span class="c1"># écho éventuel</span>
<a id="__codelineno-49-73" name="__codelineno-49-73"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-49-74" name="__codelineno-49-74"></a>            <span class="n">affiche</span><span class="p">(</span><span class="n">reponse</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-49-75" name="__codelineno-49-75"></a>        <span class="c1"># récupération code erreur</span>
<a id="__codelineno-49-76" name="__codelineno-49-76"></a>        <span class="n">codeErreur</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">reponse</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
<a id="__codelineno-49-77" name="__codelineno-49-77"></a>        <span class="c1"># erreur renvoyée par le serveur ?</span>
<a id="__codelineno-49-78" name="__codelineno-49-78"></a>        <span class="k">if</span> <span class="n">codeErreur</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">:</span>
<a id="__codelineno-49-79" name="__codelineno-49-79"></a>            <span class="c1"># on lance une exception avec l&#39;erreur</span>
<a id="__codelineno-49-80" name="__codelineno-49-80"></a>            <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="n">reponse</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span>
<a id="__codelineno-49-81" name="__codelineno-49-81"></a>        <span class="c1"># retour sans erreur</span>
<a id="__codelineno-49-82" name="__codelineno-49-82"></a>
<a id="__codelineno-49-83" name="__codelineno-49-83"></a>
<a id="__codelineno-49-84" name="__codelineno-49-84"></a><span class="c1"># --------------------------------------------------------------------------</span>
<a id="__codelineno-49-85" name="__codelineno-49-85"></a><span class="k">def</span><span class="w"> </span><span class="nf">affiche</span><span class="p">(</span><span class="n">echange</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sens</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-49-86" name="__codelineno-49-86"></a>    <span class="c1"># affiche échange ? l&#39;écran</span>
<a id="__codelineno-49-87" name="__codelineno-49-87"></a>    <span class="c1"># si sens=1 affiche --&gt;echange</span>
<a id="__codelineno-49-88" name="__codelineno-49-88"></a>    <span class="c1"># si sens=2 affiche &lt;-- échange sans les 2 derniers caractères rclf</span>
<a id="__codelineno-49-89" name="__codelineno-49-89"></a>    <span class="k">if</span> <span class="n">sens</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-49-90" name="__codelineno-49-90"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--&gt; [</span><span class="si">{</span><span class="n">echange</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-49-91" name="__codelineno-49-91"></a>        <span class="k">return</span>
<a id="__codelineno-49-92" name="__codelineno-49-92"></a>    <span class="k">elif</span> <span class="n">sens</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<a id="__codelineno-49-93" name="__codelineno-49-93"></a>        <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">echange</span><span class="p">)</span>
<a id="__codelineno-49-94" name="__codelineno-49-94"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;-- [</span><span class="si">{</span><span class="n">echange</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-49-95" name="__codelineno-49-95"></a>        <span class="k">return</span>
<a id="__codelineno-49-96" name="__codelineno-49-96"></a>
<a id="__codelineno-49-97" name="__codelineno-49-97"></a>
<a id="__codelineno-49-98" name="__codelineno-49-98"></a><span class="c1"># main ----------------------------------------------------------------</span>
<a id="__codelineno-49-99" name="__codelineno-49-99"></a>
<a id="__codelineno-49-100" name="__codelineno-49-100"></a><span class="c1"># client SMTP (SendMail Transfer Protocol) permettant d&#39;envoyer un message</span>
<a id="__codelineno-49-101" name="__codelineno-49-101"></a><span class="c1"># les infos sont prises dans un fichier config contenant les informations suivantes pour chaque serveur</span>
<a id="__codelineno-49-102" name="__codelineno-49-102"></a>
<a id="__codelineno-49-103" name="__codelineno-49-103"></a><span class="c1"># description : description du mail envoyé</span>
<a id="__codelineno-49-104" name="__codelineno-49-104"></a><span class="c1"># smtp-server : serveur SMTP</span>
<a id="__codelineno-49-105" name="__codelineno-49-105"></a><span class="c1"># smtp-port : port du serveur SMTP</span>
<a id="__codelineno-49-106" name="__codelineno-49-106"></a><span class="c1"># from : expéditeur</span>
<a id="__codelineno-49-107" name="__codelineno-49-107"></a><span class="c1"># to : destinataire</span>
<a id="__codelineno-49-108" name="__codelineno-49-108"></a><span class="c1"># subject : sujet du mail</span>
<a id="__codelineno-49-109" name="__codelineno-49-109"></a><span class="c1"># message : message du mail</span>
<a id="__codelineno-49-110" name="__codelineno-49-110"></a>
<a id="__codelineno-49-111" name="__codelineno-49-111"></a>
<a id="__codelineno-49-112" name="__codelineno-49-112"></a><span class="c1"># protocole de communication SMTP client-serveur</span>
<a id="__codelineno-49-113" name="__codelineno-49-113"></a><span class="c1"># -&gt; client se connecte sur le port 25 du serveur smtp</span>
<a id="__codelineno-49-114" name="__codelineno-49-114"></a><span class="c1"># &lt;- serveur lui envoie un message de bienvenue</span>
<a id="__codelineno-49-115" name="__codelineno-49-115"></a><span class="c1"># -&gt; client envoie la commande EHLO: nom de sa machine</span>
<a id="__codelineno-49-116" name="__codelineno-49-116"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-49-117" name="__codelineno-49-117"></a><span class="c1"># -&gt; client envoie la commande mail from: &lt;exp?diteur&gt;</span>
<a id="__codelineno-49-118" name="__codelineno-49-118"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-49-119" name="__codelineno-49-119"></a><span class="c1"># -&gt; client envoie la commande rcpt to: &lt;destinataire&gt;</span>
<a id="__codelineno-49-120" name="__codelineno-49-120"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-49-121" name="__codelineno-49-121"></a><span class="c1"># -&gt; client envoie la commande data</span>
<a id="__codelineno-49-122" name="__codelineno-49-122"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-49-123" name="__codelineno-49-123"></a><span class="c1"># -&gt; client envoie ttes les lignes de son message et termine avec une ligne contenant le seul caractère .</span>
<a id="__codelineno-49-124" name="__codelineno-49-124"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-49-125" name="__codelineno-49-125"></a><span class="c1"># -&gt; client envoie la commande quit</span>
<a id="__codelineno-49-126" name="__codelineno-49-126"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-49-127" name="__codelineno-49-127"></a>
<a id="__codelineno-49-128" name="__codelineno-49-128"></a><span class="c1"># les réponses du serveur ont la forme xxx texte où xxx est un nombre à 3 chiffres. Tout nombre xxx &gt;=500</span>
<a id="__codelineno-49-129" name="__codelineno-49-129"></a><span class="c1"># signale une erreur. La réponse peut comporter plusieurs lignes commençant toutes par xxx- sauf la dernière</span>
<a id="__codelineno-49-130" name="__codelineno-49-130"></a><span class="c1"># de la forme xxx(espace)</span>
<a id="__codelineno-49-131" name="__codelineno-49-131"></a>
<a id="__codelineno-49-132" name="__codelineno-49-132"></a><span class="c1"># les lignes de texte échangées doivent se terminer par les caractéres RC(#13) et LF(#10)</span>
<a id="__codelineno-49-133" name="__codelineno-49-133"></a>
<a id="__codelineno-49-134" name="__codelineno-49-134"></a><span class="c1"># configuration de l&#39;application</span>
<a id="__codelineno-49-135" name="__codelineno-49-135"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-49-136" name="__codelineno-49-136"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-49-137" name="__codelineno-49-137"></a>
<a id="__codelineno-49-138" name="__codelineno-49-138"></a><span class="c1"># on traite les mails un par un</span>
<a id="__codelineno-49-139" name="__codelineno-49-139"></a><span class="k">for</span> <span class="n">mail</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;mails&#39;</span><span class="p">]:</span>
<a id="__codelineno-49-140" name="__codelineno-49-140"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-49-141" name="__codelineno-49-141"></a>        <span class="c1"># logs</span>
<a id="__codelineno-49-142" name="__codelineno-49-142"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-49-143" name="__codelineno-49-143"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Envoi du message [</span><span class="si">{</span><span class="n">mail</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-49-144" name="__codelineno-49-144"></a>        <span class="c1"># préparation du message à envoyer</span>
<a id="__codelineno-49-145" name="__codelineno-49-145"></a>        <span class="n">mail</span><span class="p">[</span>
<a id="__codelineno-49-146" name="__codelineno-49-146"></a>            <span class="s2">&quot;message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;From: </span><span class="si">{</span><span class="n">mail</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">To: </span><span class="si">{</span><span class="n">mail</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> \
<a id="__codelineno-49-147" name="__codelineno-49-147"></a>                         <span class="sa">f</span><span class="s2">&quot;Subject: </span><span class="si">{</span><span class="n">mail</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span> \
<a id="__codelineno-49-148" name="__codelineno-49-148"></a>                         <span class="sa">f</span><span class="s2">&quot;Content-type: </span><span class="si">{</span><span class="n">mail</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> \
<a id="__codelineno-49-149" name="__codelineno-49-149"></a>                         <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">mail</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-49-150" name="__codelineno-49-150"></a>        <span class="c1"># envoi du message en mode verbeux</span>
<a id="__codelineno-49-151" name="__codelineno-49-151"></a>        <span class="n">sendmail</span><span class="p">(</span><span class="n">mail</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-49-152" name="__codelineno-49-152"></a>        <span class="c1"># fin</span>
<a id="__codelineno-49-153" name="__codelineno-49-153"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Message envoyé...&quot;</span><span class="p">)</span>
<a id="__codelineno-49-154" name="__codelineno-49-154"></a>    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-49-155" name="__codelineno-49-155"></a>        <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-49-156" name="__codelineno-49-156"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-49-157" name="__codelineno-49-157"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-49-158" name="__codelineno-49-158"></a>        <span class="k">pass</span>
<a id="__codelineno-49-159" name="__codelineno-49-159"></a>    <span class="c1"># mail suivant</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 134-136 : on configure l’application ;</li>
<li>lignes 139-151 : on tarite tous les mails trouvés dans la configuration ;</li>
<li>lignes 141-143 : on affiche ce qu&#x27;on va faire ;</li>
<li>lignes 144-149 : on définit le message à envoyer. Le message <strong>[message]</strong> est précédé des entêtes <strong>[From, To, Subject, Content-type]</strong> ;</li>
<li>ligne 151 : l’envoi du mail est assuré par la fonction <strong>[sendmail]</strong> qui admet deux paramètres :</li>
<li><strong>[mail]</strong> :  le dictionnaire contenant les informations nécessaires à l’envoi du mail ;</li>
<li><strong>[verbose]</strong> : un booléen indiquant si les échanges client / serveur doivent être ou non logués sur la console ;</li>
<li>lignes 154-156 : on arrête toutes les exceptions qui sortent de la fonction <strong>[sendmail]</strong>. Elles sont affichées ;</li>
<li>ligne 6 : <strong>[mail]</strong> est le dictionnaire décrivant le mail à envoyer ;</li>
<li>ligne 14 : dans le protocole SMTP, le client doit envoyer son non. On récupère ici le nom de la machine locale qui va servir de client ;</li>
<li>ligne 16 : connexion au serveur SMTP à qui le message va être envoyé ;</li>
<li>lignes 22-23 : si la connexion s&#x27;est faite avec le serveur SMTP, celui-ci va envoyer un message de bienvenue qu&#x27;on lit ici ;</li>
<li>la fonction <strong>[sendmail]</strong> envoie ensuite les différentes commandes que doit envoyer un client SMTP :</li>
<li>lignes 24-25 : la commande EHLO ;</li>
<li>lignes 26-27 : la commande MAIL FROM: ;</li>
<li>lignes 28-29 : la commande RCPT TO: ;</li>
<li>lignes 30-31 : la commande DATA ;</li>
<li>lignes 32-41 : envoi du message (From, To, Subject, Content-type, texte) ;</li>
<li>lignes 42-43 : envoi du point final ;</li>
<li>lignes 44-457 : la commande QUIT qui termine le dialogue du client avec le serveur SMTP ;</li>
<li>l&#x27;exécution de <strong>[sendmail]</strong> s&#x27;exécute dans un <strong>[try / finally]</strong> qui laisse remonter toutes les exceptions au code appelant. On sait que celui-ci les arrête toutes pour les afficher ;</li>
<li>lignes 48-50 : libération des ressources ;</li>
<li>ligne 54 : la fonction <strong>[send_command]</strong> est chargée d’envoyer les commandes du client au serveur SMTP. Elle admet quatre paramètres :</li>
<li><strong>[connexion]</strong> : la connexion qui relie le client au serveur ;</li>
<li><strong>[commande]</strong> : la commande à envoyer ;</li>
<li><strong>[verbose]</strong> : si TRUE alors les échanges client / serveur sont logués sur la console ;</li>
<li><strong>[with_rclf]</strong> : si TRUE, envoie la commande terminée par la séquence \r\n. C’est nécessaire pour toutes les commandes du protocole SMTP, mais <strong>[send_command]</strong> sert aussi à envoyer le message. Là on n’ajoute pas  la séquence \r\n ;</li>
<li>ligne 62 : la commande n&#x27;est envoyée que si elle est non vide ;</li>
<li>lignes 65-66 : la commande est envoyée au serveur sous la forme d’une chaîne d’octets UTF-8 ;</li>
<li>lignes 70-71 : lecture de de l’ensemble des lignes de la réponse. On suppose qu’elle fait moins de 1000 caractères. La réponse peut comporter plusieurs lignes. Chaque ligne a la forme XXX-YYY où XXX est un code numérique sauf la dernière ligne de la réponse qui a la forme XXX YYY (absence du caractère -) ;</li>
<li>lignes 76 : lecture du code d&#x27;erreur XXX de la 1re ligne ;</li>
<li>lignes 78-80 : si le code numérique XXX est supérieur à 500, alors le serveur a renvoyé une erreur. On lance alors une exception ;
<strong>Résultats</strong></li>
</ul>
<p>L’exécution du script donne les résultats console suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span>
<span class="normal"><a href="#__codelineno-50-14">14</a></span>
<span class="normal"><a href="#__codelineno-50-15">15</a></span>
<span class="normal"><a href="#__codelineno-50-16">16</a></span>
<span class="normal"><a href="#__codelineno-50-17">17</a></span>
<span class="normal"><a href="#__codelineno-50-18">18</a></span>
<span class="normal"><a href="#__codelineno-50-19">19</a></span>
<span class="normal"><a href="#__codelineno-50-20">20</a></span>
<span class="normal"><a href="#__codelineno-50-21">21</a></span>
<span class="normal"><a href="#__codelineno-50-22">22</a></span>
<span class="normal"><a href="#__codelineno-50-23">23</a></span>
<span class="normal"><a href="#__codelineno-50-24">24</a></span>
<span class="normal"><a href="#__codelineno-50-25">25</a></span>
<span class="normal"><a href="#__codelineno-50-26">26</a></span>
<span class="normal"><a href="#__codelineno-50-27">27</a></span>
<span class="normal"><a href="#__codelineno-50-28">28</a></span>
<span class="normal"><a href="#__codelineno-50-29">29</a></span>
<span class="normal"><a href="#__codelineno-50-30">30</a></span>
<span class="normal"><a href="#__codelineno-50-31">31</a></span>
<span class="normal"><a href="#__codelineno-50-32">32</a></span>
<span class="normal"><a href="#__codelineno-50-33">33</a></span>
<span class="normal"><a href="#__codelineno-50-34">34</a></span>
<span class="normal"><a href="#__codelineno-50-35">35</a></span>
<span class="normal"><a href="#__codelineno-50-36">36</a></span>
<span class="normal"><a href="#__codelineno-50-37">37</a></span>
<span class="normal"><a href="#__codelineno-50-38">38</a></span>
<span class="normal"><a href="#__codelineno-50-39">39</a></span>
<span class="normal"><a href="#__codelineno-50-40">40</a></span>
<span class="normal"><a href="#__codelineno-50-41">41</a></span>
<span class="normal"><a href="#__codelineno-50-42">42</a></span>
<span class="normal"><a href="#__codelineno-50-43">43</a></span>
<span class="normal"><a href="#__codelineno-50-44">44</a></span>
<span class="normal"><a href="#__codelineno-50-45">45</a></span>
<span class="normal"><a href="#__codelineno-50-46">46</a></span>
<span class="normal"><a href="#__codelineno-50-47">47</a></span>
<span class="normal"><a href="#__codelineno-50-48">48</a></span>
<span class="normal"><a href="#__codelineno-50-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">inet</span><span class="o">/</span><span class="n">smtp</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="o">----------------------------------</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="n">Envoi</span> <span class="n">du</span> <span class="n">message</span> <span class="p">[</span><span class="n">mail</span> <span class="n">to</span> <span class="n">localhost</span> <span class="n">via</span> <span class="n">localhost</span><span class="p">]</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">EHLO</span> <span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">]</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">220</span> <span class="n">Bienvenue</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">serveur</span> <span class="n">SMTP</span> <span class="n">localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">MAIL</span> <span class="n">FROM</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a><span class="mi">250</span><span class="o">-</span><span class="n">SIZE</span> <span class="mi">20480000</span>
<a id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="mi">250</span><span class="o">-</span><span class="n">AUTH</span> <span class="n">LOGIN</span>
<a id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="mi">250</span> <span class="n">HELP</span><span class="p">]</span>
<a id="__codelineno-50-11" name="__codelineno-50-11"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">RCPT</span> <span class="n">TO</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span> <span class="n">OK</span><span class="p">]</span>
<a id="__codelineno-50-13" name="__codelineno-50-13"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">DATA</span><span class="p">]</span>
<a id="__codelineno-50-14" name="__codelineno-50-14"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span> <span class="n">OK</span><span class="p">]</span>
<a id="__codelineno-50-15" name="__codelineno-50-15"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">From</span><span class="p">:</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-50-16" name="__codelineno-50-16"></a><span class="n">To</span><span class="p">:</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span>
<a id="__codelineno-50-17" name="__codelineno-50-17"></a><span class="n">Subject</span><span class="p">:</span> <span class="n">to</span> <span class="n">localhost</span> <span class="n">via</span> <span class="n">localhost</span>
<a id="__codelineno-50-18" name="__codelineno-50-18"></a><span class="n">Content</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span>
<a id="__codelineno-50-19" name="__codelineno-50-19"></a>
<a id="__codelineno-50-20" name="__codelineno-50-20"></a><span class="n">aglaë</span> <span class="n">séléné</span>
<a id="__codelineno-50-21" name="__codelineno-50-21"></a><span class="n">va</span> <span class="n">au</span> <span class="n">marché</span>
<a id="__codelineno-50-22" name="__codelineno-50-22"></a><span class="n">acheter</span> <span class="n">des</span> <span class="n">fleurs</span><span class="p">]</span>
<a id="__codelineno-50-23" name="__codelineno-50-23"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">354</span> <span class="n">OK</span><span class="p">,</span> <span class="n">send</span><span class="o">.</span><span class="p">]</span>
<a id="__codelineno-50-24" name="__codelineno-50-24"></a><span class="o">--&gt;</span> <span class="p">[</span>
<a id="__codelineno-50-25" name="__codelineno-50-25"></a><span class="o">.</span>
<a id="__codelineno-50-26" name="__codelineno-50-26"></a><span class="p">]</span>
<a id="__codelineno-50-27" name="__codelineno-50-27"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span> <span class="n">Queued</span> <span class="p">(</span><span class="mf">0.000</span> <span class="n">seconds</span><span class="p">)]</span>
<a id="__codelineno-50-28" name="__codelineno-50-28"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">QUIT</span><span class="p">]</span>
<a id="__codelineno-50-29" name="__codelineno-50-29"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">221</span> <span class="n">goodbye</span><span class="p">]</span>
<a id="__codelineno-50-30" name="__codelineno-50-30"></a><span class="n">Message</span> <span class="n">envoyé</span><span class="o">...</span>
<a id="__codelineno-50-31" name="__codelineno-50-31"></a><span class="o">----------------------------------</span>
<a id="__codelineno-50-32" name="__codelineno-50-32"></a><span class="n">Envoi</span> <span class="n">du</span> <span class="n">message</span> <span class="p">[</span><span class="n">mail</span> <span class="n">to</span> <span class="n">gmail</span> <span class="n">via</span> <span class="n">gmail</span><span class="p">]</span>
<a id="__codelineno-50-33" name="__codelineno-50-33"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">EHLO</span> <span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">]</span>
<a id="__codelineno-50-34" name="__codelineno-50-34"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">220</span> <span class="n">smtp</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">com</span> <span class="n">ESMTP</span> <span class="n">u1sm1364433wrb</span><span class="mf">.78</span> <span class="o">-</span> <span class="n">gsmtp</span><span class="p">]</span>
<a id="__codelineno-50-35" name="__codelineno-50-35"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">MAIL</span> <span class="n">FROM</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">pymailparlexemple</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-50-36" name="__codelineno-50-36"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">250</span><span class="o">-</span><span class="n">smtp</span><span class="o">.</span><span class="n">gmail</span><span class="o">.</span><span class="n">com</span> <span class="n">at</span> <span class="n">your</span> <span class="n">service</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="n">a01</span><span class="p">:</span><span class="n">cb05</span><span class="p">:</span><span class="mf">80e8</span><span class="p">:</span><span class="n">b500</span><span class="p">:</span><span class="mi">3</span><span class="n">c4b</span><span class="p">:</span><span class="mi">2203</span><span class="p">:</span><span class="mi">91</span><span class="n">fa</span><span class="p">:</span><span class="mi">9</span><span class="n">b00</span><span class="p">]</span>
<a id="__codelineno-50-37" name="__codelineno-50-37"></a><span class="mi">250</span><span class="o">-</span><span class="n">SIZE</span> <span class="mi">35882577</span>
<a id="__codelineno-50-38" name="__codelineno-50-38"></a><span class="mi">250</span><span class="o">-</span><span class="mi">8</span><span class="n">BITMIME</span>
<a id="__codelineno-50-39" name="__codelineno-50-39"></a><span class="mi">250</span><span class="o">-</span><span class="n">STARTTLS</span>
<a id="__codelineno-50-40" name="__codelineno-50-40"></a><span class="mi">250</span><span class="o">-</span><span class="n">ENHANCEDSTATUSCODES</span>
<a id="__codelineno-50-41" name="__codelineno-50-41"></a><span class="mi">250</span><span class="o">-</span><span class="n">PIPELINING</span>
<a id="__codelineno-50-42" name="__codelineno-50-42"></a><span class="mi">250</span><span class="o">-</span><span class="n">CHUNKING</span>
<a id="__codelineno-50-43" name="__codelineno-50-43"></a><span class="mi">250</span> <span class="n">SMTPUTF8</span><span class="p">]</span>
<a id="__codelineno-50-44" name="__codelineno-50-44"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">RCPT</span> <span class="n">TO</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">pymailparlexemple</span><span class="nd">@gmail</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-50-45" name="__codelineno-50-45"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">530</span> <span class="mf">5.7.0</span> <span class="n">Must</span> <span class="n">issue</span> <span class="n">a</span> <span class="n">STARTTLS</span> <span class="n">command</span> <span class="n">first</span><span class="o">.</span> <span class="n">u1sm1364433wrb</span><span class="mf">.78</span> <span class="o">-</span> <span class="n">gsmtp</span><span class="p">]</span>
<a id="__codelineno-50-46" name="__codelineno-50-46"></a><span class="n">L</span><span class="s1">&#39;erreur suivante s&#39;</span><span class="n">est</span> <span class="n">produite</span> <span class="p">:</span> <span class="mf">5.7.0</span> <span class="n">Must</span> <span class="n">issue</span> <span class="n">a</span> <span class="n">STARTTLS</span> <span class="n">command</span> <span class="n">first</span><span class="o">.</span> <span class="n">u1sm1364433wrb</span><span class="mf">.78</span> <span class="o">-</span> <span class="n">gsmtp</span>
<a id="__codelineno-50-47" name="__codelineno-50-47"></a>
<a id="__codelineno-50-48" name="__codelineno-50-48"></a>
<a id="__codelineno-50-49" name="__codelineno-50-49"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 3-30 : l’utilisation du serveur SMTP <strong>[hMailServer]</strong> pour envoyer un mail à <strong>[guest@localhost]</strong> se passe bien ;</li>
<li>lignes 32-46 : l’utilisation du serveur SMTP <strong>[smtp.gmail.com]</strong> pour envoyer un mail à <strong>[pymailparlexemple@gmail.com]</strong> ne se passe pas bien : en ligne 45, le serveur SMTP envoie un code d’erreur 530 avec un message d’erreur. Celui-ci indique que le client SMTP doit au préalable s’authentifier via une connexion sécurisée. Notre client ne l’a pas fait et est donc refusé ;
Les résultats dans Thunderbird sont les suivants :</li>
</ul>
<p><img src="images/100000000000047200000262D27CE93C.png" style="width:13.151cm;height:7.051cm;" alt="Image" /></p>
<h3 id="2157-scripts-smtp02-un-lient-smtp-ecrit-avec-la-bibliotheque-smtplib">21.5.7. scripts [smtp/02] : un lient SMTP écrit avec la bibliothèque [smtplib]</h3>
<p><img src="images/10000000000001260000015A7EFDE191.png" style="width:3.402cm;height:3.991cm;" alt="Image" /></p>
<p>Le client précédent souffre d&#x27;au moins deux insuffisances :</p>
<ul>
<li>il ne sait pas utiliser une connexion sécurisée si le serveur la réclame ;</li>
<li>il ne sait pas joindre des attachements au message ;
Nous allons traiter la première insuffisance dans le script <strong>[smtp/02]</strong>. Dans notre nouveau script nous allons utiliser le module Python <strong>[smtplib]</strong>.</li>
</ul>
<p>Le script <strong>[smtp/02/main]</strong> utilisera le fichier de configuration jSON <strong>[smtp/02/config]</strong> suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span>
<span class="normal"><a href="#__codelineno-51-13">13</a></span>
<span class="normal"><a href="#__codelineno-51-14">14</a></span>
<span class="normal"><a href="#__codelineno-51-15">15</a></span>
<span class="normal"><a href="#__codelineno-51-16">16</a></span>
<span class="normal"><a href="#__codelineno-51-17">17</a></span>
<span class="normal"><a href="#__codelineno-51-18">18</a></span>
<span class="normal"><a href="#__codelineno-51-19">19</a></span>
<span class="normal"><a href="#__codelineno-51-20">20</a></span>
<span class="normal"><a href="#__codelineno-51-21">21</a></span>
<span class="normal"><a href="#__codelineno-51-22">22</a></span>
<span class="normal"><a href="#__codelineno-51-23">23</a></span>
<span class="normal"><a href="#__codelineno-51-24">24</a></span>
<span class="normal"><a href="#__codelineno-51-25">25</a></span>
<span class="normal"><a href="#__codelineno-51-26">26</a></span>
<span class="normal"><a href="#__codelineno-51-27">27</a></span>
<span class="normal"><a href="#__codelineno-51-28">28</a></span>
<span class="normal"><a href="#__codelineno-51-29">29</a></span>
<span class="normal"><a href="#__codelineno-51-30">30</a></span>
<span class="normal"><a href="#__codelineno-51-31">31</a></span>
<span class="normal"><a href="#__codelineno-51-32">32</a></span>
<span class="normal"><a href="#__codelineno-51-33">33</a></span>
<span class="normal"><a href="#__codelineno-51-34">34</a></span>
<span class="normal"><a href="#__codelineno-51-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a>        <span class="c1"># description : description du mail envoyé</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a>        <span class="c1"># smtp-server : serveur SMTP</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a>        <span class="c1"># smtp-port : port du serveur SMTP</span>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a>        <span class="c1"># from : expéditeur</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a>        <span class="c1"># to : destinataire</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a>        <span class="c1"># subject : sujet du mail</span>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a>        <span class="c1"># message : message du mail</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a>        <span class="s2">&quot;mails&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a>            <span class="p">{</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;mail to localhost via localhost avec smtplib&quot;</span><span class="p">,</span>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a>                <span class="s2">&quot;smtp-server&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a>                <span class="s2">&quot;smtp-port&quot;</span><span class="p">:</span> <span class="s2">&quot;25&quot;</span><span class="p">,</span>
<a id="__codelineno-51-15" name="__codelineno-51-15"></a>                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;guest@localhost.com&quot;</span><span class="p">,</span>
<a id="__codelineno-51-16" name="__codelineno-51-16"></a>                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;guest@localhost.com&quot;</span><span class="p">,</span>
<a id="__codelineno-51-17" name="__codelineno-51-17"></a>                <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;to localhost via localhost avec smtplib&quot;</span><span class="p">,</span>
<a id="__codelineno-51-18" name="__codelineno-51-18"></a>                <span class="c1"># on teste les caractères accentués</span>
<a id="__codelineno-51-19" name="__codelineno-51-19"></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;aglaë séléné</span><span class="se">\n</span><span class="s2">va au marché</span><span class="se">\n</span><span class="s2">acheter des fleurs&quot;</span><span class="p">,</span>
<a id="__codelineno-51-20" name="__codelineno-51-20"></a>            <span class="p">},</span>
<a id="__codelineno-51-21" name="__codelineno-51-21"></a>            <span class="p">{</span>
<a id="__codelineno-51-22" name="__codelineno-51-22"></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;mail to gmail via gmail avec smtplib&quot;</span><span class="p">,</span>
<a id="__codelineno-51-23" name="__codelineno-51-23"></a>                <span class="s2">&quot;smtp-server&quot;</span><span class="p">:</span> <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-51-24" name="__codelineno-51-24"></a>                <span class="s2">&quot;smtp-port&quot;</span><span class="p">:</span> <span class="s2">&quot;587&quot;</span><span class="p">,</span>
<a id="__codelineno-51-25" name="__codelineno-51-25"></a>                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-51-26" name="__codelineno-51-26"></a>                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-51-27" name="__codelineno-51-27"></a>                <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;to gmail via gmail avec smtplib&quot;</span><span class="p">,</span>
<a id="__codelineno-51-28" name="__codelineno-51-28"></a>                <span class="c1"># on teste les caractères accentués</span>
<a id="__codelineno-51-29" name="__codelineno-51-29"></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;aglaë séléné</span><span class="se">\n</span><span class="s2">va au marché</span><span class="se">\n</span><span class="s2">acheter des fleurs&quot;</span><span class="p">,</span>
<a id="__codelineno-51-30" name="__codelineno-51-30"></a>                <span class="c1"># smtp avec authentification</span>
<a id="__codelineno-51-31" name="__codelineno-51-31"></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-51-32" name="__codelineno-51-32"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;#6prIlh@1QZ3TG&quot;</span><span class="p">,</span>
<a id="__codelineno-51-33" name="__codelineno-51-33"></a>            <span class="p">}</span>
<a id="__codelineno-51-34" name="__codelineno-51-34"></a>        <span class="p">]</span>
<a id="__codelineno-51-35" name="__codelineno-51-35"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>On retrouve les mêmes rubriques que dans le fichier <strong>[smtp/01/config]</strong> avec deux rubriques supplémentaires lorsque el serveur SMTP demande une authentification :</p>
<ul>
<li>ligne 31, <strong>[user]</strong> : le nom de l’utilisateur qui authentifie la connexion ;</li>
<li>ligne 32, <strong>[password]</strong> : son mot de passe ;
Ces deux rubriques ne sont présentes que si le serveur SMTP contacté exige une authentification. Celle-ci se fait alors au-travers d&#x27;une connexion sécurisée.</li>
</ul>
<p>Le code du script <strong>[smtp/02/main.py]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-52-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-52-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-52-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-52-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-52-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-52-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-52-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-52-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-52-10">10</a></span>
<span class="normal"><a href="#__codelineno-52-11">11</a></span>
<span class="normal"><a href="#__codelineno-52-12">12</a></span>
<span class="normal"><a href="#__codelineno-52-13">13</a></span>
<span class="normal"><a href="#__codelineno-52-14">14</a></span>
<span class="normal"><a href="#__codelineno-52-15">15</a></span>
<span class="normal"><a href="#__codelineno-52-16">16</a></span>
<span class="normal"><a href="#__codelineno-52-17">17</a></span>
<span class="normal"><a href="#__codelineno-52-18">18</a></span>
<span class="normal"><a href="#__codelineno-52-19">19</a></span>
<span class="normal"><a href="#__codelineno-52-20">20</a></span>
<span class="normal"><a href="#__codelineno-52-21">21</a></span>
<span class="normal"><a href="#__codelineno-52-22">22</a></span>
<span class="normal"><a href="#__codelineno-52-23">23</a></span>
<span class="normal"><a href="#__codelineno-52-24">24</a></span>
<span class="normal"><a href="#__codelineno-52-25">25</a></span>
<span class="normal"><a href="#__codelineno-52-26">26</a></span>
<span class="normal"><a href="#__codelineno-52-27">27</a></span>
<span class="normal"><a href="#__codelineno-52-28">28</a></span>
<span class="normal"><a href="#__codelineno-52-29">29</a></span>
<span class="normal"><a href="#__codelineno-52-30">30</a></span>
<span class="normal"><a href="#__codelineno-52-31">31</a></span>
<span class="normal"><a href="#__codelineno-52-32">32</a></span>
<span class="normal"><a href="#__codelineno-52-33">33</a></span>
<span class="normal"><a href="#__codelineno-52-34">34</a></span>
<span class="normal"><a href="#__codelineno-52-35">35</a></span>
<span class="normal"><a href="#__codelineno-52-36">36</a></span>
<span class="normal"><a href="#__codelineno-52-37">37</a></span>
<span class="normal"><a href="#__codelineno-52-38">38</a></span>
<span class="normal"><a href="#__codelineno-52-39">39</a></span>
<span class="normal"><a href="#__codelineno-52-40">40</a></span>
<span class="normal"><a href="#__codelineno-52-41">41</a></span>
<span class="normal"><a href="#__codelineno-52-42">42</a></span>
<span class="normal"><a href="#__codelineno-52-43">43</a></span>
<span class="normal"><a href="#__codelineno-52-44">44</a></span>
<span class="normal"><a href="#__codelineno-52-45">45</a></span>
<span class="normal"><a href="#__codelineno-52-46">46</a></span>
<span class="normal"><a href="#__codelineno-52-47">47</a></span>
<span class="normal"><a href="#__codelineno-52-48">48</a></span>
<span class="normal"><a href="#__codelineno-52-49">49</a></span>
<span class="normal"><a href="#__codelineno-52-50">50</a></span>
<span class="normal"><a href="#__codelineno-52-51">51</a></span>
<span class="normal"><a href="#__codelineno-52-52">52</a></span>
<span class="normal"><a href="#__codelineno-52-53">53</a></span>
<span class="normal"><a href="#__codelineno-52-54">54</a></span>
<span class="normal"><a href="#__codelineno-52-55">55</a></span>
<span class="normal"><a href="#__codelineno-52-56">56</a></span>
<span class="normal"><a href="#__codelineno-52-57">57</a></span>
<span class="normal"><a href="#__codelineno-52-58">58</a></span>
<span class="normal"><a href="#__codelineno-52-59">59</a></span>
<span class="normal"><a href="#__codelineno-52-60">60</a></span>
<span class="normal"><a href="#__codelineno-52-61">61</a></span>
<span class="normal"><a href="#__codelineno-52-62">62</a></span>
<span class="normal"><a href="#__codelineno-52-63">63</a></span>
<span class="normal"><a href="#__codelineno-52-64">64</a></span>
<span class="normal"><a href="#__codelineno-52-65">65</a></span>
<span class="normal"><a href="#__codelineno-52-66">66</a></span>
<span class="normal"><a href="#__codelineno-52-67">67</a></span>
<span class="normal"><a href="#__codelineno-52-68">68</a></span>
<span class="normal"><a href="#__codelineno-52-69">69</a></span>
<span class="normal"><a href="#__codelineno-52-70">70</a></span>
<span class="normal"><a href="#__codelineno-52-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="c1"># imports</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">smtplib</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">email.mime.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">MIMEText</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">email.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">formatdate</span>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a><span class="c1"># -----------------------------------------------------------------------</span>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">sendmail</span><span class="p">(</span><span class="n">mail</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a>    <span class="c1"># envoie message au serveur smtp smtpserver de la part de expéditeur</span>
<a id="__codelineno-52-10" name="__codelineno-52-10"></a>    <span class="c1"># pour destinataire. Si verbose=True, fait un suivi des échanges client-serveur</span>
<a id="__codelineno-52-11" name="__codelineno-52-11"></a>
<a id="__codelineno-52-12" name="__codelineno-52-12"></a>    <span class="c1"># on utilise la bibliothéque smtplib</span>
<a id="__codelineno-52-13" name="__codelineno-52-13"></a>    <span class="c1"># on laisse remonter les exceptions</span>
<a id="__codelineno-52-14" name="__codelineno-52-14"></a>    <span class="c1">#</span>
<a id="__codelineno-52-15" name="__codelineno-52-15"></a>    <span class="c1"># le serveur SMTP</span>
<a id="__codelineno-52-16" name="__codelineno-52-16"></a>    <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">mail</span><span class="p">[</span><span class="s2">&quot;smtp-server&quot;</span><span class="p">])</span>
<a id="__codelineno-52-17" name="__codelineno-52-17"></a>    <span class="c1"># mode verbose</span>
<a id="__codelineno-52-18" name="__codelineno-52-18"></a>    <span class="n">server</span><span class="o">.</span><span class="n">set_debuglevel</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
<a id="__codelineno-52-19" name="__codelineno-52-19"></a>    <span class="c1"># connexion sécurisée ?</span>
<a id="__codelineno-52-20" name="__codelineno-52-20"></a>    <span class="k">if</span> <span class="s2">&quot;user&quot;</span> <span class="ow">in</span> <span class="n">mail</span><span class="p">:</span>
<a id="__codelineno-52-21" name="__codelineno-52-21"></a>        <span class="c1"># connexion sécurisée</span>
<a id="__codelineno-52-22" name="__codelineno-52-22"></a>        <span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
<a id="__codelineno-52-23" name="__codelineno-52-23"></a>        <span class="c1"># EHLO commande + authentification</span>
<a id="__codelineno-52-24" name="__codelineno-52-24"></a>        <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">mail</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="n">mail</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">])</span>
<a id="__codelineno-52-25" name="__codelineno-52-25"></a>
<a id="__codelineno-52-26" name="__codelineno-52-26"></a>   <span class="c1"># construction d&#39;un message Multipart - c&#39;est ce message qui Multipart sera envoyé</span>
<a id="__codelineno-52-27" name="__codelineno-52-27"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">mail</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
<a id="__codelineno-52-28" name="__codelineno-52-28"></a>    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;from&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mail</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span>
<a id="__codelineno-52-29" name="__codelineno-52-29"></a>    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mail</span><span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">]</span>
<a id="__codelineno-52-30" name="__codelineno-52-30"></a>    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatdate</span><span class="p">(</span><span class="n">localtime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-52-31" name="__codelineno-52-31"></a>    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mail</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span>
<a id="__codelineno-52-32" name="__codelineno-52-32"></a>    <span class="c1"># on envoie le message</span>
<a id="__codelineno-52-33" name="__codelineno-52-33"></a>    <span class="n">server</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-52-34" name="__codelineno-52-34"></a>    <span class="c1"># on quitte</span>
<a id="__codelineno-52-35" name="__codelineno-52-35"></a>    <span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<a id="__codelineno-52-36" name="__codelineno-52-36"></a>
<a id="__codelineno-52-37" name="__codelineno-52-37"></a>
<a id="__codelineno-52-38" name="__codelineno-52-38"></a><span class="c1"># main ----------------------------------------------------------------</span>
<a id="__codelineno-52-39" name="__codelineno-52-39"></a>
<a id="__codelineno-52-40" name="__codelineno-52-40"></a><span class="c1"># les infos sont prises dans un fichier config contenant les informations suivantes pour chaque serveur</span>
<a id="__codelineno-52-41" name="__codelineno-52-41"></a>
<a id="__codelineno-52-42" name="__codelineno-52-42"></a><span class="c1"># description : description du mail envoyé</span>
<a id="__codelineno-52-43" name="__codelineno-52-43"></a><span class="c1"># smtp-server : serveur SMTP</span>
<a id="__codelineno-52-44" name="__codelineno-52-44"></a><span class="c1"># smtp-port : port du serveur SMTP</span>
<a id="__codelineno-52-45" name="__codelineno-52-45"></a><span class="c1"># from : expéditeur</span>
<a id="__codelineno-52-46" name="__codelineno-52-46"></a><span class="c1"># to : destinataire</span>
<a id="__codelineno-52-47" name="__codelineno-52-47"></a><span class="c1"># subject : sujet du mail</span>
<a id="__codelineno-52-48" name="__codelineno-52-48"></a><span class="c1"># content-type : encodage du mail</span>
<a id="__codelineno-52-49" name="__codelineno-52-49"></a><span class="c1"># message : message du mail</span>
<a id="__codelineno-52-50" name="__codelineno-52-50"></a>
<a id="__codelineno-52-51" name="__codelineno-52-51"></a>
<a id="__codelineno-52-52" name="__codelineno-52-52"></a><span class="c1"># configurationn de l&#39;application</span>
<a id="__codelineno-52-53" name="__codelineno-52-53"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-52-54" name="__codelineno-52-54"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-52-55" name="__codelineno-52-55"></a>
<a id="__codelineno-52-56" name="__codelineno-52-56"></a><span class="c1"># on traite les mails un par un</span>
<a id="__codelineno-52-57" name="__codelineno-52-57"></a><span class="k">for</span> <span class="n">mail</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;mails&#39;</span><span class="p">]:</span>
<a id="__codelineno-52-58" name="__codelineno-52-58"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-52-59" name="__codelineno-52-59"></a>        <span class="c1"># logs</span>
<a id="__codelineno-52-60" name="__codelineno-52-60"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-52-61" name="__codelineno-52-61"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Envoi du message [</span><span class="si">{</span><span class="n">mail</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-52-62" name="__codelineno-52-62"></a>        <span class="c1"># envoi du message en mode verbeux</span>
<a id="__codelineno-52-63" name="__codelineno-52-63"></a>        <span class="n">sendmail</span><span class="p">(</span><span class="n">mail</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-52-64" name="__codelineno-52-64"></a>        <span class="c1"># fin</span>
<a id="__codelineno-52-65" name="__codelineno-52-65"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Message envoyé...&quot;</span><span class="p">)</span>
<a id="__codelineno-52-66" name="__codelineno-52-66"></a>    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-52-67" name="__codelineno-52-67"></a>        <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-52-68" name="__codelineno-52-68"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-52-69" name="__codelineno-52-69"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-52-70" name="__codelineno-52-70"></a>        <span class="k">pass</span>
<a id="__codelineno-52-71" name="__codelineno-52-71"></a>    <span class="c1"># mail suivant</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 8-35 : seule la fonction <strong>[sendmail]</strong> est utilisée. Elle va désormais utiliser le module <strong>[smtplib]</strong> (ligne 2) ;</li>
<li>ligne 16 : connexion au serveur SMTP ;</li>
<li>ligne 18 : si <strong>[verbose=True]</strong>, les échanges client / serveur seront affichés sur la console ;</li>
<li>lignes 20-24 : on fait l&#x27;éventuelle authentification si le serveur SMTP l&#x27;exige ;</li>
<li>ligne 22 : l&#x27;authentification se fait au travers d&#x27;une connexion sécurisée ;</li>
<li>ligne 24 : authentification ;</li>
<li>lignes 26-33 : envoi du message. Le dialogue vu avec le script <strong>[smtp/01/main]</strong> va alors se dérouler. S&#x27;il y a eu authentification, il se déroulera au sein d&#x27;une connexion sécurisée ;</li>
<li>
<p>ligne 35 : on termine le dialogue client / serveur ;
Avant d’exécuter le script <strong>[smtp/02/main]</strong>, vous devez modifier la configuration du compte Gmail <strong>[pymailparlexemple@gmail.com]</strong> :</p>
</li>
<li>
<p>connectez-vous au compte Gmail <strong>[pymailparlexemple@gmail.com]</strong> ;</p>
</li>
<li>modifiez la configuration suivante :</li>
</ul>
<p><img src="images/100000000000051500000250B9D47671.png" style="width:15.02cm;height:6.831cm;" alt="Image" /></p>
<ul>
<li>en <strong>[2]</strong>, autorisez les applications moins sécurisées à accéder au compte ;
Faites la même chose avec le second compte Gmail <strong>[pymail2parlexemple@gmail.com]</strong>.</li>
</ul>
<p><strong>Résultats</strong></p>
<p>Lorsqu’on exécute le script <strong>[smtp/02/main]</strong> on obtient les résultats console suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span>
<span class="normal"><a href="#__codelineno-53-13">13</a></span>
<span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span>
<span class="normal"><a href="#__codelineno-53-16">16</a></span>
<span class="normal"><a href="#__codelineno-53-17">17</a></span>
<span class="normal"><a href="#__codelineno-53-18">18</a></span>
<span class="normal"><a href="#__codelineno-53-19">19</a></span>
<span class="normal"><a href="#__codelineno-53-20">20</a></span>
<span class="normal"><a href="#__codelineno-53-21">21</a></span>
<span class="normal"><a href="#__codelineno-53-22">22</a></span>
<span class="normal"><a href="#__codelineno-53-23">23</a></span>
<span class="normal"><a href="#__codelineno-53-24">24</a></span>
<span class="normal"><a href="#__codelineno-53-25">25</a></span>
<span class="normal"><a href="#__codelineno-53-26">26</a></span>
<span class="normal"><a href="#__codelineno-53-27">27</a></span>
<span class="normal"><a href="#__codelineno-53-28">28</a></span>
<span class="normal"><a href="#__codelineno-53-29">29</a></span>
<span class="normal"><a href="#__codelineno-53-30">30</a></span>
<span class="normal"><a href="#__codelineno-53-31">31</a></span>
<span class="normal"><a href="#__codelineno-53-32">32</a></span>
<span class="normal"><a href="#__codelineno-53-33">33</a></span>
<span class="normal"><a href="#__codelineno-53-34">34</a></span>
<span class="normal"><a href="#__codelineno-53-35">35</a></span>
<span class="normal"><a href="#__codelineno-53-36">36</a></span>
<span class="normal"><a href="#__codelineno-53-37">37</a></span>
<span class="normal"><a href="#__codelineno-53-38">38</a></span>
<span class="normal"><a href="#__codelineno-53-39">39</a></span>
<span class="normal"><a href="#__codelineno-53-40">40</a></span>
<span class="normal"><a href="#__codelineno-53-41">41</a></span>
<span class="normal"><a href="#__codelineno-53-42">42</a></span>
<span class="normal"><a href="#__codelineno-53-43">43</a></span>
<span class="normal"><a href="#__codelineno-53-44">44</a></span>
<span class="normal"><a href="#__codelineno-53-45">45</a></span>
<span class="normal"><a href="#__codelineno-53-46">46</a></span>
<span class="normal"><a href="#__codelineno-53-47">47</a></span>
<span class="normal"><a href="#__codelineno-53-48">48</a></span>
<span class="normal"><a href="#__codelineno-53-49">49</a></span>
<span class="normal"><a href="#__codelineno-53-50">50</a></span>
<span class="normal"><a href="#__codelineno-53-51">51</a></span>
<span class="normal"><a href="#__codelineno-53-52">52</a></span>
<span class="normal"><a href="#__codelineno-53-53">53</a></span>
<span class="normal"><a href="#__codelineno-53-54">54</a></span>
<span class="normal"><a href="#__codelineno-53-55">55</a></span>
<span class="normal"><a href="#__codelineno-53-56">56</a></span>
<span class="normal"><a href="#__codelineno-53-57">57</a></span>
<span class="normal"><a href="#__codelineno-53-58">58</a></span>
<span class="normal"><a href="#__codelineno-53-59">59</a></span>
<span class="normal"><a href="#__codelineno-53-60">60</a></span>
<span class="normal"><a href="#__codelineno-53-61">61</a></span>
<span class="normal"><a href="#__codelineno-53-62">62</a></span>
<span class="normal"><a href="#__codelineno-53-63">63</a></span>
<span class="normal"><a href="#__codelineno-53-64">64</a></span>
<span class="normal"><a href="#__codelineno-53-65">65</a></span>
<span class="normal"><a href="#__codelineno-53-66">66</a></span>
<span class="normal"><a href="#__codelineno-53-67">67</a></span>
<span class="normal"><a href="#__codelineno-53-68">68</a></span>
<span class="normal"><a href="#__codelineno-53-69">69</a></span>
<span class="normal"><a href="#__codelineno-53-70">70</a></span>
<span class="normal"><a href="#__codelineno-53-71">71</a></span>
<span class="normal"><a href="#__codelineno-53-72">72</a></span>
<span class="normal"><a href="#__codelineno-53-73">73</a></span>
<span class="normal"><a href="#__codelineno-53-74">74</a></span>
<span class="normal"><a href="#__codelineno-53-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">inet</span><span class="o">/</span><span class="n">smtp</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="o">----------------------------------</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="n">Envoi</span> <span class="n">du</span> <span class="n">message</span> <span class="p">[</span><span class="n">mail</span> <span class="n">to</span> <span class="n">localhost</span> <span class="n">via</span> <span class="n">localhost</span> <span class="n">avec</span> <span class="n">smtplib</span><span class="p">]</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;ehlo [192.168.43.163]</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-DESKTOP-30FF5FB</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-SIZE 20480000</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-AUTH LOGIN</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250 HELP</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">250</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;DESKTOP-30FF5FB</span><span class="se">\n</span><span class="s1">SIZE 20480000</span><span class="se">\n</span><span class="s1">AUTH LOGIN</span><span class="se">\n</span><span class="s1">HELP&#39;</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;mail FROM:&lt;guest@localhost.com&gt; size=310</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250 OK</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">250</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;OK&#39;</span>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;rcpt TO:&lt;guest@localhost.com&gt;</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250 OK</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-15" name="__codelineno-53-15"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">250</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;OK&#39;</span>
<a id="__codelineno-53-16" name="__codelineno-53-16"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;data</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-17" name="__codelineno-53-17"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;354 OK, send.</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-18" name="__codelineno-53-18"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">354</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;OK, send.&#39;</span>
<a id="__codelineno-53-19" name="__codelineno-53-19"></a><span class="n">data</span><span class="p">:</span> <span class="p">(</span><span class="mi">354</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;OK, send.&#39;</span><span class="p">)</span>
<a id="__codelineno-53-20" name="__codelineno-53-20"></a><span class="n">send</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;Content-Type: text/plain; charset=&quot;utf-8&quot;</span><span class="se">\r\n</span><span class="s1">MIME-Version: 1.0</span><span class="se">\r\n</span><span class="s1">Content-Transfer-Encoding: base64</span><span class="se">\r\n</span><span class="s1">from: guest@localhost.com</span><span class="se">\r\n</span><span class="s1">to: guest@localhost.com</span><span class="se">\r\n</span><span class="s1">date: Wed, 08 Jul 2020 08:35:39 +0200</span><span class="se">\r\n</span><span class="s1">subject: to localhost via localhost avec smtplib</span><span class="se">\r\n\r\n</span><span class="s1">YWdsYcOrIHPDqWzDqW7DqQp2YSBhdSBtYXJjaMOpCmFjaGV0ZXIgZGVzIGZsZXVycw==</span><span class="se">\r\n</span><span class="s1">.</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-21" name="__codelineno-53-21"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250 Queued (0.000 seconds)</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-22" name="__codelineno-53-22"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">250</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;Queued (0.000 seconds)&#39;</span>
<a id="__codelineno-53-23" name="__codelineno-53-23"></a><span class="n">data</span><span class="p">:</span> <span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Queued (0.000 seconds)&#39;</span><span class="p">)</span>
<a id="__codelineno-53-24" name="__codelineno-53-24"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;quit</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-25" name="__codelineno-53-25"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;221 goodbye</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-26" name="__codelineno-53-26"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">221</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;goodbye&#39;</span>
<a id="__codelineno-53-27" name="__codelineno-53-27"></a><span class="n">Message</span> <span class="n">envoyé</span><span class="o">...</span>
<a id="__codelineno-53-28" name="__codelineno-53-28"></a><span class="o">----------------------------------</span>
<a id="__codelineno-53-29" name="__codelineno-53-29"></a><span class="n">Envoi</span> <span class="n">du</span> <span class="n">message</span> <span class="p">[</span><span class="n">mail</span> <span class="n">to</span> <span class="n">gmail</span> <span class="n">via</span> <span class="n">gmail</span> <span class="n">avec</span> <span class="n">smtplib</span><span class="p">]</span>
<a id="__codelineno-53-30" name="__codelineno-53-30"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;ehlo [192.168.43.163]</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-31" name="__codelineno-53-31"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-smtp.gmail.com at your service, [37.172.118.130]</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-32" name="__codelineno-53-32"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-SIZE 35882577</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-33" name="__codelineno-53-33"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-8BITMIME</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-34" name="__codelineno-53-34"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-STARTTLS</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-35" name="__codelineno-53-35"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-ENHANCEDSTATUSCODES</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-36" name="__codelineno-53-36"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-PIPELINING</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-37" name="__codelineno-53-37"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-CHUNKING</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-38" name="__codelineno-53-38"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250 SMTPUTF8</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-39" name="__codelineno-53-39"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">250</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;smtp.gmail.com at your service, [37.172.118.130]</span><span class="se">\n</span><span class="s1">SIZE 35882577</span><span class="se">\n</span><span class="s1">8BITMIME</span><span class="se">\n</span><span class="s1">STARTTLS</span><span class="se">\n</span><span class="s1">ENHANCEDSTATUSCODES</span><span class="se">\n</span><span class="s1">PIPELINING</span><span class="se">\n</span><span class="s1">CHUNKING</span><span class="se">\n</span><span class="s1">SMTPUTF8&#39;</span>
<a id="__codelineno-53-40" name="__codelineno-53-40"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;STARTTLS</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-41" name="__codelineno-53-41"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;220 2.0.0 Ready to start TLS</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-42" name="__codelineno-53-42"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">220</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;2.0.0 Ready to start TLS&#39;</span>
<a id="__codelineno-53-43" name="__codelineno-53-43"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;ehlo [192.168.43.163]</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-44" name="__codelineno-53-44"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-smtp.gmail.com at your service, [37.172.118.130]</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-45" name="__codelineno-53-45"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-SIZE 35882577</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-46" name="__codelineno-53-46"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-8BITMIME</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-47" name="__codelineno-53-47"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-AUTH LOGIN PLAIN XOAUTH2 PLAIN-CLIENTTOKEN OAUTHBEARER XOAUTH</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-48" name="__codelineno-53-48"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-ENHANCEDSTATUSCODES</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-49" name="__codelineno-53-49"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-PIPELINING</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-50" name="__codelineno-53-50"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250-CHUNKING</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-51" name="__codelineno-53-51"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250 SMTPUTF8</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-52" name="__codelineno-53-52"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">250</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;smtp.gmail.com at your service, [37.172.118.130]</span><span class="se">\n</span><span class="s1">SIZE 35882577</span><span class="se">\n</span><span class="s1">8BITMIME</span><span class="se">\n</span><span class="s1">AUTH LOGIN PLAIN XOAUTH2 PLAIN-CLIENTTOKEN OAUTHBEARER XOAUTH</span><span class="se">\n</span><span class="s1">ENHANCEDSTATUSCODES</span><span class="se">\n</span><span class="s1">PIPELINING</span><span class="se">\n</span><span class="s1">CHUNKING</span><span class="se">\n</span><span class="s1">SMTPUTF8&#39;</span>
<a id="__codelineno-53-53" name="__codelineno-53-53"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;AUTH PLAIN AHB5bWFpbDJwYXJsZXhlbXBsZUBnbWFpbC5jb20AIzZwcklsaEQmQDFRWjNURw==</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-54" name="__codelineno-53-54"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;235 2.7.0 Accepted</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-55" name="__codelineno-53-55"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">235</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;2.7.0 Accepted&#39;</span>
<a id="__codelineno-53-56" name="__codelineno-53-56"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;mail FROM:&lt;pymail2parlexemple@gmail.com&gt; size=320</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-57" name="__codelineno-53-57"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250 2.1.0 OK e5sm4132618wrs.33 - gsmtp</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-58" name="__codelineno-53-58"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">250</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;2.1.0 OK e5sm4132618wrs.33 - gsmtp&#39;</span>
<a id="__codelineno-53-59" name="__codelineno-53-59"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;rcpt TO:&lt;pymail2parlexemple@gmail.com&gt;</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-60" name="__codelineno-53-60"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250 2.1.5 OK e5sm4132618wrs.33 - gsmtp</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-61" name="__codelineno-53-61"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">250</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;2.1.5 OK e5sm4132618wrs.33 - gsmtp&#39;</span>
<a id="__codelineno-53-62" name="__codelineno-53-62"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;data</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-63" name="__codelineno-53-63"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;354  Go ahead e5sm4132618wrs.33 - gsmtp</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-64" name="__codelineno-53-64"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">354</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;Go ahead e5sm4132618wrs.33 - gsmtp&#39;</span>
<a id="__codelineno-53-65" name="__codelineno-53-65"></a><span class="n">data</span><span class="p">:</span> <span class="p">(</span><span class="mi">354</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Go ahead e5sm4132618wrs.33 - gsmtp&#39;</span><span class="p">)</span>
<a id="__codelineno-53-66" name="__codelineno-53-66"></a><span class="n">send</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;Content-Type: text/plain; charset=&quot;utf-8&quot;</span><span class="se">\r\n</span><span class="s1">MIME-Version: 1.0</span><span class="se">\r\n</span><span class="s1">Content-Transfer-Encoding: base64</span><span class="se">\r\n</span><span class="s1">from: pymail2parlexemple@gmail.com</span><span class="se">\r\n</span><span class="s1">to: pymail2parlexemple@gmail.com</span><span class="se">\r\n</span><span class="s1">date: Wed, 08 Jul 2020 08:35:40 +0200</span><span class="se">\r\n</span><span class="s1">subject: to gmail via gmail avec smtplib</span><span class="se">\r\n\r\n</span><span class="s1">YWdsYcOrIHPDqWzDqW7DqQp2YSBhdSBtYXJjaMOpCmFjaGV0ZXIgZGVzIGZsZXVycw==</span><span class="se">\r\n</span><span class="s1">.</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-67" name="__codelineno-53-67"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;250 2.0.0 OK  1594190139 e5sm4132618wrs.33 - gsmtp</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-68" name="__codelineno-53-68"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">250</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;2.0.0 OK  1594190139 e5sm4132618wrs.33 - gsmtp&#39;</span>
<a id="__codelineno-53-69" name="__codelineno-53-69"></a><span class="n">data</span><span class="p">:</span> <span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;2.0.0 OK  1594190139 e5sm4132618wrs.33 - gsmtp&#39;</span><span class="p">)</span>
<a id="__codelineno-53-70" name="__codelineno-53-70"></a><span class="n">send</span><span class="p">:</span> <span class="s1">&#39;quit</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-71" name="__codelineno-53-71"></a><span class="n">Message</span> <span class="n">envoyé</span><span class="o">...</span>
<a id="__codelineno-53-72" name="__codelineno-53-72"></a><span class="n">reply</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;221 2.0.0 closing connection e5sm4132618wrs.33 - gsmtp</span><span class="se">\r\n</span><span class="s1">&#39;</span>
<a id="__codelineno-53-73" name="__codelineno-53-73"></a><span class="n">reply</span><span class="p">:</span> <span class="n">retcode</span> <span class="p">(</span><span class="mi">221</span><span class="p">);</span> <span class="n">Msg</span><span class="p">:</span> <span class="sa">b</span><span class="s1">&#39;2.0.0 closing connection e5sm4132618wrs.33 - gsmtp&#39;</span>
<a id="__codelineno-53-74" name="__codelineno-53-74"></a>
<a id="__codelineno-53-75" name="__codelineno-53-75"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 40 : le client <strong>[smtplib]</strong> commence le dialogue pour établir une liaison cryptée avec le serveur SMTP, ce qu’on n’avait pas su faire dans le script <strong>[smtp/main/01]</strong> ;</li>
<li>sinon on retouve les commandes connues du protocole SMTP ;
Si on consulte le compte Gmail de l’utilisateur <strong>[pymail2parlexemple]</strong> on a la chose suivante :</li>
</ul>
<p><img src="images/10000000000004830000027B835BC393.png" style="width:13.36cm;height:7.351cm;" alt="Image" /></p>
<h3 id="2158-scripts-smtp03-gestion-des-fichiers-attaches">21.5.8. scripts [smtp/03] : gestion des fichiers attachés</h3>
<p>Nous complétons le script <strong>[smtp/02/main]</strong> afin que le mail envoyé puisse avoir des fichiers attachés.</p>
<p><img src="images/10000000000001D2000001EA1A87D15F.png" style="width:5.381cm;height:5.661cm;" alt="Image" /></p>
<p>Le script <strong>[smtp/03/main]</strong> est configuré par le script <strong>[smtp/03/config]</strong> suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-54-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-54-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-54-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-54-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-54-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-54-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-54-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-54-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-54-10">10</a></span>
<span class="normal"><a href="#__codelineno-54-11">11</a></span>
<span class="normal"><a href="#__codelineno-54-12">12</a></span>
<span class="normal"><a href="#__codelineno-54-13">13</a></span>
<span class="normal"><a href="#__codelineno-54-14">14</a></span>
<span class="normal"><a href="#__codelineno-54-15">15</a></span>
<span class="normal"><a href="#__codelineno-54-16">16</a></span>
<span class="normal"><a href="#__codelineno-54-17">17</a></span>
<span class="normal"><a href="#__codelineno-54-18">18</a></span>
<span class="normal"><a href="#__codelineno-54-19">19</a></span>
<span class="normal"><a href="#__codelineno-54-20">20</a></span>
<span class="normal"><a href="#__codelineno-54-21">21</a></span>
<span class="normal"><a href="#__codelineno-54-22">22</a></span>
<span class="normal"><a href="#__codelineno-54-23">23</a></span>
<span class="normal"><a href="#__codelineno-54-24">24</a></span>
<span class="normal"><a href="#__codelineno-54-25">25</a></span>
<span class="normal"><a href="#__codelineno-54-26">26</a></span>
<span class="normal"><a href="#__codelineno-54-27">27</a></span>
<span class="normal"><a href="#__codelineno-54-28">28</a></span>
<span class="normal"><a href="#__codelineno-54-29">29</a></span>
<span class="normal"><a href="#__codelineno-54-30">30</a></span>
<span class="normal"><a href="#__codelineno-54-31">31</a></span>
<span class="normal"><a href="#__codelineno-54-32">32</a></span>
<span class="normal"><a href="#__codelineno-54-33">33</a></span>
<span class="normal"><a href="#__codelineno-54-34">34</a></span>
<span class="normal"><a href="#__codelineno-54-35">35</a></span>
<span class="normal"><a href="#__codelineno-54-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a>    <span class="c1"># configuration de l&#39;application</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a>        <span class="c1"># description : description du mail envoyé</span>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a>        <span class="c1"># smtp-server : serveur SMTP</span>
<a id="__codelineno-54-11" name="__codelineno-54-11"></a>        <span class="c1"># smtp-port : port du serveur SMTP</span>
<a id="__codelineno-54-12" name="__codelineno-54-12"></a>        <span class="c1"># from : expéditeur</span>
<a id="__codelineno-54-13" name="__codelineno-54-13"></a>        <span class="c1"># to : destinataire</span>
<a id="__codelineno-54-14" name="__codelineno-54-14"></a>        <span class="c1"># subject : sujet du mail</span>
<a id="__codelineno-54-15" name="__codelineno-54-15"></a>        <span class="c1"># message : message du mail</span>
<a id="__codelineno-54-16" name="__codelineno-54-16"></a>        <span class="s2">&quot;mails&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-54-17" name="__codelineno-54-17"></a>            <span class="p">{</span>
<a id="__codelineno-54-18" name="__codelineno-54-18"></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;mail to gmail via gmail avec smtplib&quot;</span><span class="p">,</span>
<a id="__codelineno-54-19" name="__codelineno-54-19"></a>                <span class="s2">&quot;smtp-server&quot;</span><span class="p">:</span> <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-54-20" name="__codelineno-54-20"></a>                <span class="s2">&quot;smtp-port&quot;</span><span class="p">:</span> <span class="s2">&quot;587&quot;</span><span class="p">,</span>
<a id="__codelineno-54-21" name="__codelineno-54-21"></a>                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-54-22" name="__codelineno-54-22"></a>                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-54-23" name="__codelineno-54-23"></a>                <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;to gmail via gmail avec smtplib&quot;</span><span class="p">,</span>
<a id="__codelineno-54-24" name="__codelineno-54-24"></a>                <span class="c1"># on teste les caractères accentués</span>
<a id="__codelineno-54-25" name="__codelineno-54-25"></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;aglaë séléné</span><span class="se">\n</span><span class="s2">va au marché</span><span class="se">\n</span><span class="s2">acheter des fleurs&quot;</span><span class="p">,</span>
<a id="__codelineno-54-26" name="__codelineno-54-26"></a>                <span class="c1"># smtp avec authentification</span>
<a id="__codelineno-54-27" name="__codelineno-54-27"></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-54-28" name="__codelineno-54-28"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;#6prIlhD&amp;@1QZ3TG&quot;</span><span class="p">,</span>
<a id="__codelineno-54-29" name="__codelineno-54-29"></a>                <span class="c1"># ici, il faut mettre des chemins absolus pour les fichiers attachés</span>
<a id="__codelineno-54-30" name="__codelineno-54-30"></a>                <span class="s2">&quot;attachments&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-54-31" name="__codelineno-54-31"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/attachments/fichier attaché.docx&quot;</span><span class="p">,</span>
<a id="__codelineno-54-32" name="__codelineno-54-32"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/attachments/fichier attaché.pdf&quot;</span><span class="p">,</span>
<a id="__codelineno-54-33" name="__codelineno-54-33"></a>                <span class="p">]</span>
<a id="__codelineno-54-34" name="__codelineno-54-34"></a>            <span class="p">}</span>
<a id="__codelineno-54-35" name="__codelineno-54-35"></a>        <span class="p">]</span>
<a id="__codelineno-54-36" name="__codelineno-54-36"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Le fichier <strong>[smtp/03/config]</strong> ne diffère du fichier <strong>[smtp/02/config]</strong> utilisé précédemment que par la présence facultative d&#x27;une liste <strong>[attachments]</strong> (lignes 30-32) qui désigne la liste des fichiers à attacher au message à envoyer.</p>
<p>Le script <strong>[smtp/03/main]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-55-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-55-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-55-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-55-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-55-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-55-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-55-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-55-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-55-10">10</a></span>
<span class="normal"><a href="#__codelineno-55-11">11</a></span>
<span class="normal"><a href="#__codelineno-55-12">12</a></span>
<span class="normal"><a href="#__codelineno-55-13">13</a></span>
<span class="normal"><a href="#__codelineno-55-14">14</a></span>
<span class="normal"><a href="#__codelineno-55-15">15</a></span>
<span class="normal"><a href="#__codelineno-55-16">16</a></span>
<span class="normal"><a href="#__codelineno-55-17">17</a></span>
<span class="normal"><a href="#__codelineno-55-18">18</a></span>
<span class="normal"><a href="#__codelineno-55-19">19</a></span>
<span class="normal"><a href="#__codelineno-55-20">20</a></span>
<span class="normal"><a href="#__codelineno-55-21">21</a></span>
<span class="normal"><a href="#__codelineno-55-22">22</a></span>
<span class="normal"><a href="#__codelineno-55-23">23</a></span>
<span class="normal"><a href="#__codelineno-55-24">24</a></span>
<span class="normal"><a href="#__codelineno-55-25">25</a></span>
<span class="normal"><a href="#__codelineno-55-26">26</a></span>
<span class="normal"><a href="#__codelineno-55-27">27</a></span>
<span class="normal"><a href="#__codelineno-55-28">28</a></span>
<span class="normal"><a href="#__codelineno-55-29">29</a></span>
<span class="normal"><a href="#__codelineno-55-30">30</a></span>
<span class="normal"><a href="#__codelineno-55-31">31</a></span>
<span class="normal"><a href="#__codelineno-55-32">32</a></span>
<span class="normal"><a href="#__codelineno-55-33">33</a></span>
<span class="normal"><a href="#__codelineno-55-34">34</a></span>
<span class="normal"><a href="#__codelineno-55-35">35</a></span>
<span class="normal"><a href="#__codelineno-55-36">36</a></span>
<span class="normal"><a href="#__codelineno-55-37">37</a></span>
<span class="normal"><a href="#__codelineno-55-38">38</a></span>
<span class="normal"><a href="#__codelineno-55-39">39</a></span>
<span class="normal"><a href="#__codelineno-55-40">40</a></span>
<span class="normal"><a href="#__codelineno-55-41">41</a></span>
<span class="normal"><a href="#__codelineno-55-42">42</a></span>
<span class="normal"><a href="#__codelineno-55-43">43</a></span>
<span class="normal"><a href="#__codelineno-55-44">44</a></span>
<span class="normal"><a href="#__codelineno-55-45">45</a></span>
<span class="normal"><a href="#__codelineno-55-46">46</a></span>
<span class="normal"><a href="#__codelineno-55-47">47</a></span>
<span class="normal"><a href="#__codelineno-55-48">48</a></span>
<span class="normal"><a href="#__codelineno-55-49">49</a></span>
<span class="normal"><a href="#__codelineno-55-50">50</a></span>
<span class="normal"><a href="#__codelineno-55-51">51</a></span>
<span class="normal"><a href="#__codelineno-55-52">52</a></span>
<span class="normal"><a href="#__codelineno-55-53">53</a></span>
<span class="normal"><a href="#__codelineno-55-54">54</a></span>
<span class="normal"><a href="#__codelineno-55-55">55</a></span>
<span class="normal"><a href="#__codelineno-55-56">56</a></span>
<span class="normal"><a href="#__codelineno-55-57">57</a></span>
<span class="normal"><a href="#__codelineno-55-58">58</a></span>
<span class="normal"><a href="#__codelineno-55-59">59</a></span>
<span class="normal"><a href="#__codelineno-55-60">60</a></span>
<span class="normal"><a href="#__codelineno-55-61">61</a></span>
<span class="normal"><a href="#__codelineno-55-62">62</a></span>
<span class="normal"><a href="#__codelineno-55-63">63</a></span>
<span class="normal"><a href="#__codelineno-55-64">64</a></span>
<span class="normal"><a href="#__codelineno-55-65">65</a></span>
<span class="normal"><a href="#__codelineno-55-66">66</a></span>
<span class="normal"><a href="#__codelineno-55-67">67</a></span>
<span class="normal"><a href="#__codelineno-55-68">68</a></span>
<span class="normal"><a href="#__codelineno-55-69">69</a></span>
<span class="normal"><a href="#__codelineno-55-70">70</a></span>
<span class="normal"><a href="#__codelineno-55-71">71</a></span>
<span class="normal"><a href="#__codelineno-55-72">72</a></span>
<span class="normal"><a href="#__codelineno-55-73">73</a></span>
<span class="normal"><a href="#__codelineno-55-74">74</a></span>
<span class="normal"><a href="#__codelineno-55-75">75</a></span>
<span class="normal"><a href="#__codelineno-55-76">76</a></span>
<span class="normal"><a href="#__codelineno-55-77">77</a></span>
<span class="normal"><a href="#__codelineno-55-78">78</a></span>
<span class="normal"><a href="#__codelineno-55-79">79</a></span>
<span class="normal"><a href="#__codelineno-55-80">80</a></span>
<span class="normal"><a href="#__codelineno-55-81">81</a></span>
<span class="normal"><a href="#__codelineno-55-82">82</a></span>
<span class="normal"><a href="#__codelineno-55-83">83</a></span>
<span class="normal"><a href="#__codelineno-55-84">84</a></span>
<span class="normal"><a href="#__codelineno-55-85">85</a></span>
<span class="normal"><a href="#__codelineno-55-86">86</a></span>
<span class="normal"><a href="#__codelineno-55-87">87</a></span>
<span class="normal"><a href="#__codelineno-55-88">88</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="c1"># imports</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">email</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">mimetypes</span>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">smtplib</span>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">email</span><span class="w"> </span><span class="kn">import</span> <span class="n">encoders</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">email.mime.audio</span><span class="w"> </span><span class="kn">import</span> <span class="n">MIMEAudio</span>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">email.mime.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">MIMEBase</span>
<a id="__codelineno-55-9" name="__codelineno-55-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">email.mime.image</span><span class="w"> </span><span class="kn">import</span> <span class="n">MIMEImage</span>
<a id="__codelineno-55-10" name="__codelineno-55-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">email.mime.message</span><span class="w"> </span><span class="kn">import</span> <span class="n">MIMEMessage</span>
<a id="__codelineno-55-11" name="__codelineno-55-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">email.mime.multipart</span><span class="w"> </span><span class="kn">import</span> <span class="n">MIMEMultipart</span>
<a id="__codelineno-55-12" name="__codelineno-55-12"></a><span class="kn">from</span><span class="w"> </span><span class="nn">email.mime.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">MIMEText</span>
<a id="__codelineno-55-13" name="__codelineno-55-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">email.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">formatdate</span>
<a id="__codelineno-55-14" name="__codelineno-55-14"></a>
<a id="__codelineno-55-15" name="__codelineno-55-15"></a>
<a id="__codelineno-55-16" name="__codelineno-55-16"></a>
<a id="__codelineno-55-17" name="__codelineno-55-17"></a><span class="c1"># -----------------------------------------------------------------------</span>
<a id="__codelineno-55-18" name="__codelineno-55-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">sendmail</span><span class="p">(</span><span class="n">mail</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-55-19" name="__codelineno-55-19"></a>    <span class="c1"># envoie mail[message] au serveur smtp mail[smtp-server] de la part de mail[from]</span>
<a id="__codelineno-55-20" name="__codelineno-55-20"></a>    <span class="c1"># pour mail[to]. Si verbose=True, fait un suivi des échanges client-serveur</span>
<a id="__codelineno-55-21" name="__codelineno-55-21"></a>
<a id="__codelineno-55-22" name="__codelineno-55-22"></a>    <span class="c1"># on utilise la bibliothéque smtplib</span>
<a id="__codelineno-55-23" name="__codelineno-55-23"></a>    <span class="c1"># on laisse remonter les exceptions</span>
<a id="__codelineno-55-24" name="__codelineno-55-24"></a>    <span class="c1">#</span>
<a id="__codelineno-55-25" name="__codelineno-55-25"></a>    <span class="c1"># le serveur SMTP</span>
<a id="__codelineno-55-26" name="__codelineno-55-26"></a>    <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">mail</span><span class="p">[</span><span class="s2">&quot;smtp-server&quot;</span><span class="p">])</span>
<a id="__codelineno-55-27" name="__codelineno-55-27"></a>    <span class="c1"># mode verbose</span>
<a id="__codelineno-55-28" name="__codelineno-55-28"></a>    <span class="n">server</span><span class="o">.</span><span class="n">set_debuglevel</span><span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
<a id="__codelineno-55-29" name="__codelineno-55-29"></a>    <span class="c1"># connexion sécurisée ?</span>
<a id="__codelineno-55-30" name="__codelineno-55-30"></a>    <span class="k">if</span> <span class="s2">&quot;user&quot;</span> <span class="ow">in</span> <span class="n">mail</span><span class="p">:</span>
<a id="__codelineno-55-31" name="__codelineno-55-31"></a>        <span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
<a id="__codelineno-55-32" name="__codelineno-55-32"></a>        <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">mail</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="n">mail</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">])</span>
<a id="__codelineno-55-33" name="__codelineno-55-33"></a>
<a id="__codelineno-55-34" name="__codelineno-55-34"></a>    <span class="c1"># construction d&#39;un message Multipart - c&#39;est le message qui sera envoyé</span>
<a id="__codelineno-55-35" name="__codelineno-55-35"></a>    <span class="c1"># credit : https://docs.python.org/3.4/library/email-examples.html</span>
<a id="__codelineno-55-36" name="__codelineno-55-36"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
<a id="__codelineno-55-37" name="__codelineno-55-37"></a>    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mail</span><span class="p">[</span><span class="s2">&quot;from&quot;</span><span class="p">]</span>
<a id="__codelineno-55-38" name="__codelineno-55-38"></a>    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mail</span><span class="p">[</span><span class="s2">&quot;to&quot;</span><span class="p">]</span>
<a id="__codelineno-55-39" name="__codelineno-55-39"></a>    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formatdate</span><span class="p">(</span><span class="n">localtime</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-55-40" name="__codelineno-55-40"></a>    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mail</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span>
<a id="__codelineno-55-41" name="__codelineno-55-41"></a>    <span class="c1"># on attache le message texte au format MIMEText</span>
<a id="__codelineno-55-42" name="__codelineno-55-42"></a>    <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">MIMEText</span><span class="p">(</span><span class="n">mail</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]))</span>
<a id="__codelineno-55-43" name="__codelineno-55-43"></a>    <span class="c1"># on parcourt les attachements</span>
<a id="__codelineno-55-44" name="__codelineno-55-44"></a>    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">mail</span><span class="p">[</span><span class="s2">&quot;attachments&quot;</span><span class="p">]:</span>
<a id="__codelineno-55-45" name="__codelineno-55-45"></a>        <span class="c1"># path doit être un chemin absolu</span>
<a id="__codelineno-55-46" name="__codelineno-55-46"></a>        <span class="c1"># on devine le type du fichier attaché</span>
<a id="__codelineno-55-47" name="__codelineno-55-47"></a>        <span class="n">ctype</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">mimetypes</span><span class="o">.</span><span class="n">guess_type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-55-48" name="__codelineno-55-48"></a>        <span class="c1"># si on n&#39;a pas deviné</span>
<a id="__codelineno-55-49" name="__codelineno-55-49"></a>        <span class="k">if</span> <span class="n">ctype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-55-50" name="__codelineno-55-50"></a>            <span class="c1"># No guess could be made, or the file is encoded (compressed), so</span>
<a id="__codelineno-55-51" name="__codelineno-55-51"></a>            <span class="c1"># use a generic bag-of-bits type.</span>
<a id="__codelineno-55-52" name="__codelineno-55-52"></a>            <span class="n">ctype</span> <span class="o">=</span> <span class="s1">&#39;application/octet-stream&#39;</span>
<a id="__codelineno-55-53" name="__codelineno-55-53"></a>        <span class="c1"># on décompose le type en maintype/subtype</span>
<a id="__codelineno-55-54" name="__codelineno-55-54"></a>        <span class="n">maintype</span><span class="p">,</span> <span class="n">subtype</span> <span class="o">=</span> <span class="n">ctype</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-55-55" name="__codelineno-55-55"></a>        <span class="c1"># on traite les différents cas</span>
<a id="__codelineno-55-56" name="__codelineno-55-56"></a>        <span class="k">if</span> <span class="n">maintype</span> <span class="o">==</span> <span class="s1">&#39;text&#39;</span><span class="p">:</span>
<a id="__codelineno-55-57" name="__codelineno-55-57"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-55-58" name="__codelineno-55-58"></a>                <span class="c1"># Note: we should handle calculating the charset</span>
<a id="__codelineno-55-59" name="__codelineno-55-59"></a>                <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEText</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">_subtype</span><span class="o">=</span><span class="n">subtype</span><span class="p">)</span>
<a id="__codelineno-55-60" name="__codelineno-55-60"></a>        <span class="k">elif</span> <span class="n">maintype</span> <span class="o">==</span> <span class="s1">&#39;image&#39;</span><span class="p">:</span>
<a id="__codelineno-55-61" name="__codelineno-55-61"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-55-62" name="__codelineno-55-62"></a>                <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEImage</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">_subtype</span><span class="o">=</span><span class="n">subtype</span><span class="p">)</span>
<a id="__codelineno-55-63" name="__codelineno-55-63"></a>        <span class="k">elif</span> <span class="n">maintype</span> <span class="o">==</span> <span class="s1">&#39;audio&#39;</span><span class="p">:</span>
<a id="__codelineno-55-64" name="__codelineno-55-64"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-55-65" name="__codelineno-55-65"></a>                <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEAudio</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">_subtype</span><span class="o">=</span><span class="n">subtype</span><span class="p">)</span>
<a id="__codelineno-55-66" name="__codelineno-55-66"></a>        <span class="c1"># cas du type message / rfc822</span>
<a id="__codelineno-55-67" name="__codelineno-55-67"></a>        <span class="k">elif</span> <span class="n">maintype</span> <span class="o">==</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span>
<a id="__codelineno-55-68" name="__codelineno-55-68"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-55-69" name="__codelineno-55-69"></a>                <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEMessage</span><span class="p">(</span><span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
<a id="__codelineno-55-70" name="__codelineno-55-70"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-55-71" name="__codelineno-55-71"></a>            <span class="c1"># autres cas</span>
<a id="__codelineno-55-72" name="__codelineno-55-72"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<a id="__codelineno-55-73" name="__codelineno-55-73"></a>                <span class="n">part</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="n">maintype</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span>
<a id="__codelineno-55-74" name="__codelineno-55-74"></a>                <span class="n">part</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<a id="__codelineno-55-75" name="__codelineno-55-75"></a>            <span class="c1"># Encode the payload using Base64</span>
<a id="__codelineno-55-76" name="__codelineno-55-76"></a>            <span class="n">encoders</span><span class="o">.</span><span class="n">encode_base64</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
<a id="__codelineno-55-77" name="__codelineno-55-77"></a>        <span class="c1"># Set the filename parameter</span>
<a id="__codelineno-55-78" name="__codelineno-55-78"></a>        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<a id="__codelineno-55-79" name="__codelineno-55-79"></a>        <span class="n">part</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">,</span> <span class="s1">&#39;attachment&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">basename</span><span class="p">)</span>
<a id="__codelineno-55-80" name="__codelineno-55-80"></a>        <span class="c1"># on attache le fichier au message à envoyer</span>
<a id="__codelineno-55-81" name="__codelineno-55-81"></a>        <span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
<a id="__codelineno-55-82" name="__codelineno-55-82"></a>    <span class="c1"># tous les attachements ont été faits - on envoie le message en tant que chaîne de caractères</span>
<a id="__codelineno-55-83" name="__codelineno-55-83"></a>    <span class="n">server</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-55-84" name="__codelineno-55-84"></a>
<a id="__codelineno-55-85" name="__codelineno-55-85"></a>
<a id="__codelineno-55-86" name="__codelineno-55-86"></a><span class="c1"># main ----------------------------------------------------------------</span>
<a id="__codelineno-55-87" name="__codelineno-55-87"></a>
<a id="__codelineno-55-88" name="__codelineno-55-88"></a><span class="o">..</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 18-32 : la fonction <strong>[sendmail]</strong> reste ce qu&#x27;elle était lorsqu&#x27;il n&#x27;y avait pas d&#x27;attachements ;</li>
<li>ligne 35 : le code qui suit est tiré d&#x27;une documentation officielle de Python ;</li>
<li>ligne 36 : le message qui va être envoyé va comprendre plusieurs parties : du texte et des fichiers attachés. On appelle cela un message <strong>[Multipart]</strong> ;</li>
<li>lignes 37-40 : on trouve dans le message <strong>[Multipart]</strong> les champs habituels de tout mail ;</li>
<li>ligne 42 : les différentes parties du message <strong>[Multipart]</strong> <strong>[msg]</strong> sont attachées au message par la méthode <strong>[msg.attach]</strong> (ligne 81). Les parties attachées peuvent être de toute nature. Celles-ci sont caractérisées par un type MIME. Le type MIME d&#x27;un texte ordinaire est le type <strong>[MIMEText]</strong> ;</li>
<li>lignes 44-81 : on va attacher au message <strong>[msg Multipart]</strong> tous les attachements du message à envoyer (ligne 81) ;</li>
<li>ligne 44 : <strong>[path]</strong> représente le chemin absolu du fichier à attacher ;</li>
<li>ligne 47 : pour trouver le type MIME à utiliser pour la partie à attacher, on va utiliser le suffixe (.docx, .php…) du fichier à attacher. La méthode <strong>[</strong><strong>mimetypes</strong><strong>.guess_type</strong><strong>]</strong> fait ce travail. Elle rend deux informations :</li>
<li><strong>[ctype]</strong> : le type MIME du fichier ;</li>
<li><strong>[encoding]</strong> : une information sur son encodage ;</li>
<li>lignes 49-52 : au cas où on ne peut pas déterminer le type MIME du fichier, on dit que c&#x27;est un fichier binaire (ligne 52) ;</li>
<li>ligne 54 : le type MIME d’un fichier se décompose en type principal / type secondaire, par exemple <strong>[application/pdf]</strong>. On sépare ces deux éléments ;</li>
<li>lignes 56-76 : on traite différents cas selon la valeur du type MIME principal. Par exemple, dans le cas <strong>[application/pdf]</strong> d&#x27;un fichier PDF, on va exécuter les lignes 70-76 :</li>
<li>lignes 56-59 : le cas où le fichier attaché est un fichier texte. Dans ce cas on crée un élément de  type <strong>[MIMEText]</strong> de contenu <strong>[fp.read]</strong> ;</li>
<li>lignes 60-62 : le cas où le fichier contient une image. Dans ce cas on crée un élément de  type <strong>[MIMEImage]</strong> de contenu <strong>[fp.read]</strong> ;</li>
<li>lignes 63-65 : le cas où le fichier est un fichier audio. Dans ce cas on crée un élément de  type <strong>[MIMEAudio]</strong> de contenu <strong>[fp.read]</strong> ;</li>
<li>lignes 66-69 : le cas où le fichier est un mail. Dans ce cas on crée un élément de  type <strong>[MIMEMessage]</strong> (ligne 69) de contenu <strong>[</strong><strong>email</strong><strong>.message_from_bytes(fp.read())</strong><strong>]</strong>. Contrairement aux cas précédents où le contenu de l’élément MIME était le contenu binaire du fichier associé, ici le contenu de l’élément MIMEMessage est de type <strong>[email.message.Message]</strong> ;</li>
<li>lignes 70-76 : les autres cas. Cela comprend par exemple les fichiers Word et PDF de notre exemple ;</li>
<li>ligne 72 : le fichier à attacher est ouvert en mode binaire (rb=read binary) ;</li>
<li>ligne 74 : <strong>[fp.read]</strong> lit la totalité du fichier binaire ;</li>
<li>lignes 72-74 : la structure <strong>[with open(…) as file]</strong> fait deux choses :</li>
<li>elle ouvre le fichier et lui donne le descripteur <strong>[file]</strong> ;</li>
<li>elle assure qu&#x27;à la sortie du <strong>[with]</strong>, erreur ou pas, le descripteur <strong>[file]</strong> sera fermé. C&#x27;est donc une alternative à la structure <strong>[try file=open(…)/ finally]</strong> ;</li>
<li>ligne 73 : on crée un nouvel élément <strong>[part]</strong> à incorporer au message Multipart. On utilise ici la classe <strong>[MIMEBase]</strong> et on passe au constructeur les éléments <strong>[maintype, subtype]</strong> déterminés ligne 54 ;</li>
<li>ligne 74 : l’élement à incorporer dans le message Multipart doit avoir un contenu. Celui-ci peut être initialisé avec la méthode <strong>[</strong><strong>set_payload</strong><strong>]</strong> ;</li>
<li>lignes 75-76 : les fichiers attachés doivent subir un encodage 7 bits. En effet, historiquement certains serveurs SMTP ne supportaient que des caractères codés sur 7 bits. Ici c’est le codage appelé ‘Base64’ qui est utilisé ;</li>
<li>ligne 77 : à partir de cette ligne, le traitement est comment à tous les types MIME que nous avons créés aux lignes 56-76 <strong>[MIMEMessage, MIMEImage, MIMEAudio, MIMEBase, MIMEText]</strong> ; </li>
<li>ligne 79 : l’élément à ajouter dans le message Multipart a un entête le décrivant. On indique ici que l’élément ajouté correspond à un fichier attaché. Le nom de ce fichier est le troisième paramètre passé à la méthode <strong>[add_header]</strong>. Le nom de ce fichier est souvent utilisé par les lecteurs de courrier pour enregistrer, sous ce nom, le fichier attaché dans le système de fichiers du lecteur. On a pour l’instant travaillé avec le nom absolu du fichie attaché. Ici on passe simplement son nom sans son chemin (ligne 78) ;</li>
<li>ligne 81 : le binaire du fichier est incorporé dans le message <strong>[msg Multipart]</strong> ;</li>
<li>ligne 83 : lorsque tous les parties du message ont été attachées au <strong>[msg Multipart]</strong>, celui-ci est envoyé ;
<strong>Résultats</strong></li>
</ul>
<p>Si on exécute le script <strong>[smtp/03/main]</strong> avec le fichier <strong>[smtp/02/config]</strong> déjà présenté, le compte <strong>[pymail2parlexemple@gmail.com]</strong> reçoit ceci :</p>
<p><img src="images/1000000000000576000002294274C742.png" style="width:16.162cm;height:6.391cm;" alt="Image" /></p>
<p>On voit les fichiers attachés en <strong>[4, 9-11]</strong>.</p>
<p>Montrons un exemple maintenant avec un mail attaché. Nous allons sauvegarder le mail reçu en <strong>[3]</strong> ci-dessus :</p>
<p><img src="images/100000000000058F000002C6CA92EA2E.png" style="width:16.431cm;height:8.191cm;" alt="Image" /></p>
<p>Nous sauvegardons le mail sous le nom <strong>[mail attaché 1.eml]</strong> dans le dossier <strong>[smtp/03/attachments]</strong>.</p>
<p>Nous modifions maintenant le fichier <strong>[smtp/03/config]</strong> de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-56-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-56-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-56-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-56-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-56-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-56-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-56-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-56-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-56-10">10</a></span>
<span class="normal"><a href="#__codelineno-56-11">11</a></span>
<span class="normal"><a href="#__codelineno-56-12">12</a></span>
<span class="normal"><a href="#__codelineno-56-13">13</a></span>
<span class="normal"><a href="#__codelineno-56-14">14</a></span>
<span class="normal"><a href="#__codelineno-56-15">15</a></span>
<span class="normal"><a href="#__codelineno-56-16">16</a></span>
<span class="normal"><a href="#__codelineno-56-17">17</a></span>
<span class="normal"><a href="#__codelineno-56-18">18</a></span>
<span class="normal"><a href="#__codelineno-56-19">19</a></span>
<span class="normal"><a href="#__codelineno-56-20">20</a></span>
<span class="normal"><a href="#__codelineno-56-21">21</a></span>
<span class="normal"><a href="#__codelineno-56-22">22</a></span>
<span class="normal"><a href="#__codelineno-56-23">23</a></span>
<span class="normal"><a href="#__codelineno-56-24">24</a></span>
<span class="normal"><a href="#__codelineno-56-25">25</a></span>
<span class="normal"><a href="#__codelineno-56-26">26</a></span>
<span class="normal"><a href="#__codelineno-56-27">27</a></span>
<span class="normal"><a href="#__codelineno-56-28">28</a></span>
<span class="normal"><a href="#__codelineno-56-29">29</a></span>
<span class="normal"><a href="#__codelineno-56-30">30</a></span>
<span class="normal"><a href="#__codelineno-56-31">31</a></span>
<span class="normal"><a href="#__codelineno-56-32">32</a></span>
<span class="normal"><a href="#__codelineno-56-33">33</a></span>
<span class="normal"><a href="#__codelineno-56-34">34</a></span>
<span class="normal"><a href="#__codelineno-56-35">35</a></span>
<span class="normal"><a href="#__codelineno-56-36">36</a></span>
<span class="normal"><a href="#__codelineno-56-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a>    <span class="c1"># configuration de l&#39;application</span>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a>        <span class="c1"># description : description du mail envoyé</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a>        <span class="c1"># smtp-server : serveur SMTP</span>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a>        <span class="c1"># smtp-port : port du serveur SMTP</span>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a>        <span class="c1"># from : expéditeur</span>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a>        <span class="c1"># to : destinataire</span>
<a id="__codelineno-56-14" name="__codelineno-56-14"></a>        <span class="c1"># subject : sujet du mail</span>
<a id="__codelineno-56-15" name="__codelineno-56-15"></a>        <span class="c1"># message : message du mail</span>
<a id="__codelineno-56-16" name="__codelineno-56-16"></a>        <span class="s2">&quot;mails&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-56-17" name="__codelineno-56-17"></a>            <span class="p">{</span>
<a id="__codelineno-56-18" name="__codelineno-56-18"></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;mail to gmail via gmail avec smtplib&quot;</span><span class="p">,</span>
<a id="__codelineno-56-19" name="__codelineno-56-19"></a>                <span class="s2">&quot;smtp-server&quot;</span><span class="p">:</span> <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-56-20" name="__codelineno-56-20"></a>                <span class="s2">&quot;smtp-port&quot;</span><span class="p">:</span> <span class="s2">&quot;587&quot;</span><span class="p">,</span>
<a id="__codelineno-56-21" name="__codelineno-56-21"></a>                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-56-22" name="__codelineno-56-22"></a>                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-56-23" name="__codelineno-56-23"></a>                <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;to gmail via gmail avec smtplib&quot;</span><span class="p">,</span>
<a id="__codelineno-56-24" name="__codelineno-56-24"></a>                <span class="c1"># on teste les caractères accentués</span>
<a id="__codelineno-56-25" name="__codelineno-56-25"></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;aglaë séléné</span><span class="se">\n</span><span class="s2">va au marché</span><span class="se">\n</span><span class="s2">acheter des fleurs&quot;</span><span class="p">,</span>
<a id="__codelineno-56-26" name="__codelineno-56-26"></a>                <span class="c1"># smtp avec authentification</span>
<a id="__codelineno-56-27" name="__codelineno-56-27"></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-56-28" name="__codelineno-56-28"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;#6prIlhD&amp;@1QZ3TG&quot;</span><span class="p">,</span>
<a id="__codelineno-56-29" name="__codelineno-56-29"></a>                <span class="c1"># ici, il faut mettre des chemins absolus pour les fichiers attachés</span>
<a id="__codelineno-56-30" name="__codelineno-56-30"></a>                <span class="s2">&quot;attachments&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-56-31" name="__codelineno-56-31"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/attachments/fichier attaché.docx&quot;</span><span class="p">,</span>
<a id="__codelineno-56-32" name="__codelineno-56-32"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/attachments/fichier attaché.pdf&quot;</span><span class="p">,</span>
<a id="__codelineno-56-33" name="__codelineno-56-33"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/attachments/mail attaché 1.eml&quot;</span><span class="p">,</span>
<a id="__codelineno-56-34" name="__codelineno-56-34"></a>                <span class="p">]</span>
<a id="__codelineno-56-35" name="__codelineno-56-35"></a>            <span class="p">}</span>
<a id="__codelineno-56-36" name="__codelineno-56-36"></a>        <span class="p">]</span>
<a id="__codelineno-56-37" name="__codelineno-56-37"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 33, nous avons ajouté un attachement ;
Maintenant nous exécutons de nouveau le script <strong>[smtp/03/main]</strong>. Cela donne le résultat suivant dans la boîte à lettres de l’utilisateur <strong>[pymail2parlexemple@gmail.com]</strong> :</li>
</ul>
<p><img src="images/100000000000055400000286866C36EC.png" style="width:15.77cm;height:7.46cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, le mail reçu ;</li>
<li>en <strong>[2]</strong> : le texte du message ;</li>
<li>en <strong>[3]</strong> : le texte du mail attaché ;</li>
<li>en <strong>[4]</strong> : Thunderbird a trouvé 5 pièces jointes :</li>
<li><strong>[fichier attaché.docx]</strong> ;</li>
<li><strong>[fichier attaché.pdf]</strong> ;</li>
<li><strong>[mail attaché 1.eml]</strong>. Cette pièce jointe est elle-même un mail contenant deux pièces jointes :</li>
<li><strong>[fichier attaché.docx]</strong> ;</li>
<li><strong>[fichier attaché.pdf]</strong> ;</li>
</ul>
<h2 id="216-le-protocole-pop3">21.6. Le protocole POP3</h2>
<h3 id="2161-introduction">21.6.1. Introduction</h3>
<p>Pour lire les mails entreposés dans un serveur de mails, deux protocoles existent :</p>
<ul>
<li>le protocole POP3 (Post Office Protocol) historiquement le 1er protocole mais peu utilisé maintenant ;</li>
<li>le protocole IMAP (Internet Message Access Protocol) protocole plus récent que POP3 et le plus utilisé actuellement ;
Pour découvrir le protocole POP3, nous allons utiliser l’architecture suivante :</li>
</ul>
<p><img src="images/10000001000001F5000000DEBE03EC4B.png" style="width:8.49cm;height:3.761cm;" alt="Image" /></p>
<ul>
<li><strong>[Serveur B]</strong> sera selon les cas :</li>
<li>un serveur POP3 local, implémenté par le serveur de mail <strong>[hMailServer]</strong> ;</li>
<li>le serveur <strong>[</strong><strong>pop.gmail.com</strong><strong>]</strong> qui est le serveur POP3 du gestionnaire de mails <strong>[gmail.com]</strong> ;</li>
<li><strong>[Client A]</strong> sera un client POP3 de diverses formes :</li>
<li>le client <strong>[RawTcpClient]</strong> pour découvrir le protocole POP3 ;</li>
<li>un script Python rejouant le protocole POP3 du client <strong>[RawTcpClient]</strong> ;</li>
<li>un script Python utilisant des modules Python permettant de gérer les pièces attachées ainsi que l&#x27;utilisation d’une connexion chiffrée et authentifiée lorsque le serveur POP3 l&#x27;exige ;</li>
</ul>
<h3 id="2162-decouverte-du-protocole-pop3">21.6.2. Découverte du protocole POP3</h3>
<p>Comme nous l’avons fait avec le protocole SMTP, nous allons découvrir le protocole POP3 à l’aide des logs du serveur de mails <strong>[hMailServer]</strong>. Il faut ici lancer ce serveur.</p>
<p>Avec Thunderbird, nous allons :</p>
<ul>
<li>envoyer un mail à l’utilisateur <strong>[guest@localhost.com]</strong> ;</li>
<li>lire la boîte à lettre de cet utilisateur ;</li>
</ul>
<p><img src="images/1000000000000356000001B978AD1FBC.png" style="width:9.85cm;height:5.091cm;" alt="Image" /></p>
<p><img src="images/1000000000000356000001E2706CE8C1.png" style="width:9.85cm;height:5.561cm;" alt="Image" /></p>
<p>En <strong>[3-6]</strong> ci-dessus, le message reçu par l’utilisateur <strong>[guest@localhost.com]</strong>.</p>
<p>Nous examinons maintenant les logs du serveur <strong>[hMailServer]</strong>. Pour cela nous utilisons l’outil d’administration <strong>[hMailServer Administrator]</strong> :</p>
<p><img src="images/10000000000002980000035A89FE4BF1.png" style="width:7.661cm;height:9.901cm;" alt="Image" /></p>
<p>Les logs POP3 sont les suivants (les dernières lignes dans le fichier de logs du jour) :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-57-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-57-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-57-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-57-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-57-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-57-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-57-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-57-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-57-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-57-10">10</a></span>
<span class="normal"><a href="#__codelineno-57-11">11</a></span>
<span class="normal"><a href="#__codelineno-57-12">12</a></span>
<span class="normal"><a href="#__codelineno-57-13">13</a></span>
<span class="normal"><a href="#__codelineno-57-14">14</a></span>
<span class="normal"><a href="#__codelineno-57-15">15</a></span>
<span class="normal"><a href="#__codelineno-57-16">16</a></span>
<span class="normal"><a href="#__codelineno-57-17">17</a></span>
<span class="normal"><a href="#__codelineno-57-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">35084</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.392&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: +OK Bienvenue sur le serveur POP3 localhost.com&quot;</span>
<a id="__codelineno-57-2" name="__codelineno-57-2"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.405&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: CAPA&quot;</span>
<a id="__codelineno-57-3" name="__codelineno-57-3"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.407&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: +OK CAPA list follows[nl]USER[nl]UIDL[nl]TOP[nl].&quot;</span>
<a id="__codelineno-57-4" name="__codelineno-57-4"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">35076</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.410&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: USER guest&quot;</span>
<a id="__codelineno-57-5" name="__codelineno-57-5"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">35076</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.411&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: +OK Send your password&quot;</span>
<a id="__codelineno-57-6" name="__codelineno-57-6"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.418&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: PASS ***&quot;</span>
<a id="__codelineno-57-7" name="__codelineno-57-7"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.421&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: +OK Mailbox locked and ready&quot;</span>
<a id="__codelineno-57-8" name="__codelineno-57-8"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.423&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: STAT&quot;</span>
<a id="__codelineno-57-9" name="__codelineno-57-9"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.423&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: +OK 1 612&quot;</span>
<a id="__codelineno-57-10" name="__codelineno-57-10"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.426&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: LIST&quot;</span>
<a id="__codelineno-57-11" name="__codelineno-57-11"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.426&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: +OK 1 messages (612 octets)&quot;</span>
<a id="__codelineno-57-12" name="__codelineno-57-12"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.426&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: 1 612[nl].&quot;</span>
<a id="__codelineno-57-13" name="__codelineno-57-13"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">35076</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.427&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: UIDL&quot;</span>
<a id="__codelineno-57-14" name="__codelineno-57-14"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">35076</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.428&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: +OK 1 messages (612 octets)[nl]1 42[nl].&quot;</span>
<a id="__codelineno-57-15" name="__codelineno-57-15"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.435&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: RETR 1&quot;</span>
<a id="__codelineno-57-16" name="__codelineno-57-16"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34968</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.436&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: .&quot;</span>
<a id="__codelineno-57-17" name="__codelineno-57-17"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34924</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.459&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;RECEIVED: QUIT&quot;</span>
<a id="__codelineno-57-18" name="__codelineno-57-18"></a><span class="s2">&quot;POP3D&quot;</span>    <span class="mi">34924</span>    <span class="mi">5</span>    <span class="s2">&quot;2020-07-08 14:19:46.459&quot;</span>    <span class="s2">&quot;127.0.0.1&quot;</span>    <span class="s2">&quot;SENT: +OK POP3 server saying goodbye...&quot;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : le serveur POP3 envoie un message de bienvenue au client (Thunderbird) qui vient de se connecter ;</li>
<li>ligne 2 : le client envoie la commande <strong>[CAPA]</strong> (capabilities) pour demander la listes des commandes qu’il peut utiliser ;</li>
<li>ligne 3 : le serveur lui répond qu’il peut utiliser les commandes <strong>[USER, UIDL, TOP]</strong>. Le serveur POP commence ses réponses par <strong>[+OK]</strong> ou <strong>[-ERR]</strong> pour indiquer qu’il a réussi ou échoué à exécuter la commande du client ;</li>
<li>ligne 4 : le client envoie la commande <strong>[USER guest]</strong> pour indiquer qu’il veut consulter la boîte à lettres de l’utilisateur <strong>[guest]</strong> ;</li>
<li>ligne 5 : le serveur lui répond <strong>[+OK]</strong> et demande le mote de passe de <strong>[guest]</strong> ;</li>
<li>ligne 6 : le client envoie la commande <strong>[PASS password]</strong> pour envoyer le mot de passe de l’utilisateur <strong>[guest]</strong>. Ici le mot de passe est en clair car le serveur POP3 n’a pas imposé de connexion sécurisée. Nous verrons que ce sera différent avec le serveur POP3 de Gmail ;</li>
<li>ligne 7 : le serveur a validé l’ensemble login / mot de passe. Il indique qu’il bloque la boîte à lettres de l’utilisateur <strong>[guest]</strong> ;</li>
<li>ligne 8 : le client lui envoie la commande <strong>[STAT]</strong> qui demande des informations sur la boîte à lettres ;</li>
<li>ligne 9 : le serveur lui répond qu’il y a un message de 612 octets. De façon générale, il répond qu’il y a N messages et donne la taille totale de ces messages ;</li>
<li>ligne 10 : le client envoie la commande <strong>[LIST]</strong>. Cette commande demande la liste des messages ;</li>
<li>ligne 11 : le serveur lui envoie la liste des messages sous la forme suivante :</li>
<li>une ligne récapitulative avec le nombre de messages et leur taille totale ;</li>
<li>une ligne par message indiquant le n° du message et sa taille ;</li>
<li>ligne 13 : le client envoie la commande <strong>[UIDL]</strong> qui demande la liste des messages avec leurs identifiants. En effet, chaque message est repéré par un n° unique au sein du service de mails ;</li>
<li>ligne 14 : la réponse du serveur. On voit ainsi que le message n° 1 dans la liste a l’identifiant 42 ;</li>
<li>ligne 15 : le client envoie la commande <strong>[RETR 1]</strong> qui demande à ce qu’on lui transfère le message n° 1 de la liste ;</li>
<li>ligne 16 : le serveur POP3 le fait ;</li>
<li>ligne 17 : le client envoie la commande <strong>[QUIT]</strong> pour indiquer qu’il va se déconnecter du serveur POP3 ;</li>
<li>ligne 18 : le serveur va lui également fermer sa connexion avec le client mais auparavant il lui envoie un message d’au-revoir ;
Nous allons reproduire maintenant des éléments du dialogue ci-dessus en utilisant le client <strong>[RawTcpClient]</strong> exécuté dans une fenêtre PyCharm :</li>
</ul>
<p><img src="images/10000000000001FC000002BAC1775AE8.png" style="width:5.871cm;height:8.071cm;" alt="Image" /></p>
<p>Le dialogue est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-58-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-58-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-58-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-58-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-58-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-58-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-58-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-58-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-58-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-58-10">10</a></span>
<span class="normal"><a href="#__codelineno-58-11">11</a></span>
<span class="normal"><a href="#__codelineno-58-12">12</a></span>
<span class="normal"><a href="#__codelineno-58-13">13</a></span>
<span class="normal"><a href="#__codelineno-58-14">14</a></span>
<span class="normal"><a href="#__codelineno-58-15">15</a></span>
<span class="normal"><a href="#__codelineno-58-16">16</a></span>
<span class="normal"><a href="#__codelineno-58-17">17</a></span>
<span class="normal"><a href="#__codelineno-58-18">18</a></span>
<span class="normal"><a href="#__codelineno-58-19">19</a></span>
<span class="normal"><a href="#__codelineno-58-20">20</a></span>
<span class="normal"><a href="#__codelineno-58-21">21</a></span>
<span class="normal"><a href="#__codelineno-58-22">22</a></span>
<span class="normal"><a href="#__codelineno-58-23">23</a></span>
<span class="normal"><a href="#__codelineno-58-24">24</a></span>
<span class="normal"><a href="#__codelineno-58-25">25</a></span>
<span class="normal"><a href="#__codelineno-58-26">26</a></span>
<span class="normal"><a href="#__codelineno-58-27">27</a></span>
<span class="normal"><a href="#__codelineno-58-28">28</a></span>
<span class="normal"><a href="#__codelineno-58-29">29</a></span>
<span class="normal"><a href="#__codelineno-58-30">30</a></span>
<span class="normal"><a href="#__codelineno-58-31">31</a></span>
<span class="normal"><a href="#__codelineno-58-32">32</a></span>
<span class="normal"><a href="#__codelineno-58-33">33</a></span>
<span class="normal"><a href="#__codelineno-58-34">34</a></span>
<span class="normal"><a href="#__codelineno-58-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">RawTcpClient</span><span class="o">.</span><span class="n">exe</span> <span class="n">localhost</span> <span class="mi">110</span>
<a id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="n">Client</span> <span class="p">[</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span><span class="p">:</span><span class="mi">63762</span><span class="p">]</span> <span class="n">connecté</span> <span class="n">au</span> <span class="n">serveur</span> <span class="p">[</span><span class="n">localhost</span><span class="o">-</span><span class="mi">110</span><span class="p">]</span>
<a id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="n">Tapez</span> <span class="n">vos</span> <span class="n">commandes</span> <span class="p">(</span><span class="n">quit</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-58-4" name="__codelineno-58-4"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="n">Bienvenue</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">serveur</span> <span class="n">POP3</span> <span class="n">localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="n">USER</span> <span class="n">guest</span>
<a id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="n">Send</span> <span class="n">your</span> <span class="n">password</span><span class="p">]</span>
<a id="__codelineno-58-7" name="__codelineno-58-7"></a><span class="n">PASS</span> <span class="n">guest</span>
<a id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="n">Mailbox</span> <span class="n">locked</span> <span class="ow">and</span> <span class="n">ready</span><span class="p">]</span>
<a id="__codelineno-58-9" name="__codelineno-58-9"></a><span class="n">LIST</span>
<a id="__codelineno-58-10" name="__codelineno-58-10"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="mi">1</span> <span class="n">messages</span> <span class="p">(</span><span class="mi">612</span> <span class="n">octets</span><span class="p">)]</span>
<a id="__codelineno-58-11" name="__codelineno-58-11"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">612</span><span class="p">]</span>
<a id="__codelineno-58-12" name="__codelineno-58-12"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">.</span><span class="p">]</span>
<a id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="n">RETR</span> <span class="mi">1</span>
<a id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="mi">612</span> <span class="n">octets</span><span class="p">]</span>
<a id="__codelineno-58-15" name="__codelineno-58-15"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Return</span><span class="o">-</span><span class="n">Path</span><span class="p">:</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-58-16" name="__codelineno-58-16"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Received</span><span class="p">:</span> <span class="kn">from</span><span class="w"> </span><span class="p">[</span><span class="mf">127.0.0.1</span><span class="p">]</span> <span class="p">(</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span> <span class="p">[</span><span class="mf">127.0.0.1</span><span class="p">])]</span>
<a id="__codelineno-58-17" name="__codelineno-58-17"></a><span class="o">&lt;--</span> <span class="p">[</span>   <span class="n">by</span> <span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span> <span class="k">with</span> <span class="n">ESMTP</span><span class="p">]</span>
<a id="__codelineno-58-18" name="__codelineno-58-18"></a><span class="o">&lt;--</span> <span class="p">[</span>   <span class="p">;</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">8</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">14</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">36</span> <span class="o">+</span><span class="mi">0200</span><span class="p">]</span>
<a id="__codelineno-58-19" name="__codelineno-58-19"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">To</span><span class="p">:</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-58-20" name="__codelineno-58-20"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">From</span><span class="p">:</span> <span class="s2">&quot;guest@localhost.com&quot;</span> <span class="o">&lt;</span><span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-58-21" name="__codelineno-58-21"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Subject</span><span class="p">:</span> <span class="n">protocole</span> <span class="n">POP3</span><span class="p">]</span>
<a id="__codelineno-58-22" name="__codelineno-58-22"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Message</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">ca895136</span><span class="o">-</span><span class="mi">25</span><span class="n">c5</span><span class="o">-</span><span class="mf">411e-373</span><span class="n">a</span><span class="o">-</span><span class="n">a68cbd0eca51</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-58-23" name="__codelineno-58-23"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">8</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">14</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">33</span> <span class="o">+</span><span class="mi">0200</span><span class="p">]</span>
<a id="__codelineno-58-24" name="__codelineno-58-24"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="n">Windows</span> <span class="n">NT</span> <span class="mf">10.0</span><span class="p">;</span> <span class="n">WOW64</span><span class="p">;</span> <span class="n">rv</span><span class="p">:</span><span class="mf">68.0</span><span class="p">)</span> <span class="n">Gecko</span><span class="o">/</span><span class="mi">20100101</span><span class="p">]</span>
<a id="__codelineno-58-25" name="__codelineno-58-25"></a><span class="o">&lt;--</span> <span class="p">[</span> <span class="n">Thunderbird</span><span class="o">/</span><span class="mf">68.10.0</span><span class="p">]</span>
<a id="__codelineno-58-26" name="__codelineno-58-26"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">MIME</span><span class="o">-</span><span class="n">Version</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">]</span>
<a id="__codelineno-58-27" name="__codelineno-58-27"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="p">;</span> <span class="nb">format</span><span class="o">=</span><span class="n">flowed</span><span class="p">]</span>
<a id="__codelineno-58-28" name="__codelineno-58-28"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Content</span><span class="o">-</span><span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="mi">8</span><span class="n">bit</span><span class="p">]</span>
<a id="__codelineno-58-29" name="__codelineno-58-29"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Content</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span> <span class="n">fr</span><span class="p">]</span>
<a id="__codelineno-58-30" name="__codelineno-58-30"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-58-31" name="__codelineno-58-31"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">ceci</span> <span class="n">est</span> <span class="n">un</span> <span class="n">test</span> <span class="n">pour</span> <span class="n">découvrir</span> <span class="n">le</span> <span class="n">protocole</span> <span class="n">POP3</span><span class="p">]</span>
<a id="__codelineno-58-32" name="__codelineno-58-32"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-58-33" name="__codelineno-58-33"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">.</span><span class="p">]</span>
<a id="__codelineno-58-34" name="__codelineno-58-34"></a><span class="n">QUIT</span>
<a id="__codelineno-58-35" name="__codelineno-58-35"></a><span class="n">Fin</span> <span class="n">de</span> <span class="n">la</span> <span class="n">connexion</span> <span class="n">avec</span> <span class="n">le</span> <span class="n">serveur</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : on ouvre une connexion avec le port 110 de la machine <strong>[localhost]</strong>. C’est là qu’opère le service POP3 de <strong>[hMailServer]</strong> ;</li>
<li>aux lignes 5, 7, 9, 13, 34, nous utilisons les commandes <strong>[USER, PASS, LIST, RETR, QUIT]</strong> ;</li>
<li>ligne 4 : le message de bienvenue du serveur POP3 ;</li>
<li>ligne 5 : on indique qu’on veut accéder à la boîte à lettres de l’utilisateur <strong>[guest]</strong> ;</li>
<li>ligne 7 : on envoie le mot de passe de l’utilisateur <strong>[guest]</strong> en clair ;</li>
<li>ligne 9 : on demande la liste des messages de la boîte à lettres ;</li>
<li>ligne 13 : on demande le message n° 1 ;</li>
<li>lignes 14-33 : le serveur POP3 envoie le message n° 1 ;</li>
<li>
<p>ligne 34 : on termine la session ;
Voici un résumé de quelques commandes courantes acceptées par un serveur POP3 :</p>
</li>
<li>
<p>la commande <strong>[USER]</strong> sert à définir l’utilisateur dont on veut lire la boîte mail ;</p>
</li>
<li>la commande <strong>[PASS]</strong> sert à définir son mot de passe ;</li>
<li>la commande <strong>[LIST]</strong> demande la liste des messages présents dans la boîte à lettres de l’utilisateur ;</li>
<li>la commande <strong>[RETR]</strong> demande à voir le message dont on passe le n° ;</li>
<li>la commande <strong>[DELE]</strong> demande la suppression du message dont on passe le n° ;</li>
<li>
<p>la commande <strong>[QUIT]</strong> indique au serveur qu’on a terminé ;
La réponse du serveur peut prendre plusieurs formes :</p>
</li>
<li>
<p>une ligne unique commençant par <strong>[+OK]</strong> pour indiquer que la commande précédente du client a réussi ;</p>
</li>
<li>une ligne unique commençant par <strong>[-ERR]</strong> pour indiquer que la commande précédente du client a échoué ;</li>
<li>plusieurs lignes où :</li>
<li>la 1re ligne commence par <strong>[+OK]</strong> ;</li>
<li>la dernière ligne est constituée d’un unique point ;</li>
</ul>
<h3 id="2163-scripts-pop301-un-client-pop3-basique">21.6.3. scripts [pop3/01] : un client POP3 basique</h3>
<p><img src="images/1000000000000143000001A3C17B9BCA.png" style="width:3.721cm;height:4.841cm;" alt="Image" /></p>
<p>Comme le procole POP3 a la même structure que le protocole SMTP, le script <strong>[pop3/01/main.py]</strong> est un portage du script <strong>[smtp/01/main.py]</strong>. Il aura le fichier de configuration <strong>[pop3/01/config.py]</strong> suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-59-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-59-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-59-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-59-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-59-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-59-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-59-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-59-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-59-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-59-10">10</a></span>
<span class="normal"><a href="#__codelineno-59-11">11</a></span>
<span class="normal"><a href="#__codelineno-59-12">12</a></span>
<span class="normal"><a href="#__codelineno-59-13">13</a></span>
<span class="normal"><a href="#__codelineno-59-14">14</a></span>
<span class="normal"><a href="#__codelineno-59-15">15</a></span>
<span class="normal"><a href="#__codelineno-59-16">16</a></span>
<span class="normal"><a href="#__codelineno-59-17">17</a></span>
<span class="normal"><a href="#__codelineno-59-18">18</a></span>
<span class="normal"><a href="#__codelineno-59-19">19</a></span>
<span class="normal"><a href="#__codelineno-59-20">20</a></span>
<span class="normal"><a href="#__codelineno-59-21">21</a></span>
<span class="normal"><a href="#__codelineno-59-22">22</a></span>
<span class="normal"><a href="#__codelineno-59-23">23</a></span>
<span class="normal"><a href="#__codelineno-59-24">24</a></span>
<span class="normal"><a href="#__codelineno-59-25">25</a></span>
<span class="normal"><a href="#__codelineno-59-26">26</a></span>
<span class="normal"><a href="#__codelineno-59-27">27</a></span>
<span class="normal"><a href="#__codelineno-59-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-59-2" name="__codelineno-59-2"></a>    <span class="c1"># les boîtes à lettres dont on relève les mails</span>
<a id="__codelineno-59-3" name="__codelineno-59-3"></a>    <span class="n">mailboxes</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-59-4" name="__codelineno-59-4"></a>        <span class="c1"># server : serveur POP3</span>
<a id="__codelineno-59-5" name="__codelineno-59-5"></a>        <span class="c1"># port : port du serveur POP3</span>
<a id="__codelineno-59-6" name="__codelineno-59-6"></a>        <span class="c1"># user : utilisateur dont on veut lire les messages</span>
<a id="__codelineno-59-7" name="__codelineno-59-7"></a>        <span class="c1"># password : son mot de passe</span>
<a id="__codelineno-59-8" name="__codelineno-59-8"></a>        <span class="c1"># maxmails : le nombre maximum de mails à télécharger</span>
<a id="__codelineno-59-9" name="__codelineno-59-9"></a>        <span class="c1"># timeout : délai d&#39;attente maximal d&#39;une réponse du serveur</span>
<a id="__codelineno-59-10" name="__codelineno-59-10"></a>        <span class="c1"># encoding : encodage des mails reçus</span>
<a id="__codelineno-59-11" name="__codelineno-59-11"></a>        <span class="c1"># delete : si True, alors les mails sont supprimés de la boîte à lettres</span>
<a id="__codelineno-59-12" name="__codelineno-59-12"></a>        <span class="c1"># une fois qu&#39;ils ont été téléchargés localement</span>
<a id="__codelineno-59-13" name="__codelineno-59-13"></a>
<a id="__codelineno-59-14" name="__codelineno-59-14"></a>        <span class="p">{</span>
<a id="__codelineno-59-15" name="__codelineno-59-15"></a>            <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-59-16" name="__codelineno-59-16"></a>            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;110&quot;</span><span class="p">,</span>
<a id="__codelineno-59-17" name="__codelineno-59-17"></a>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;guest&quot;</span><span class="p">,</span>
<a id="__codelineno-59-18" name="__codelineno-59-18"></a>            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;guest&quot;</span><span class="p">,</span>
<a id="__codelineno-59-19" name="__codelineno-59-19"></a>            <span class="s2">&quot;maxmails&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-59-20" name="__codelineno-59-20"></a>            <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
<a id="__codelineno-59-21" name="__codelineno-59-21"></a>            <span class="s2">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
<a id="__codelineno-59-22" name="__codelineno-59-22"></a>            <span class="s2">&quot;delete&quot;</span><span class="p">:</span> <span class="kc">False</span>
<a id="__codelineno-59-23" name="__codelineno-59-23"></a>        <span class="p">}</span>
<a id="__codelineno-59-24" name="__codelineno-59-24"></a>    <span class="p">]</span>
<a id="__codelineno-59-25" name="__codelineno-59-25"></a>    <span class="c1"># on rend la configuration</span>
<a id="__codelineno-59-26" name="__codelineno-59-26"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-59-27" name="__codelineno-59-27"></a>        <span class="s2">&quot;mailboxes&quot;</span><span class="p">:</span> <span class="n">mailboxes</span>
<a id="__codelineno-59-28" name="__codelineno-59-28"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 3-24 : la liste des boîtes à lettres à consulter. Ici il n’y en a qu’une ;</li>
<li>lignes 4-12 : significations des éléments du dictionnaire définissant chacune des boîtes à lettres ;</li>
<li>ligne 15 : le serveur POP3 interrogé est le serveur local <strong>[hMailServer]</strong> ;</li>
<li>lignes 17-18 : on veut lire la boîte à lettres de l’utilisateur <strong>[guest@localhost]</strong> ;</li>
<li>ligne 19 : on lira au plus 10 mails ;</li>
<li>ligne 20 : le client aura un délai d&#x27;attente d&#x27;une réponse du serveur d’au plus 1 seconde ;</li>
<li>ligne 21 : le type d&#x27;encodage des messages lus  ;</li>
<li>ligne 22 : on ne supprimera pas les messages téléchargés ;
Le script <strong>[pop3/01/main.py]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-60-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-60-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-60-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-60-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-60-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-60-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-60-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-60-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-60-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-60-10">10</a></span>
<span class="normal"><a href="#__codelineno-60-11">11</a></span>
<span class="normal"><a href="#__codelineno-60-12">12</a></span>
<span class="normal"><a href="#__codelineno-60-13">13</a></span>
<span class="normal"><a href="#__codelineno-60-14">14</a></span>
<span class="normal"><a href="#__codelineno-60-15">15</a></span>
<span class="normal"><a href="#__codelineno-60-16">16</a></span>
<span class="normal"><a href="#__codelineno-60-17">17</a></span>
<span class="normal"><a href="#__codelineno-60-18">18</a></span>
<span class="normal"><a href="#__codelineno-60-19">19</a></span>
<span class="normal"><a href="#__codelineno-60-20">20</a></span>
<span class="normal"><a href="#__codelineno-60-21">21</a></span>
<span class="normal"><a href="#__codelineno-60-22">22</a></span>
<span class="normal"><a href="#__codelineno-60-23">23</a></span>
<span class="normal"><a href="#__codelineno-60-24">24</a></span>
<span class="normal"><a href="#__codelineno-60-25">25</a></span>
<span class="normal"><a href="#__codelineno-60-26">26</a></span>
<span class="normal"><a href="#__codelineno-60-27">27</a></span>
<span class="normal"><a href="#__codelineno-60-28">28</a></span>
<span class="normal"><a href="#__codelineno-60-29">29</a></span>
<span class="normal"><a href="#__codelineno-60-30">30</a></span>
<span class="normal"><a href="#__codelineno-60-31">31</a></span>
<span class="normal"><a href="#__codelineno-60-32">32</a></span>
<span class="normal"><a href="#__codelineno-60-33">33</a></span>
<span class="normal"><a href="#__codelineno-60-34">34</a></span>
<span class="normal"><a href="#__codelineno-60-35">35</a></span>
<span class="normal"><a href="#__codelineno-60-36">36</a></span>
<span class="normal"><a href="#__codelineno-60-37">37</a></span>
<span class="normal"><a href="#__codelineno-60-38">38</a></span>
<span class="normal"><a href="#__codelineno-60-39">39</a></span>
<span class="normal"><a href="#__codelineno-60-40">40</a></span>
<span class="normal"><a href="#__codelineno-60-41">41</a></span>
<span class="normal"><a href="#__codelineno-60-42">42</a></span>
<span class="normal"><a href="#__codelineno-60-43">43</a></span>
<span class="normal"><a href="#__codelineno-60-44">44</a></span>
<span class="normal"><a href="#__codelineno-60-45">45</a></span>
<span class="normal"><a href="#__codelineno-60-46">46</a></span>
<span class="normal"><a href="#__codelineno-60-47">47</a></span>
<span class="normal"><a href="#__codelineno-60-48">48</a></span>
<span class="normal"><a href="#__codelineno-60-49">49</a></span>
<span class="normal"><a href="#__codelineno-60-50">50</a></span>
<span class="normal"><a href="#__codelineno-60-51">51</a></span>
<span class="normal"><a href="#__codelineno-60-52">52</a></span>
<span class="normal"><a href="#__codelineno-60-53">53</a></span>
<span class="normal"><a href="#__codelineno-60-54">54</a></span>
<span class="normal"><a href="#__codelineno-60-55">55</a></span>
<span class="normal"><a href="#__codelineno-60-56">56</a></span>
<span class="normal"><a href="#__codelineno-60-57">57</a></span>
<span class="normal"><a href="#__codelineno-60-58">58</a></span>
<span class="normal"><a href="#__codelineno-60-59">59</a></span>
<span class="normal"><a href="#__codelineno-60-60">60</a></span>
<span class="normal"><a href="#__codelineno-60-61">61</a></span>
<span class="normal"><a href="#__codelineno-60-62">62</a></span>
<span class="normal"><a href="#__codelineno-60-63">63</a></span>
<span class="normal"><a href="#__codelineno-60-64">64</a></span>
<span class="normal"><a href="#__codelineno-60-65">65</a></span>
<span class="normal"><a href="#__codelineno-60-66">66</a></span>
<span class="normal"><a href="#__codelineno-60-67">67</a></span>
<span class="normal"><a href="#__codelineno-60-68">68</a></span>
<span class="normal"><a href="#__codelineno-60-69">69</a></span>
<span class="normal"><a href="#__codelineno-60-70">70</a></span>
<span class="normal"><a href="#__codelineno-60-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="c1"># imports</span>
<a id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<a id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">socket</span>
<a id="__codelineno-60-4" name="__codelineno-60-4"></a>
<a id="__codelineno-60-5" name="__codelineno-60-5"></a>
<a id="__codelineno-60-6" name="__codelineno-60-6"></a><span class="c1"># -----------------------------------------------------------------------</span>
<a id="__codelineno-60-7" name="__codelineno-60-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">readmails</span><span class="p">(</span><span class="n">mailbox</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-60-8" name="__codelineno-60-8"></a>    <span class="c1"># lit la boîte mail décrite par le dictionnaire [mailbox]</span>
<a id="__codelineno-60-9" name="__codelineno-60-9"></a>    <span class="c1"># si verbose=True, fait un suivi des échanges client-serveur</span>
<a id="__codelineno-60-10" name="__codelineno-60-10"></a><span class="err">…</span>
<a id="__codelineno-60-11" name="__codelineno-60-11"></a>
<a id="__codelineno-60-12" name="__codelineno-60-12"></a>
<a id="__codelineno-60-13" name="__codelineno-60-13"></a><span class="c1"># --------------------------------------------------------------------------</span>
<a id="__codelineno-60-14" name="__codelineno-60-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">send_command</span><span class="p">(</span><span class="n">mailbox</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">connexion</span><span class="p">:</span> <span class="n">socket</span><span class="p">,</span> <span class="n">commande</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">with_rclf</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-60-15" name="__codelineno-60-15"></a>    <span class="c1"># envoie commande dans le canal connexion</span>
<a id="__codelineno-60-16" name="__codelineno-60-16"></a>    <span class="c1"># mode verbeux si verbose=True</span>
<a id="__codelineno-60-17" name="__codelineno-60-17"></a>    <span class="c1"># si with_rclf=True, ajoute la séquence rclf à échange</span>
<a id="__codelineno-60-18" name="__codelineno-60-18"></a>    <span class="c1"># rend la 1ère ligne de la réponse</span>
<a id="__codelineno-60-19" name="__codelineno-60-19"></a><span class="err">…</span>
<a id="__codelineno-60-20" name="__codelineno-60-20"></a>
<a id="__codelineno-60-21" name="__codelineno-60-21"></a>
<a id="__codelineno-60-22" name="__codelineno-60-22"></a><span class="c1"># --------------------------------------------------------------------------</span>
<a id="__codelineno-60-23" name="__codelineno-60-23"></a><span class="k">def</span><span class="w"> </span><span class="nf">affiche</span><span class="p">(</span><span class="n">echange</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sens</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-60-24" name="__codelineno-60-24"></a>    <span class="err">…</span>
<a id="__codelineno-60-25" name="__codelineno-60-25"></a>
<a id="__codelineno-60-26" name="__codelineno-60-26"></a>
<a id="__codelineno-60-27" name="__codelineno-60-27"></a><span class="c1"># main ----------------------------------------------------------------</span>
<a id="__codelineno-60-28" name="__codelineno-60-28"></a>
<a id="__codelineno-60-29" name="__codelineno-60-29"></a><span class="c1"># client POP3 (Post Office Protocol) permettant de lire des messages d&#39;une boîte à lettres</span>
<a id="__codelineno-60-30" name="__codelineno-60-30"></a><span class="c1"># protocole de communication POP3 client-serveur</span>
<a id="__codelineno-60-31" name="__codelineno-60-31"></a><span class="c1"># -&gt; client se connecte sur le port 110 du serveur smtp</span>
<a id="__codelineno-60-32" name="__codelineno-60-32"></a><span class="c1"># &lt;- serveur lui envoie un message de bienvenue</span>
<a id="__codelineno-60-33" name="__codelineno-60-33"></a><span class="c1"># -&gt; client envoie la commande USER utilisateur</span>
<a id="__codelineno-60-34" name="__codelineno-60-34"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-60-35" name="__codelineno-60-35"></a><span class="c1"># -&gt; client envoie la commande PASS mot_de_passe</span>
<a id="__codelineno-60-36" name="__codelineno-60-36"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-60-37" name="__codelineno-60-37"></a><span class="c1"># -&gt; client envoie la commande LIST</span>
<a id="__codelineno-60-38" name="__codelineno-60-38"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-60-39" name="__codelineno-60-39"></a><span class="c1"># -&gt; client envoie la commande RETR n° pour chacun des mails</span>
<a id="__codelineno-60-40" name="__codelineno-60-40"></a><span class="c1"># &lt;- serveur répond OK ou non. Si OK envoie le contenu du mail demandé</span>
<a id="__codelineno-60-41" name="__codelineno-60-41"></a><span class="c1"># -&gt; serveur envoie ttes les lignes du mail et termine avec une ligne contenant le</span>
<a id="__codelineno-60-42" name="__codelineno-60-42"></a><span class="c1"># seul caractère .</span>
<a id="__codelineno-60-43" name="__codelineno-60-43"></a><span class="c1"># -&gt; client envoie la commande DELE n° pour supprimer un mail</span>
<a id="__codelineno-60-44" name="__codelineno-60-44"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-60-45" name="__codelineno-60-45"></a><span class="c1"># # -&gt; client envoie la commande QUIT pour terminer le dialogue avec le serveur</span>
<a id="__codelineno-60-46" name="__codelineno-60-46"></a><span class="c1"># &lt;- serveur répond OK ou non</span>
<a id="__codelineno-60-47" name="__codelineno-60-47"></a><span class="c1"># les réponses du serveur ont la forme +OK texte où -ERR texte</span>
<a id="__codelineno-60-48" name="__codelineno-60-48"></a><span class="c1"># La réponse peut comporter plusieurs lignes. Alors la dernière est constituée d&#39;un unique point</span>
<a id="__codelineno-60-49" name="__codelineno-60-49"></a><span class="c1"># les lignes de texte échangées doivent se terminer par les caractères RC(#13) et LF(#10)</span>
<a id="__codelineno-60-50" name="__codelineno-60-50"></a><span class="c1"># </span>
<a id="__codelineno-60-51" name="__codelineno-60-51"></a>
<a id="__codelineno-60-52" name="__codelineno-60-52"></a><span class="c1"># on récupère la configuration de l&#39;application</span>
<a id="__codelineno-60-53" name="__codelineno-60-53"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-60-54" name="__codelineno-60-54"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-60-55" name="__codelineno-60-55"></a>
<a id="__codelineno-60-56" name="__codelineno-60-56"></a><span class="c1"># on traite les boîtes mail une par une</span>
<a id="__codelineno-60-57" name="__codelineno-60-57"></a><span class="k">for</span> <span class="n">mailbox</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;mailboxes&#39;</span><span class="p">]:</span>
<a id="__codelineno-60-58" name="__codelineno-60-58"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-60-59" name="__codelineno-60-59"></a>        <span class="c1"># affichage console</span>
<a id="__codelineno-60-60" name="__codelineno-60-60"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-60-61" name="__codelineno-60-61"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-60-62" name="__codelineno-60-62"></a>            <span class="sa">f</span><span class="s2">&quot;Lecture de la boîte mail POP3 </span><span class="si">{</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-60-63" name="__codelineno-60-63"></a>        <span class="c1"># lecture de la boîte mail en mode verbeux</span>
<a id="__codelineno-60-64" name="__codelineno-60-64"></a>        <span class="n">readmails</span><span class="p">(</span><span class="n">mailbox</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-60-65" name="__codelineno-60-65"></a>        <span class="c1"># fin</span>
<a id="__codelineno-60-66" name="__codelineno-60-66"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lecture terminée...&quot;</span><span class="p">)</span>
<a id="__codelineno-60-67" name="__codelineno-60-67"></a>    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-60-68" name="__codelineno-60-68"></a>        <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-60-69" name="__codelineno-60-69"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-60-70" name="__codelineno-60-70"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-60-71" name="__codelineno-60-71"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<p>Comme nous l’avons dit, <strong>[pop3/01/main.py]</strong> est un portage du script <strong>[smtp/01/main.py]</strong> que nous avons déjà commenté. Nous ne commenterons que les principales différences :</p>
<ul>
<li>ligne 64 : la fonction <strong>[readmails]</strong> est chargée de lire les mails d&#x27;une boîte aux lettres. Les informations pour se connecter à cette boîte à lettres sont dans le dictionnaire <strong>[mailbox]</strong>. Le second paramètre <strong>[True]</strong> est le paramètre <strong>[Verbose]</strong> qui demande ici un suivi des échanges client / serveur ;
La fonction <strong>[readmails]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-61-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-61-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-61-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-61-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-61-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-61-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-61-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-61-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-61-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-61-10">10</a></span>
<span class="normal"><a href="#__codelineno-61-11">11</a></span>
<span class="normal"><a href="#__codelineno-61-12">12</a></span>
<span class="normal"><a href="#__codelineno-61-13">13</a></span>
<span class="normal"><a href="#__codelineno-61-14">14</a></span>
<span class="normal"><a href="#__codelineno-61-15">15</a></span>
<span class="normal"><a href="#__codelineno-61-16">16</a></span>
<span class="normal"><a href="#__codelineno-61-17">17</a></span>
<span class="normal"><a href="#__codelineno-61-18">18</a></span>
<span class="normal"><a href="#__codelineno-61-19">19</a></span>
<span class="normal"><a href="#__codelineno-61-20">20</a></span>
<span class="normal"><a href="#__codelineno-61-21">21</a></span>
<span class="normal"><a href="#__codelineno-61-22">22</a></span>
<span class="normal"><a href="#__codelineno-61-23">23</a></span>
<span class="normal"><a href="#__codelineno-61-24">24</a></span>
<span class="normal"><a href="#__codelineno-61-25">25</a></span>
<span class="normal"><a href="#__codelineno-61-26">26</a></span>
<span class="normal"><a href="#__codelineno-61-27">27</a></span>
<span class="normal"><a href="#__codelineno-61-28">28</a></span>
<span class="normal"><a href="#__codelineno-61-29">29</a></span>
<span class="normal"><a href="#__codelineno-61-30">30</a></span>
<span class="normal"><a href="#__codelineno-61-31">31</a></span>
<span class="normal"><a href="#__codelineno-61-32">32</a></span>
<span class="normal"><a href="#__codelineno-61-33">33</a></span>
<span class="normal"><a href="#__codelineno-61-34">34</a></span>
<span class="normal"><a href="#__codelineno-61-35">35</a></span>
<span class="normal"><a href="#__codelineno-61-36">36</a></span>
<span class="normal"><a href="#__codelineno-61-37">37</a></span>
<span class="normal"><a href="#__codelineno-61-38">38</a></span>
<span class="normal"><a href="#__codelineno-61-39">39</a></span>
<span class="normal"><a href="#__codelineno-61-40">40</a></span>
<span class="normal"><a href="#__codelineno-61-41">41</a></span>
<span class="normal"><a href="#__codelineno-61-42">42</a></span>
<span class="normal"><a href="#__codelineno-61-43">43</a></span>
<span class="normal"><a href="#__codelineno-61-44">44</a></span>
<span class="normal"><a href="#__codelineno-61-45">45</a></span>
<span class="normal"><a href="#__codelineno-61-46">46</a></span>
<span class="normal"><a href="#__codelineno-61-47">47</a></span>
<span class="normal"><a href="#__codelineno-61-48">48</a></span>
<span class="normal"><a href="#__codelineno-61-49">49</a></span>
<span class="normal"><a href="#__codelineno-61-50">50</a></span>
<span class="normal"><a href="#__codelineno-61-51">51</a></span>
<span class="normal"><a href="#__codelineno-61-52">52</a></span>
<span class="normal"><a href="#__codelineno-61-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="c1"># -----------------------------------------------------------------------</span>
<a id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">readmails</span><span class="p">(</span><span class="n">mailbox</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-61-3" name="__codelineno-61-3"></a>    <span class="c1"># lit les mails de la boîte mail décrite par le dictionnaire [mailbox]</span>
<a id="__codelineno-61-4" name="__codelineno-61-4"></a>    <span class="c1"># si verbose=True, fait un suivi des échanges client-serveur</span>
<a id="__codelineno-61-5" name="__codelineno-61-5"></a>
<a id="__codelineno-61-6" name="__codelineno-61-6"></a>    <span class="c1"># on isole les paramètres de la boîte mail</span>
<a id="__codelineno-61-7" name="__codelineno-61-7"></a>    <span class="c1"># on suppose que le dictionnaire [mailbox] est valide</span>
<a id="__codelineno-61-8" name="__codelineno-61-8"></a>    <span class="n">server</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span>
<a id="__codelineno-61-9" name="__codelineno-61-9"></a>    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">])</span>
<a id="__codelineno-61-10" name="__codelineno-61-10"></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
<a id="__codelineno-61-11" name="__codelineno-61-11"></a>    <span class="n">password</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
<a id="__codelineno-61-12" name="__codelineno-61-12"></a>    <span class="n">maxmails</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;maxmails&#39;</span><span class="p">]</span>
<a id="__codelineno-61-13" name="__codelineno-61-13"></a>    <span class="n">delete</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;delete&#39;</span><span class="p">]</span>
<a id="__codelineno-61-14" name="__codelineno-61-14"></a>    <span class="n">timeout</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;timeout&#39;</span><span class="p">]</span>
<a id="__codelineno-61-15" name="__codelineno-61-15"></a>
<a id="__codelineno-61-16" name="__codelineno-61-16"></a>    <span class="c1"># on laisse remonter les erreurs système</span>
<a id="__codelineno-61-17" name="__codelineno-61-17"></a>    <span class="n">connexion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-61-18" name="__codelineno-61-18"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-61-19" name="__codelineno-61-19"></a>        <span class="c1"># ouverture d&#39;une connexion sur le port [port] de [server] avec un timeout d&#39;une seconde</span>
<a id="__codelineno-61-20" name="__codelineno-61-20"></a>        <span class="n">connexion</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
<a id="__codelineno-61-21" name="__codelineno-61-21"></a>
<a id="__codelineno-61-22" name="__codelineno-61-22"></a>        <span class="c1"># connexion représente un flux de communication bidirectionnel</span>
<a id="__codelineno-61-23" name="__codelineno-61-23"></a>        <span class="c1"># entre le client (ce programme) et le serveur pop3 contacté</span>
<a id="__codelineno-61-24" name="__codelineno-61-24"></a>        <span class="c1"># ce canal est utilisé pour les échanges de commandes et d&#39;informations</span>
<a id="__codelineno-61-25" name="__codelineno-61-25"></a>
<a id="__codelineno-61-26" name="__codelineno-61-26"></a>        <span class="c1"># lecture msg de bienvenue</span>
<a id="__codelineno-61-27" name="__codelineno-61-27"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">mailbox</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-61-28" name="__codelineno-61-28"></a>        <span class="c1"># cmde USER</span>
<a id="__codelineno-61-29" name="__codelineno-61-29"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">mailbox</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;USER </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-61-30" name="__codelineno-61-30"></a>        <span class="c1"># cmde PASS</span>
<a id="__codelineno-61-31" name="__codelineno-61-31"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">mailbox</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;PASS </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-61-32" name="__codelineno-61-32"></a>        <span class="c1"># cmde LIST</span>
<a id="__codelineno-61-33" name="__codelineno-61-33"></a>        <span class="n">première_ligne</span> <span class="o">=</span> <span class="n">send_command</span><span class="p">(</span><span class="n">mailbox</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="s2">&quot;LIST&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-61-34" name="__codelineno-61-34"></a>        <span class="c1"># analyse de la 1ère ligne pour connaître le nbre de messages</span>
<a id="__codelineno-61-35" name="__codelineno-61-35"></a>        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\+OK (\d+)&quot;</span><span class="p">,</span> <span class="n">première_ligne</span><span class="p">)</span>
<a id="__codelineno-61-36" name="__codelineno-61-36"></a>        <span class="n">nbmessages</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-61-37" name="__codelineno-61-37"></a>        <span class="c1"># on boucle sur les messages</span>
<a id="__codelineno-61-38" name="__codelineno-61-38"></a>        <span class="n">imessage</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-61-39" name="__codelineno-61-39"></a>        <span class="k">while</span> <span class="n">imessage</span> <span class="o">&lt;</span> <span class="n">nbmessages</span> <span class="ow">and</span> <span class="n">imessage</span> <span class="o">&lt;</span> <span class="n">maxmails</span><span class="p">:</span>
<a id="__codelineno-61-40" name="__codelineno-61-40"></a>            <span class="c1"># cmde RETR</span>
<a id="__codelineno-61-41" name="__codelineno-61-41"></a>            <span class="n">send_command</span><span class="p">(</span><span class="n">mailbox</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;RETR </span><span class="si">{</span><span class="n">imessage</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-61-42" name="__codelineno-61-42"></a>            <span class="c1"># cmde DELE</span>
<a id="__codelineno-61-43" name="__codelineno-61-43"></a>            <span class="k">if</span> <span class="n">delete</span><span class="p">:</span>
<a id="__codelineno-61-44" name="__codelineno-61-44"></a>                <span class="n">send_command</span><span class="p">(</span><span class="n">mailbox</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;DELE </span><span class="si">{</span><span class="n">imessage</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-61-45" name="__codelineno-61-45"></a>            <span class="c1"># msg suivant</span>
<a id="__codelineno-61-46" name="__codelineno-61-46"></a>            <span class="n">imessage</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-61-47" name="__codelineno-61-47"></a>        <span class="c1"># cmde QUIT</span>
<a id="__codelineno-61-48" name="__codelineno-61-48"></a>        <span class="n">send_command</span><span class="p">(</span><span class="n">mailbox</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="s2">&quot;QUIT&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-61-49" name="__codelineno-61-49"></a>        <span class="c1"># fin</span>
<a id="__codelineno-61-50" name="__codelineno-61-50"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-61-51" name="__codelineno-61-51"></a>        <span class="c1"># fermeture connexion</span>
<a id="__codelineno-61-52" name="__codelineno-61-52"></a>        <span class="k">if</span> <span class="n">connexion</span><span class="p">:</span>
<a id="__codelineno-61-53" name="__codelineno-61-53"></a>            <span class="n">connexion</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 8-14 : on récupère les informations de configuration de la boîte à lettres à consulter ;</li>
<li>lignes 19-20 : ouverture d’une connexion avec le serveur POP3 ;</li>
<li>lignes 26-27 : lecture du message de bienvenue envoyé par le serveur ;</li>
<li>lignes 28-29 : on envoie la commande <strong>[USER]</strong> pour identifier l’utilisateur dont on veut les mails ;</li>
<li>lignes 30-31 : on envoie la commande <strong>[PASS]</strong> pour donner le mot de passe de cet utilisateur ;</li>
<li>lignes 32-33 : on envoie la commande <strong>[LIST]</strong> pour savoir combien il y a de mails dans la boîte à lettres de cet utilisateur. La fonction <strong>[sendCommand]</strong> renvoie la première ligne de la réponse du serveur. Dans celle-ci le serveur indique combien il y a de messages dans la boîte à lettres ;</li>
<li>lignes 34-36 : on récupère le nombre de messages dans la 1re ligne de la réponse ;</li>
<li>lignes 39-46 : on boucle sur chacun des messages. Pour chacun d’eux on émet deux commandes :</li>
<li>RETR i : pour récupérer le message n° i (lignes 40-41) ;</li>
<li>DELE i : pour le supprimer si la configuration demande que les messages lus soient supprimés du serveur (lignes 43-44) ;</li>
<li>lignes 47-48 : on envoie la commande <strong>[QUIT]</strong> pour dire au serveur qu’on a terminé ;
La fonction <strong>[send_command]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-62-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-62-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-62-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-62-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-62-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-62-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-62-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-62-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-62-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-62-10">10</a></span>
<span class="normal"><a href="#__codelineno-62-11">11</a></span>
<span class="normal"><a href="#__codelineno-62-12">12</a></span>
<span class="normal"><a href="#__codelineno-62-13">13</a></span>
<span class="normal"><a href="#__codelineno-62-14">14</a></span>
<span class="normal"><a href="#__codelineno-62-15">15</a></span>
<span class="normal"><a href="#__codelineno-62-16">16</a></span>
<span class="normal"><a href="#__codelineno-62-17">17</a></span>
<span class="normal"><a href="#__codelineno-62-18">18</a></span>
<span class="normal"><a href="#__codelineno-62-19">19</a></span>
<span class="normal"><a href="#__codelineno-62-20">20</a></span>
<span class="normal"><a href="#__codelineno-62-21">21</a></span>
<span class="normal"><a href="#__codelineno-62-22">22</a></span>
<span class="normal"><a href="#__codelineno-62-23">23</a></span>
<span class="normal"><a href="#__codelineno-62-24">24</a></span>
<span class="normal"><a href="#__codelineno-62-25">25</a></span>
<span class="normal"><a href="#__codelineno-62-26">26</a></span>
<span class="normal"><a href="#__codelineno-62-27">27</a></span>
<span class="normal"><a href="#__codelineno-62-28">28</a></span>
<span class="normal"><a href="#__codelineno-62-29">29</a></span>
<span class="normal"><a href="#__codelineno-62-30">30</a></span>
<span class="normal"><a href="#__codelineno-62-31">31</a></span>
<span class="normal"><a href="#__codelineno-62-32">32</a></span>
<span class="normal"><a href="#__codelineno-62-33">33</a></span>
<span class="normal"><a href="#__codelineno-62-34">34</a></span>
<span class="normal"><a href="#__codelineno-62-35">35</a></span>
<span class="normal"><a href="#__codelineno-62-36">36</a></span>
<span class="normal"><a href="#__codelineno-62-37">37</a></span>
<span class="normal"><a href="#__codelineno-62-38">38</a></span>
<span class="normal"><a href="#__codelineno-62-39">39</a></span>
<span class="normal"><a href="#__codelineno-62-40">40</a></span>
<span class="normal"><a href="#__codelineno-62-41">41</a></span>
<span class="normal"><a href="#__codelineno-62-42">42</a></span>
<span class="normal"><a href="#__codelineno-62-43">43</a></span>
<span class="normal"><a href="#__codelineno-62-44">44</a></span>
<span class="normal"><a href="#__codelineno-62-45">45</a></span>
<span class="normal"><a href="#__codelineno-62-46">46</a></span>
<span class="normal"><a href="#__codelineno-62-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1"></a><span class="c1"># --------------------------------------------------------------------------</span>
<a id="__codelineno-62-2" name="__codelineno-62-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">send_command</span><span class="p">(</span><span class="n">mailbox</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">connexion</span><span class="p">:</span> <span class="n">socket</span><span class="p">,</span> <span class="n">commande</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">with_rclf</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-62-3" name="__codelineno-62-3"></a>    <span class="c1"># envoie commande dans le canal connexion</span>
<a id="__codelineno-62-4" name="__codelineno-62-4"></a>    <span class="c1"># mode verbeux si verbose=True</span>
<a id="__codelineno-62-5" name="__codelineno-62-5"></a>    <span class="c1"># si with_rclf=True, ajoute la séquence rclf à échange</span>
<a id="__codelineno-62-6" name="__codelineno-62-6"></a>    <span class="c1"># rend la 1ère ligne de la réponse</span>
<a id="__codelineno-62-7" name="__codelineno-62-7"></a>
<a id="__codelineno-62-8" name="__codelineno-62-8"></a>    <span class="c1"># marque de fin de ligne</span>
<a id="__codelineno-62-9" name="__codelineno-62-9"></a>    <span class="k">if</span> <span class="n">with_rclf</span><span class="p">:</span>
<a id="__codelineno-62-10" name="__codelineno-62-10"></a>        <span class="n">rclf</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
<a id="__codelineno-62-11" name="__codelineno-62-11"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-62-12" name="__codelineno-62-12"></a>        <span class="n">rclf</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-62-13" name="__codelineno-62-13"></a>    <span class="c1"># envoi commande si non vide</span>
<a id="__codelineno-62-14" name="__codelineno-62-14"></a>    <span class="k">if</span> <span class="n">commande</span><span class="p">:</span>
<a id="__codelineno-62-15" name="__codelineno-62-15"></a>        <span class="n">connexion</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">bytearray</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">commande</span><span class="si">}{</span><span class="n">rclf</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
<a id="__codelineno-62-16" name="__codelineno-62-16"></a>        <span class="c1"># écho éventuel</span>
<a id="__codelineno-62-17" name="__codelineno-62-17"></a>        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-62-18" name="__codelineno-62-18"></a>            <span class="n">affiche</span><span class="p">(</span><span class="n">commande</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-62-19" name="__codelineno-62-19"></a>    <span class="c1"># lecture de la socket comme si elle était un fichier texte</span>
<a id="__codelineno-62-20" name="__codelineno-62-20"></a>    <span class="n">encoding</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;encoding&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
<a id="__codelineno-62-21" name="__codelineno-62-21"></a>    <span class="n">file</span> <span class="o">=</span> <span class="n">connexion</span><span class="o">.</span><span class="n">makefile</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
<a id="__codelineno-62-22" name="__codelineno-62-22"></a>    <span class="c1"># on exploite ce fichier ligne par ligne</span>
<a id="__codelineno-62-23" name="__codelineno-62-23"></a>    <span class="c1"># lecture 1ère ligne</span>
<a id="__codelineno-62-24" name="__codelineno-62-24"></a>    <span class="n">première_ligne</span> <span class="o">=</span> <span class="n">réponse</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-62-25" name="__codelineno-62-25"></a>    <span class="c1"># mode verbeux ?</span>
<a id="__codelineno-62-26" name="__codelineno-62-26"></a>    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-62-27" name="__codelineno-62-27"></a>        <span class="n">affiche</span><span class="p">(</span><span class="n">première_ligne</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-62-28" name="__codelineno-62-28"></a>    <span class="c1"># récupération code erreur</span>
<a id="__codelineno-62-29" name="__codelineno-62-29"></a>    <span class="n">code_erreur</span> <span class="o">=</span> <span class="n">réponse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-62-30" name="__codelineno-62-30"></a>    <span class="k">if</span> <span class="n">code_erreur</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">:</span>
<a id="__codelineno-62-31" name="__codelineno-62-31"></a>        <span class="c1"># il y a eu une erreur</span>
<a id="__codelineno-62-32" name="__codelineno-62-32"></a>        <span class="k">raise</span> <span class="ne">BaseException</span><span class="p">(</span><span class="n">réponse</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
<a id="__codelineno-62-33" name="__codelineno-62-33"></a>    <span class="c1"># cas particulier des réponses à plusieurs lignes LIST, RETR</span>
<a id="__codelineno-62-34" name="__codelineno-62-34"></a>    <span class="n">cmd</span> <span class="o">=</span> <span class="n">commande</span><span class="o">.</span><span class="n">lower</span><span class="p">()[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-62-35" name="__codelineno-62-35"></a>    <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;list&quot;</span> <span class="ow">or</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s2">&quot;retr&quot;</span><span class="p">:</span>
<a id="__codelineno-62-36" name="__codelineno-62-36"></a>        <span class="c1"># dernière ligne de la réponse ?</span>
<a id="__codelineno-62-37" name="__codelineno-62-37"></a>        <span class="n">dernière_ligne</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-62-38" name="__codelineno-62-38"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">dernière_ligne</span><span class="p">:</span>
<a id="__codelineno-62-39" name="__codelineno-62-39"></a>            <span class="c1"># lecture ligne suivante</span>
<a id="__codelineno-62-40" name="__codelineno-62-40"></a>            <span class="n">ligne_suivante</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-62-41" name="__codelineno-62-41"></a>            <span class="c1"># mode verbeux ?</span>
<a id="__codelineno-62-42" name="__codelineno-62-42"></a>            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
<a id="__codelineno-62-43" name="__codelineno-62-43"></a>                <span class="n">affiche</span><span class="p">(</span><span class="n">ligne_suivante</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-62-44" name="__codelineno-62-44"></a>            <span class="c1"># dernière ligne ?</span>
<a id="__codelineno-62-45" name="__codelineno-62-45"></a>            <span class="n">dernière_ligne</span> <span class="o">=</span> <span class="n">ligne_suivante</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span>
<a id="__codelineno-62-46" name="__codelineno-62-46"></a>    <span class="c1"># fini - on rend la 1ère ligne</span>
<a id="__codelineno-62-47" name="__codelineno-62-47"></a>    <span class="k">return</span> <span class="n">première_ligne</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 13-18 : la commande <strong>[command]</strong> n&#x27;est envoyée au serveur POP3 que si elle est non vide. Ce cas est nécessaire pour lire le message de bienvenue du serveur POP3 qu&#x27;il envoie alors même que le client n&#x27;a pas encore envoyé de commandes ;</li>
<li>lignes 19-21 : on lit la socket comme si elle était un fichier texte. Cela va nous permettre d&#x27;utiliser la méthode <strong>[readline]</strong> (ligne 24) et de lire ainsi le message ligne par ligne. On utilise la clé <strong>[encoding]</strong> du dictionnaire <strong>[mailbox]</strong> pour indiquer le codage des lignes qui vont être lues ;</li>
<li>ligne 24 : on lit la 1re ligne de la réponse ;</li>
<li>lignes 28-32 : on gère le cas d&#x27;une éventuelle erreur. Celles-ci sont du type <strong>[-ERR invalid password, -ERR mailbox unknown, -ERR unable to lock mailbox…]</strong> ;</li>
<li>ligne 32 : on lance une exception avec le message de l&#x27;erreur ;</li>
<li>ligne 35 : seules les commandes <strong>[list, retr]</strong> peuvent avoir des réponses à plusieurs lignes ;</li>
<li>lignes 36-45 : dans le cas d&#x27;une réponse à plusieurs lignes, on affiche toutes les lignes reçues (lignes 42-43) jusqu&#x27;à recevoir la dernière ligne (ligne 45) ;</li>
<li>ligne 46 : on rend la 1re ligne lue car dans le cas de la commande <strong>[LIST]</strong>, elle comporte le nombre de messages présents dans la boîte à lettres ;
<strong>Résultats</strong></li>
</ul>
<p>Prenons l&#x27;exemple précédent. Avec Thunderbird, nous avions envoyé le message suivant à l&#x27;utilisateur <strong>[guest@localhost]</strong> (il faut que le serveur hMailServer soit lancé) :</p>
<p><img src="images/100000000000047300000283D01ECC0A.png" style="width:13.151cm;height:7.421cm;" alt="Image" /></p>
<p>A l’exécution, on obtient les résultats suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-63-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-63-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-63-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-63-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-63-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-63-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-63-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-63-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-63-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-63-10">10</a></span>
<span class="normal"><a href="#__codelineno-63-11">11</a></span>
<span class="normal"><a href="#__codelineno-63-12">12</a></span>
<span class="normal"><a href="#__codelineno-63-13">13</a></span>
<span class="normal"><a href="#__codelineno-63-14">14</a></span>
<span class="normal"><a href="#__codelineno-63-15">15</a></span>
<span class="normal"><a href="#__codelineno-63-16">16</a></span>
<span class="normal"><a href="#__codelineno-63-17">17</a></span>
<span class="normal"><a href="#__codelineno-63-18">18</a></span>
<span class="normal"><a href="#__codelineno-63-19">19</a></span>
<span class="normal"><a href="#__codelineno-63-20">20</a></span>
<span class="normal"><a href="#__codelineno-63-21">21</a></span>
<span class="normal"><a href="#__codelineno-63-22">22</a></span>
<span class="normal"><a href="#__codelineno-63-23">23</a></span>
<span class="normal"><a href="#__codelineno-63-24">24</a></span>
<span class="normal"><a href="#__codelineno-63-25">25</a></span>
<span class="normal"><a href="#__codelineno-63-26">26</a></span>
<span class="normal"><a href="#__codelineno-63-27">27</a></span>
<span class="normal"><a href="#__codelineno-63-28">28</a></span>
<span class="normal"><a href="#__codelineno-63-29">29</a></span>
<span class="normal"><a href="#__codelineno-63-30">30</a></span>
<span class="normal"><a href="#__codelineno-63-31">31</a></span>
<span class="normal"><a href="#__codelineno-63-32">32</a></span>
<span class="normal"><a href="#__codelineno-63-33">33</a></span>
<span class="normal"><a href="#__codelineno-63-34">34</a></span>
<span class="normal"><a href="#__codelineno-63-35">35</a></span>
<span class="normal"><a href="#__codelineno-63-36">36</a></span>
<span class="normal"><a href="#__codelineno-63-37">37</a></span>
<span class="normal"><a href="#__codelineno-63-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">inet</span><span class="o">/</span><span class="n">pop3</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-63-2" name="__codelineno-63-2"></a><span class="o">----------------------------------</span>
<a id="__codelineno-63-3" name="__codelineno-63-3"></a><span class="n">Lecture</span> <span class="n">de</span> <span class="n">la</span> <span class="n">boîte</span> <span class="n">mail</span> <span class="n">POP3</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="p">:</span><span class="mi">110</span>
<a id="__codelineno-63-4" name="__codelineno-63-4"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="n">Bienvenue</span> <span class="n">sur</span> <span class="n">le</span> <span class="n">serveur</span> <span class="n">POP3</span> <span class="n">localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-63-5" name="__codelineno-63-5"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">USER</span> <span class="n">guest</span><span class="p">]</span>
<a id="__codelineno-63-6" name="__codelineno-63-6"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="n">Send</span> <span class="n">your</span> <span class="n">password</span><span class="p">]</span>
<a id="__codelineno-63-7" name="__codelineno-63-7"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">PASS</span> <span class="n">guest</span><span class="p">]</span>
<a id="__codelineno-63-8" name="__codelineno-63-8"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="n">Mailbox</span> <span class="n">locked</span> <span class="ow">and</span> <span class="n">ready</span><span class="p">]</span>
<a id="__codelineno-63-9" name="__codelineno-63-9"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">LIST</span><span class="p">]</span>
<a id="__codelineno-63-10" name="__codelineno-63-10"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="mi">1</span> <span class="n">messages</span> <span class="p">(</span><span class="mi">612</span> <span class="n">octets</span><span class="p">)]</span>
<a id="__codelineno-63-11" name="__codelineno-63-11"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">612</span><span class="p">]</span>
<a id="__codelineno-63-12" name="__codelineno-63-12"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">.</span><span class="p">]</span>
<a id="__codelineno-63-13" name="__codelineno-63-13"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">RETR</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-63-14" name="__codelineno-63-14"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="mi">612</span> <span class="n">octets</span><span class="p">]</span>
<a id="__codelineno-63-15" name="__codelineno-63-15"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Return</span><span class="o">-</span><span class="n">Path</span><span class="p">:</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-63-16" name="__codelineno-63-16"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Received</span><span class="p">:</span> <span class="kn">from</span><span class="w"> </span><span class="p">[</span><span class="mf">127.0.0.1</span><span class="p">]</span> <span class="p">(</span><span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span> <span class="p">[</span><span class="mf">127.0.0.1</span><span class="p">])]</span>
<a id="__codelineno-63-17" name="__codelineno-63-17"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">by</span> <span class="n">DESKTOP</span><span class="o">-</span><span class="mi">30</span><span class="n">FF5FB</span> <span class="k">with</span> <span class="n">ESMTP</span><span class="p">]</span>
<a id="__codelineno-63-18" name="__codelineno-63-18"></a><span class="o">&lt;--</span> <span class="p">[;</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">8</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">14</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">36</span> <span class="o">+</span><span class="mi">0200</span><span class="p">]</span>
<a id="__codelineno-63-19" name="__codelineno-63-19"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">To</span><span class="p">:</span> <span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span><span class="p">]</span>
<a id="__codelineno-63-20" name="__codelineno-63-20"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">From</span><span class="p">:</span> <span class="s2">&quot;guest@localhost.com&quot;</span> <span class="o">&lt;</span><span class="n">guest</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-63-21" name="__codelineno-63-21"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Subject</span><span class="p">:</span> <span class="n">protocole</span> <span class="n">POP3</span><span class="p">]</span>
<a id="__codelineno-63-22" name="__codelineno-63-22"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Message</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">ca895136</span><span class="o">-</span><span class="mi">25</span><span class="n">c5</span><span class="o">-</span><span class="mf">411e-373</span><span class="n">a</span><span class="o">-</span><span class="n">a68cbd0eca51</span><span class="nd">@localhost</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span><span class="p">]</span>
<a id="__codelineno-63-23" name="__codelineno-63-23"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">8</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">14</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">33</span> <span class="o">+</span><span class="mi">0200</span><span class="p">]</span>
<a id="__codelineno-63-24" name="__codelineno-63-24"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">Mozilla</span><span class="o">/</span><span class="mf">5.0</span> <span class="p">(</span><span class="n">Windows</span> <span class="n">NT</span> <span class="mf">10.0</span><span class="p">;</span> <span class="n">WOW64</span><span class="p">;</span> <span class="n">rv</span><span class="p">:</span><span class="mf">68.0</span><span class="p">)</span> <span class="n">Gecko</span><span class="o">/</span><span class="mi">20100101</span><span class="p">]</span>
<a id="__codelineno-63-25" name="__codelineno-63-25"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Thunderbird</span><span class="o">/</span><span class="mf">68.10.0</span><span class="p">]</span>
<a id="__codelineno-63-26" name="__codelineno-63-26"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">MIME</span><span class="o">-</span><span class="n">Version</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">]</span>
<a id="__codelineno-63-27" name="__codelineno-63-27"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span><span class="p">;</span> <span class="nb">format</span><span class="o">=</span><span class="n">flowed</span><span class="p">]</span>
<a id="__codelineno-63-28" name="__codelineno-63-28"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Content</span><span class="o">-</span><span class="n">Transfer</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="mi">8</span><span class="n">bit</span><span class="p">]</span>
<a id="__codelineno-63-29" name="__codelineno-63-29"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">Content</span><span class="o">-</span><span class="n">Language</span><span class="p">:</span> <span class="n">fr</span><span class="p">]</span>
<a id="__codelineno-63-30" name="__codelineno-63-30"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-63-31" name="__codelineno-63-31"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="n">ceci</span> <span class="n">est</span> <span class="n">un</span> <span class="n">test</span> <span class="n">pour</span> <span class="n">découvrir</span> <span class="n">le</span> <span class="n">protocole</span> <span class="n">POP3</span><span class="p">]</span>
<a id="__codelineno-63-32" name="__codelineno-63-32"></a><span class="o">&lt;--</span> <span class="p">[]</span>
<a id="__codelineno-63-33" name="__codelineno-63-33"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">.</span><span class="p">]</span>
<a id="__codelineno-63-34" name="__codelineno-63-34"></a><span class="o">--&gt;</span> <span class="p">[</span><span class="n">QUIT</span><span class="p">]</span>
<a id="__codelineno-63-35" name="__codelineno-63-35"></a><span class="o">&lt;--</span> <span class="p">[</span><span class="o">+</span><span class="n">OK</span> <span class="n">POP3</span> <span class="n">server</span> <span class="n">saying</span> <span class="n">goodbye</span><span class="o">...</span><span class="p">]</span>
<a id="__codelineno-63-36" name="__codelineno-63-36"></a><span class="n">Lecture</span> <span class="n">terminée</span><span class="o">...</span>
<a id="__codelineno-63-37" name="__codelineno-63-37"></a>
<a id="__codelineno-63-38" name="__codelineno-63-38"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>lignes 15-31 : on récupère correctement le message envoyé à <strong>[guest@localhost]</strong>.
Nous avons là un client POP3 basique auquel il manque certaines capacités :</p>
</li>
<li>
<p>la possibilité de dialoguer avec un serveur POP3 sécurisé ;</p>
</li>
<li>la possibilité de lire les pièces attachées à un message ;
Nous allons implémenter ces deux possibilités avec un nouveau script qui sera cette fois plus complexe.</li>
</ul>
<h3 id="2164-scripts-pop302-client-pop3-avec-les-modules-poplib-et-email">21.6.4. scripts [pop3/02] : client POP3 avec les modules [poplib] et [email]</h3>
<p>Nous allons écrire un client POP3 permettant de gérer les pièces attachées ainsi que la communication avec des serveurs sécurisés. Par ailleurs, nous sauvegarderons dans des fichiers, les messages et leurs pièces attachées.</p>
<p>Nous allons utiliser deux modules Python :</p>
<ul>
<li><strong>[poplib]</strong> : qui va assurer le protocole POP3 ;</li>
<li><strong>[email]</strong> : qui regroupe de nombreux sous-modules qui vont nous permettre d&#x27;analyser les messages reçus. Chaque message est une chaîne de caractères structurée dans laquelle on peut retrouver :</li>
<li>les entêtes du message <strong>[From, To, Subject, Return-Path…]</strong> ;</li>
<li>le message dans ses versions texte et éventuellement HTML ;</li>
<li>les pièces attachées ;</li>
</ul>
<p><img src="images/10000000000001B1000001EBDD5E2D9F.png" style="width:4.989cm;height:5.659cm;" alt="Image" /></p>
<p>Le script <strong>[inet/pop3/02/main]</strong> <strong>[1]</strong> est configuré par le fichier <strong>[inet/pop3/02/config]</strong> <strong>[2]</strong> et utilise le module <strong>[inet/shared/mail_parser]</strong> <strong>[3]</strong>.</p>
<p>Le fichier <strong>[pop3/02/config]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-64-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-64-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-64-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-64-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-64-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-64-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-64-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-64-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-64-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-64-10">10</a></span>
<span class="normal"><a href="#__codelineno-64-11">11</a></span>
<span class="normal"><a href="#__codelineno-64-12">12</a></span>
<span class="normal"><a href="#__codelineno-64-13">13</a></span>
<span class="normal"><a href="#__codelineno-64-14">14</a></span>
<span class="normal"><a href="#__codelineno-64-15">15</a></span>
<span class="normal"><a href="#__codelineno-64-16">16</a></span>
<span class="normal"><a href="#__codelineno-64-17">17</a></span>
<span class="normal"><a href="#__codelineno-64-18">18</a></span>
<span class="normal"><a href="#__codelineno-64-19">19</a></span>
<span class="normal"><a href="#__codelineno-64-20">20</a></span>
<span class="normal"><a href="#__codelineno-64-21">21</a></span>
<span class="normal"><a href="#__codelineno-64-22">22</a></span>
<span class="normal"><a href="#__codelineno-64-23">23</a></span>
<span class="normal"><a href="#__codelineno-64-24">24</a></span>
<span class="normal"><a href="#__codelineno-64-25">25</a></span>
<span class="normal"><a href="#__codelineno-64-26">26</a></span>
<span class="normal"><a href="#__codelineno-64-27">27</a></span>
<span class="normal"><a href="#__codelineno-64-28">28</a></span>
<span class="normal"><a href="#__codelineno-64-29">29</a></span>
<span class="normal"><a href="#__codelineno-64-30">30</a></span>
<span class="normal"><a href="#__codelineno-64-31">31</a></span>
<span class="normal"><a href="#__codelineno-64-32">32</a></span>
<span class="normal"><a href="#__codelineno-64-33">33</a></span>
<span class="normal"><a href="#__codelineno-64-34">34</a></span>
<span class="normal"><a href="#__codelineno-64-35">35</a></span>
<span class="normal"><a href="#__codelineno-64-36">36</a></span>
<span class="normal"><a href="#__codelineno-64-37">37</a></span>
<span class="normal"><a href="#__codelineno-64-38">38</a></span>
<span class="normal"><a href="#__codelineno-64-39">39</a></span>
<span class="normal"><a href="#__codelineno-64-40">40</a></span>
<span class="normal"><a href="#__codelineno-64-41">41</a></span>
<span class="normal"><a href="#__codelineno-64-42">42</a></span>
<span class="normal"><a href="#__codelineno-64-43">43</a></span>
<span class="normal"><a href="#__codelineno-64-44">44</a></span>
<span class="normal"><a href="#__codelineno-64-45">45</a></span>
<span class="normal"><a href="#__codelineno-64-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-64-2" name="__codelineno-64-2"></a>
<a id="__codelineno-64-3" name="__codelineno-64-3"></a>
<a id="__codelineno-64-4" name="__codelineno-64-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-64-5" name="__codelineno-64-5"></a>    <span class="c1"># configuration de l&#39;appli</span>
<a id="__codelineno-64-6" name="__codelineno-64-6"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-64-7" name="__codelineno-64-7"></a>        <span class="c1"># liste des boîtes à lettres à gérer</span>
<a id="__codelineno-64-8" name="__codelineno-64-8"></a>        <span class="s2">&quot;mailboxes&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-64-9" name="__codelineno-64-9"></a>            <span class="c1"># server : serveur POP3</span>
<a id="__codelineno-64-10" name="__codelineno-64-10"></a>            <span class="c1"># port : port du serveur POP3</span>
<a id="__codelineno-64-11" name="__codelineno-64-11"></a>            <span class="c1"># user : utilisateur dont on veut lire les messages</span>
<a id="__codelineno-64-12" name="__codelineno-64-12"></a>            <span class="c1"># password : son mot de passe</span>
<a id="__codelineno-64-13" name="__codelineno-64-13"></a>            <span class="c1"># maxmails : le nombre maximum de mail à télécharger</span>
<a id="__codelineno-64-14" name="__codelineno-64-14"></a>            <span class="c1"># timeout : délai d&#39;attente maximal d&#39;une réponse du serveur</span>
<a id="__codelineno-64-15" name="__codelineno-64-15"></a>            <span class="c1"># delete : à vrai s&#39;il faut supprimer du serveur les messages téléchargés</span>
<a id="__codelineno-64-16" name="__codelineno-64-16"></a>            <span class="c1"># ssl : à vrai si la lecture des mails se fait au travers d&#39;une liaison sécurisée</span>
<a id="__codelineno-64-17" name="__codelineno-64-17"></a>            <span class="c1"># output : le dossier de rangement des messages téléchargés</span>
<a id="__codelineno-64-18" name="__codelineno-64-18"></a>
<a id="__codelineno-64-19" name="__codelineno-64-19"></a>            <span class="p">{</span>
<a id="__codelineno-64-20" name="__codelineno-64-20"></a>                <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;pop.gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-64-21" name="__codelineno-64-21"></a>                <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;995&quot;</span><span class="p">,</span>
<a id="__codelineno-64-22" name="__codelineno-64-22"></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-64-23" name="__codelineno-64-23"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;#6prIlhD&amp;@1QZ3TG&quot;</span><span class="p">,</span>
<a id="__codelineno-64-24" name="__codelineno-64-24"></a>                <span class="s2">&quot;maxmails&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-64-25" name="__codelineno-64-25"></a>                <span class="s2">&quot;delete&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-64-26" name="__codelineno-64-26"></a>                <span class="s2">&quot;ssl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-64-27" name="__codelineno-64-27"></a>                <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-64-28" name="__codelineno-64-28"></a>                <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="s2">&quot;output&quot;</span>
<a id="__codelineno-64-29" name="__codelineno-64-29"></a>            <span class="p">}</span>
<a id="__codelineno-64-30" name="__codelineno-64-30"></a>        <span class="p">]</span>
<a id="__codelineno-64-31" name="__codelineno-64-31"></a>    <span class="p">}</span>
<a id="__codelineno-64-32" name="__codelineno-64-32"></a>    <span class="c1"># chemin absolu du dossier du script</span>
<a id="__codelineno-64-33" name="__codelineno-64-33"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-64-34" name="__codelineno-64-34"></a>
<a id="__codelineno-64-35" name="__codelineno-64-35"></a>    <span class="c1"># chemins absolus des dossiers à inclure dans le syspath</span>
<a id="__codelineno-64-36" name="__codelineno-64-36"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-64-37" name="__codelineno-64-37"></a>        <span class="c1"># dossier local</span>
<a id="__codelineno-64-38" name="__codelineno-64-38"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../shared&quot;</span><span class="p">,</span>
<a id="__codelineno-64-39" name="__codelineno-64-39"></a>   <span class="p">]</span>
<a id="__codelineno-64-40" name="__codelineno-64-40"></a>
<a id="__codelineno-64-41" name="__codelineno-64-41"></a>    <span class="c1"># configuration du syspath</span>
<a id="__codelineno-64-42" name="__codelineno-64-42"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-64-43" name="__codelineno-64-43"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-64-44" name="__codelineno-64-44"></a>
<a id="__codelineno-64-45" name="__codelineno-64-45"></a>    <span class="c1"># on rend la configuration</span>
<a id="__codelineno-64-46" name="__codelineno-64-46"></a>    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<p>Le fichier définit la liste des boîtes à lettres à consulter et fixe le Python Path de l’application.</p>
<p>Il n’y a ici qu’une unique boîte à lettres :</p>
<ul>
<li>lignes 22-23 : l&#x27;utilisateur dont on veut lire les mails ;</li>
<li>lignes 20-21 : le nom et le port du serveur POP3 qui stocke les mails de cet utilisateur ;</li>
<li>ligne 24 : le nombre maximum de mails à récupérer. En effet, si vous essayez ce script sur votre propre boîte mail, vous ne voudrez sans doute pas récupérer les centaines de mails qui s&#x27;y trouvent ;</li>
<li>ligne 25 : booléen qui indique si après la lecture d&#x27;un mail, on doit supprimer celui-ci (delete=True) ;</li>
<li>ligne 26 : l’attribut <strong>[ssl]</strong> à True signifie que le serveur POP3 défini aux lignes 20-21 utilise une connexion cryptée ;</li>
<li>ligne 27 : le temps d&#x27;attente maximal des réponses du serveur exprimé en secondes ;</li>
<li>ligne 28 : le dossier dans lequel ranger les mails lus. Il sera créé s&#x27;il n&#x27;existe pas. On a ici un nom relatif. A l&#x27;exécution, il sera relatif au dossier à partir duquel vous lancez le script. Avec <strong>[Pycharm]</strong>, ce dossier sera celui du script <strong>[pop3/02]</strong> ;
Le script <strong>[pop3/02/main]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-65-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-65-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-65-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-65-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-65-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-65-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-65-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-65-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-65-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-65-10">10</a></span>
<span class="normal"><a href="#__codelineno-65-11">11</a></span>
<span class="normal"><a href="#__codelineno-65-12">12</a></span>
<span class="normal"><a href="#__codelineno-65-13">13</a></span>
<span class="normal"><a href="#__codelineno-65-14">14</a></span>
<span class="normal"><a href="#__codelineno-65-15">15</a></span>
<span class="normal"><a href="#__codelineno-65-16">16</a></span>
<span class="normal"><a href="#__codelineno-65-17">17</a></span>
<span class="normal"><a href="#__codelineno-65-18">18</a></span>
<span class="normal"><a href="#__codelineno-65-19">19</a></span>
<span class="normal"><a href="#__codelineno-65-20">20</a></span>
<span class="normal"><a href="#__codelineno-65-21">21</a></span>
<span class="normal"><a href="#__codelineno-65-22">22</a></span>
<span class="normal"><a href="#__codelineno-65-23">23</a></span>
<span class="normal"><a href="#__codelineno-65-24">24</a></span>
<span class="normal"><a href="#__codelineno-65-25">25</a></span>
<span class="normal"><a href="#__codelineno-65-26">26</a></span>
<span class="normal"><a href="#__codelineno-65-27">27</a></span>
<span class="normal"><a href="#__codelineno-65-28">28</a></span>
<span class="normal"><a href="#__codelineno-65-29">29</a></span>
<span class="normal"><a href="#__codelineno-65-30">30</a></span>
<span class="normal"><a href="#__codelineno-65-31">31</a></span>
<span class="normal"><a href="#__codelineno-65-32">32</a></span>
<span class="normal"><a href="#__codelineno-65-33">33</a></span>
<span class="normal"><a href="#__codelineno-65-34">34</a></span>
<span class="normal"><a href="#__codelineno-65-35">35</a></span>
<span class="normal"><a href="#__codelineno-65-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1"></a><span class="c1"># imports</span>
<a id="__codelineno-65-2" name="__codelineno-65-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">email</span>
<a id="__codelineno-65-3" name="__codelineno-65-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-65-4" name="__codelineno-65-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">poplib</span>
<a id="__codelineno-65-5" name="__codelineno-65-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<a id="__codelineno-65-6" name="__codelineno-65-6"></a>
<a id="__codelineno-65-7" name="__codelineno-65-7"></a>
<a id="__codelineno-65-8" name="__codelineno-65-8"></a><span class="c1"># lecture d&#39;une boîte mail</span>
<a id="__codelineno-65-9" name="__codelineno-65-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">readmails</span><span class="p">(</span><span class="n">mailbox</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-65-10" name="__codelineno-65-10"></a>    <span class="c1"># lit la boîte mail décrite par le dictionnaire [mailbox]</span>
<a id="__codelineno-65-11" name="__codelineno-65-11"></a>    <span class="c1"># si verbose=True, fait un suivi des échanges client-serveur</span>
<a id="__codelineno-65-12" name="__codelineno-65-12"></a><span class="err">…</span>
<a id="__codelineno-65-13" name="__codelineno-65-13"></a>
<a id="__codelineno-65-14" name="__codelineno-65-14"></a><span class="c1"># main ----------------------------------------------------------------</span>
<a id="__codelineno-65-15" name="__codelineno-65-15"></a><span class="c1">#  client POP3 (Post Office Protocol) permettant de lire des mails</span>
<a id="__codelineno-65-16" name="__codelineno-65-16"></a>
<a id="__codelineno-65-17" name="__codelineno-65-17"></a><span class="c1"># on récupère la configuration de l&#39;application</span>
<a id="__codelineno-65-18" name="__codelineno-65-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-65-19" name="__codelineno-65-19"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-65-20" name="__codelineno-65-20"></a>
<a id="__codelineno-65-21" name="__codelineno-65-21"></a><span class="c1"># on traite les boîtes mail une par une</span>
<a id="__codelineno-65-22" name="__codelineno-65-22"></a><span class="k">for</span> <span class="n">mailbox</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;mailboxes&#39;</span><span class="p">]:</span>
<a id="__codelineno-65-23" name="__codelineno-65-23"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-65-24" name="__codelineno-65-24"></a>        <span class="c1"># affichage console</span>
<a id="__codelineno-65-25" name="__codelineno-65-25"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-65-26" name="__codelineno-65-26"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-65-27" name="__codelineno-65-27"></a>            <span class="sa">f</span><span class="s2">&quot;Lecture de la boîte mail POP3 </span><span class="si">{</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-65-28" name="__codelineno-65-28"></a>        <span class="c1"># lecture de la boîte mail en mode verbeux</span>
<a id="__codelineno-65-29" name="__codelineno-65-29"></a>        <span class="n">readmails</span><span class="p">(</span><span class="n">mailbox</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-65-30" name="__codelineno-65-30"></a>        <span class="c1"># fin</span>
<a id="__codelineno-65-31" name="__codelineno-65-31"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lecture terminée...&quot;</span><span class="p">)</span>
<a id="__codelineno-65-32" name="__codelineno-65-32"></a>    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-65-33" name="__codelineno-65-33"></a>        <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-65-34" name="__codelineno-65-34"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-65-35" name="__codelineno-65-35"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-65-36" name="__codelineno-65-36"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 17-36 : la partie <strong>[main]</strong> du script est analogue à celle du script <strong>[pop3/01]</strong> ;
La fonction <strong>[</strong><strong>readmails</strong><strong>]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-66-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-66-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-66-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-66-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-66-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-66-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-66-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-66-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-66-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-66-10">10</a></span>
<span class="normal"><a href="#__codelineno-66-11">11</a></span>
<span class="normal"><a href="#__codelineno-66-12">12</a></span>
<span class="normal"><a href="#__codelineno-66-13">13</a></span>
<span class="normal"><a href="#__codelineno-66-14">14</a></span>
<span class="normal"><a href="#__codelineno-66-15">15</a></span>
<span class="normal"><a href="#__codelineno-66-16">16</a></span>
<span class="normal"><a href="#__codelineno-66-17">17</a></span>
<span class="normal"><a href="#__codelineno-66-18">18</a></span>
<span class="normal"><a href="#__codelineno-66-19">19</a></span>
<span class="normal"><a href="#__codelineno-66-20">20</a></span>
<span class="normal"><a href="#__codelineno-66-21">21</a></span>
<span class="normal"><a href="#__codelineno-66-22">22</a></span>
<span class="normal"><a href="#__codelineno-66-23">23</a></span>
<span class="normal"><a href="#__codelineno-66-24">24</a></span>
<span class="normal"><a href="#__codelineno-66-25">25</a></span>
<span class="normal"><a href="#__codelineno-66-26">26</a></span>
<span class="normal"><a href="#__codelineno-66-27">27</a></span>
<span class="normal"><a href="#__codelineno-66-28">28</a></span>
<span class="normal"><a href="#__codelineno-66-29">29</a></span>
<span class="normal"><a href="#__codelineno-66-30">30</a></span>
<span class="normal"><a href="#__codelineno-66-31">31</a></span>
<span class="normal"><a href="#__codelineno-66-32">32</a></span>
<span class="normal"><a href="#__codelineno-66-33">33</a></span>
<span class="normal"><a href="#__codelineno-66-34">34</a></span>
<span class="normal"><a href="#__codelineno-66-35">35</a></span>
<span class="normal"><a href="#__codelineno-66-36">36</a></span>
<span class="normal"><a href="#__codelineno-66-37">37</a></span>
<span class="normal"><a href="#__codelineno-66-38">38</a></span>
<span class="normal"><a href="#__codelineno-66-39">39</a></span>
<span class="normal"><a href="#__codelineno-66-40">40</a></span>
<span class="normal"><a href="#__codelineno-66-41">41</a></span>
<span class="normal"><a href="#__codelineno-66-42">42</a></span>
<span class="normal"><a href="#__codelineno-66-43">43</a></span>
<span class="normal"><a href="#__codelineno-66-44">44</a></span>
<span class="normal"><a href="#__codelineno-66-45">45</a></span>
<span class="normal"><a href="#__codelineno-66-46">46</a></span>
<span class="normal"><a href="#__codelineno-66-47">47</a></span>
<span class="normal"><a href="#__codelineno-66-48">48</a></span>
<span class="normal"><a href="#__codelineno-66-49">49</a></span>
<span class="normal"><a href="#__codelineno-66-50">50</a></span>
<span class="normal"><a href="#__codelineno-66-51">51</a></span>
<span class="normal"><a href="#__codelineno-66-52">52</a></span>
<span class="normal"><a href="#__codelineno-66-53">53</a></span>
<span class="normal"><a href="#__codelineno-66-54">54</a></span>
<span class="normal"><a href="#__codelineno-66-55">55</a></span>
<span class="normal"><a href="#__codelineno-66-56">56</a></span>
<span class="normal"><a href="#__codelineno-66-57">57</a></span>
<span class="normal"><a href="#__codelineno-66-58">58</a></span>
<span class="normal"><a href="#__codelineno-66-59">59</a></span>
<span class="normal"><a href="#__codelineno-66-60">60</a></span>
<span class="normal"><a href="#__codelineno-66-61">61</a></span>
<span class="normal"><a href="#__codelineno-66-62">62</a></span>
<span class="normal"><a href="#__codelineno-66-63">63</a></span>
<span class="normal"><a href="#__codelineno-66-64">64</a></span>
<span class="normal"><a href="#__codelineno-66-65">65</a></span>
<span class="normal"><a href="#__codelineno-66-66">66</a></span>
<span class="normal"><a href="#__codelineno-66-67">67</a></span>
<span class="normal"><a href="#__codelineno-66-68">68</a></span>
<span class="normal"><a href="#__codelineno-66-69">69</a></span>
<span class="normal"><a href="#__codelineno-66-70">70</a></span>
<span class="normal"><a href="#__codelineno-66-71">71</a></span>
<span class="normal"><a href="#__codelineno-66-72">72</a></span>
<span class="normal"><a href="#__codelineno-66-73">73</a></span>
<span class="normal"><a href="#__codelineno-66-74">74</a></span>
<span class="normal"><a href="#__codelineno-66-75">75</a></span>
<span class="normal"><a href="#__codelineno-66-76">76</a></span>
<span class="normal"><a href="#__codelineno-66-77">77</a></span>
<span class="normal"><a href="#__codelineno-66-78">78</a></span>
<span class="normal"><a href="#__codelineno-66-79">79</a></span>
<span class="normal"><a href="#__codelineno-66-80">80</a></span>
<span class="normal"><a href="#__codelineno-66-81">81</a></span>
<span class="normal"><a href="#__codelineno-66-82">82</a></span>
<span class="normal"><a href="#__codelineno-66-83">83</a></span>
<span class="normal"><a href="#__codelineno-66-84">84</a></span>
<span class="normal"><a href="#__codelineno-66-85">85</a></span>
<span class="normal"><a href="#__codelineno-66-86">86</a></span>
<span class="normal"><a href="#__codelineno-66-87">87</a></span>
<span class="normal"><a href="#__codelineno-66-88">88</a></span>
<span class="normal"><a href="#__codelineno-66-89">89</a></span>
<span class="normal"><a href="#__codelineno-66-90">90</a></span>
<span class="normal"><a href="#__codelineno-66-91">91</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1"></a><span class="c1"># lecture d&#39;une boîte mail</span>
<a id="__codelineno-66-2" name="__codelineno-66-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">readmails</span><span class="p">(</span><span class="n">mailbox</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<a id="__codelineno-66-3" name="__codelineno-66-3"></a>    <span class="c1"># lit la boîte mail décrite par le dictionnaire [mailbox]</span>
<a id="__codelineno-66-4" name="__codelineno-66-4"></a>    <span class="c1"># si verbose=True, fait un suivi des échanges client-serveur</span>
<a id="__codelineno-66-5" name="__codelineno-66-5"></a>
<a id="__codelineno-66-6" name="__codelineno-66-6"></a>    <span class="c1"># import de mail_parser</span>
<a id="__codelineno-66-7" name="__codelineno-66-7"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">mail_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">save_message</span>
<a id="__codelineno-66-8" name="__codelineno-66-8"></a>
<a id="__codelineno-66-9" name="__codelineno-66-9"></a>    <span class="c1"># on isole les paramètres de la boîte mail</span>
<a id="__codelineno-66-10" name="__codelineno-66-10"></a>    <span class="c1"># on suppose que le dictionnaire [mailbox] est valide</span>
<a id="__codelineno-66-11" name="__codelineno-66-11"></a>    <span class="n">server</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span>
<a id="__codelineno-66-12" name="__codelineno-66-12"></a>    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">])</span>
<a id="__codelineno-66-13" name="__codelineno-66-13"></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
<a id="__codelineno-66-14" name="__codelineno-66-14"></a>    <span class="n">password</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
<a id="__codelineno-66-15" name="__codelineno-66-15"></a>    <span class="n">maxmails</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;maxmails&#39;</span><span class="p">]</span>
<a id="__codelineno-66-16" name="__codelineno-66-16"></a>    <span class="n">ssl</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;ssl&#39;</span><span class="p">]</span>
<a id="__codelineno-66-17" name="__codelineno-66-17"></a>    <span class="n">timeout</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;timeout&#39;</span><span class="p">]</span>
<a id="__codelineno-66-18" name="__codelineno-66-18"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
<a id="__codelineno-66-19" name="__codelineno-66-19"></a>
<a id="__codelineno-66-20" name="__codelineno-66-20"></a>    <span class="c1"># on laisse remonter les erreurs système</span>
<a id="__codelineno-66-21" name="__codelineno-66-21"></a>    <span class="n">pop3</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-66-22" name="__codelineno-66-22"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-66-23" name="__codelineno-66-23"></a>        <span class="c1"># on crée les dossiers de stockage s&#39;ils n&#39;existent pas</span>
<a id="__codelineno-66-24" name="__codelineno-66-24"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
<a id="__codelineno-66-25" name="__codelineno-66-25"></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<a id="__codelineno-66-26" name="__codelineno-66-26"></a>        <span class="c1"># user</span>
<a id="__codelineno-66-27" name="__codelineno-66-27"></a>        <span class="n">dir2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-66-28" name="__codelineno-66-28"></a>        <span class="c1"># on supprime le dossier [dir2] s&#39;il existe puis on le recrée</span>
<a id="__codelineno-66-29" name="__codelineno-66-29"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir2</span><span class="p">):</span>
<a id="__codelineno-66-30" name="__codelineno-66-30"></a>            <span class="c1"># suppression</span>
<a id="__codelineno-66-31" name="__codelineno-66-31"></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dir2</span><span class="p">)</span>
<a id="__codelineno-66-32" name="__codelineno-66-32"></a>        <span class="c1"># création</span>
<a id="__codelineno-66-33" name="__codelineno-66-33"></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dir2</span><span class="p">)</span>
<a id="__codelineno-66-34" name="__codelineno-66-34"></a>        <span class="c1"># ouverture d&#39;une connexion sur le port [port] de [server]</span>
<a id="__codelineno-66-35" name="__codelineno-66-35"></a>        <span class="k">if</span> <span class="n">ssl</span><span class="p">:</span>
<a id="__codelineno-66-36" name="__codelineno-66-36"></a>            <span class="n">pop3</span> <span class="o">=</span> <span class="n">poplib</span><span class="o">.</span><span class="n">POP3_SSL</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
<a id="__codelineno-66-37" name="__codelineno-66-37"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-66-38" name="__codelineno-66-38"></a>            <span class="n">pop3</span> <span class="o">=</span> <span class="n">poplib</span><span class="o">.</span><span class="n">POP3</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
<a id="__codelineno-66-39" name="__codelineno-66-39"></a>
<a id="__codelineno-66-40" name="__codelineno-66-40"></a>        <span class="c1"># connexion représente un flux de communication bidirectionnel</span>
<a id="__codelineno-66-41" name="__codelineno-66-41"></a>        <span class="c1"># entre le client (ce programme) et le serveur pop3 contacté</span>
<a id="__codelineno-66-42" name="__codelineno-66-42"></a>        <span class="c1"># ce canal est utilisé pour les échanges de commandes et d&#39;informations</span>
<a id="__codelineno-66-43" name="__codelineno-66-43"></a>
<a id="__codelineno-66-44" name="__codelineno-66-44"></a>        <span class="c1"># mode verbose</span>
<a id="__codelineno-66-45" name="__codelineno-66-45"></a>        <span class="n">pop3</span><span class="o">.</span><span class="n">set_debuglevel</span><span class="p">(</span><span class="mi">2</span> <span class="k">if</span> <span class="n">verbose</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-66-46" name="__codelineno-66-46"></a>        <span class="c1"># lecture msg de bienvenue</span>
<a id="__codelineno-66-47" name="__codelineno-66-47"></a>        <span class="n">pop3</span><span class="o">.</span><span class="n">getwelcome</span><span class="p">(</span>    <span class="p">)</span>
<a id="__codelineno-66-48" name="__codelineno-66-48"></a>        <span class="c1"># cmde USER</span>
<a id="__codelineno-66-49" name="__codelineno-66-49"></a>        <span class="n">réponse</span> <span class="o">=</span> <span class="n">pop3</span><span class="o">.</span><span class="n">user</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<a id="__codelineno-66-50" name="__codelineno-66-50"></a>        <span class="c1"># cmde PASS</span>
<a id="__codelineno-66-51" name="__codelineno-66-51"></a>        <span class="n">réponse</span> <span class="o">=</span> <span class="n">pop3</span><span class="o">.</span><span class="n">pass_</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
<a id="__codelineno-66-52" name="__codelineno-66-52"></a>        <span class="c1"># cmde LIST</span>
<a id="__codelineno-66-53" name="__codelineno-66-53"></a>        <span class="n">liste</span> <span class="o">=</span> <span class="n">pop3</span><span class="o">.</span><span class="n">list</span><span class="p">()</span>
<a id="__codelineno-66-54" name="__codelineno-66-54"></a>        <span class="c1"># les mails sont dans liste[1]</span>
<a id="__codelineno-66-55" name="__codelineno-66-55"></a>        <span class="n">imail</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-66-56" name="__codelineno-66-56"></a>        <span class="n">nb_mails</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">liste</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-66-57" name="__codelineno-66-57"></a>        <span class="n">fini</span> <span class="o">=</span> <span class="n">imail</span> <span class="o">==</span> <span class="n">maxmails</span> <span class="ow">or</span> <span class="n">imail</span> <span class="o">==</span> <span class="n">nb_mails</span>
<a id="__codelineno-66-58" name="__codelineno-66-58"></a>        <span class="n">éléments</span> <span class="o">=</span> <span class="n">liste</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-66-59" name="__codelineno-66-59"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">fini</span><span class="p">:</span>
<a id="__codelineno-66-60" name="__codelineno-66-60"></a>            <span class="c1"># élément courant</span>
<a id="__codelineno-66-61" name="__codelineno-66-61"></a>            <span class="n">élément</span> <span class="o">=</span> <span class="n">éléments</span><span class="p">[</span><span class="n">imail</span><span class="p">]</span>
<a id="__codelineno-66-62" name="__codelineno-66-62"></a>            <span class="c1"># élément est une liste d&#39;octets qu&#39;on décode en string</span>
<a id="__codelineno-66-63" name="__codelineno-66-63"></a>            <span class="n">desc</span> <span class="o">=</span> <span class="n">élément</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<a id="__codelineno-66-64" name="__codelineno-66-64"></a>            <span class="c1"># on a une chaîne séparée par des blancs</span>
<a id="__codelineno-66-65" name="__codelineno-66-65"></a>            <span class="c1"># le 1er élément est le n° du message</span>
<a id="__codelineno-66-66" name="__codelineno-66-66"></a>            <span class="n">num</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-66-67" name="__codelineno-66-67"></a>            <span class="c1"># on récupère le message</span>
<a id="__codelineno-66-68" name="__codelineno-66-68"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">pop3</span><span class="o">.</span><span class="n">retr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
<a id="__codelineno-66-69" name="__codelineno-66-69"></a>            <span class="c1"># les lignes du message sont dans message [1]</span>
<a id="__codelineno-66-70" name="__codelineno-66-70"></a>            <span class="n">str_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-66-71" name="__codelineno-66-71"></a>            <span class="k">for</span> <span class="n">ligne</span> <span class="ow">in</span> <span class="n">message</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
<a id="__codelineno-66-72" name="__codelineno-66-72"></a>                <span class="c1"># ligne est une suite d&#39;octets qu&#39;on décode en string</span>
<a id="__codelineno-66-73" name="__codelineno-66-73"></a>                <span class="n">str_message</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ligne</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span>
<a id="__codelineno-66-74" name="__codelineno-66-74"></a>            <span class="c1"># dossier du message</span>
<a id="__codelineno-66-75" name="__codelineno-66-75"></a>            <span class="n">dir3</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dir2</span><span class="si">}</span><span class="s2">/message_</span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-66-76" name="__codelineno-66-76"></a>            <span class="c1"># si le dossier n&#39;existe pas, on le crée</span>
<a id="__codelineno-66-77" name="__codelineno-66-77"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir3</span><span class="p">):</span>
<a id="__codelineno-66-78" name="__codelineno-66-78"></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dir3</span><span class="p">)</span>
<a id="__codelineno-66-79" name="__codelineno-66-79"></a>            <span class="c1"># objet email.message.Message</span>
<a id="__codelineno-66-80" name="__codelineno-66-80"></a>            <span class="n">save_message</span><span class="p">(</span><span class="n">dir3</span><span class="p">,</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_string</span><span class="p">(</span><span class="n">str_message</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-66-81" name="__codelineno-66-81"></a>            <span class="c1"># un mail de +</span>
<a id="__codelineno-66-82" name="__codelineno-66-82"></a>            <span class="n">imail</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-66-83" name="__codelineno-66-83"></a>            <span class="c1"># a-t-on atteint le max ?</span>
<a id="__codelineno-66-84" name="__codelineno-66-84"></a>            <span class="n">fini</span> <span class="o">=</span> <span class="n">imail</span> <span class="o">==</span> <span class="n">maxmails</span> <span class="ow">or</span> <span class="n">imail</span> <span class="o">==</span> <span class="n">nb_mails</span>
<a id="__codelineno-66-85" name="__codelineno-66-85"></a>
<a id="__codelineno-66-86" name="__codelineno-66-86"></a>        <span class="c1"># cmde QUIT</span>
<a id="__codelineno-66-87" name="__codelineno-66-87"></a>        <span class="n">pop3</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<a id="__codelineno-66-88" name="__codelineno-66-88"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-66-89" name="__codelineno-66-89"></a>        <span class="c1"># fermeture connexion</span>
<a id="__codelineno-66-90" name="__codelineno-66-90"></a>        <span class="k">if</span> <span class="n">pop3</span><span class="p">:</span>
<a id="__codelineno-66-91" name="__codelineno-66-91"></a>            <span class="n">pop3</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 6-7 : on importe la fonction <strong>[mail_parser.save_message]</strong> utilisée ligne 80 ; </li>
<li>le code de la fonction est encapsulée dans un try (ligne 22)/ finally (ligne 88). Ainsi toutes les exceptions remontent au code principal qui les arrêtent et les affichent ;</li>
<li>lignes 11-18 : on récupère les informations de configuration de la boîte à lettres ;</li>
<li>lignes 23-33 : tous les messages seront stockés dans le dossier <strong>[output/user]</strong> où <strong>[output]</strong> et <strong>[user]</strong> sont définis dans la configuration. On crée donc successivement les dossiers <strong>[output]</strong> puis <strong>[output/user]</strong>. Pour créer ce dernier, on le supprime d&#x27;abord ligne 31. <strong>[shutil]</strong> est un module qu&#x27;il faut importer. <strong>[shutil.rmtree(dir)]</strong> supprime le dossier <strong>[dir]</strong> et tout ce qu&#x27;il contient ;</li>
<li>pour toutes les opérations sur les fichiers système on utilise le module <strong>[os]</strong> qu&#x27;il faut également importer ;</li>
<li>lignes 34-38 : on ouvre une connexion avec le serveur POP3. Si le serveur est sécurisé, on utilise la classe <strong>[poplib.POP3_SSL]</strong> sinon la classe <strong>[poplib.POP3]</strong>. L&#x27;attribut <strong>[ssl]</strong> utilisé ligne 35 provient de la configuration de la boîte à lettres ;</li>
<li>ligne 45 : on fixe un niveau de logs :</li>
<li>0 : pas de logs ;</li>
<li>1 : les commandes émises par le client POP3 sont loguées ;</li>
<li>2 : logs détaillés. On voit également ce que reçoit le client POP3 ;</li>
<li>ligne 47 : après la connexion, leserveur POP3 envoie un message de bienvenue. On lit celui-ci ;</li>
<li>lignes 48-49 : commande USER du protocole POP3 ;</li>
<li>lignes 50-51 : commande PASS du protocole POP3 ;</li>
<li>lignes 52-53 : commande LIST du protocole POP3. La réponse est un tuple (response, <strong>[&#x27;mesg_num octets&#x27;…]</strong>, octets), par exemple liste=(b&#x27;+OK 3 messages (3859 octets)&#x27;, <strong>[b&#x27;1 584&#x27;, b&#x27;2 550&#x27;, b&#x27;3 2725&#x27;]</strong>, 22). On voit que les deux premiers éléments du tuple sont des bytes (préfixe b). liste<strong>[1]</strong> est un tableau où chaque élément est une suite d&#x27;octets contenant deux informations : le n° du message et sa taille en octets ;</li>
<li>ligne 56 : de ce qui précède on déduit que le nombre de messages dans la boîte à lettres peut être obtenu par <strong>[len[liste1]</strong>] ;</li>
<li>lignes 59-84 : on boucle sur chacun des messages. On s&#x27;arrête lorsque tous ont été lus ou qu&#x27;on a atteint le nombre maximal de mails fixé par configuration ;</li>
<li>ligne 61 : élément courant du tableau liste<strong>[1]</strong>, donc quelque chose comme b&#x27;1 584&#x27;, une suite d&#x27;octets ;</li>
<li>ligne 63 : on passe de la suite d&#x27;octets à une chaîne de caractères. On a maintenant la chaîne &#x27;1 584&#x27; ;</li>
<li>ligne 66 : on récupère le n° du message, ici la chaîne &#x27;1&#x27; ;</li>
<li>
<p>ligne 68 : on émet la commande POP3 RETR num. On récupère une réponse du genre :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-67-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1"></a><span class="p">[</span><span class="n">message</span><span class="o">=</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;+OK 584 octets&#39;</span><span class="p">,</span> <span class="p">[</span><span class="sa">b</span><span class="s1">&#39;Return-Path: guest@localhost&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Received: from [127.0.0.1] (localhost [127.0.0.1])&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">by DESKTOP-528I5CU with ESMTPA&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">; Tue, 17 Mar 2020 09:41:50 +0100&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;To: guest@localhost&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;From: &quot;guest@localhost&quot; &lt;guest@localhost&gt;&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Subject: test&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Message-ID: &lt;2572d0f0-5b7c-2c31-5a70-c628293d5709@localhost&gt;&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Date: Tue, 17 Mar 2020 09:41:48 +0100&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39; Thunderbird/68.6.0&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;MIME-Version: 1.0&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Content-Type: text/plain; charset=utf-8; format=flowed&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Content-Transfer-Encoding: 8bit&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Content-Language: fr&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;h</span><span class="se">\xc3\xa9</span><span class="s1">l</span><span class="se">\xc3\xa8</span><span class="s1">ne est all</span><span class="se">\xc3\xa9</span><span class="s1">e au march</span><span class="se">\xc3\xa9</span><span class="s1"> acheter des l</span><span class="se">\xc3\xa9</span><span class="s1">gumes.&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="mi">614</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>message est un tuple de trois éléments ;</p>
</li>
<li>message<strong>[1]</strong> est un tableau de lignes. Chaque ligne est une suite d&#x27;octets (préfixe b). Le message complet est formé par cet ensemble de lignes ;</li>
<li><strong>[Return-Path, Received, To, Subject, Message-ID, Content-Type, Content-Transfer-Encoding, Content-Language]</strong> sont les entêtes du message. Chacun donne une information sur le message reçu. Ces informations vont permettre de récupérer le corps du message (avant-dernier élément du tableau message<strong>[1]</strong>) ;</li>
<li>lignes 71-73 : on crée la chaîne <strong>[strMessage]</strong> formée de toutes les lignes du message. On a maintenant le message sous forme d&#x27;une chaîne de caractères. Ce message peut contenir d&#x27;autres messages ainsi que des pièces attachées. Car les pièces attachées le sont sous la forme d&#x27;une chaîne de caractères. Donc un point à retenir, c&#x27;est qu&#x27;un mail est au départ une chaîne de caractères et c&#x27;est cette chaîne de caractères qu&#x27;il faut analyser pour en extraire les pièces attachées, les éventuels autres messages encapsulés et bien sûr le corps du message, ce qu&#x27;a écrit l&#x27;expéditeur ;</li>
<li>lignes 74-78 : on va ranger le corps du message et les pièces attachées message dans le dossier <strong>[dir3]</strong> ;</li>
<li>lignes 79-80 : on va déléguer l&#x27;analyse du message à une fonction <strong>[save_message]</strong> :</li>
<li>le 1er paramètre est <strong>[dir3]</strong>, le dossier dans lequel le contenu du message doit être rangé ;</li>
<li>le second paramètre est un type <strong>[email.message.Message]</strong>. Cet objet a les méthodes pour récupérer les différentes parties du message (corps, pièces attachées) ainsi que tous ses entêtes. Il faut importer le module <strong>[email]</strong> pour disposer de cet objet. La fonction <strong>[</strong><strong>email</strong><strong>.message_from_string</strong><strong>]</strong> permet de construire un objet <strong>[email.message.Message]</strong> à partir de la chaîne de caractères du message ;
La fonction <strong>[save_message]</strong> fait partie du module <strong>[mail_parser]</strong> :</li>
</ul>
<p><img src="images/10000000000001310000017594E4CCCF.png" style="width:3.511cm;height:4.301cm;" alt="Image" /></p>
<p>Le module <strong>[mail_parser]</strong> a été importé aux lignes 6-7 de la fonction <strong>[readmails]</strong> ;</p>
<p>Dans <strong>[mail_parser.py]</strong> la fonction <strong>[save_message]</strong> est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-68-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-68-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-68-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-68-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-68-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-68-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-68-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-68-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-68-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-68-10">10</a></span>
<span class="normal"><a href="#__codelineno-68-11">11</a></span>
<span class="normal"><a href="#__codelineno-68-12">12</a></span>
<span class="normal"><a href="#__codelineno-68-13">13</a></span>
<span class="normal"><a href="#__codelineno-68-14">14</a></span>
<span class="normal"><a href="#__codelineno-68-15">15</a></span>
<span class="normal"><a href="#__codelineno-68-16">16</a></span>
<span class="normal"><a href="#__codelineno-68-17">17</a></span>
<span class="normal"><a href="#__codelineno-68-18">18</a></span>
<span class="normal"><a href="#__codelineno-68-19">19</a></span>
<span class="normal"><a href="#__codelineno-68-20">20</a></span>
<span class="normal"><a href="#__codelineno-68-21">21</a></span>
<span class="normal"><a href="#__codelineno-68-22">22</a></span>
<span class="normal"><a href="#__codelineno-68-23">23</a></span>
<span class="normal"><a href="#__codelineno-68-24">24</a></span>
<span class="normal"><a href="#__codelineno-68-25">25</a></span>
<span class="normal"><a href="#__codelineno-68-26">26</a></span>
<span class="normal"><a href="#__codelineno-68-27">27</a></span>
<span class="normal"><a href="#__codelineno-68-28">28</a></span>
<span class="normal"><a href="#__codelineno-68-29">29</a></span>
<span class="normal"><a href="#__codelineno-68-30">30</a></span>
<span class="normal"><a href="#__codelineno-68-31">31</a></span>
<span class="normal"><a href="#__codelineno-68-32">32</a></span>
<span class="normal"><a href="#__codelineno-68-33">33</a></span>
<span class="normal"><a href="#__codelineno-68-34">34</a></span>
<span class="normal"><a href="#__codelineno-68-35">35</a></span>
<span class="normal"><a href="#__codelineno-68-36">36</a></span>
<span class="normal"><a href="#__codelineno-68-37">37</a></span>
<span class="normal"><a href="#__codelineno-68-38">38</a></span>
<span class="normal"><a href="#__codelineno-68-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1"></a><span class="c1"># imports</span>
<a id="__codelineno-68-2" name="__codelineno-68-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">codecs</span>
<a id="__codelineno-68-3" name="__codelineno-68-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">email.contentmanager</span>
<a id="__codelineno-68-4" name="__codelineno-68-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">email.header</span>
<a id="__codelineno-68-5" name="__codelineno-68-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">email.iterators</span>
<a id="__codelineno-68-6" name="__codelineno-68-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">email.message</span>
<a id="__codelineno-68-7" name="__codelineno-68-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-68-8" name="__codelineno-68-8"></a>
<a id="__codelineno-68-9" name="__codelineno-68-9"></a>
<a id="__codelineno-68-10" name="__codelineno-68-10"></a><span class="c1"># sauvegarde d&#39;un message de type email.message.Message</span>
<a id="__codelineno-68-11" name="__codelineno-68-11"></a><span class="c1"># cette fonction peut être appelée de façon récursive</span>
<a id="__codelineno-68-12" name="__codelineno-68-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_message</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email_message</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">irfc822</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-68-13" name="__codelineno-68-13"></a>    <span class="c1"># output : dossier de sauvegarde des messages</span>
<a id="__codelineno-68-14" name="__codelineno-68-14"></a>    <span class="c1"># email_message : le message à sauvegarder</span>
<a id="__codelineno-68-15" name="__codelineno-68-15"></a>    <span class="c1"># irfc822 : n° courant de la numérotation des mails attachés</span>
<a id="__codelineno-68-16" name="__codelineno-68-16"></a>    <span class="c1">#</span>
<a id="__codelineno-68-17" name="__codelineno-68-17"></a>    <span class="c1"># partie du message</span>
<a id="__codelineno-68-18" name="__codelineno-68-18"></a>    <span class="n">part</span> <span class="o">=</span> <span class="n">email_message</span>
<a id="__codelineno-68-19" name="__codelineno-68-19"></a>    <span class="c1"># les entêtes [From, To, Subject] sont trouvés dans une des parties multipart</span>
<a id="__codelineno-68-20" name="__codelineno-68-20"></a>    <span class="c1"># ou bien dans une partie [text/*] lorsqu&#39;il n&#39;y a pas de partie [multipart]</span>
<a id="__codelineno-68-21" name="__codelineno-68-21"></a>    <span class="n">keys</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-68-22" name="__codelineno-68-22"></a>    <span class="c1"># From doit faire partie des entêtes, sinon la partie n&#39;a pas les entêtes qu&#39;on cherche</span>
<a id="__codelineno-68-23" name="__codelineno-68-23"></a>    <span class="k">if</span> <span class="s2">&quot;From&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
<a id="__codelineno-68-24" name="__codelineno-68-24"></a>        <span class="c1"># on récupère certains entêtes</span>
<a id="__codelineno-68-25" name="__codelineno-68-25"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;From: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;From&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-68-26" name="__codelineno-68-26"></a>                   <span class="sa">f</span><span class="s2">&quot;To: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;To&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-68-27" name="__codelineno-68-27"></a>                   <span class="sa">f</span><span class="s2">&quot;Subject: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Subject&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-68-28" name="__codelineno-68-28"></a>                   <span class="sa">f</span><span class="s2">&quot;Return-Path: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Return-Path&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-68-29" name="__codelineno-68-29"></a>                   <span class="sa">f</span><span class="s2">&quot;User-Agent: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-68-30" name="__codelineno-68-30"></a>                   <span class="sa">f</span><span class="s2">&quot;Date: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<a id="__codelineno-68-31" name="__codelineno-68-31"></a>        <span class="c1"># sauvegarde des entêtes dans un fichier texte</span>
<a id="__codelineno-68-32" name="__codelineno-68-32"></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/headers.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-68-33" name="__codelineno-68-33"></a>            <span class="c1"># écriture dans fichier</span>
<a id="__codelineno-68-34" name="__codelineno-68-34"></a>            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-68-35" name="__codelineno-68-35"></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-68-36" name="__codelineno-68-36"></a>
<a id="__codelineno-68-37" name="__codelineno-68-37"></a>    <span class="c1"># type de la partie [part]</span>
<a id="__codelineno-68-38" name="__codelineno-68-38"></a>    <span class="n">main_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">()</span>
<a id="__codelineno-68-39" name="__codelineno-68-39"></a>   <span class="err">…</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 12 : la fonction reçoit au plus trois paramètres :</li>
<li><strong>[output]</strong> : le dossier où enregistrer le message (2ième paramètre) ;</li>
<li><strong>[email_message]</strong> : un message de type <strong>[email.message.Message]</strong>. Ce type est un type structuré. Il contient le texte du mail ainsi que tous les fichiers attachés et offre des méthodes pour récupérer ses différents éléments ;</li>
<li><strong>[irfc822]</strong> : ce paramètre est utilisé pour numéroter les mails encapsulés dans <strong>[email_message]</strong><strong> ;</strong></li>
<li>ligne 18 : l&#x27;objet <strong>[email_message]</strong> est mis dans <strong>[part]</strong>. Le type <strong>[email.message.Message]</strong> contient des parties <strong>[part]</strong> (corps du message, pièces attachées, mails encapsulés) qui ont également le type <strong>[email.message.Message]</strong>. Chaque partie <strong>[part]</strong> peut avoir des sous-parties. Ainsi le type <strong>[email.message.Message]</strong> est un arbre d&#x27;éléments de type <strong>[email.message.Message]</strong> :</li>
<li><strong>[part.ismultipart()]</strong> vaut <strong>[True]</strong> si la partie <strong>[part]</strong> contient des sous-parties. Celles-ci sont alors disponibles via <strong>[part.get_payload()]</strong> ;</li>
<li>lorsque <strong>[part.ismultipart()]</strong> vaut <strong>[False]</strong>, c&#x27;est qu&#x27;on est arrivé à une feuille de l&#x27;arbre du message initial : il peut s&#x27;agir :</li>
<li>du corps du message sous la forme d&#x27;un texte normal ;</li>
<li>du corps du message sous la forme d&#x27;un texte HTML ;</li>
<li>d&#x27;une pièce attachée (à l&#x27;exception d&#x27;un message encapsulé pour lequel <strong>[part.ismultipart()]</strong> vaut <strong>[True]</strong>) ;</li>
<li>de par la nature en arbre du paramètre <strong>[email.message.Message]</strong>, la fonction <strong>[save_message]</strong> sera appelée de façon récursive. La récursivité cesse lorsqu&#x27;on atteint les feuilles de l&#x27;arbre, ç-à-d une partie <strong>[part]</strong> pour laquelle <strong>[part.ismultipart()]</strong> vaut <strong>[False]</strong> ;</li>
<li>ligne 21 : nous demandons à voir les clés (ou entêtes) du message couramment analysé (qui de par la récursivité peut être une sous-partie du message initial) ;</li>
<li>lignes 23-35 : on veut enregistrer les entêtes :</li>
<li><strong>[From]</strong> : l&#x27;expéditeur du message ;</li>
<li><strong>[To]</strong> : le destinataire du message ;</li>
<li><strong>[Subject]</strong> : le sujet du message ;</li>
<li><strong>[Return-Path]</strong> : le destinataire à qui on doit répondre si on veut répondre. En effet, cette information n&#x27;est pas toujours dans le <strong>[From]</strong> ;</li>
<li><strong>[User-Agent]</strong> : le client POP3 qui dialogue avec le serveur POP3 ;</li>
<li><strong>[Date]</strong> : date d&#x27;envoi du mail ;</li>
<li>ligne 23 : seule l&#x27;une des parties d&#x27;un message contient ces entêtes. Pour les autres parties, le code des lignes 23-35 sera ignoré ;</li>
<li>lignes 25-30 : on crée une liste avec les six entêtes ;</li>
<li>ligne 25 : analysons le 1er entête :</li>
<li><strong>[part.get(key)]</strong> permet d&#x27;avoir l&#x27;entête associé à la clé <strong>[key]</strong> ;</li>
<li>cet entête peut être encodé. Si cet encodage n&#x27;est pas utf-8, on décode l&#x27;entête pour le réencoder en utf-8 à l’aide de la fonction <strong>[decode_header]</strong> ;</li>
<li>le 1er entête sera de la forme <strong>[From: pymail2lexemple@gmail.com]</strong> ;</li>
<li>lignes 31-35 : on sauve les entêtes dans le fichier <strong>[output/headers.txt]</strong> ;
La fonction <strong>[decode_header]</strong> est la suivante (toujours dans <strong>[mail_parser.py]</strong>) :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-69-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-69-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-69-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-69-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-69-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-69-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-69-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-69-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-69-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-69-10">10</a></span>
<span class="normal"><a href="#__codelineno-69-11">11</a></span>
<span class="normal"><a href="#__codelineno-69-12">12</a></span>
<span class="normal"><a href="#__codelineno-69-13">13</a></span>
<span class="normal"><a href="#__codelineno-69-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1"></a><span class="c1"># décodage de headers</span>
<a id="__codelineno-69-2" name="__codelineno-69-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">decode_header</span><span class="p">(</span><span class="n">header</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-69-3" name="__codelineno-69-3"></a>    <span class="c1"># on décode l&#39;entête</span>
<a id="__codelineno-69-4" name="__codelineno-69-4"></a>    <span class="n">header</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">header</span><span class="o">.</span><span class="n">decode_header</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-69-5" name="__codelineno-69-5"></a>    <span class="c1"># le résultat est un tableau - ici il n&#39;aura qu&#39;un élément de type (header, encoding)</span>
<a id="__codelineno-69-6" name="__codelineno-69-6"></a>    <span class="c1"># si encoding==None, alors header est une chaîne de caractères</span>
<a id="__codelineno-69-7" name="__codelineno-69-7"></a>    <span class="c1"># sinon c&#39;est une liste d&#39;octets codés par encoding</span>
<a id="__codelineno-69-8" name="__codelineno-69-8"></a>    <span class="n">header</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-69-9" name="__codelineno-69-9"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">encoding</span><span class="p">:</span>
<a id="__codelineno-69-10" name="__codelineno-69-10"></a>        <span class="c1"># si pas d&#39;encodage</span>
<a id="__codelineno-69-11" name="__codelineno-69-11"></a>        <span class="k">return</span> <span class="n">header</span>
<a id="__codelineno-69-12" name="__codelineno-69-12"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-69-13" name="__codelineno-69-13"></a>        <span class="c1"># si encodage, on décode</span>
<a id="__codelineno-69-14" name="__codelineno-69-14"></a>        <span class="k">return</span> <span class="n">header</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 4 : on décode l&#x27;entête :</li>
<li>il faut importer le module <strong>[email.header]</strong> ;</li>
<li>on obtient une liste de tuples <strong>[(header1,encoding1) , (header2, encoding2)…]</strong> ;</li>
<li>pour les entêtes <strong>[From, To, Subject, Return-Path, Date]</strong> la liste n&#x27;aura qu&#x27;un élément ;</li>
<li>ligne 8 : on récupère l&#x27;entête unique et son encodage :</li>
<li>si <strong>[encoding==None]</strong> alors <strong>[header]</strong> est l&#x27;entête sous la forme d&#x27;une chaîne de caractères ;</li>
<li>sinon, <strong>[header]</strong> est une suite d&#x27;octets représentant l&#x27;entête encodé ;</li>
<li>lignes 10-11 : s&#x27;il n&#x27;y avait pas d&#x27;encodage, alors on rend l&#x27;entête ;</li>
<li>lignes 12-14 : s&#x27;il y avait un encodage, alors on décode,  dans une chaîne de caractères, la suite d&#x27;octets qu&#x27;on a récupérée et on rend celle-ci ;
Revenons à la fonction <strong>[save_message]</strong> :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-70-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-70-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-70-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-70-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-70-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-70-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-70-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-70-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-70-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-70-10">10</a></span>
<span class="normal"><a href="#__codelineno-70-11">11</a></span>
<span class="normal"><a href="#__codelineno-70-12">12</a></span>
<span class="normal"><a href="#__codelineno-70-13">13</a></span>
<span class="normal"><a href="#__codelineno-70-14">14</a></span>
<span class="normal"><a href="#__codelineno-70-15">15</a></span>
<span class="normal"><a href="#__codelineno-70-16">16</a></span>
<span class="normal"><a href="#__codelineno-70-17">17</a></span>
<span class="normal"><a href="#__codelineno-70-18">18</a></span>
<span class="normal"><a href="#__codelineno-70-19">19</a></span>
<span class="normal"><a href="#__codelineno-70-20">20</a></span>
<span class="normal"><a href="#__codelineno-70-21">21</a></span>
<span class="normal"><a href="#__codelineno-70-22">22</a></span>
<span class="normal"><a href="#__codelineno-70-23">23</a></span>
<span class="normal"><a href="#__codelineno-70-24">24</a></span>
<span class="normal"><a href="#__codelineno-70-25">25</a></span>
<span class="normal"><a href="#__codelineno-70-26">26</a></span>
<span class="normal"><a href="#__codelineno-70-27">27</a></span>
<span class="normal"><a href="#__codelineno-70-28">28</a></span>
<span class="normal"><a href="#__codelineno-70-29">29</a></span>
<span class="normal"><a href="#__codelineno-70-30">30</a></span>
<span class="normal"><a href="#__codelineno-70-31">31</a></span>
<span class="normal"><a href="#__codelineno-70-32">32</a></span>
<span class="normal"><a href="#__codelineno-70-33">33</a></span>
<span class="normal"><a href="#__codelineno-70-34">34</a></span>
<span class="normal"><a href="#__codelineno-70-35">35</a></span>
<span class="normal"><a href="#__codelineno-70-36">36</a></span>
<span class="normal"><a href="#__codelineno-70-37">37</a></span>
<span class="normal"><a href="#__codelineno-70-38">38</a></span>
<span class="normal"><a href="#__codelineno-70-39">39</a></span>
<span class="normal"><a href="#__codelineno-70-40">40</a></span>
<span class="normal"><a href="#__codelineno-70-41">41</a></span>
<span class="normal"><a href="#__codelineno-70-42">42</a></span>
<span class="normal"><a href="#__codelineno-70-43">43</a></span>
<span class="normal"><a href="#__codelineno-70-44">44</a></span>
<span class="normal"><a href="#__codelineno-70-45">45</a></span>
<span class="normal"><a href="#__codelineno-70-46">46</a></span>
<span class="normal"><a href="#__codelineno-70-47">47</a></span>
<span class="normal"><a href="#__codelineno-70-48">48</a></span>
<span class="normal"><a href="#__codelineno-70-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1"></a><span class="c1"># sauvegarde d&#39;un message de type email.message.Message</span>
<a id="__codelineno-70-2" name="__codelineno-70-2"></a><span class="c1"># cette fonction peut être appelée de façon récursive</span>
<a id="__codelineno-70-3" name="__codelineno-70-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_message</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email_message</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">irfc822</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-70-4" name="__codelineno-70-4"></a>    <span class="c1"># output : dossier de sauvegarde des messages</span>
<a id="__codelineno-70-5" name="__codelineno-70-5"></a>    <span class="c1"># email_message : le message à sauvegarder</span>
<a id="__codelineno-70-6" name="__codelineno-70-6"></a>    <span class="c1"># irfc822 : n° courant de la numérotation des mails attachés</span>
<a id="__codelineno-70-7" name="__codelineno-70-7"></a>    <span class="c1">#</span>
<a id="__codelineno-70-8" name="__codelineno-70-8"></a>    <span class="c1"># partie du message</span>
<a id="__codelineno-70-9" name="__codelineno-70-9"></a>    <span class="n">part</span> <span class="o">=</span> <span class="n">email_message</span>
<a id="__codelineno-70-10" name="__codelineno-70-10"></a>    <span class="c1"># les entêtes [From, To, Subject] sont trouvés dans une des parties multipart</span>
<a id="__codelineno-70-11" name="__codelineno-70-11"></a>    <span class="c1"># ou bien dans une partie [text/*] lorsqu&#39;il n&#39;y a pas de partie [multipart]</span>
<a id="__codelineno-70-12" name="__codelineno-70-12"></a>    <span class="n">keys</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-70-13" name="__codelineno-70-13"></a>    <span class="c1"># From doit faire partie des entêtes, sinon la partie n&#39;a pas les entêtes qu&#39;on cherche</span>
<a id="__codelineno-70-14" name="__codelineno-70-14"></a>    <span class="k">if</span> <span class="s2">&quot;From&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
<a id="__codelineno-70-15" name="__codelineno-70-15"></a>        <span class="c1"># on récupère certains entêtes</span>
<a id="__codelineno-70-16" name="__codelineno-70-16"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;From: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;From&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-70-17" name="__codelineno-70-17"></a>                   <span class="sa">f</span><span class="s2">&quot;To: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;To&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-70-18" name="__codelineno-70-18"></a>                   <span class="sa">f</span><span class="s2">&quot;Subject: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Subject&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-70-19" name="__codelineno-70-19"></a>                   <span class="sa">f</span><span class="s2">&quot;Return-Path: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Return-Path&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-70-20" name="__codelineno-70-20"></a>                   <span class="sa">f</span><span class="s2">&quot;User-Agent: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-70-21" name="__codelineno-70-21"></a>                   <span class="sa">f</span><span class="s2">&quot;Date: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<a id="__codelineno-70-22" name="__codelineno-70-22"></a>        <span class="c1"># sauvegarde des entêtes dans un fichier texte</span>
<a id="__codelineno-70-23" name="__codelineno-70-23"></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/headers.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-70-24" name="__codelineno-70-24"></a>            <span class="c1"># écriture dans fichier</span>
<a id="__codelineno-70-25" name="__codelineno-70-25"></a>            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-70-26" name="__codelineno-70-26"></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-70-27" name="__codelineno-70-27"></a>
<a id="__codelineno-70-28" name="__codelineno-70-28"></a>    <span class="c1"># type de la partie [part]</span>
<a id="__codelineno-70-29" name="__codelineno-70-29"></a>    <span class="n">main_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">()</span>
<a id="__codelineno-70-30" name="__codelineno-70-30"></a>    <span class="n">sub_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">()</span>
<a id="__codelineno-70-31" name="__codelineno-70-31"></a>    <span class="n">type_of_part</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sub_type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-70-32" name="__codelineno-70-32"></a>    <span class="c1"># si le message est de type text/plain</span>
<a id="__codelineno-70-33" name="__codelineno-70-33"></a>    <span class="k">if</span> <span class="n">type_of_part</span> <span class="o">==</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">:</span>
<a id="__codelineno-70-34" name="__codelineno-70-34"></a>        <span class="c1"># message texte</span>
<a id="__codelineno-70-35" name="__codelineno-70-35"></a>        <span class="n">save_textmessage</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-70-36" name="__codelineno-70-36"></a>
<a id="__codelineno-70-37" name="__codelineno-70-37"></a>    <span class="c1"># si le message est de type text/html</span>
<a id="__codelineno-70-38" name="__codelineno-70-38"></a>    <span class="k">elif</span> <span class="n">type_of_part</span> <span class="o">==</span> <span class="s2">&quot;text/html&quot;</span><span class="p">:</span>
<a id="__codelineno-70-39" name="__codelineno-70-39"></a>        <span class="c1"># message HTML</span>
<a id="__codelineno-70-40" name="__codelineno-70-40"></a>        <span class="n">save_textmessage</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-70-41" name="__codelineno-70-41"></a>
<a id="__codelineno-70-42" name="__codelineno-70-42"></a>    <span class="c1"># si le message est un conteneur de parties</span>
<a id="__codelineno-70-43" name="__codelineno-70-43"></a>    <span class="k">elif</span> <span class="n">part</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">():</span>
<a id="__codelineno-70-44" name="__codelineno-70-44"></a>        <span class="err">…</span>
<a id="__codelineno-70-45" name="__codelineno-70-45"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-70-46" name="__codelineno-70-46"></a>        <span class="err">…</span>
<a id="__codelineno-70-47" name="__codelineno-70-47"></a>    <span class="c1"># on ignore les autres parties (pas text/plain, pas text/html, pas attachment)</span>
<a id="__codelineno-70-48" name="__codelineno-70-48"></a>    <span class="c1"># on rend la valeur actuelle de irfc822 (numérotation des mails attachés rangés dans le dossier output)</span>
<a id="__codelineno-70-49" name="__codelineno-70-49"></a>    <span class="k">return</span> <span class="n">irfc822</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 1-26 : on a traité les entêtes du message initial ;</li>
<li>lignes 28-31 : les parties d&#x27;un message de type <strong>[email.message.Message]</strong> ont un type principal et un sous-type. On les récupère ;</li>
<li>lignes 32-35 : si la partie traitée a le type <strong>[text/plain]</strong> alors on est arrivés à une feuille de l&#x27;arbre du message initial. C&#x27;est le texte qu&#x27;a écrit l&#x27;expéditeur dans son message ;</li>
<li>ligne 35 : ce texte est écrit dans un fichier :</li>
<li>le 1er paramètre <strong>[output]</strong> est le dossier dans lequel le texte doit être sauvegardé ;</li>
<li>le second paramètre est la partie du message qui contient le texte à sauvegarder ;</li>
<li>le troisième paramètre vaut 0 pour sauvegarder un texte normal, 1 pour un texte HTML ;</li>
<li>lignes 37-40 : si la partie a le type <strong>[text/html]</strong> alors on est également arrivés à une feuille de l&#x27;arbre du message initial. C&#x27;est le texte qu&#x27;a écrit l&#x27;expéditeur dans son message, cette fois-ci au format HTML. Les gestionnaires de courrier ne proposent pas tous ce format ;
La fonction <strong>[</strong><strong>save_textmessage</strong><strong>]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-71-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-71-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-71-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-71-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-71-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-71-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-71-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-71-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-71-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-71-10">10</a></span>
<span class="normal"><a href="#__codelineno-71-11">11</a></span>
<span class="normal"><a href="#__codelineno-71-12">12</a></span>
<span class="normal"><a href="#__codelineno-71-13">13</a></span>
<span class="normal"><a href="#__codelineno-71-14">14</a></span>
<span class="normal"><a href="#__codelineno-71-15">15</a></span>
<span class="normal"><a href="#__codelineno-71-16">16</a></span>
<span class="normal"><a href="#__codelineno-71-17">17</a></span>
<span class="normal"><a href="#__codelineno-71-18">18</a></span>
<span class="normal"><a href="#__codelineno-71-19">19</a></span>
<span class="normal"><a href="#__codelineno-71-20">20</a></span>
<span class="normal"><a href="#__codelineno-71-21">21</a></span>
<span class="normal"><a href="#__codelineno-71-22">22</a></span>
<span class="normal"><a href="#__codelineno-71-23">23</a></span>
<span class="normal"><a href="#__codelineno-71-24">24</a></span>
<span class="normal"><a href="#__codelineno-71-25">25</a></span>
<span class="normal"><a href="#__codelineno-71-26">26</a></span>
<span class="normal"><a href="#__codelineno-71-27">27</a></span>
<span class="normal"><a href="#__codelineno-71-28">28</a></span>
<span class="normal"><a href="#__codelineno-71-29">29</a></span>
<span class="normal"><a href="#__codelineno-71-30">30</a></span>
<span class="normal"><a href="#__codelineno-71-31">31</a></span>
<span class="normal"><a href="#__codelineno-71-32">32</a></span>
<span class="normal"><a href="#__codelineno-71-33">33</a></span>
<span class="normal"><a href="#__codelineno-71-34">34</a></span>
<span class="normal"><a href="#__codelineno-71-35">35</a></span>
<span class="normal"><a href="#__codelineno-71-36">36</a></span>
<span class="normal"><a href="#__codelineno-71-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1"></a><span class="c1"># sauvegarde d&#39;un message texte</span>
<a id="__codelineno-71-2" name="__codelineno-71-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_textmessage</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">part</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">type_of_text</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-71-3" name="__codelineno-71-3"></a>    <span class="c1"># entêtes</span>
<a id="__codelineno-71-4" name="__codelineno-71-4"></a>    <span class="n">headers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-71-5" name="__codelineno-71-5"></a>    <span class="c1"># charset du message</span>
<a id="__codelineno-71-6" name="__codelineno-71-6"></a>    <span class="n">charset</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_charset</span><span class="p">()</span>
<a id="__codelineno-71-7" name="__codelineno-71-7"></a>    <span class="k">if</span> <span class="n">charset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-71-8" name="__codelineno-71-8"></a>        <span class="n">charset</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_charset</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-71-9" name="__codelineno-71-9"></a>        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Charset: </span><span class="si">{</span><span class="n">charset</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-71-10" name="__codelineno-71-10"></a>    <span class="c1"># mode de codage du contenu</span>
<a id="__codelineno-71-11" name="__codelineno-71-11"></a>    <span class="n">content_transfer_encoding</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Transfer-Encoding&quot;</span><span class="p">)</span>
<a id="__codelineno-71-12" name="__codelineno-71-12"></a>    <span class="k">if</span> <span class="n">content_transfer_encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-71-13" name="__codelineno-71-13"></a>        <span class="n">headers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transfer-Content-Encoding: </span><span class="si">{</span><span class="n">content_transfer_encoding</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-71-14" name="__codelineno-71-14"></a>    <span class="c1"># le mode 8bit a posé problème</span>
<a id="__codelineno-71-15" name="__codelineno-71-15"></a>    <span class="k">if</span> <span class="n">content_transfer_encoding</span> <span class="o">==</span> <span class="s2">&quot;8bit&quot;</span><span class="p">:</span>
<a id="__codelineno-71-16" name="__codelineno-71-16"></a>        <span class="c1"># on récupère le message du mail</span>
<a id="__codelineno-71-17" name="__codelineno-71-17"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span>
<a id="__codelineno-71-18" name="__codelineno-71-18"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-71-19" name="__codelineno-71-19"></a>        <span class="c1"># on récupère le message du mail</span>
<a id="__codelineno-71-20" name="__codelineno-71-20"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">contentmanager</span><span class="o">.</span><span class="n">raw_data_manager</span><span class="o">.</span><span class="n">get_content</span><span class="p">(</span><span class="n">part</span><span class="p">)</span>
<a id="__codelineno-71-21" name="__codelineno-71-21"></a>    <span class="c1"># selon les types de texte</span>
<a id="__codelineno-71-22" name="__codelineno-71-22"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-71-23" name="__codelineno-71-23"></a>    <span class="k">if</span> <span class="n">type_of_text</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-71-24" name="__codelineno-71-24"></a>        <span class="c1"># sauvegarde des entêtes</span>
<a id="__codelineno-71-25" name="__codelineno-71-25"></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/headers.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-71-26" name="__codelineno-71-26"></a>            <span class="c1"># écriture dans fichier</span>
<a id="__codelineno-71-27" name="__codelineno-71-27"></a>            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-71-28" name="__codelineno-71-28"></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-71-29" name="__codelineno-71-29"></a>        <span class="c1"># fichier texte pour le contenu</span>
<a id="__codelineno-71-30" name="__codelineno-71-30"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/mail.txt&quot;</span>
<a id="__codelineno-71-31" name="__codelineno-71-31"></a>    <span class="k">elif</span> <span class="n">type_of_text</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-71-32" name="__codelineno-71-32"></a>        <span class="c1"># fichier html pour le contenu</span>
<a id="__codelineno-71-33" name="__codelineno-71-33"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/mail.html&quot;</span>
<a id="__codelineno-71-34" name="__codelineno-71-34"></a>    <span class="c1"># sauvegarde du message</span>
<a id="__codelineno-71-35" name="__codelineno-71-35"></a>    <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-71-36" name="__codelineno-71-36"></a>        <span class="c1"># écriture dans fichier</span>
<a id="__codelineno-71-37" name="__codelineno-71-37"></a>        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>comme les entêtes, le texte du message peut être encodé. Il peut y avoir deux encodages :</li>
<li>l&#x27;encodage initial du texte (utf-8, iso-8859-1…). C&#x27;est l&#x27;encodage utilisé par le gestionnaire de courrier qui a envoyé le message. Il est connu avec l&#x27;entête <strong>[Content-Type]</strong> du message reçu ;</li>
<li>un second encodage qu&#x27;a pu subir le texte précédent pour être envoyé. Il est connu avec l&#x27;entête <strong>[Transfer-Content-Encoding]</strong> du message reçu ;</li>
<li>ligne 6 : l&#x27;encodage initial du texte ;</li>
<li>ligne 11 : le second encodage que le texte a subi pour son transfert vers le destinataire ;</li>
<li>lignes 9, 13 : ces deux informations sont mises dans la liste <strong>[headers]</strong>. Elles seront rajoutées aux informations du fichier <strong>[headers.txt]</strong> qui enregistre certains entêtes du message ;</li>
<li>ligne 20 : <strong>[</strong><strong>email</strong><strong>.</strong><strong>contentmanager</strong><strong>.raw_data_manager.get_content</strong><strong>]</strong> permet d&#x27;avoir le message avec son encodage initial 1. On s&#x27;est débarrassé de l&#x27;encodage 2. Seulement l&#x27;objet <strong>[</strong><strong>email</strong><strong>.</strong><strong>contentmanager</strong><strong>.raw_data_manager</strong><strong>]</strong> ne gère que deux types de <strong>[Transfer-Content-Encoding]</strong> :</li>
<li><strong>[quoted-printable]</strong> ;</li>
<li>
<p><strong>[base64]</strong> ;
Il ignore les autres. Or Thunderbird par exemple utilise le <strong>[Transfer-Content-Encoding]</strong> nommé &quot;8bit&quot;. Cet encodage est  ignoré et les messages avec des caractères accentués sont dénaturés. Le message peut alors être obtenu par la méthode <strong>[</strong><strong>part</strong><strong>.get_payload()</strong><strong>]</strong> (lignes 15-17) ;</p>
</li>
<li>
<p>ligne 21 : lorsqu&#x27;on est là, on a le message débarrassé de son encodage de transfert, donc le message tel qu&#x27;il a été écrit par l&#x27;expéditeur ;</p>
</li>
<li>lignes 22-37 : on est dans le cas où on doit sauvegarder un message texte ;</li>
<li>lignes 24-28 : on sauvegarde les deux entêtes construits lignes 9, 13 dans le fichier <strong>[headers.txt]</strong>. Celui-ci existe déjà et contient des entêtes. Aussi utilise-t-on le mode &quot;a&quot; (ligne 25) pour ouvrir ce fichier. &quot;a&quot; signifie &quot;append&quot; et les nouveaux entêtes sont ajoutés (en fin de fichier) au contenu existant du fichier <strong>[headers.txt]</strong> ;</li>
<li>ligne 30 : le nom du fichier dans lequel sauvegarder le message texte ;</li>
<li>ligne 33 : le nom du fichier dans lequel sauvegarder le message HTML ;</li>
<li>lignes 34-37 : on sauvegarde le texte utf-8 dans un fichier ;
Revenons à la fonction <strong>[save_message]</strong> :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-72-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-72-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-72-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-72-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-72-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-72-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-72-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-72-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-72-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-72-10">10</a></span>
<span class="normal"><a href="#__codelineno-72-11">11</a></span>
<span class="normal"><a href="#__codelineno-72-12">12</a></span>
<span class="normal"><a href="#__codelineno-72-13">13</a></span>
<span class="normal"><a href="#__codelineno-72-14">14</a></span>
<span class="normal"><a href="#__codelineno-72-15">15</a></span>
<span class="normal"><a href="#__codelineno-72-16">16</a></span>
<span class="normal"><a href="#__codelineno-72-17">17</a></span>
<span class="normal"><a href="#__codelineno-72-18">18</a></span>
<span class="normal"><a href="#__codelineno-72-19">19</a></span>
<span class="normal"><a href="#__codelineno-72-20">20</a></span>
<span class="normal"><a href="#__codelineno-72-21">21</a></span>
<span class="normal"><a href="#__codelineno-72-22">22</a></span>
<span class="normal"><a href="#__codelineno-72-23">23</a></span>
<span class="normal"><a href="#__codelineno-72-24">24</a></span>
<span class="normal"><a href="#__codelineno-72-25">25</a></span>
<span class="normal"><a href="#__codelineno-72-26">26</a></span>
<span class="normal"><a href="#__codelineno-72-27">27</a></span>
<span class="normal"><a href="#__codelineno-72-28">28</a></span>
<span class="normal"><a href="#__codelineno-72-29">29</a></span>
<span class="normal"><a href="#__codelineno-72-30">30</a></span>
<span class="normal"><a href="#__codelineno-72-31">31</a></span>
<span class="normal"><a href="#__codelineno-72-32">32</a></span>
<span class="normal"><a href="#__codelineno-72-33">33</a></span>
<span class="normal"><a href="#__codelineno-72-34">34</a></span>
<span class="normal"><a href="#__codelineno-72-35">35</a></span>
<span class="normal"><a href="#__codelineno-72-36">36</a></span>
<span class="normal"><a href="#__codelineno-72-37">37</a></span>
<span class="normal"><a href="#__codelineno-72-38">38</a></span>
<span class="normal"><a href="#__codelineno-72-39">39</a></span>
<span class="normal"><a href="#__codelineno-72-40">40</a></span>
<span class="normal"><a href="#__codelineno-72-41">41</a></span>
<span class="normal"><a href="#__codelineno-72-42">42</a></span>
<span class="normal"><a href="#__codelineno-72-43">43</a></span>
<span class="normal"><a href="#__codelineno-72-44">44</a></span>
<span class="normal"><a href="#__codelineno-72-45">45</a></span>
<span class="normal"><a href="#__codelineno-72-46">46</a></span>
<span class="normal"><a href="#__codelineno-72-47">47</a></span>
<span class="normal"><a href="#__codelineno-72-48">48</a></span>
<span class="normal"><a href="#__codelineno-72-49">49</a></span>
<span class="normal"><a href="#__codelineno-72-50">50</a></span>
<span class="normal"><a href="#__codelineno-72-51">51</a></span>
<span class="normal"><a href="#__codelineno-72-52">52</a></span>
<span class="normal"><a href="#__codelineno-72-53">53</a></span>
<span class="normal"><a href="#__codelineno-72-54">54</a></span>
<span class="normal"><a href="#__codelineno-72-55">55</a></span>
<span class="normal"><a href="#__codelineno-72-56">56</a></span>
<span class="normal"><a href="#__codelineno-72-57">57</a></span>
<span class="normal"><a href="#__codelineno-72-58">58</a></span>
<span class="normal"><a href="#__codelineno-72-59">59</a></span>
<span class="normal"><a href="#__codelineno-72-60">60</a></span>
<span class="normal"><a href="#__codelineno-72-61">61</a></span>
<span class="normal"><a href="#__codelineno-72-62">62</a></span>
<span class="normal"><a href="#__codelineno-72-63">63</a></span>
<span class="normal"><a href="#__codelineno-72-64">64</a></span>
<span class="normal"><a href="#__codelineno-72-65">65</a></span>
<span class="normal"><a href="#__codelineno-72-66">66</a></span>
<span class="normal"><a href="#__codelineno-72-67">67</a></span>
<span class="normal"><a href="#__codelineno-72-68">68</a></span>
<span class="normal"><a href="#__codelineno-72-69">69</a></span>
<span class="normal"><a href="#__codelineno-72-70">70</a></span>
<span class="normal"><a href="#__codelineno-72-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1"></a><span class="c1"># sauvegarde d&#39;un message de type email.message.Message</span>
<a id="__codelineno-72-2" name="__codelineno-72-2"></a><span class="c1"># cette fonction peut être appelée de façon récursive</span>
<a id="__codelineno-72-3" name="__codelineno-72-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_message</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email_message</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">irfc822</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-72-4" name="__codelineno-72-4"></a>    <span class="c1"># output : dossier de sauvegarde des messages</span>
<a id="__codelineno-72-5" name="__codelineno-72-5"></a>    <span class="c1"># email_message : le message à sauvegarder</span>
<a id="__codelineno-72-6" name="__codelineno-72-6"></a>    <span class="c1"># irfc822 : n° courant de la numérotation des mails attachés</span>
<a id="__codelineno-72-7" name="__codelineno-72-7"></a>    <span class="c1">#</span>
<a id="__codelineno-72-8" name="__codelineno-72-8"></a>    <span class="c1"># partie du message</span>
<a id="__codelineno-72-9" name="__codelineno-72-9"></a>    <span class="n">part</span> <span class="o">=</span> <span class="n">email_message</span>
<a id="__codelineno-72-10" name="__codelineno-72-10"></a>    <span class="c1"># les entêtes [From, To, Subject] sont trouvés dans une des parties multipart</span>
<a id="__codelineno-72-11" name="__codelineno-72-11"></a>    <span class="c1"># ou bien dans une partie [text/*] lorsqu&#39;il n&#39;y a pas de partie [multipart]</span>
<a id="__codelineno-72-12" name="__codelineno-72-12"></a>    <span class="n">keys</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-72-13" name="__codelineno-72-13"></a>    <span class="c1"># From doit faire partie des entêtes, sinon la partie n&#39;a pas les entêtes qu&#39;on cherche</span>
<a id="__codelineno-72-14" name="__codelineno-72-14"></a>    <span class="k">if</span> <span class="s2">&quot;From&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
<a id="__codelineno-72-15" name="__codelineno-72-15"></a>        <span class="c1"># on récupère certains entêtes</span>
<a id="__codelineno-72-16" name="__codelineno-72-16"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;From: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;From&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-72-17" name="__codelineno-72-17"></a>                   <span class="sa">f</span><span class="s2">&quot;To: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;To&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-72-18" name="__codelineno-72-18"></a>                   <span class="sa">f</span><span class="s2">&quot;Subject: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Subject&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-72-19" name="__codelineno-72-19"></a>                   <span class="sa">f</span><span class="s2">&quot;Return-Path: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Return-Path&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-72-20" name="__codelineno-72-20"></a>                   <span class="sa">f</span><span class="s2">&quot;User-Agent: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-72-21" name="__codelineno-72-21"></a>                   <span class="sa">f</span><span class="s2">&quot;Date: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<a id="__codelineno-72-22" name="__codelineno-72-22"></a>        <span class="c1"># sauvegarde des entêtes dans un fichier texte</span>
<a id="__codelineno-72-23" name="__codelineno-72-23"></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/headers.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-72-24" name="__codelineno-72-24"></a>            <span class="c1"># écriture dans fichier</span>
<a id="__codelineno-72-25" name="__codelineno-72-25"></a>            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-72-26" name="__codelineno-72-26"></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-72-27" name="__codelineno-72-27"></a>
<a id="__codelineno-72-28" name="__codelineno-72-28"></a>    <span class="c1"># type de la partie [part]</span>
<a id="__codelineno-72-29" name="__codelineno-72-29"></a>    <span class="n">main_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">()</span>
<a id="__codelineno-72-30" name="__codelineno-72-30"></a>    <span class="n">sub_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">()</span>
<a id="__codelineno-72-31" name="__codelineno-72-31"></a>    <span class="n">type_of_part</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sub_type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-72-32" name="__codelineno-72-32"></a>    <span class="c1"># si le message est de type text/plain</span>
<a id="__codelineno-72-33" name="__codelineno-72-33"></a>    <span class="k">if</span> <span class="n">type_of_part</span> <span class="o">==</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">:</span>
<a id="__codelineno-72-34" name="__codelineno-72-34"></a>        <span class="c1"># message texte</span>
<a id="__codelineno-72-35" name="__codelineno-72-35"></a>        <span class="n">save_textmessage</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-72-36" name="__codelineno-72-36"></a>
<a id="__codelineno-72-37" name="__codelineno-72-37"></a>    <span class="c1"># si le message est de type text/html</span>
<a id="__codelineno-72-38" name="__codelineno-72-38"></a>    <span class="k">elif</span> <span class="n">type_of_part</span> <span class="o">==</span> <span class="s2">&quot;text/html&quot;</span><span class="p">:</span>
<a id="__codelineno-72-39" name="__codelineno-72-39"></a>        <span class="c1"># message HTML</span>
<a id="__codelineno-72-40" name="__codelineno-72-40"></a>        <span class="n">save_textmessage</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-72-41" name="__codelineno-72-41"></a>
<a id="__codelineno-72-42" name="__codelineno-72-42"></a>    <span class="c1"># si le message est un conteneur de parties</span>
<a id="__codelineno-72-43" name="__codelineno-72-43"></a>    <span class="k">elif</span> <span class="n">part</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">():</span>
<a id="__codelineno-72-44" name="__codelineno-72-44"></a>        <span class="c1"># cas particulier du mail attaché</span>
<a id="__codelineno-72-45" name="__codelineno-72-45"></a>        <span class="k">if</span> <span class="n">type_of_part</span> <span class="o">==</span> <span class="s2">&quot;message/rfc822&quot;</span><span class="p">:</span>
<a id="__codelineno-72-46" name="__codelineno-72-46"></a>            <span class="c1"># création d&#39;un nouveau dossier output2 pour le mail attaché</span>
<a id="__codelineno-72-47" name="__codelineno-72-47"></a>            <span class="n">irfc822</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-72-48" name="__codelineno-72-48"></a>            <span class="n">output2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/rfc822_</span><span class="si">{</span><span class="n">irfc822</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-72-49" name="__codelineno-72-49"></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output2</span><span class="p">)</span>
<a id="__codelineno-72-50" name="__codelineno-72-50"></a>            <span class="c1"># sauvegarde des sous-parties du message irfc822 dans output2</span>
<a id="__codelineno-72-51" name="__codelineno-72-51"></a>            <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">():</span>
<a id="__codelineno-72-52" name="__codelineno-72-52"></a>                <span class="c1"># dans le nouveau dossier irfc822 redémarre à 0</span>
<a id="__codelineno-72-53" name="__codelineno-72-53"></a>                <span class="n">save_message</span><span class="p">(</span><span class="n">output2</span><span class="p">,</span> <span class="n">subpart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-72-54" name="__codelineno-72-54"></a>
<a id="__codelineno-72-55" name="__codelineno-72-55"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-72-56" name="__codelineno-72-56"></a>            <span class="c1"># on n&#39;a pas affaire à un mail attaché</span>
<a id="__codelineno-72-57" name="__codelineno-72-57"></a>            <span class="c1"># sauvegarde des sous-parties dans le dossier courant output</span>
<a id="__codelineno-72-58" name="__codelineno-72-58"></a>            <span class="c1"># irfc822 doit alors être incrémenté pour chaque sous-partie message/rfc822</span>
<a id="__codelineno-72-59" name="__codelineno-72-59"></a>            <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">():</span>
<a id="__codelineno-72-60" name="__codelineno-72-60"></a>                <span class="c1"># save_message rend la dernière valeur de irfc822</span>
<a id="__codelineno-72-61" name="__codelineno-72-61"></a>                <span class="c1"># incrémentée de 1 si subpart=&quot;message/rfc822&quot;, pas incrémentée sinon</span>
<a id="__codelineno-72-62" name="__codelineno-72-62"></a>                <span class="n">irfc822</span> <span class="o">=</span> <span class="n">save_message</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">subpart</span><span class="p">,</span> <span class="n">irfc822</span><span class="p">)</span>
<a id="__codelineno-72-63" name="__codelineno-72-63"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-72-64" name="__codelineno-72-64"></a>        <span class="c1"># autres cas (pas text/plain, pas text/html, pas multipart)</span>
<a id="__codelineno-72-65" name="__codelineno-72-65"></a>        <span class="c1"># attachement ?</span>
<a id="__codelineno-72-66" name="__codelineno-72-66"></a>        <span class="n">disposition</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">)</span>
<a id="__codelineno-72-67" name="__codelineno-72-67"></a>        <span class="k">if</span> <span class="n">disposition</span> <span class="ow">and</span> <span class="n">disposition</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;attachment&#39;</span><span class="p">):</span>
<a id="__codelineno-72-68" name="__codelineno-72-68"></a>            <span class="n">save_attachment</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">part</span><span class="p">)</span>
<a id="__codelineno-72-69" name="__codelineno-72-69"></a>    <span class="c1"># on ignore les autres parties (pas text/plain, pas text/html, pas attachment)</span>
<a id="__codelineno-72-70" name="__codelineno-72-70"></a>    <span class="c1"># on rend la valeur actuelle de irfc822 (numérotation des mails attachés rangés dans le dossier output)</span>
<a id="__codelineno-72-71" name="__codelineno-72-71"></a>    <span class="k">return</span> <span class="n">irfc822</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 33-40 : nous avons traité deux cas possibles d&#x27;un message à une extrémité de l&#x27;arbre du message initial (pas de sous-parties). Il nous reste encore deux cas à traiter :</li>
<li>lignes 43-62 : le cas où la partie analysée contient elle-même des sous-parties (part.ismultipart()==True) ;</li>
<li>
<p>lignes 63-68 : pour les cas restants, on ne traite que le cas où la partie analysée est un attachement ;
Nous traitons ce dernier cas. Nous sommes là encore à une extrémité du message initial (pas de sous-parties). Nous avons déjà rencontré deux cas de cette espèce : les types <strong>text/plain</strong> et <strong>text/html</strong>. Nous traitons maintenant le cas du fichier attaché.</p>
</li>
<li>
<p>ligne 66 : l&#x27;attachement est repéré par la clé <strong>[Content-Disposition]</strong> ;</p>
</li>
<li>ligne 67 : si cette clé existe et que celle-ci commence par la chaîne <strong>[attachment]</strong>, alors on a affaire à une pièce attachée au message ;</li>
<li>ligne 68 : l&#x27;attachement est sauvegardé dans le dossier <strong>[output]</strong> ;
La fonction <strong>[</strong><strong>save_attachment</strong><strong>]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-73-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-73-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-73-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-73-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-73-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-73-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-73-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-73-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-73-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-73-10">10</a></span>
<span class="normal"><a href="#__codelineno-73-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1"></a><span class="c1"># sauvegarde d&#39;un attachement</span>
<a id="__codelineno-73-2" name="__codelineno-73-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_attachment</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">part</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
<a id="__codelineno-73-3" name="__codelineno-73-3"></a>    <span class="c1"># nom du fichier attaché</span>
<a id="__codelineno-73-4" name="__codelineno-73-4"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get_filename</span><span class="p">())</span>
<a id="__codelineno-73-5" name="__codelineno-73-5"></a>
<a id="__codelineno-73-6" name="__codelineno-73-6"></a>    <span class="c1"># le nom du fichier peut être encodé</span>
<a id="__codelineno-73-7" name="__codelineno-73-7"></a>    <span class="c1"># par exemple =?utf-8?Q?Cours-Tutoriels-Serge-Tah=C3=A9-1568x268=2Ep</span>
<a id="__codelineno-73-8" name="__codelineno-73-8"></a>    <span class="n">filename</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-73-9" name="__codelineno-73-9"></a>    <span class="c1"># on sauvegarde le fichier attaché</span>
<a id="__codelineno-73-10" name="__codelineno-73-10"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-73-11" name="__codelineno-73-11"></a>        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 4 : si <strong>[part]</strong> est un attachement, alors le nom du fichier attaché est obtenu par <strong>[part.get_filename]</strong>. On ne garde que le nom du fichier pas son chemin ;</li>
<li>ligne 8 : les noms des fichiers sont généralement encodés et ce de la même façon que les entêtes du message. Aussi utilise-t-on la fonction <strong>[decode_header]</strong> pour le décoder ;</li>
<li>ligne 11 : le contenu du fichier attaché est pour l&#x27;instant une chaîne de caractères produite par l&#x27;encodage (souvent base64) en texte du contenu initial du fichier. Pour obtenir ce contenu initial on utilise la fonction <strong>[</strong><strong>part</strong><strong>.get_payload(decode=</strong><strong>True</strong><strong>)</strong><strong>]</strong>. Le paramètre <strong>[</strong><strong>decode=</strong><strong>True</strong><strong>]</strong> indique que le contenu de la pièce attachée doit être décodé. On obtient alors une suite d&#x27;octets ;</li>
<li>ligne 10 : cette suite d&#x27;octets est sauvegardée dans le fichier <strong>[output/filename]</strong>. Le mode &quot;wb&quot; d&#x27;ouverture du fichier signifie write binary ;
Revenons au code de la fonction <strong>[save_message]</strong> :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-74-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-74-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-74-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-74-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-74-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-74-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-74-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-74-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-74-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-74-10">10</a></span>
<span class="normal"><a href="#__codelineno-74-11">11</a></span>
<span class="normal"><a href="#__codelineno-74-12">12</a></span>
<span class="normal"><a href="#__codelineno-74-13">13</a></span>
<span class="normal"><a href="#__codelineno-74-14">14</a></span>
<span class="normal"><a href="#__codelineno-74-15">15</a></span>
<span class="normal"><a href="#__codelineno-74-16">16</a></span>
<span class="normal"><a href="#__codelineno-74-17">17</a></span>
<span class="normal"><a href="#__codelineno-74-18">18</a></span>
<span class="normal"><a href="#__codelineno-74-19">19</a></span>
<span class="normal"><a href="#__codelineno-74-20">20</a></span>
<span class="normal"><a href="#__codelineno-74-21">21</a></span>
<span class="normal"><a href="#__codelineno-74-22">22</a></span>
<span class="normal"><a href="#__codelineno-74-23">23</a></span>
<span class="normal"><a href="#__codelineno-74-24">24</a></span>
<span class="normal"><a href="#__codelineno-74-25">25</a></span>
<span class="normal"><a href="#__codelineno-74-26">26</a></span>
<span class="normal"><a href="#__codelineno-74-27">27</a></span>
<span class="normal"><a href="#__codelineno-74-28">28</a></span>
<span class="normal"><a href="#__codelineno-74-29">29</a></span>
<span class="normal"><a href="#__codelineno-74-30">30</a></span>
<span class="normal"><a href="#__codelineno-74-31">31</a></span>
<span class="normal"><a href="#__codelineno-74-32">32</a></span>
<span class="normal"><a href="#__codelineno-74-33">33</a></span>
<span class="normal"><a href="#__codelineno-74-34">34</a></span>
<span class="normal"><a href="#__codelineno-74-35">35</a></span>
<span class="normal"><a href="#__codelineno-74-36">36</a></span>
<span class="normal"><a href="#__codelineno-74-37">37</a></span>
<span class="normal"><a href="#__codelineno-74-38">38</a></span>
<span class="normal"><a href="#__codelineno-74-39">39</a></span>
<span class="normal"><a href="#__codelineno-74-40">40</a></span>
<span class="normal"><a href="#__codelineno-74-41">41</a></span>
<span class="normal"><a href="#__codelineno-74-42">42</a></span>
<span class="normal"><a href="#__codelineno-74-43">43</a></span>
<span class="normal"><a href="#__codelineno-74-44">44</a></span>
<span class="normal"><a href="#__codelineno-74-45">45</a></span>
<span class="normal"><a href="#__codelineno-74-46">46</a></span>
<span class="normal"><a href="#__codelineno-74-47">47</a></span>
<span class="normal"><a href="#__codelineno-74-48">48</a></span>
<span class="normal"><a href="#__codelineno-74-49">49</a></span>
<span class="normal"><a href="#__codelineno-74-50">50</a></span>
<span class="normal"><a href="#__codelineno-74-51">51</a></span>
<span class="normal"><a href="#__codelineno-74-52">52</a></span>
<span class="normal"><a href="#__codelineno-74-53">53</a></span>
<span class="normal"><a href="#__codelineno-74-54">54</a></span>
<span class="normal"><a href="#__codelineno-74-55">55</a></span>
<span class="normal"><a href="#__codelineno-74-56">56</a></span>
<span class="normal"><a href="#__codelineno-74-57">57</a></span>
<span class="normal"><a href="#__codelineno-74-58">58</a></span>
<span class="normal"><a href="#__codelineno-74-59">59</a></span>
<span class="normal"><a href="#__codelineno-74-60">60</a></span>
<span class="normal"><a href="#__codelineno-74-61">61</a></span>
<span class="normal"><a href="#__codelineno-74-62">62</a></span>
<span class="normal"><a href="#__codelineno-74-63">63</a></span>
<span class="normal"><a href="#__codelineno-74-64">64</a></span>
<span class="normal"><a href="#__codelineno-74-65">65</a></span>
<span class="normal"><a href="#__codelineno-74-66">66</a></span>
<span class="normal"><a href="#__codelineno-74-67">67</a></span>
<span class="normal"><a href="#__codelineno-74-68">68</a></span>
<span class="normal"><a href="#__codelineno-74-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_message</span><span class="p">(</span><span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email_message</span><span class="p">:</span> <span class="n">email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">Message</span><span class="p">,</span> <span class="n">irfc822</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-74-2" name="__codelineno-74-2"></a>    <span class="c1"># output : dossier de sauvegarde des messages</span>
<a id="__codelineno-74-3" name="__codelineno-74-3"></a>    <span class="c1"># email_message : le message à sauvegarder</span>
<a id="__codelineno-74-4" name="__codelineno-74-4"></a>    <span class="c1"># irfc822 : n° courant de la numérotation des mails attachés</span>
<a id="__codelineno-74-5" name="__codelineno-74-5"></a>    <span class="c1">#</span>
<a id="__codelineno-74-6" name="__codelineno-74-6"></a>    <span class="c1"># partie du message</span>
<a id="__codelineno-74-7" name="__codelineno-74-7"></a>    <span class="n">part</span> <span class="o">=</span> <span class="n">email_message</span>
<a id="__codelineno-74-8" name="__codelineno-74-8"></a>    <span class="c1"># les entêtes [From, To, Subject] sont trouvés dans une des parties multipart</span>
<a id="__codelineno-74-9" name="__codelineno-74-9"></a>    <span class="c1"># ou bien dans une partie [text/*] lorsqu&#39;il n&#39;y a pas de partie [multipart]</span>
<a id="__codelineno-74-10" name="__codelineno-74-10"></a>    <span class="n">keys</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-74-11" name="__codelineno-74-11"></a>    <span class="c1"># From doit faire partie des entêtes, sinon la partie n&#39;a pas les entêtes qu&#39;on cherche</span>
<a id="__codelineno-74-12" name="__codelineno-74-12"></a>    <span class="k">if</span> <span class="s2">&quot;From&quot;</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
<a id="__codelineno-74-13" name="__codelineno-74-13"></a>        <span class="c1"># on récupère certains entêtes</span>
<a id="__codelineno-74-14" name="__codelineno-74-14"></a>        <span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;From: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;From&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-74-15" name="__codelineno-74-15"></a>                   <span class="sa">f</span><span class="s2">&quot;To: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;To&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-74-16" name="__codelineno-74-16"></a>                   <span class="sa">f</span><span class="s2">&quot;Subject: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Subject&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-74-17" name="__codelineno-74-17"></a>                   <span class="sa">f</span><span class="s2">&quot;Return-Path: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Return-Path&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-74-18" name="__codelineno-74-18"></a>                   <span class="sa">f</span><span class="s2">&quot;User-Agent: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-74-19" name="__codelineno-74-19"></a>                   <span class="sa">f</span><span class="s2">&quot;Date: </span><span class="si">{</span><span class="n">decode_header</span><span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<a id="__codelineno-74-20" name="__codelineno-74-20"></a>        <span class="c1"># sauvegarde des entêtes dans un fichier texte</span>
<a id="__codelineno-74-21" name="__codelineno-74-21"></a>        <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/headers.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-74-22" name="__codelineno-74-22"></a>            <span class="c1"># écriture dans fichier</span>
<a id="__codelineno-74-23" name="__codelineno-74-23"></a>            <span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
<a id="__codelineno-74-24" name="__codelineno-74-24"></a>            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-74-25" name="__codelineno-74-25"></a>
<a id="__codelineno-74-26" name="__codelineno-74-26"></a>    <span class="c1"># type de la partie [part]</span>
<a id="__codelineno-74-27" name="__codelineno-74-27"></a>    <span class="n">main_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_maintype</span><span class="p">()</span>
<a id="__codelineno-74-28" name="__codelineno-74-28"></a>    <span class="n">sub_type</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get_content_subtype</span><span class="p">()</span>
<a id="__codelineno-74-29" name="__codelineno-74-29"></a>    <span class="n">type_of_part</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">main_type</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">sub_type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-74-30" name="__codelineno-74-30"></a>    <span class="c1"># si le message est de type text/plain</span>
<a id="__codelineno-74-31" name="__codelineno-74-31"></a>    <span class="k">if</span> <span class="n">type_of_part</span> <span class="o">==</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">:</span>
<a id="__codelineno-74-32" name="__codelineno-74-32"></a>        <span class="c1"># message texte</span>
<a id="__codelineno-74-33" name="__codelineno-74-33"></a>        <span class="n">save_textmessage</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-74-34" name="__codelineno-74-34"></a>
<a id="__codelineno-74-35" name="__codelineno-74-35"></a>    <span class="c1"># si le message est de type text/html</span>
<a id="__codelineno-74-36" name="__codelineno-74-36"></a>    <span class="k">elif</span> <span class="n">type_of_part</span> <span class="o">==</span> <span class="s2">&quot;text/html&quot;</span><span class="p">:</span>
<a id="__codelineno-74-37" name="__codelineno-74-37"></a>        <span class="c1"># message HTML</span>
<a id="__codelineno-74-38" name="__codelineno-74-38"></a>        <span class="n">save_textmessage</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">part</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-74-39" name="__codelineno-74-39"></a>
<a id="__codelineno-74-40" name="__codelineno-74-40"></a>    <span class="c1"># si le message est un conteneur de parties</span>
<a id="__codelineno-74-41" name="__codelineno-74-41"></a>    <span class="k">elif</span> <span class="n">part</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">():</span>
<a id="__codelineno-74-42" name="__codelineno-74-42"></a>        <span class="c1"># cas particulier du mail attaché</span>
<a id="__codelineno-74-43" name="__codelineno-74-43"></a>        <span class="k">if</span> <span class="n">type_of_part</span> <span class="o">==</span> <span class="s2">&quot;message/rfc822&quot;</span><span class="p">:</span>
<a id="__codelineno-74-44" name="__codelineno-74-44"></a>            <span class="c1"># création d&#39;un nouveau dossier output2 pour le mail attaché</span>
<a id="__codelineno-74-45" name="__codelineno-74-45"></a>            <span class="n">irfc822</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-74-46" name="__codelineno-74-46"></a>            <span class="n">output2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/rfc822_</span><span class="si">{</span><span class="n">irfc822</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-74-47" name="__codelineno-74-47"></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output2</span><span class="p">)</span>
<a id="__codelineno-74-48" name="__codelineno-74-48"></a>            <span class="c1"># sauvegarde des sous-parties du message irfc822 dans output2</span>
<a id="__codelineno-74-49" name="__codelineno-74-49"></a>            <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">():</span>
<a id="__codelineno-74-50" name="__codelineno-74-50"></a>                <span class="c1"># dans le nouveau dossier irfc822 redémarre à 0</span>
<a id="__codelineno-74-51" name="__codelineno-74-51"></a>                <span class="n">save_message</span><span class="p">(</span><span class="n">output2</span><span class="p">,</span> <span class="n">subpart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-74-52" name="__codelineno-74-52"></a>
<a id="__codelineno-74-53" name="__codelineno-74-53"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-74-54" name="__codelineno-74-54"></a>            <span class="c1"># on n&#39;a pas affaire à un mail attaché</span>
<a id="__codelineno-74-55" name="__codelineno-74-55"></a>            <span class="c1"># sauvegarde des sous-parties dans le dossier courant output</span>
<a id="__codelineno-74-56" name="__codelineno-74-56"></a>            <span class="c1"># irfc822 doit alors être incrémenté pour chaque sous-partie message/rfc822</span>
<a id="__codelineno-74-57" name="__codelineno-74-57"></a>            <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">():</span>
<a id="__codelineno-74-58" name="__codelineno-74-58"></a>                <span class="c1"># save_message rend la dernière valeur de irfc822</span>
<a id="__codelineno-74-59" name="__codelineno-74-59"></a>                <span class="c1"># incrémentée de 1 si subpart=&quot;message/rfc822&quot;, pas incrémentée sinon</span>
<a id="__codelineno-74-60" name="__codelineno-74-60"></a>                <span class="n">irfc822</span> <span class="o">=</span> <span class="n">save_message</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">subpart</span><span class="p">,</span> <span class="n">irfc822</span><span class="p">)</span>
<a id="__codelineno-74-61" name="__codelineno-74-61"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-74-62" name="__codelineno-74-62"></a>        <span class="c1"># autres cas (pas text/plain, pas text/html, pas multipart)</span>
<a id="__codelineno-74-63" name="__codelineno-74-63"></a>        <span class="c1"># attachement ?</span>
<a id="__codelineno-74-64" name="__codelineno-74-64"></a>        <span class="n">disposition</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">)</span>
<a id="__codelineno-74-65" name="__codelineno-74-65"></a>        <span class="k">if</span> <span class="n">disposition</span> <span class="ow">and</span> <span class="n">disposition</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;attachment&#39;</span><span class="p">):</span>
<a id="__codelineno-74-66" name="__codelineno-74-66"></a>            <span class="n">save_attachment</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">part</span><span class="p">)</span>
<a id="__codelineno-74-67" name="__codelineno-74-67"></a>    <span class="c1"># on ignore les autres parties (pas text/plain, pas text/html, pas attachment)</span>
<a id="__codelineno-74-68" name="__codelineno-74-68"></a>    <span class="c1"># on rend la valeur actuelle de irfc822 (numérotation des mails attachés rangés dans le dossier output)</span>
<a id="__codelineno-74-69" name="__codelineno-74-69"></a>    <span class="k">return</span> <span class="n">irfc822</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>nous avons traité les cas des terminaisons de l&#x27;arbre du message initial : les parties <strong>[text/plain, text/html et Content-Disposition=attachment;…]</strong> Il nous reste à traiter le cas où la partie analysée est un conteneur de parties, ç-à-d qu&#x27;elle contient des sous-parties <strong>[part.is_multipart()==True]</strong>, ligne 41. Pour arriver aux terminaisons de l&#x27;arbre du message, il faut donc analyser ces sous-parties ;</li>
<li>ligne 43 : on traite de façon particulière le cas où la partie analysée a un type <strong>[message/rfc822]</strong>. C&#x27;est le type d&#x27;un mail. C&#x27;est donc le cas où un mail a comme pièce attachée un autre mail ;
Le code est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-75-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-75-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-75-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-75-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-75-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-75-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-75-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-75-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-75-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-75-10">10</a></span>
<span class="normal"><a href="#__codelineno-75-11">11</a></span>
<span class="normal"><a href="#__codelineno-75-12">12</a></span>
<span class="normal"><a href="#__codelineno-75-13">13</a></span>
<span class="normal"><a href="#__codelineno-75-14">14</a></span>
<span class="normal"><a href="#__codelineno-75-15">15</a></span>
<span class="normal"><a href="#__codelineno-75-16">16</a></span>
<span class="normal"><a href="#__codelineno-75-17">17</a></span>
<span class="normal"><a href="#__codelineno-75-18">18</a></span>
<span class="normal"><a href="#__codelineno-75-19">19</a></span>
<span class="normal"><a href="#__codelineno-75-20">20</a></span>
<span class="normal"><a href="#__codelineno-75-21">21</a></span>
<span class="normal"><a href="#__codelineno-75-22">22</a></span>
<span class="normal"><a href="#__codelineno-75-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1"></a>    <span class="c1"># si le message est un conteneur de parties</span>
<a id="__codelineno-75-2" name="__codelineno-75-2"></a>    <span class="k">elif</span> <span class="n">part</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">():</span>
<a id="__codelineno-75-3" name="__codelineno-75-3"></a>        <span class="c1"># cas particulier du mail attaché</span>
<a id="__codelineno-75-4" name="__codelineno-75-4"></a>        <span class="k">if</span> <span class="n">type_of_part</span> <span class="o">==</span> <span class="s2">&quot;message/rfc822&quot;</span><span class="p">:</span>
<a id="__codelineno-75-5" name="__codelineno-75-5"></a>            <span class="c1"># création d&#39;un nouveau dossier output2 pour le mail attaché</span>
<a id="__codelineno-75-6" name="__codelineno-75-6"></a>            <span class="n">irfc822</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-75-7" name="__codelineno-75-7"></a>            <span class="n">output2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/rfc822_</span><span class="si">{</span><span class="n">irfc822</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-75-8" name="__codelineno-75-8"></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output2</span><span class="p">)</span>
<a id="__codelineno-75-9" name="__codelineno-75-9"></a>            <span class="c1"># sauvegarde des sous-parties du message irfc822 dans output2</span>
<a id="__codelineno-75-10" name="__codelineno-75-10"></a>            <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">():</span>
<a id="__codelineno-75-11" name="__codelineno-75-11"></a>                <span class="c1"># dans le nouveau dossier irfc822 redémarre à 0</span>
<a id="__codelineno-75-12" name="__codelineno-75-12"></a>                <span class="n">save_message</span><span class="p">(</span><span class="n">output2</span><span class="p">,</span> <span class="n">subpart</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-75-13" name="__codelineno-75-13"></a>
<a id="__codelineno-75-14" name="__codelineno-75-14"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-75-15" name="__codelineno-75-15"></a>            <span class="c1"># on n&#39;a pas affaire à un mail attaché</span>
<a id="__codelineno-75-16" name="__codelineno-75-16"></a>            <span class="c1"># sauvegarde des sous-parties dans le dossier courant output</span>
<a id="__codelineno-75-17" name="__codelineno-75-17"></a>            <span class="c1"># irfc822 doit alors être incrémenté pour chaque sous-partie message/rfc822</span>
<a id="__codelineno-75-18" name="__codelineno-75-18"></a>            <span class="k">for</span> <span class="n">subpart</span> <span class="ow">in</span> <span class="n">part</span><span class="o">.</span><span class="n">get_payload</span><span class="p">():</span>
<a id="__codelineno-75-19" name="__codelineno-75-19"></a>                <span class="c1"># save_message rend la dernière valeur de irfc822</span>
<a id="__codelineno-75-20" name="__codelineno-75-20"></a>                <span class="c1"># incrémentée de 1 si subpart=&quot;message/rfc822&quot;, pas incrémentée sinon</span>
<a id="__codelineno-75-21" name="__codelineno-75-21"></a>                <span class="n">irfc822</span> <span class="o">=</span> <span class="n">save_message</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">subpart</span><span class="p">,</span> <span class="n">irfc822</span><span class="p">)</span>
<a id="__codelineno-75-22" name="__codelineno-75-22"></a><span class="err">…</span>
<a id="__codelineno-75-23" name="__codelineno-75-23"></a>    <span class="k">return</span> <span class="n">irfc822</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>la différence entre une partie <strong>[message/rfc822]</strong> et les autres parties multipart est que le dossier de sauvegarde change ;</li>
<li>lignes 6-8 : pour la partie <strong>[message/rfc822]</strong>, le dossier de sauvegarde devient celui de la ligne 7 <strong>[output/rfc822_x]</strong> où x est le n° du mail attaché, 1 pour le premier, 2 pour le deuxième… ;</li>
<li>ligne 21 : pour les autres parties multipart, le dossier de sauvegarde continue à être le dossier <strong>[output]</strong> du message initial. On ne change pas de dossier ;</li>
<li>lignes 10-12 : chaque sous-partie est sauvegardée par un appel récursif à <strong>[save_message]</strong>. Le 3e paramètre est l&#x27;indice de numérotation des mails encapsulés dans <strong>[subpart]</strong>. Au départ cet indice vaut 0 ;</li>
<li>
<p>ligne 21 : même explication que pour la ligne 12, mais la valeur du 3e paramètre <strong>[irfc822]</strong> change. Si dans la boucle des lignes 18-21, il y a plusieurs mails encapsulés, ils doivent être rangés dans des dossiers <strong>[…/rfc822-1…/rfc822_2…]</strong>. Donc le 3e paramètre de la fonction <strong>[save_message]</strong> doit avoir successivement les valeurs, 1, 2, 3… Pour ce faire, <strong>[save_message]</strong> rend la valeur de <strong>[irfc822]</strong> (ligne 21).
Prenons un exemple et supposons que la liste des sous-parties de la ligne 18 soit <strong>[subpart1, subpart2, subpart3, subpart4, subpart5]</strong> et que <strong>[subpart1, subpart3, subpart5]</strong> soient des mails attachés, <strong>[subpart2]</strong> une partie text/plain et <strong>[subpart4]</strong> un attachement, et qu&#x27;on n&#x27;a pas encore rencontré de mail attaché dans le message <strong>[irfc822=0]</strong>. Dans ce cas :</p>
</li>
<li>
<p><strong>[subpart1]</strong> est sauvegardé par la ligne 21 : la fonction <strong>[saveMessage]</strong> est exécutée avec irfc822=0 ;</p>
</li>
<li><strong>[subpart1]</strong> est un mail attaché, donc irfc822 passe à 1 (ligne 6 du code). Un dossier <strong>[output/irfc822_1]</strong> est créé. La valeur rendue par <strong>[saveMessage(ouput,subpart1,0)]</strong> est donc 1 (ligne 23) ;</li>
<li><strong>[subpart2]</strong> est sauvegardé par la ligne 21 : la fonction <strong>[saveMessage]</strong> est exécutée avec irfc822=1 ;</li>
<li><strong>[subpart2]</strong> n&#x27;est pas un mail attaché. Donc irfc822 reste à 1. C&#x27;est la valeur récupérée ligne 21 ;</li>
<li><strong>[subpart3]</strong> est sauvegardé par la ligne 21 : la fonction <strong>[save_message]</strong> est exécutée avec irfc822=1 ;</li>
<li><strong>[subpart3]</strong> est un mail attaché, donc irfc822 passe à 2 (ligne 6 du code).  Un dossier <strong>[output/irfc822_2]</strong> est créé. La valeur rendue par <strong>[save_message(ouput,subpart1,1)]</strong> est donc 2 (ligne 21) ;</li>
<li><strong>[subpart4]</strong> est sauvegardé par la ligne 21 : la fonction <strong>[save_message]</strong> est exécutée avec irfc822=2 ;</li>
<li><strong>[subpart4]</strong> n&#x27;est pas un mail attaché. Donc irfc822 reste à 2. C&#x27;est la valeur récupérée ligne 21 ;</li>
<li><strong>[subpart5]</strong> est sauvegardé par la ligne 21 : la fonction <strong>[save_message]</strong> est exécutée avec irfc822=2 ;</li>
<li><strong>[subpart5]</strong> est un mail attaché, donc irfc822 passe à 3 (ligne 6 du code). Un dossier <strong>[output/irfc822_3]</strong> est créé.  La valeur rendue par <strong>[save_message(ouput,subpart1,2)]</strong> est donc 3 (ligne 21) ;
 <strong>Exemples d&#x27;exécution</strong></li>
</ul>
<p>Nous envoyons 4 mails à <strong>[pymail2parlexemple@gmail.com]</strong> à partir de : <strong>[Gmail, Outlook, em Client, Thunderbird]</strong></p>
<ul>
<li><strong>[Gmail]</strong> : [<a href="https://mail.google.com/">https://mail.google.com/</a>] ;</li>
<li><strong>[Outlook]</strong> : [<a href="https://outlook.live.com/owa/">https://outlook.live.com/owa/</a>] ;</li>
<li><strong>[em Client]</strong> : [<a href="https://www.emclient.com/">https://www.emclient.com/</a>] ;</li>
<li><strong>[Mozilla Thunderbird]</strong> : <strong>[https://www.thunderbird.net/fr/]</strong> ;
Tous les mails auront le sujet <strong>[hélène va au marché]</strong> et comme texte <strong>[acheter des légumes]</strong>. On veut tester comment sont récupérés les caractères accentués.</li>
</ul>
<p>Nous les lisons avec le script <strong>[pop3/02/main]</strong> configuré avec le fichier <strong>[pop3/02/config]</strong> suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-76-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-76-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-76-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-76-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-76-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-76-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-76-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-76-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-76-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-76-10">10</a></span>
<span class="normal"><a href="#__codelineno-76-11">11</a></span>
<span class="normal"><a href="#__codelineno-76-12">12</a></span>
<span class="normal"><a href="#__codelineno-76-13">13</a></span>
<span class="normal"><a href="#__codelineno-76-14">14</a></span>
<span class="normal"><a href="#__codelineno-76-15">15</a></span>
<span class="normal"><a href="#__codelineno-76-16">16</a></span>
<span class="normal"><a href="#__codelineno-76-17">17</a></span>
<span class="normal"><a href="#__codelineno-76-18">18</a></span>
<span class="normal"><a href="#__codelineno-76-19">19</a></span>
<span class="normal"><a href="#__codelineno-76-20">20</a></span>
<span class="normal"><a href="#__codelineno-76-21">21</a></span>
<span class="normal"><a href="#__codelineno-76-22">22</a></span>
<span class="normal"><a href="#__codelineno-76-23">23</a></span>
<span class="normal"><a href="#__codelineno-76-24">24</a></span>
<span class="normal"><a href="#__codelineno-76-25">25</a></span>
<span class="normal"><a href="#__codelineno-76-26">26</a></span>
<span class="normal"><a href="#__codelineno-76-27">27</a></span>
<span class="normal"><a href="#__codelineno-76-28">28</a></span>
<span class="normal"><a href="#__codelineno-76-29">29</a></span>
<span class="normal"><a href="#__codelineno-76-30">30</a></span>
<span class="normal"><a href="#__codelineno-76-31">31</a></span>
<span class="normal"><a href="#__codelineno-76-32">32</a></span>
<span class="normal"><a href="#__codelineno-76-33">33</a></span>
<span class="normal"><a href="#__codelineno-76-34">34</a></span>
<span class="normal"><a href="#__codelineno-76-35">35</a></span>
<span class="normal"><a href="#__codelineno-76-36">36</a></span>
<span class="normal"><a href="#__codelineno-76-37">37</a></span>
<span class="normal"><a href="#__codelineno-76-38">38</a></span>
<span class="normal"><a href="#__codelineno-76-39">39</a></span>
<span class="normal"><a href="#__codelineno-76-40">40</a></span>
<span class="normal"><a href="#__codelineno-76-41">41</a></span>
<span class="normal"><a href="#__codelineno-76-42">42</a></span>
<span class="normal"><a href="#__codelineno-76-43">43</a></span>
<span class="normal"><a href="#__codelineno-76-44">44</a></span>
<span class="normal"><a href="#__codelineno-76-45">45</a></span>
<span class="normal"><a href="#__codelineno-76-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-76-2" name="__codelineno-76-2"></a>
<a id="__codelineno-76-3" name="__codelineno-76-3"></a>
<a id="__codelineno-76-4" name="__codelineno-76-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-76-5" name="__codelineno-76-5"></a>    <span class="c1"># configuration de l&#39;appli</span>
<a id="__codelineno-76-6" name="__codelineno-76-6"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-76-7" name="__codelineno-76-7"></a>        <span class="c1"># liste des boîtes à lettres à gérer</span>
<a id="__codelineno-76-8" name="__codelineno-76-8"></a>        <span class="s2">&quot;mailboxes&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-76-9" name="__codelineno-76-9"></a>            <span class="c1"># server : serveur POP3</span>
<a id="__codelineno-76-10" name="__codelineno-76-10"></a>            <span class="c1"># port : port du serveur POP3</span>
<a id="__codelineno-76-11" name="__codelineno-76-11"></a>            <span class="c1"># user : utilisateur dont on veut lire les messages</span>
<a id="__codelineno-76-12" name="__codelineno-76-12"></a>            <span class="c1"># password : son mot de passe</span>
<a id="__codelineno-76-13" name="__codelineno-76-13"></a>            <span class="c1"># maxmails : le nombre maximum de mail à télécharger</span>
<a id="__codelineno-76-14" name="__codelineno-76-14"></a>            <span class="c1"># timeout : délai d&#39;attente maximal d&#39;une réponse du serveur</span>
<a id="__codelineno-76-15" name="__codelineno-76-15"></a>            <span class="c1"># delete : à vrai s&#39;il faut supprimer du serveur les messages téléchargés</span>
<a id="__codelineno-76-16" name="__codelineno-76-16"></a>            <span class="c1"># ssl : à vrai si la lecture des mails se fait au travers d&#39;une liaison sécurisée</span>
<a id="__codelineno-76-17" name="__codelineno-76-17"></a>            <span class="c1"># output : le dossier de rangement des messages téléchargés</span>
<a id="__codelineno-76-18" name="__codelineno-76-18"></a>
<a id="__codelineno-76-19" name="__codelineno-76-19"></a>            <span class="p">{</span>
<a id="__codelineno-76-20" name="__codelineno-76-20"></a>                <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;pop.gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-76-21" name="__codelineno-76-21"></a>                <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;995&quot;</span><span class="p">,</span>
<a id="__codelineno-76-22" name="__codelineno-76-22"></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-76-23" name="__codelineno-76-23"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;#6prD&amp;@1QZ3TG&quot;</span><span class="p">,</span>
<a id="__codelineno-76-24" name="__codelineno-76-24"></a>                <span class="s2">&quot;maxmails&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-76-25" name="__codelineno-76-25"></a>                <span class="s2">&quot;delete&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-76-26" name="__codelineno-76-26"></a>                <span class="s2">&quot;ssl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-76-27" name="__codelineno-76-27"></a>                <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-76-28" name="__codelineno-76-28"></a>                <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="s2">&quot;output&quot;</span>
<a id="__codelineno-76-29" name="__codelineno-76-29"></a>            <span class="p">}</span>
<a id="__codelineno-76-30" name="__codelineno-76-30"></a>        <span class="p">]</span>
<a id="__codelineno-76-31" name="__codelineno-76-31"></a>    <span class="p">}</span>
<a id="__codelineno-76-32" name="__codelineno-76-32"></a>    <span class="c1"># chemin absolu du dossier du script</span>
<a id="__codelineno-76-33" name="__codelineno-76-33"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-76-34" name="__codelineno-76-34"></a>
<a id="__codelineno-76-35" name="__codelineno-76-35"></a>    <span class="c1"># chemins absolus des dossiers à inclure dans le syspath</span>
<a id="__codelineno-76-36" name="__codelineno-76-36"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-76-37" name="__codelineno-76-37"></a>        <span class="c1"># dossier local</span>
<a id="__codelineno-76-38" name="__codelineno-76-38"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../shared&quot;</span><span class="p">,</span>
<a id="__codelineno-76-39" name="__codelineno-76-39"></a>    <span class="p">]</span>
<a id="__codelineno-76-40" name="__codelineno-76-40"></a>
<a id="__codelineno-76-41" name="__codelineno-76-41"></a>    <span class="c1"># configuration du syspath</span>
<a id="__codelineno-76-42" name="__codelineno-76-42"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-76-43" name="__codelineno-76-43"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-76-44" name="__codelineno-76-44"></a>
<a id="__codelineno-76-45" name="__codelineno-76-45"></a>    <span class="c1"># on rend la configuration</span>
<a id="__codelineno-76-46" name="__codelineno-76-46"></a>    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<p>Le résultat est le suivant :</p>
<p><img src="images/10000000000001F5000002CE4784B3CC.png" style="width:5.201cm;height:7.451cm;" alt="Image" /></p>
<p>Le message 1 est celui envoyé par Thunderbird :</p>
<p><img src="images/10000000000005570000018A84E248A9.png" style="width:15.77cm;height:4.552cm;" alt="Image" /></p>
<ul>
<li>en <strong>[5]</strong>, Thunderbird <strong>[3]</strong> utilise un <strong>[Transfer-Content-Encoding]</strong> de type <strong>[8bit]</strong> ;</li>
<li>en <strong>[4]</strong> : le message est codé en UTF-8 ;
Le message 2 est celui envoyé par em Client :</li>
</ul>
<p><img src="images/100000000000055700000172DDFC8D8D.png" style="width:15.791cm;height:4.271cm;" alt="Image" /></p>
<p><img src="images/1000000000000390000001DEF94A03F0.png" style="width:10.521cm;height:5.52cm;" alt="Image" /></p>
<p>On remarquera que <strong>[em Client]</strong> code les textes en utf-8 <strong>[4]</strong> et qu&#x27;il les transfère en <strong>[quoted-printable]</strong> <strong>[5]</strong>. Il a également envoyé une copie du message en HTML <strong>[7-8]</strong>. Tous les gestionnaires de mail testés ici peuvent faire cela. Il s’agit d’un paramètre de configuration.</p>
<p>Le message 3 est celui envoyé par Gmail :</p>
<p><img src="images/10000000000005580000016AFE1602C2.png" style="width:15.77cm;height:4.181cm;" alt="Image" /></p>
<p>On remarquera que Gmail code les textes en utf-8 <strong>[3]</strong> et qu&#x27;il les transfère en <strong>[quoted-printable]</strong> <strong>[4]</strong>. En <strong>[6]</strong>, la version HTML du message.</p>
<p>Le message 4 est celui envoyé par Outlook :</p>
<p><img src="images/10000000000005AA000001DF743EC6E8.png" style="width:16.721cm;height:5.531cm;" alt="Image" /></p>
<p>On remarquera que Outlook code les textes en iso-8859-1 <strong>[3]</strong> et qu&#x27;il les transfère en <strong>[quoted-printable]</strong> <strong>[4]</strong>.</p>
<p>Les exemples précédents montrent deux choses :</p>
<ul>
<li>notre client <strong>[pop3/02]</strong> a été fonctionnel ;</li>
<li>les gestionnaires de courriers ont des façons différentes d&#x27;envoyer un mail ;
Voyons maintenant les fichiers attachés. Avec Thunderbird, nous vidons la boîte mail de l&#x27;utilisateur <strong>[pymail2parlexemple@gmail.com]</strong>. Puis nous utilisons le script <strong>[smtp/03/main]</strong> pour envoyer un mail avec la configuration <strong>[smtp/03/config]</strong> suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-77-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-77-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-77-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-77-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-77-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-77-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-77-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-77-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-77-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-77-10">10</a></span>
<span class="normal"><a href="#__codelineno-77-11">11</a></span>
<span class="normal"><a href="#__codelineno-77-12">12</a></span>
<span class="normal"><a href="#__codelineno-77-13">13</a></span>
<span class="normal"><a href="#__codelineno-77-14">14</a></span>
<span class="normal"><a href="#__codelineno-77-15">15</a></span>
<span class="normal"><a href="#__codelineno-77-16">16</a></span>
<span class="normal"><a href="#__codelineno-77-17">17</a></span>
<span class="normal"><a href="#__codelineno-77-18">18</a></span>
<span class="normal"><a href="#__codelineno-77-19">19</a></span>
<span class="normal"><a href="#__codelineno-77-20">20</a></span>
<span class="normal"><a href="#__codelineno-77-21">21</a></span>
<span class="normal"><a href="#__codelineno-77-22">22</a></span>
<span class="normal"><a href="#__codelineno-77-23">23</a></span>
<span class="normal"><a href="#__codelineno-77-24">24</a></span>
<span class="normal"><a href="#__codelineno-77-25">25</a></span>
<span class="normal"><a href="#__codelineno-77-26">26</a></span>
<span class="normal"><a href="#__codelineno-77-27">27</a></span>
<span class="normal"><a href="#__codelineno-77-28">28</a></span>
<span class="normal"><a href="#__codelineno-77-29">29</a></span>
<span class="normal"><a href="#__codelineno-77-30">30</a></span>
<span class="normal"><a href="#__codelineno-77-31">31</a></span>
<span class="normal"><a href="#__codelineno-77-32">32</a></span>
<span class="normal"><a href="#__codelineno-77-33">33</a></span>
<span class="normal"><a href="#__codelineno-77-34">34</a></span>
<span class="normal"><a href="#__codelineno-77-35">35</a></span>
<span class="normal"><a href="#__codelineno-77-36">36</a></span>
<span class="normal"><a href="#__codelineno-77-37">37</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-77-2" name="__codelineno-77-2"></a>
<a id="__codelineno-77-3" name="__codelineno-77-3"></a>
<a id="__codelineno-77-4" name="__codelineno-77-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-77-5" name="__codelineno-77-5"></a>    <span class="c1"># configuration de l&#39;application</span>
<a id="__codelineno-77-6" name="__codelineno-77-6"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-77-7" name="__codelineno-77-7"></a>
<a id="__codelineno-77-8" name="__codelineno-77-8"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-77-9" name="__codelineno-77-9"></a>        <span class="c1"># description : description du mail envoyé</span>
<a id="__codelineno-77-10" name="__codelineno-77-10"></a>        <span class="c1"># smtp-server : serveur SMTP</span>
<a id="__codelineno-77-11" name="__codelineno-77-11"></a>        <span class="c1"># smtp-port : port du serveur SMTP</span>
<a id="__codelineno-77-12" name="__codelineno-77-12"></a>        <span class="c1"># from : expéditeur</span>
<a id="__codelineno-77-13" name="__codelineno-77-13"></a>        <span class="c1"># to : destinataire</span>
<a id="__codelineno-77-14" name="__codelineno-77-14"></a>        <span class="c1"># subject : sujet du mail</span>
<a id="__codelineno-77-15" name="__codelineno-77-15"></a>        <span class="c1"># message : message du mail</span>
<a id="__codelineno-77-16" name="__codelineno-77-16"></a>        <span class="s2">&quot;mails&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-77-17" name="__codelineno-77-17"></a>            <span class="p">{</span>
<a id="__codelineno-77-18" name="__codelineno-77-18"></a>                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;mail to gmail via gmail avec smtplib&quot;</span><span class="p">,</span>
<a id="__codelineno-77-19" name="__codelineno-77-19"></a>                <span class="s2">&quot;smtp-server&quot;</span><span class="p">:</span> <span class="s2">&quot;smtp.gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-77-20" name="__codelineno-77-20"></a>                <span class="s2">&quot;smtp-port&quot;</span><span class="p">:</span> <span class="s2">&quot;587&quot;</span><span class="p">,</span>
<a id="__codelineno-77-21" name="__codelineno-77-21"></a>                <span class="s2">&quot;from&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-77-22" name="__codelineno-77-22"></a>                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-77-23" name="__codelineno-77-23"></a>                <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="s2">&quot;to gmail via gmail avec smtplib&quot;</span><span class="p">,</span>
<a id="__codelineno-77-24" name="__codelineno-77-24"></a>                <span class="c1"># on teste les caractères accentués</span>
<a id="__codelineno-77-25" name="__codelineno-77-25"></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;aglaë séléné</span><span class="se">\n</span><span class="s2">va au marché</span><span class="se">\n</span><span class="s2">acheter des fleurs&quot;</span><span class="p">,</span>
<a id="__codelineno-77-26" name="__codelineno-77-26"></a>                <span class="c1"># smtp avec authentification</span>
<a id="__codelineno-77-27" name="__codelineno-77-27"></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-77-28" name="__codelineno-77-28"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;#6prIlhD&amp;@1QZ3TG&quot;</span><span class="p">,</span>
<a id="__codelineno-77-29" name="__codelineno-77-29"></a>                <span class="c1"># ici, il faut mettre des chemins absolus pour les fichiers attachés</span>
<a id="__codelineno-77-30" name="__codelineno-77-30"></a>                <span class="s2">&quot;attachments&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-77-31" name="__codelineno-77-31"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/attachments/fichier attaché.docx&quot;</span><span class="p">,</span>
<a id="__codelineno-77-32" name="__codelineno-77-32"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/attachments/fichier attaché.pdf&quot;</span><span class="p">,</span>
<a id="__codelineno-77-33" name="__codelineno-77-33"></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/attachments/mail attaché 1.eml&quot;</span><span class="p">,</span>
<a id="__codelineno-77-34" name="__codelineno-77-34"></a>                <span class="p">]</span>
<a id="__codelineno-77-35" name="__codelineno-77-35"></a>            <span class="p">}</span>
<a id="__codelineno-77-36" name="__codelineno-77-36"></a>        <span class="p">]</span>
<a id="__codelineno-77-37" name="__codelineno-77-37"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 31-33 : nous attachons au mail :</li>
<li>un fichier Word ;</li>
<li>un fichier PDF ;</li>
<li>un mail contenant les mêmes deux fichiers attachés ;
Une fois le mail envoyé, nous exécutons le script <strong>[pop3/02]</strong> pour lire la boîte mail de l’utilisateur <strong>[pymail2parlexemple@gmail.com]</strong>. Les résultats sont les suivants :</li>
</ul>
<p><img src="images/100000000000023800000236E1AB340F.png" style="width:5.912cm;height:5.89cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong> : le message avec ses deux fichiers attachés ;</li>
<li>en <strong>[2]</strong> : le mail attaché lui-même avec ses deux fichiers attachés ;
<strong>Conclusion</strong></li>
</ul>
<p>Le module <strong>[mail_parser.py]</strong> est particulièrement complexe. Cela est dû à la complexité des mails eux-mêmes. Nous allons réutiliser ce module pour le protocole IMAP.</p>
<h2 id="217-le-protocole-imap">21.7. Le protocole IMAP</h2>
<h3 id="2171-introduction">21.7.1. Introduction</h3>
<p>Pour lire les mails entreposés dans un serveur de mails, deux protocoles existent :</p>
<ul>
<li>le protocole POP3 (Post Office Protocol) historiquement le 1er protocole mais peu utilisé maintenant ;</li>
<li>le protocole IMAP (Internet Message Access Protocol) protocole plus récent que POP3 et le plus utilisé actuellement ;
Pour découvrir le protocole IMAP, nous allons utiliser l’architecture suivante :</li>
</ul>
<p><img src="images/1000000100000200000000DF4A08E6A0.png" style="width:8.76cm;height:3.811cm;" alt="Image" /></p>
<ul>
<li><strong>[Serveur B]</strong> sera selon les cas :</li>
<li>un serveur IMAP local, implémenté par le serveur de mail <strong>[hMailServer]</strong> ;</li>
<li>le serveur <strong>[</strong><strong>imap.gmail.com:993</strong><strong>]</strong> qui est le serveur IMAP du gestionnaire de mails <strong>[Gmail]</strong> ;</li>
<li>
<p><strong>[Client A]</strong> sera un script Python utilisant des modules Python permettant de gérer les pièces attachées ainsi que l&#x27;utilisation d’une connexion chiffrée et authentifiée lorsque le serveur IMAP l&#x27;exige ;
Le protocole IMAP va au-delà du protocole POP3 :</p>
</li>
<li>
<p>les mails sont conservés sur le serveur IMAP et peuvent être organisés en dossiers ;</p>
</li>
<li>le client IMAP peut envoyer des commandes de création / modification / suppression de ces dossiers ;
Voyons un exemple avec Thunderbird. Dans l&#x27;architecture suivante :</li>
</ul>
<p><img src="images/1000000100000200000000DEBF0B481C.png" style="width:8.771cm;height:3.8cm;" alt="Image" /></p>
<ul>
<li>Thunderbird est le client A ;</li>
<li><strong>[imap.gmail.com]</strong> est le serveur B (Gmail) ;
Créons un dossier dans les mails de l&#x27;utilisateur <strong>[pymail2parlexemple@gmail.com]</strong> avec Thunderbird :</li>
</ul>
<p><img src="images/10000000000005580000030F25DAF49B.png" style="width:15.77cm;height:9.051cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1-6]</strong>, nous créons le dossier <strong>[dossier1]</strong> ;</li>
</ul>
<p><img src="images/10000000000003550000019513F04E21.png" style="width:9.861cm;height:4.68cm;" alt="Image" /></p>
<ul>
<li>en <strong>[7-8]</strong>, nous déplaçons (avec la souris) tous les fichiers du dossier <strong>[Courrier entrant]</strong> dans le dossier <strong>[dossier1]</strong> ;
Maintenant connectons-nous au site web de Gmail et identifions-nous comme l&#x27;utilisateur <strong>[pymail2parlexemple@gmail.com]</strong> :</li>
</ul>
<p><img src="images/1000000000000446000002861C598ABB.png" style="width:12.611cm;height:7.451cm;" alt="Image" /></p>
<ul>
<li>en <strong>[2-3]</strong>, la boîte de réception est vide ;</li>
<li>en <strong>[1]</strong>, le dossier <strong>[dossier1]</strong> qui a été créé ;</li>
</ul>
<p><img src="images/10000000000004E70000021A68326E10.png" style="width:14.481cm;height:6.211cm;" alt="Image" /></p>
<ul>
<li>en <strong>[4-6]</strong> : les mails qui ont été déplacés dans le dossier <strong>[dossier1]</strong> ;
Nous sommes là devant l&#x27;architecture suivante :</li>
</ul>
<p><img src="images/10000001000001F0000001045B25786D.png" style="width:8.471cm;height:4.44cm;" alt="Image" /></p>
<ul>
<li>Client A est l&#x27;application Thunderbird ;</li>
<li>Client C est l&#x27;application web de Gmail ;</li>
<li>
<p>Serveur B est le serveur IMAP de Gmail ;
L&#x27;arbre des dossiers de l&#x27;utilisateur est maintenu par le serveur IMAP. Ensuite tous les clients IMAP se synchronisent sur lui pour présenter à l&#x27;utilisateur les dossiers de son compte. Ici Thunderbird a envoyé plusieurs commandes pour  :</p>
</li>
<li>
<p>créer le dossier <strong>[dossier1]</strong> ;</p>
</li>
<li>transférer des messages dans ce dossier ;</li>
</ul>
<h3 id="2172-script-imapmain-client-imap-avec-le-module-imaplib">21.7.2. script [imap/main] : client IMAP avec le module [imaplib]</h3>
<p><img src="images/1000000000000114000000E1ECECCBD2.png" style="width:3.181cm;height:2.601cm;" alt="Image" /></p>
<p>Le script <strong>[imap/main]</strong> est configuré par le script <strong>[imap/config]</strong> suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-78-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-78-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-78-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-78-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-78-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-78-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-78-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-78-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-78-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-78-10">10</a></span>
<span class="normal"><a href="#__codelineno-78-11">11</a></span>
<span class="normal"><a href="#__codelineno-78-12">12</a></span>
<span class="normal"><a href="#__codelineno-78-13">13</a></span>
<span class="normal"><a href="#__codelineno-78-14">14</a></span>
<span class="normal"><a href="#__codelineno-78-15">15</a></span>
<span class="normal"><a href="#__codelineno-78-16">16</a></span>
<span class="normal"><a href="#__codelineno-78-17">17</a></span>
<span class="normal"><a href="#__codelineno-78-18">18</a></span>
<span class="normal"><a href="#__codelineno-78-19">19</a></span>
<span class="normal"><a href="#__codelineno-78-20">20</a></span>
<span class="normal"><a href="#__codelineno-78-21">21</a></span>
<span class="normal"><a href="#__codelineno-78-22">22</a></span>
<span class="normal"><a href="#__codelineno-78-23">23</a></span>
<span class="normal"><a href="#__codelineno-78-24">24</a></span>
<span class="normal"><a href="#__codelineno-78-25">25</a></span>
<span class="normal"><a href="#__codelineno-78-26">26</a></span>
<span class="normal"><a href="#__codelineno-78-27">27</a></span>
<span class="normal"><a href="#__codelineno-78-28">28</a></span>
<span class="normal"><a href="#__codelineno-78-29">29</a></span>
<span class="normal"><a href="#__codelineno-78-30">30</a></span>
<span class="normal"><a href="#__codelineno-78-31">31</a></span>
<span class="normal"><a href="#__codelineno-78-32">32</a></span>
<span class="normal"><a href="#__codelineno-78-33">33</a></span>
<span class="normal"><a href="#__codelineno-78-34">34</a></span>
<span class="normal"><a href="#__codelineno-78-35">35</a></span>
<span class="normal"><a href="#__codelineno-78-36">36</a></span>
<span class="normal"><a href="#__codelineno-78-37">37</a></span>
<span class="normal"><a href="#__codelineno-78-38">38</a></span>
<span class="normal"><a href="#__codelineno-78-39">39</a></span>
<span class="normal"><a href="#__codelineno-78-40">40</a></span>
<span class="normal"><a href="#__codelineno-78-41">41</a></span>
<span class="normal"><a href="#__codelineno-78-42">42</a></span>
<span class="normal"><a href="#__codelineno-78-43">43</a></span>
<span class="normal"><a href="#__codelineno-78-44">44</a></span>
<span class="normal"><a href="#__codelineno-78-45">45</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-78-2" name="__codelineno-78-2"></a>
<a id="__codelineno-78-3" name="__codelineno-78-3"></a>
<a id="__codelineno-78-4" name="__codelineno-78-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-78-5" name="__codelineno-78-5"></a>    <span class="c1"># configuration de l&#39;appli</span>
<a id="__codelineno-78-6" name="__codelineno-78-6"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-78-7" name="__codelineno-78-7"></a>        <span class="c1"># liste des boîtes à lettres à gérer</span>
<a id="__codelineno-78-8" name="__codelineno-78-8"></a>        <span class="s2">&quot;mailboxes&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-78-9" name="__codelineno-78-9"></a>            <span class="c1"># server : serveur IMAP</span>
<a id="__codelineno-78-10" name="__codelineno-78-10"></a>            <span class="c1"># port : port du serveur IMAP</span>
<a id="__codelineno-78-11" name="__codelineno-78-11"></a>            <span class="c1"># user : utilisateur dont on veut lire les messages</span>
<a id="__codelineno-78-12" name="__codelineno-78-12"></a>            <span class="c1"># password : son mot de passe</span>
<a id="__codelineno-78-13" name="__codelineno-78-13"></a>            <span class="c1"># maxmails : le nombre maximum de mail à télécharger</span>
<a id="__codelineno-78-14" name="__codelineno-78-14"></a>            <span class="c1"># timeout : délai d&#39;attente maximal d&#39;une réponse du serveur</span>
<a id="__codelineno-78-15" name="__codelineno-78-15"></a>            <span class="c1"># delete : à vrai s&#39;il faut supprimer du serveur les messages téléchargés</span>
<a id="__codelineno-78-16" name="__codelineno-78-16"></a>            <span class="c1"># ssl : à vrai si la lecture des mails se fait au travers d&#39;une liaison sécurisée</span>
<a id="__codelineno-78-17" name="__codelineno-78-17"></a>            <span class="c1"># output : le dossier de rangement des messages téléchargés</span>
<a id="__codelineno-78-18" name="__codelineno-78-18"></a>
<a id="__codelineno-78-19" name="__codelineno-78-19"></a>            <span class="p">{</span>
<a id="__codelineno-78-20" name="__codelineno-78-20"></a>                <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;imap.gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-78-21" name="__codelineno-78-21"></a>                <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;993&quot;</span><span class="p">,</span>
<a id="__codelineno-78-22" name="__codelineno-78-22"></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;pymail2parlexemple@gmail.com&quot;</span><span class="p">,</span>
<a id="__codelineno-78-23" name="__codelineno-78-23"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;#6prIlhD&amp;@1QZ3TG&quot;</span><span class="p">,</span>
<a id="__codelineno-78-24" name="__codelineno-78-24"></a>                <span class="s2">&quot;maxmails&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-78-25" name="__codelineno-78-25"></a>                <span class="s2">&quot;ssl&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-78-26" name="__codelineno-78-26"></a>                <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-78-27" name="__codelineno-78-27"></a>                <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="s2">&quot;output&quot;</span>
<a id="__codelineno-78-28" name="__codelineno-78-28"></a>            <span class="p">}</span>
<a id="__codelineno-78-29" name="__codelineno-78-29"></a>        <span class="p">]</span>
<a id="__codelineno-78-30" name="__codelineno-78-30"></a>    <span class="p">}</span>
<a id="__codelineno-78-31" name="__codelineno-78-31"></a>    <span class="c1"># chemin absolu du dossier du script</span>
<a id="__codelineno-78-32" name="__codelineno-78-32"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-78-33" name="__codelineno-78-33"></a>
<a id="__codelineno-78-34" name="__codelineno-78-34"></a>    <span class="c1"># chemins absolus des dossiers à inclure dans le syspath</span>
<a id="__codelineno-78-35" name="__codelineno-78-35"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-78-36" name="__codelineno-78-36"></a>        <span class="c1"># dossier local</span>
<a id="__codelineno-78-37" name="__codelineno-78-37"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../shared&quot;</span><span class="p">,</span>
<a id="__codelineno-78-38" name="__codelineno-78-38"></a>    <span class="p">]</span>
<a id="__codelineno-78-39" name="__codelineno-78-39"></a>
<a id="__codelineno-78-40" name="__codelineno-78-40"></a>    <span class="c1"># configuration du syspath</span>
<a id="__codelineno-78-41" name="__codelineno-78-41"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-78-42" name="__codelineno-78-42"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-78-43" name="__codelineno-78-43"></a>
<a id="__codelineno-78-44" name="__codelineno-78-44"></a>    <span class="c1"># on rend la configuration</span>
<a id="__codelineno-78-45" name="__codelineno-78-45"></a>    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 8-29 :  la clé <strong>[mailboxes]</strong> est associée à la liste des boîtes à lettres à consulter ;</li>
<li>ligne 20 : le serveur IMAP ;</li>
<li>ligne 21 : son port de service ;</li>
<li>lignes 22-23 : l&#x27;utilisateur dont on veut lire les mails ;</li>
<li>ligne 24 : le nombre maximum de mails qu&#x27;on veut lire ;</li>
<li>ligne 25 : indique s’il faut établir une liaison sécurisée avec le serveur IMAP (True) ou pas (False) ;</li>
<li>ligne 26 : le délai d&#x27;attente maximum d&#x27;attente d&#x27;une réponse du serveur ;</li>
<li>ligne 27 : dossier de sauvegarde des mails lus ;
Le script <strong>[imap/main]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-79-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-79-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-79-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-79-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-79-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-79-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-79-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-79-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-79-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-79-10">10</a></span>
<span class="normal"><a href="#__codelineno-79-11">11</a></span>
<span class="normal"><a href="#__codelineno-79-12">12</a></span>
<span class="normal"><a href="#__codelineno-79-13">13</a></span>
<span class="normal"><a href="#__codelineno-79-14">14</a></span>
<span class="normal"><a href="#__codelineno-79-15">15</a></span>
<span class="normal"><a href="#__codelineno-79-16">16</a></span>
<span class="normal"><a href="#__codelineno-79-17">17</a></span>
<span class="normal"><a href="#__codelineno-79-18">18</a></span>
<span class="normal"><a href="#__codelineno-79-19">19</a></span>
<span class="normal"><a href="#__codelineno-79-20">20</a></span>
<span class="normal"><a href="#__codelineno-79-21">21</a></span>
<span class="normal"><a href="#__codelineno-79-22">22</a></span>
<span class="normal"><a href="#__codelineno-79-23">23</a></span>
<span class="normal"><a href="#__codelineno-79-24">24</a></span>
<span class="normal"><a href="#__codelineno-79-25">25</a></span>
<span class="normal"><a href="#__codelineno-79-26">26</a></span>
<span class="normal"><a href="#__codelineno-79-27">27</a></span>
<span class="normal"><a href="#__codelineno-79-28">28</a></span>
<span class="normal"><a href="#__codelineno-79-29">29</a></span>
<span class="normal"><a href="#__codelineno-79-30">30</a></span>
<span class="normal"><a href="#__codelineno-79-31">31</a></span>
<span class="normal"><a href="#__codelineno-79-32">32</a></span>
<span class="normal"><a href="#__codelineno-79-33">33</a></span>
<span class="normal"><a href="#__codelineno-79-34">34</a></span>
<span class="normal"><a href="#__codelineno-79-35">35</a></span>
<span class="normal"><a href="#__codelineno-79-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1"></a><span class="c1"># imports</span>
<a id="__codelineno-79-2" name="__codelineno-79-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">email</span>
<a id="__codelineno-79-3" name="__codelineno-79-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">imaplib</span>
<a id="__codelineno-79-4" name="__codelineno-79-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-79-5" name="__codelineno-79-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<a id="__codelineno-79-6" name="__codelineno-79-6"></a>
<a id="__codelineno-79-7" name="__codelineno-79-7"></a>
<a id="__codelineno-79-8" name="__codelineno-79-8"></a><span class="c1"># -----------------------------------------------------------------------</span>
<a id="__codelineno-79-9" name="__codelineno-79-9"></a>
<a id="__codelineno-79-10" name="__codelineno-79-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">readmails</span><span class="p">(</span><span class="n">mailbox</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-79-11" name="__codelineno-79-11"></a>    <span class="err">…</span>
<a id="__codelineno-79-12" name="__codelineno-79-12"></a>
<a id="__codelineno-79-13" name="__codelineno-79-13"></a>
<a id="__codelineno-79-14" name="__codelineno-79-14"></a><span class="c1"># main ----------------------------------------------------------------</span>
<a id="__codelineno-79-15" name="__codelineno-79-15"></a><span class="c1">#  client IMAP permettant de lire des mails</span>
<a id="__codelineno-79-16" name="__codelineno-79-16"></a>
<a id="__codelineno-79-17" name="__codelineno-79-17"></a><span class="c1"># on récupère la configuration de l&#39;application</span>
<a id="__codelineno-79-18" name="__codelineno-79-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-79-19" name="__codelineno-79-19"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-79-20" name="__codelineno-79-20"></a>
<a id="__codelineno-79-21" name="__codelineno-79-21"></a><span class="c1"># on traite les boîtes mail une par une</span>
<a id="__codelineno-79-22" name="__codelineno-79-22"></a><span class="k">for</span> <span class="n">mailbox</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;mailboxes&#39;</span><span class="p">]:</span>
<a id="__codelineno-79-23" name="__codelineno-79-23"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-79-24" name="__codelineno-79-24"></a>        <span class="c1"># affichage console</span>
<a id="__codelineno-79-25" name="__codelineno-79-25"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-79-26" name="__codelineno-79-26"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-79-27" name="__codelineno-79-27"></a>            <span class="sa">f</span><span class="s2">&quot;Lecture de la boîte mail POP3 </span><span class="si">{</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / </span><span class="si">{</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-79-28" name="__codelineno-79-28"></a>        <span class="c1"># lecture de la boîte mail</span>
<a id="__codelineno-79-29" name="__codelineno-79-29"></a>        <span class="n">readmails</span><span class="p">(</span><span class="n">mailbox</span><span class="p">)</span>
<a id="__codelineno-79-30" name="__codelineno-79-30"></a>        <span class="c1"># fin</span>
<a id="__codelineno-79-31" name="__codelineno-79-31"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lecture terminée...&quot;</span><span class="p">)</span>
<a id="__codelineno-79-32" name="__codelineno-79-32"></a>    <span class="c1"># except BaseException as erreur:</span>
<a id="__codelineno-79-33" name="__codelineno-79-33"></a>    <span class="c1">#     # on affiche l&#39;erreur</span>
<a id="__codelineno-79-34" name="__codelineno-79-34"></a>    <span class="c1">#     print(f&quot;L&#39;erreur suivante s&#39;est produite : {erreur}&quot;)</span>
<a id="__codelineno-79-35" name="__codelineno-79-35"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-79-36" name="__codelineno-79-36"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 14-36 : nous retrouvons la démarche déjà rencontrée dans le script |<a href="#_scripts_[pop3/02]_:"><u><u>pop3/02/main</u></u></a>| ;
La fonction <strong>[readmails]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-80-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-80-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-80-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-80-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-80-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-80-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-80-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-80-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-80-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-80-10">10</a></span>
<span class="normal"><a href="#__codelineno-80-11">11</a></span>
<span class="normal"><a href="#__codelineno-80-12">12</a></span>
<span class="normal"><a href="#__codelineno-80-13">13</a></span>
<span class="normal"><a href="#__codelineno-80-14">14</a></span>
<span class="normal"><a href="#__codelineno-80-15">15</a></span>
<span class="normal"><a href="#__codelineno-80-16">16</a></span>
<span class="normal"><a href="#__codelineno-80-17">17</a></span>
<span class="normal"><a href="#__codelineno-80-18">18</a></span>
<span class="normal"><a href="#__codelineno-80-19">19</a></span>
<span class="normal"><a href="#__codelineno-80-20">20</a></span>
<span class="normal"><a href="#__codelineno-80-21">21</a></span>
<span class="normal"><a href="#__codelineno-80-22">22</a></span>
<span class="normal"><a href="#__codelineno-80-23">23</a></span>
<span class="normal"><a href="#__codelineno-80-24">24</a></span>
<span class="normal"><a href="#__codelineno-80-25">25</a></span>
<span class="normal"><a href="#__codelineno-80-26">26</a></span>
<span class="normal"><a href="#__codelineno-80-27">27</a></span>
<span class="normal"><a href="#__codelineno-80-28">28</a></span>
<span class="normal"><a href="#__codelineno-80-29">29</a></span>
<span class="normal"><a href="#__codelineno-80-30">30</a></span>
<span class="normal"><a href="#__codelineno-80-31">31</a></span>
<span class="normal"><a href="#__codelineno-80-32">32</a></span>
<span class="normal"><a href="#__codelineno-80-33">33</a></span>
<span class="normal"><a href="#__codelineno-80-34">34</a></span>
<span class="normal"><a href="#__codelineno-80-35">35</a></span>
<span class="normal"><a href="#__codelineno-80-36">36</a></span>
<span class="normal"><a href="#__codelineno-80-37">37</a></span>
<span class="normal"><a href="#__codelineno-80-38">38</a></span>
<span class="normal"><a href="#__codelineno-80-39">39</a></span>
<span class="normal"><a href="#__codelineno-80-40">40</a></span>
<span class="normal"><a href="#__codelineno-80-41">41</a></span>
<span class="normal"><a href="#__codelineno-80-42">42</a></span>
<span class="normal"><a href="#__codelineno-80-43">43</a></span>
<span class="normal"><a href="#__codelineno-80-44">44</a></span>
<span class="normal"><a href="#__codelineno-80-45">45</a></span>
<span class="normal"><a href="#__codelineno-80-46">46</a></span>
<span class="normal"><a href="#__codelineno-80-47">47</a></span>
<span class="normal"><a href="#__codelineno-80-48">48</a></span>
<span class="normal"><a href="#__codelineno-80-49">49</a></span>
<span class="normal"><a href="#__codelineno-80-50">50</a></span>
<span class="normal"><a href="#__codelineno-80-51">51</a></span>
<span class="normal"><a href="#__codelineno-80-52">52</a></span>
<span class="normal"><a href="#__codelineno-80-53">53</a></span>
<span class="normal"><a href="#__codelineno-80-54">54</a></span>
<span class="normal"><a href="#__codelineno-80-55">55</a></span>
<span class="normal"><a href="#__codelineno-80-56">56</a></span>
<span class="normal"><a href="#__codelineno-80-57">57</a></span>
<span class="normal"><a href="#__codelineno-80-58">58</a></span>
<span class="normal"><a href="#__codelineno-80-59">59</a></span>
<span class="normal"><a href="#__codelineno-80-60">60</a></span>
<span class="normal"><a href="#__codelineno-80-61">61</a></span>
<span class="normal"><a href="#__codelineno-80-62">62</a></span>
<span class="normal"><a href="#__codelineno-80-63">63</a></span>
<span class="normal"><a href="#__codelineno-80-64">64</a></span>
<span class="normal"><a href="#__codelineno-80-65">65</a></span>
<span class="normal"><a href="#__codelineno-80-66">66</a></span>
<span class="normal"><a href="#__codelineno-80-67">67</a></span>
<span class="normal"><a href="#__codelineno-80-68">68</a></span>
<span class="normal"><a href="#__codelineno-80-69">69</a></span>
<span class="normal"><a href="#__codelineno-80-70">70</a></span>
<span class="normal"><a href="#__codelineno-80-71">71</a></span>
<span class="normal"><a href="#__codelineno-80-72">72</a></span>
<span class="normal"><a href="#__codelineno-80-73">73</a></span>
<span class="normal"><a href="#__codelineno-80-74">74</a></span>
<span class="normal"><a href="#__codelineno-80-75">75</a></span>
<span class="normal"><a href="#__codelineno-80-76">76</a></span>
<span class="normal"><a href="#__codelineno-80-77">77</a></span>
<span class="normal"><a href="#__codelineno-80-78">78</a></span>
<span class="normal"><a href="#__codelineno-80-79">79</a></span>
<span class="normal"><a href="#__codelineno-80-80">80</a></span>
<span class="normal"><a href="#__codelineno-80-81">81</a></span>
<span class="normal"><a href="#__codelineno-80-82">82</a></span>
<span class="normal"><a href="#__codelineno-80-83">83</a></span>
<span class="normal"><a href="#__codelineno-80-84">84</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">readmails</span><span class="p">(</span><span class="n">mailbox</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-80-2" name="__codelineno-80-2"></a>    <span class="c1"># on laisse remonter les exceptions</span>
<a id="__codelineno-80-3" name="__codelineno-80-3"></a>    <span class="c1">#</span>
<a id="__codelineno-80-4" name="__codelineno-80-4"></a>    <span class="c1"># module du parseur de mail</span>
<a id="__codelineno-80-5" name="__codelineno-80-5"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">mail_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">save_message</span>
<a id="__codelineno-80-6" name="__codelineno-80-6"></a>
<a id="__codelineno-80-7" name="__codelineno-80-7"></a>    <span class="c1"># on récupère des informations de configuration</span>
<a id="__codelineno-80-8" name="__codelineno-80-8"></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span>
<a id="__codelineno-80-9" name="__codelineno-80-9"></a>    <span class="n">user</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
<a id="__codelineno-80-10" name="__codelineno-80-10"></a>    <span class="n">password</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
<a id="__codelineno-80-11" name="__codelineno-80-11"></a>    <span class="n">timeout</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;timeout&#39;</span><span class="p">]</span>
<a id="__codelineno-80-12" name="__codelineno-80-12"></a>    <span class="n">server</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">]</span>
<a id="__codelineno-80-13" name="__codelineno-80-13"></a>    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">])</span>
<a id="__codelineno-80-14" name="__codelineno-80-14"></a>    <span class="n">maxmails</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;maxmails&#39;</span><span class="p">]</span>
<a id="__codelineno-80-15" name="__codelineno-80-15"></a>    <span class="n">ssl</span> <span class="o">=</span> <span class="n">mailbox</span><span class="p">[</span><span class="s1">&#39;ssl&#39;</span><span class="p">]</span>
<a id="__codelineno-80-16" name="__codelineno-80-16"></a>    <span class="c1">#</span>
<a id="__codelineno-80-17" name="__codelineno-80-17"></a>    <span class="c1"># c&#39;est parti</span>
<a id="__codelineno-80-18" name="__codelineno-80-18"></a>    <span class="n">imap_resource</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-80-19" name="__codelineno-80-19"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-80-20" name="__codelineno-80-20"></a>        <span class="c1"># on crée les dossiers de stockage s&#39;ils n&#39;existent pas</span>
<a id="__codelineno-80-21" name="__codelineno-80-21"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
<a id="__codelineno-80-22" name="__codelineno-80-22"></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<a id="__codelineno-80-23" name="__codelineno-80-23"></a>        <span class="c1"># user</span>
<a id="__codelineno-80-24" name="__codelineno-80-24"></a>        <span class="n">dir2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-80-25" name="__codelineno-80-25"></a>        <span class="c1"># on supprime le dossier [dir2] s&#39;il existe puis on le recrée</span>
<a id="__codelineno-80-26" name="__codelineno-80-26"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir2</span><span class="p">):</span>
<a id="__codelineno-80-27" name="__codelineno-80-27"></a>            <span class="c1"># suppression</span>
<a id="__codelineno-80-28" name="__codelineno-80-28"></a>            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dir2</span><span class="p">)</span>
<a id="__codelineno-80-29" name="__codelineno-80-29"></a>        <span class="c1"># création</span>
<a id="__codelineno-80-30" name="__codelineno-80-30"></a>        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dir2</span><span class="p">)</span>
<a id="__codelineno-80-31" name="__codelineno-80-31"></a>        <span class="c1"># connexion au serveur IMAP</span>
<a id="__codelineno-80-32" name="__codelineno-80-32"></a>        <span class="k">if</span> <span class="n">ssl</span><span class="p">:</span>
<a id="__codelineno-80-33" name="__codelineno-80-33"></a>            <span class="n">imap_resource</span> <span class="o">=</span> <span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4_SSL</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
<a id="__codelineno-80-34" name="__codelineno-80-34"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-80-35" name="__codelineno-80-35"></a>            <span class="n">imap_resource</span> <span class="o">=</span> <span class="n">imaplib</span><span class="o">.</span><span class="n">IMAP4</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
<a id="__codelineno-80-36" name="__codelineno-80-36"></a>        <span class="c1"># timeout des communications du client</span>
<a id="__codelineno-80-37" name="__codelineno-80-37"></a>        <span class="n">sock</span> <span class="o">=</span> <span class="n">imap_resource</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
<a id="__codelineno-80-38" name="__codelineno-80-38"></a>        <span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
<a id="__codelineno-80-39" name="__codelineno-80-39"></a>        <span class="c1"># authentification</span>
<a id="__codelineno-80-40" name="__codelineno-80-40"></a>        <span class="n">imap_resource</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<a id="__codelineno-80-41" name="__codelineno-80-41"></a>        <span class="c1"># on sélectionne le dossier INBOX (courrier entrant)</span>
<a id="__codelineno-80-42" name="__codelineno-80-42"></a>        <span class="n">imap_resource</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;INBOX&#39;</span><span class="p">)</span>
<a id="__codelineno-80-43" name="__codelineno-80-43"></a>        <span class="c1"># on récupère tous les messages de ce dossier : critère ALL</span>
<a id="__codelineno-80-44" name="__codelineno-80-44"></a>        <span class="c1"># pas d&#39;encoding particulier : None</span>
<a id="__codelineno-80-45" name="__codelineno-80-45"></a>        <span class="n">typ1</span><span class="p">,</span> <span class="n">data1</span> <span class="o">=</span> <span class="n">imap_resource</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">)</span>
<a id="__codelineno-80-46" name="__codelineno-80-46"></a>        <span class="c1"># print(f&quot;typ={typ1}, data={data1}&quot;)</span>
<a id="__codelineno-80-47" name="__codelineno-80-47"></a>
<a id="__codelineno-80-48" name="__codelineno-80-48"></a>        <span class="c1"># data1[0] est un tableau d&#39;octets réunissant les n°s de tous les messages séparés par un espace</span>
<a id="__codelineno-80-49" name="__codelineno-80-49"></a>        <span class="n">nums</span> <span class="o">=</span> <span class="n">data1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<a id="__codelineno-80-50" name="__codelineno-80-50"></a>        <span class="n">imail</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-80-51" name="__codelineno-80-51"></a>        <span class="n">fini</span> <span class="o">=</span> <span class="n">imail</span> <span class="o">&gt;=</span> <span class="n">maxmails</span> <span class="ow">or</span> <span class="n">imail</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<a id="__codelineno-80-52" name="__codelineno-80-52"></a>        <span class="c1"># on lit les mails un à un</span>
<a id="__codelineno-80-53" name="__codelineno-80-53"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">fini</span><span class="p">:</span>
<a id="__codelineno-80-54" name="__codelineno-80-54"></a>            <span class="c1"># num est un n° de message en binaire</span>
<a id="__codelineno-80-55" name="__codelineno-80-55"></a>            <span class="n">num</span> <span class="o">=</span> <span class="n">nums</span><span class="p">[</span><span class="n">imail</span><span class="p">]</span>
<a id="__codelineno-80-56" name="__codelineno-80-56"></a>            <span class="c1"># print(f&quot;message n° {num}&quot;)</span>
<a id="__codelineno-80-57" name="__codelineno-80-57"></a>
<a id="__codelineno-80-58" name="__codelineno-80-58"></a>            <span class="c1"># on récupère le msg n° num</span>
<a id="__codelineno-80-59" name="__codelineno-80-59"></a>            <span class="n">typ2</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">imap_resource</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="s1">&#39;(RFC822)&#39;</span><span class="p">)</span>
<a id="__codelineno-80-60" name="__codelineno-80-60"></a>            <span class="c1"># print(f&quot;type={typ2}, data={data2}&quot;)</span>
<a id="__codelineno-80-61" name="__codelineno-80-61"></a>
<a id="__codelineno-80-62" name="__codelineno-80-62"></a>            <span class="c1"># data est une liste qui contient des tuples, ici un seul</span>
<a id="__codelineno-80-63" name="__codelineno-80-63"></a>            <span class="c1"># data[0] est le tuple, data[0][1] est le deuxième élément du tuple</span>
<a id="__codelineno-80-64" name="__codelineno-80-64"></a>            <span class="c1"># data[0][1] contient une suite d&#39;octets représentant toutes les lignes du message</span>
<a id="__codelineno-80-65" name="__codelineno-80-65"></a>            <span class="c1"># par message il faut entendre texte du message + tous les fichiers attachés</span>
<a id="__codelineno-80-66" name="__codelineno-80-66"></a>
<a id="__codelineno-80-67" name="__codelineno-80-67"></a>            <span class="c1"># on récupère le message comme type email.message.Message</span>
<a id="__codelineno-80-68" name="__codelineno-80-68"></a>            <span class="n">message</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">message_from_bytes</span><span class="p">(</span><span class="n">data2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-80-69" name="__codelineno-80-69"></a>            <span class="c1"># dossier du message</span>
<a id="__codelineno-80-70" name="__codelineno-80-70"></a>            <span class="n">dir3</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dir2</span><span class="si">}</span><span class="s2">/message_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-80-71" name="__codelineno-80-71"></a>            <span class="c1"># si le dossier n&#39;existe pas, on le crée</span>
<a id="__codelineno-80-72" name="__codelineno-80-72"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir3</span><span class="p">):</span>
<a id="__codelineno-80-73" name="__codelineno-80-73"></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dir3</span><span class="p">)</span>
<a id="__codelineno-80-74" name="__codelineno-80-74"></a>            <span class="c1"># on le sauvegarde</span>
<a id="__codelineno-80-75" name="__codelineno-80-75"></a>            <span class="n">save_message</span><span class="p">(</span><span class="n">dir3</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<a id="__codelineno-80-76" name="__codelineno-80-76"></a>            <span class="c1"># message suivant</span>
<a id="__codelineno-80-77" name="__codelineno-80-77"></a>            <span class="n">imail</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-80-78" name="__codelineno-80-78"></a>            <span class="n">fini</span> <span class="o">=</span> <span class="n">imail</span> <span class="o">&gt;=</span> <span class="n">maxmails</span> <span class="ow">or</span> <span class="n">imail</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<a id="__codelineno-80-79" name="__codelineno-80-79"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-80-80" name="__codelineno-80-80"></a>        <span class="k">if</span> <span class="n">imap_resource</span><span class="p">:</span>
<a id="__codelineno-80-81" name="__codelineno-80-81"></a>            <span class="c1"># on ferme la connexion avec la mailbox</span>
<a id="__codelineno-80-82" name="__codelineno-80-82"></a>            <span class="n">imap_resource</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-80-83" name="__codelineno-80-83"></a>            <span class="c1"># on se déconnecte du serveur IMAP</span>
<a id="__codelineno-80-84" name="__codelineno-80-84"></a>            <span class="n">imap_resource</span><span class="o">.</span><span class="n">logout</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 7-15 : on récupère les éléments de la configuration ;</li>
<li>lignes 19, 79 : le code est contrôlé par un try / finally. On n&#x27;intercepte donc pas les exceptions (absence de la clause except) qui vont alors remonter au code appelant qui les arrête et les affiche ;</li>
<li>lignes 23-30 : on crée le dossier de sauvegarde des mails ;</li>
<li>lignes 31-35 : on se connecte au serveur IMAP. La classe utilisée est différente selon qu&#x27;on a affaire à un serveur IMAP sécurisé (IMAP4_SSL) ou pas (IMAP4) ;</li>
<li>lignes 36-38 : on fixe le timeout des communications client / serveur ;</li>
<li>lignes 39-40 : on s&#x27;authentifie auprès du serveur IMAP ;</li>
<li>lignes 41-42 : on a vu que la boîte mail d&#x27;un utilisateur IMAP pouvait être organisée en dossiers. Le dossier <strong>[INBOX]</strong> est celle du courrier entrant. Pour sélectionner le dossier <strong>[dossier1]</strong> on écrirait <strong>[</strong><strong>imapResource.select(</strong><strong>&#x27;dossier1&#x27;</strong><strong>)</strong><strong>]</strong> ;</li>
<li>lignes 43-45 : on demande la liste de tous les messages trouvés dans <strong>[INBOX]</strong> :</li>
<li>le 1er paramètre de <strong>[</strong><strong>imapResource.search</strong><strong>]</strong> est un type d&#x27;encodage. <strong>[None]</strong> signifie &quot;pas de filtre sur l&#x27;encodage&quot; ;</li>
<li>le 2e paramètre est un critère. Il y a différentes façons d&#x27;exprimer celui-ci. Le critère <strong>[ALL]</strong> signifie qu&#x27;on veut tous les messages du dossier ;
Le résultat de <strong>[</strong><strong>imapResource.search</strong><strong>]</strong> ressemble à ceci :</li>
</ul>
<p>typ=OK, data=<strong>[b&#x27;1 2&#x27;]</strong></p>
<p><strong>[data]</strong> est une liste qui contient les n°s des messages obtenus. Ceux-ci sont en binaire. Ci-dessus, deux messages ont été trouvés dans le dossier <strong>[INBOX]</strong> ;</p>
<ul>
<li>ligne 49 : on récupère les n°s des messages. Ci-dessus on aura la liste <strong>[b&#x27;1&#x27; b&#x27;2&#x27;]</strong>, une liste de numéros codés en binaire ;</li>
<li>lignes 53-78 : on va boucler pour lire les messages du dossier <strong>[INBOX]</strong> ;</li>
<li>lignes 54-55 : n° du message ;</li>
<li>lignes 58-59 : le message n° <strong>[num]</strong> est demandé au serveur IMAP ;</li>
<li>le 1er paramètre est le n° du message désiré ;</li>
<li>le second paramètre est une chaîne &quot;(part1)(part2)…&quot; où <strong>[parti]</strong> est le nom d&#x27;une partie du message. Je n&#x27;ai pas approfondi ce point. Le nom (RFC822) désigne la totalité du mail ;
On reçoit quelque chose de la forme suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-81-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1"></a><span class="nb">type</span><span class="o">=</span><span class="n">OK</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[(</span><span class="sa">b</span><span class="s1">&#39;1 (RFC822 </span><span class="si">{614}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;Return-Path: guest@localhost</span><span class="se">\r\n</span><span class="s1">Received: from [127.0.0.1] (localhost [127.0.0.1])</span><span class="se">\r\n\t</span><span class="s1">by DESKTOP-528I5CU with ESMTPA</span><span class="se">\r\n\t</span><span class="s1">; Tue, 17 Mar 2020 09:41:50 +0100</span><span class="se">\r\n</span><span class="s1">To: guest@localhost</span><span class="se">\r\n</span><span class="s1">From: &quot;guest@localhost&quot; &lt;guest@localhost&gt;</span><span class="se">\r\n</span><span class="s1">Subject: test</span><span class="se">\r\n</span><span class="s1">Message-ID: &lt;2572d0f0-5b7c-2c31-5a70-c628293d5709@localhost&gt;</span><span class="se">\r\n</span><span class="s1">Date: Tue, 17 Mar 2020 09:41:48 +0100</span><span class="se">\r\n</span><span class="s1">User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101</span><span class="se">\r\n</span><span class="s1"> Thunderbird/68.6.0</span><span class="se">\r\n</span><span class="s1">MIME-Version: 1.0</span><span class="se">\r\n</span><span class="s1">Content-Type: text/plain; charset=utf-8; format=flowed</span><span class="se">\r\n</span><span class="s1">Content-Transfer-Encoding: 8bit</span><span class="se">\r\n</span><span class="s1">Content-Language: fr</span><span class="se">\r\n\r\n</span><span class="s1">h</span><span class="se">\xc3\xa9</span><span class="s1">l</span><span class="se">\xc3\xa8</span><span class="s1">ne est all</span><span class="se">\xc3\xa9</span><span class="s1">e au march</span><span class="se">\xc3\xa9</span><span class="s1"> acheter des l</span><span class="se">\xc3\xa9</span><span class="s1">gumes.</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;)&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>L&#x27;élément <strong>[data]</strong> est ici une liste à 1 élément et cet unique élément est un tuple de trois éléments :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-82-1">1</a></span>
<span class="normal"><a href="#__codelineno-82-2">2</a></span>
<span class="normal"><a href="#__codelineno-82-3">3</a></span>
<span class="normal"><a href="#__codelineno-82-4">4</a></span>
<span class="normal"><a href="#__codelineno-82-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1"></a><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-82-2" name="__codelineno-82-2"></a>    <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;1 (RFC822 </span><span class="si">{614}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-82-3" name="__codelineno-82-3"></a>     <span class="sa">b</span><span class="s1">&#39;Return-Path: guest@localhost</span><span class="se">\r\n</span><span class="s1">Received: from [127.0.0.1] (localhost [127.0.0.1])</span><span class="se">\r\n\t</span><span class="s1">by DESKTOP-528I5CU with ESMTPA</span><span class="se">\r\n\t</span><span class="s1">; Tue, 17 Mar 2020 09:41:50 +0100</span><span class="se">\r\n</span><span class="s1">To: guest@localhost</span><span class="se">\r\n</span><span class="s1">From: &quot;guest@localhost&quot; &lt;guest@localhost&gt;</span><span class="se">\r\n</span><span class="s1">Subject: test</span><span class="se">\r\n</span><span class="s1">Message-ID: &lt;2572d0f0-5b7c-2c31-5a70-c628293d5709@localhost&gt;</span><span class="se">\r\n</span><span class="s1">Date: Tue, 17 Mar 2020 09:41:48 +0100</span><span class="se">\r\n</span><span class="s1">User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101</span><span class="se">\r\n</span><span class="s1"> Thunderbird/68.6.0</span><span class="se">\r\n</span><span class="s1">MIME-Version: 1.0</span><span class="se">\r\n</span><span class="s1">Content-Type: text/plain; charset=utf-8; format=flowed</span><span class="se">\r\n</span><span class="s1">Content-Transfer-Encoding: 8bit</span><span class="se">\r\n</span><span class="s1">Content-Language: fr</span><span class="se">\r\n\r\n</span><span class="s1">h</span><span class="se">\xc3\xa9</span><span class="s1">l</span><span class="se">\xc3\xa8</span><span class="s1">ne est all</span><span class="se">\xc3\xa9</span><span class="s1">e au march</span><span class="se">\xc3\xa9</span><span class="s1"> acheter des l</span><span class="se">\xc3\xa9</span><span class="s1">gumes.</span><span class="se">\r\n\r\n</span><span class="s1">&#39;</span><span class="p">),</span>
<a id="__codelineno-82-4" name="__codelineno-82-4"></a>    <span class="sa">b</span><span class="s1">&#39;)&#39;</span>
<a id="__codelineno-82-5" name="__codelineno-82-5"></a><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>Le second élément de ce tuple est une chaîne binaire représentant la totalité du message demandé. On reconnaît ci-dessus, des éléments déjà présentés lors de l&#x27;étude du module <strong>[mail_parser]</strong>.</p>
<p>data<strong>[0]</strong> représente un tuple à deux éléments. data<strong>[0][1]</strong> représente les lignes du message sous une forme binaire.</p>
<ul>
<li>ligne 68 : la fonction <strong>[</strong><strong>email</strong><strong>.message_from_bytes(data2[0</strong><strong>]</strong><strong>[1]</strong>)] construit un objet de type <strong>[email.message.Message]</strong> à partir des lignes du message. Le type <strong>[email.message.Message]</strong> est le type du paramètre du module <strong>[mail_parser]</strong> que nous avons écrit précédemment ;</li>
<li>lignes 69-73 : nous créons le dossier de sauvegarde du message n° <strong>[num]</strong> ;</li>
<li>ligne 75 : nous faisons appel à la fonction <strong>[save_message]</strong> du module <strong>[mail_parser]</strong> de la ligne 5. Cette fonction a été décrite au paragraphe |<a href="#_script_[pop3-02]_:"><u><u>pop3/02/main</u></u></a>| ;</li>
<li>lignes 76-78 : on reboucle pour traiter le message suivant ;</li>
<li>lignes 79-84 : qu&#x27;il y ait eu erreur ou pas :</li>
<li>ligne 82 : on clôt la connexion avec le dossier interrogé ;</li>
<li>ligne 84 : on se déconnecte du serveur IMAP ;
Les résultats obtenus sont identiques à ceux obtenus avec le script <strong>[pop3/02/main]</strong>. C&#x27;est normal puisque c&#x27;est le même parseur de mail <strong>[mail_parser]</strong> qui est utilisé.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>