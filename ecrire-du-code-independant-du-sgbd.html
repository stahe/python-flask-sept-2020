
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Python 3 et au framework web Flask par l'exemple">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-flask-sept-2020/ecrire-du-code-independant-du-sgbd.html">
      
      
        <link rel="prev" href="utilisation-du-sgbd-postgresql.html">
      
      
        <link rel="next" href="utilisation-de-lorm-sqlalchemy.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>18. Ecrire du code indépendant du SGBD - Introduction au langage Python 3 et au framework web Flask par l'exemple</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#18-ecrire-du-code-independant-du-sgbd" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-header__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Python 3 et au framework web Flask par l'exemple
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              18. Ecrire du code indépendant du SGBD
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-nav__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Python 3 et au framework web Flask par l'exemple
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="avant-propos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Avant-propos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dx27un-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Installation d&#x27;un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-bases-de-python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Les bases de Python
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-chaines-de-caracteres.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Les chaînes de caractères
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-exceptions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Les exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fonctions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Les fonctions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fichiers-texte.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Les fichiers texte
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Exercice d&#x27;application – version 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-imports.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Les imports
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Exercice d’application : version 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Exercice d’application : version 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-et-objets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. Les classes et objets
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-generiques-baseentity-et-myexception.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. Les classes génériques [BaseEntity] et [MyException]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture-en-couches-et-programmation-par-interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. Architecture en couches et programmation par interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. Exercice d&#x27;application - version 4
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-mysql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. Utilisation du SGBD MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-postgresql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. Utilisation du SGBD PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="ecrire-du-code-independant-du-sgbd.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    18. Ecrire du code indépendant du SGBD
  

    
  </span>
  
  

      </a>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-de-lorm-sqlalchemy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. Utilisation de l’ORM SQLALCHEMY
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application-version-5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Exercice d&#x27;application : version 5
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="fonctions-internet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Fonctions internet
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="services-web-avec-le-framework-flask.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Services web avec le framework Flask
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23. Exercice d’application : version 6
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24. Exercice d’application : version 7
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25. Exercice d’application : version 8
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="du-dictionnaire-a-xml-et-vice-versa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26. Du dictionnaire à XML et vice-versa
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-9.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27. Exercice d’application : version 9
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-10.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28. Exercice d’application : version 10
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-11.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    29. Exercice d’application : version 11
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30. Exercice d’application : version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="clients-web-pour-les-services-json-et-xml-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    31. Clients web pour les services jSON et XML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="le-mode-html-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    32. Le mode HTML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-13.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    33. Exercice d’application : version 13
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-14.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    34. Exercice d’application : version 14
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-15.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    35. Exercice d’application : version 15
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-16.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    36. Exercice d’application : version 16
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-17.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    37. Exercice d’application : version 17
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-18.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    38. Exercice d’application : version 18
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    39. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="18-ecrire-du-code-independant-du-sgbd">18. Ecrire du code indépendant du SGBD</h1>
<p>Nous avons vu précédemment que dans certains cas il était possible de migrer simplement du code Python écrit pour le SGBD MySQL vers du code écrit pour le SGBD PostgreSQL. Dans ce chapitre, nous montrons comment systématiser cette approche. L’architecture proposée devient la suivante :</p>
<p><img src="images/10000000000003B4000000E6700B9C1D.png" style="width:10.951cm;height:2.661cm;" alt="Image" /></p>
<p>On souhaite que le choix du connecteur et donc du SGBD se fasse par configuration et ne nécessite pas de réécriture du script. On rappelle que cela n’est possible que dans les cas où le script n’utilise pas d’extensions propriétaires du SGBD.</p>
<p>L’arborescence des scripts sera la suivante :</p>
<p><img src="images/1000000000000168000001EBB3D4138F.png" style="width:4.16cm;height:5.661cm;" alt="Image" /></p>
<p>Les scripts <strong>[any_xx]</strong> reprennent les scripts déjà étudiés pour les SGBD MySQL et PostgreSQL. Nous n’allons pas tous les reprendre. Nous allons nous concentrer sur le script <strong>[any_04]</strong> qui est le plus complexe. On rappelle que ce script exécute les commandes SQL du fichier <strong>[data/commandes.sql]</strong> suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># suppression de la table [personnes]</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="n">drop</span> <span class="n">table</span> <span class="k">if</span> <span class="n">exists</span> <span class="n">personnes</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="c1"># création de la table personnes</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="n">create</span> <span class="n">table</span> <span class="n">personnes</span> <span class="p">(</span><span class="nb">id</span> <span class="nb">int</span> <span class="n">primary</span> <span class="n">key</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">nom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">age</span> <span class="n">integer</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">unique</span> <span class="p">(</span><span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">))</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="c1"># insertion de deux personnes</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Paul&#39;</span><span class="p">,</span><span class="s1">&#39;Langevin&#39;</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Sylvie&#39;</span><span class="p">,</span><span class="s1">&#39;Lefur&#39;</span><span class="p">,</span><span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="c1"># affichage de la table</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="n">select</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="c1"># erreur volontaire</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="n">xx</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="c1"># insertion de trois personnes</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Pierre&#39;</span><span class="p">,</span><span class="s1">&#39;Nicazou&#39;</span><span class="p">,</span><span class="mi">35</span><span class="p">)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Geraldine&#39;</span><span class="p">,</span><span class="s1">&#39;Colou&#39;</span><span class="p">,</span><span class="mi">26</span><span class="p">)</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Paulette&#39;</span><span class="p">,</span><span class="s1">&#39;Girond&#39;</span><span class="p">,</span><span class="mi">56</span><span class="p">)</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="c1"># affichage de la table</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="n">select</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="c1"># liste des personnes par ordre alphabétique des noms et à nom égal par ordre alphabétique des prénoms</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">order</span> <span class="n">by</span> <span class="n">nom</span> <span class="n">asc</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">desc</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="c1"># liste des personnes ayant un âge dans l&#39;intervalle [20,40] par ordre décroissant de l&#39;âge</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="c1"># puis à âge égal par ordre alphabétique des noms et à nom égal par ordre alphabétique des prénoms</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">age</span> <span class="n">between</span> <span class="mi">20</span> <span class="ow">and</span> <span class="mi">40</span> <span class="n">order</span> <span class="n">by</span> <span class="n">age</span> <span class="n">desc</span><span class="p">,</span> <span class="n">nom</span> <span class="n">asc</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">asc</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="c1"># insertion de mme Bruneau</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Josette&#39;</span><span class="p">,</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">,</span><span class="mi">46</span><span class="p">)</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="c1"># mise à jour de son âge</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="n">update</span> <span class="n">personnes</span> <span class="nb">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">47</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="c1"># liste des personnes ayant Bruneau pour nom</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="c1"># suppression de Mme Bruneau</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="n">delete</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="c1"># liste des personnes ayant Bruneau pour nom</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span>
</code></pre></div></td></tr></table></div>
<p>Nous avons modifié la ligne 2 pour que la commande ait le même comportement pour les SGBD MySQL et PostgreSQL si la table <strong>[personnes]</strong> n’existe pas.</p>
<p>Le script <strong>[any_04]</strong> est configuré par le script <strong>[config.py]</strong> suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span>
<span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">():</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>    <span class="c1"># chemin absolu du dossier de ce script</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>    <span class="c1"># configuration des dossiers du syspath</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>        <span class="c1"># dossiers locaux</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/shared&quot;</span><span class="p">,</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>    <span class="p">]</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a>    <span class="c1"># fixation du syspath</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>    <span class="c1"># configuration de l&#39;application</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>        <span class="c1"># sgbd gérés</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>        <span class="s2">&quot;sgbds&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a>            <span class="s2">&quot;mysql&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>                <span class="c1"># connecteur du sgbd</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>                <span class="s2">&quot;sgbd_connector&quot;</span><span class="p">:</span> <span class="s2">&quot;mysql.connector&quot;</span><span class="p">,</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a>                <span class="c1"># nom du module rassemblant des fonctions de gestion du sgbd</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a>                <span class="s2">&quot;sgbd_fonctions&quot;</span><span class="p">:</span> <span class="s2">&quot;any_module&quot;</span><span class="p">,</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>                <span class="c1"># identifiants de la connexion</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;admpersonnes&quot;</span><span class="p">,</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;nobody&quot;</span><span class="p">,</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a>                <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a>                <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="s2">&quot;dbpersonnes&quot;</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a>            <span class="p">},</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a>            <span class="s2">&quot;postgresql&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a>                <span class="c1"># connecteur du sgbd</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a>                <span class="s2">&quot;sgbd_connector&quot;</span><span class="p">:</span> <span class="s2">&quot;psycopg2&quot;</span><span class="p">,</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a>                <span class="c1"># nom du module rassemblant des fonctions de gestion du sgbd</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a>                <span class="s2">&quot;sgbd_fonctions&quot;</span><span class="p">:</span> <span class="s2">&quot;any_module&quot;</span><span class="p">,</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a>                <span class="c1"># identifiants de la connexion</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a>                <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;admpersonnes&quot;</span><span class="p">,</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;nobody&quot;</span><span class="p">,</span>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a>                <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a>                <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="s2">&quot;dbpersonnes&quot;</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a>            <span class="p">}</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a>        <span class="p">},</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a>        <span class="c1"># fichier de commandes SQL</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a>        <span class="s2">&quot;commands_filename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/data/commandes.sql&quot;</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a>    <span class="p">}</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a>    <span class="c1"># syspath de l&#39;application</span>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a>    <span class="c1"># on rend la config</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a>    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<p>La nouveauté réside dans les lignes 18-43 :</p>
<ul>
<li>ligne 20 : <strong>[sgbds]</strong> est un dictionnaire avec deux clés <strong>[mysql]</strong> ligne 21 et <strong>[postgresql]</strong> ligne 32 ;</li>
<li>la valeur associée à ces clés est un dictionnaire donnant les éléments permettant la connexion à un SGBD :</li>
<li>lignes 21-32 : les éléments d’une connexion au SGBD MySQL ;</li>
<li>ligne 23 : le connecteur Python à utiliser ;</li>
<li>ligne 25 : le module contenant des fonctions partagées ;</li>
<li>lignes 26-30 : les identifiants de la connexion ;</li>
<li>lignes 32-41 : les mêmes éléments pour une connexion au SGBD PostgreSQL ;
Le script <strong>[any_04]</strong> qui exécute le fichier de commandes SQL <strong>[data/commandes.sql]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span>
<span class="normal"><a href="#__codelineno-2-31">31</a></span>
<span class="normal"><a href="#__codelineno-2-32">32</a></span>
<span class="normal"><a href="#__codelineno-2-33">33</a></span>
<span class="normal"><a href="#__codelineno-2-34">34</a></span>
<span class="normal"><a href="#__codelineno-2-35">35</a></span>
<span class="normal"><a href="#__codelineno-2-36">36</a></span>
<span class="normal"><a href="#__codelineno-2-37">37</a></span>
<span class="normal"><a href="#__codelineno-2-38">38</a></span>
<span class="normal"><a href="#__codelineno-2-39">39</a></span>
<span class="normal"><a href="#__codelineno-2-40">40</a></span>
<span class="normal"><a href="#__codelineno-2-41">41</a></span>
<span class="normal"><a href="#__codelineno-2-42">42</a></span>
<span class="normal"><a href="#__codelineno-2-43">43</a></span>
<span class="normal"><a href="#__codelineno-2-44">44</a></span>
<span class="normal"><a href="#__codelineno-2-45">45</a></span>
<span class="normal"><a href="#__codelineno-2-46">46</a></span>
<span class="normal"><a href="#__codelineno-2-47">47</a></span>
<span class="normal"><a href="#__codelineno-2-48">48</a></span>
<span class="normal"><a href="#__codelineno-2-49">49</a></span>
<span class="normal"><a href="#__codelineno-2-50">50</a></span>
<span class="normal"><a href="#__codelineno-2-51">51</a></span>
<span class="normal"><a href="#__codelineno-2-52">52</a></span>
<span class="normal"><a href="#__codelineno-2-53">53</a></span>
<span class="normal"><a href="#__codelineno-2-54">54</a></span>
<span class="normal"><a href="#__codelineno-2-55">55</a></span>
<span class="normal"><a href="#__codelineno-2-56">56</a></span>
<span class="normal"><a href="#__codelineno-2-57">57</a></span>
<span class="normal"><a href="#__codelineno-2-58">58</a></span>
<span class="normal"><a href="#__codelineno-2-59">59</a></span>
<span class="normal"><a href="#__codelineno-2-60">60</a></span>
<span class="normal"><a href="#__codelineno-2-61">61</a></span>
<span class="normal"><a href="#__codelineno-2-62">62</a></span>
<span class="normal"><a href="#__codelineno-2-63">63</a></span>
<span class="normal"><a href="#__codelineno-2-64">64</a></span>
<span class="normal"><a href="#__codelineno-2-65">65</a></span>
<span class="normal"><a href="#__codelineno-2-66">66</a></span>
<span class="normal"><a href="#__codelineno-2-67">67</a></span>
<span class="normal"><a href="#__codelineno-2-68">68</a></span>
<span class="normal"><a href="#__codelineno-2-69">69</a></span>
<span class="normal"><a href="#__codelineno-2-70">70</a></span>
<span class="normal"><a href="#__codelineno-2-71">71</a></span>
<span class="normal"><a href="#__codelineno-2-72">72</a></span>
<span class="normal"><a href="#__codelineno-2-73">73</a></span>
<span class="normal"><a href="#__codelineno-2-74">74</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="c1"># le syspath est configuré - on peut faire les imports</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">importlib</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="c1"># vérification de la syntaxe de l&#39;appel</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="c1"># argv[0] sgbd_name true / false</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="c1"># il faut 3 paramètres</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="n">erreur</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a>    <span class="c1"># on récupère les deux paramètres qui nous intéressent</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a>    <span class="n">sgbd_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a>    <span class="n">with_transaction</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a>    <span class="c1"># vérification des deux paramètres</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a>    <span class="n">erreur</span> <span class="o">=</span> <span class="p">(</span><span class="n">with_transaction</span> <span class="o">!=</span> <span class="s2">&quot;true&quot;</span> <span class="ow">and</span> <span class="n">with_transaction</span> <span class="o">!=</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span> \
<a id="__codelineno-2-21" name="__codelineno-2-21"></a>             <span class="ow">or</span> <span class="n">sgbd_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;sgbds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="c1"># erreur ?</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="k">if</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;syntaxe : </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (1) sgbd_name (2) true / false&quot;</span><span class="p">)</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a><span class="c1"># configuration du sgbd_name</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="n">sgbd_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;sgbds&quot;</span><span class="p">][</span><span class="n">sgbd_name</span><span class="p">]</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="c1"># connecteur du sgbd_name</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="n">sgbd_connector</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">sgbd_config</span><span class="p">[</span><span class="s2">&quot;sgbd_connector&quot;</span><span class="p">])</span>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="c1"># bibliothèque de fonctions</span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="n">lib</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">sgbd_config</span><span class="p">[</span><span class="s2">&quot;sgbd_fonctions&quot;</span><span class="p">])</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="c1"># calcul d&#39;un texte à afficher</span>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="n">with_transaction</span> <span class="o">=</span> <span class="n">with_transaction</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="k">if</span> <span class="n">with_transaction</span><span class="p">:</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a>    <span class="n">texte</span> <span class="o">=</span> <span class="s2">&quot;avec transaction&quot;</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a>    <span class="n">texte</span> <span class="o">=</span> <span class="s2">&quot;sans transaction&quot;</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a><span class="c1"># affichage</span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="n">commands_filename</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;commands_filename&#39;</span><span class="p">]</span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exécution du fichier SQL </span><span class="si">{</span><span class="n">commands_filename</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">texte</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a><span class="c1"># exécution des ordres SQL du fichier</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a><span class="n">connexion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a>    <span class="c1"># connexion</span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a>    <span class="n">connexion</span> <span class="o">=</span> <span class="n">sgbd_connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a>        <span class="n">host</span><span class="o">=</span><span class="n">sgbd_config</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">],</span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a>        <span class="n">user</span><span class="o">=</span><span class="n">sgbd_config</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">],</span>
<a id="__codelineno-2-55" name="__codelineno-2-55"></a>        <span class="n">password</span><span class="o">=</span><span class="n">sgbd_config</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span>
<a id="__codelineno-2-56" name="__codelineno-2-56"></a>        <span class="n">database</span><span class="o">=</span><span class="n">sgbd_config</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">])</span>
<a id="__codelineno-2-57" name="__codelineno-2-57"></a>    <span class="c1"># exécution du fichier des commandes SQL</span>
<a id="__codelineno-2-58" name="__codelineno-2-58"></a>    <span class="n">erreurs</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">execute_file_of_commands</span><span class="p">(</span><span class="n">sgbd_connector</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="n">commands_filename</span><span class="p">,</span> <span class="n">suivi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arrêt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-2-59" name="__codelineno-2-59"></a>                                           <span class="n">with_transaction</span><span class="o">=</span><span class="n">with_transaction</span><span class="p">)</span>
<a id="__codelineno-2-60" name="__codelineno-2-60"></a><span class="k">except</span> <span class="p">(</span><span class="n">sgbd_connector</span><span class="o">.</span><span class="n">InterfaceError</span><span class="p">,</span> <span class="n">sgbd_connector</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-2-61" name="__codelineno-2-61"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-62" name="__codelineno-2-62"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-2-63" name="__codelineno-2-63"></a>    <span class="c1"># fermeture de la connexion</span>
<a id="__codelineno-2-64" name="__codelineno-2-64"></a>    <span class="k">if</span> <span class="n">connexion</span><span class="p">:</span>
<a id="__codelineno-2-65" name="__codelineno-2-65"></a>        <span class="n">connexion</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-2-66" name="__codelineno-2-66"></a>
<a id="__codelineno-2-67" name="__codelineno-2-67"></a><span class="c1"># affichage nombre d&#39;erreurs</span>
<a id="__codelineno-2-68" name="__codelineno-2-68"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-2-69" name="__codelineno-2-69"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exécution terminée&quot;</span><span class="p">)</span>
<a id="__codelineno-2-70" name="__codelineno-2-70"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-2-71" name="__codelineno-2-71"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Il y a eu </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">erreurs</span><span class="p">)</span><span class="si">}</span><span class="s2"> erreur(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-2-72" name="__codelineno-2-72"></a><span class="c1"># affichage des erreurs</span>
<a id="__codelineno-2-73" name="__codelineno-2-73"></a><span class="k">for</span> <span class="n">erreur</span> <span class="ow">in</span> <span class="n">erreurs</span><span class="p">:</span>
<a id="__codelineno-2-74" name="__codelineno-2-74"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">erreur</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 1-4 : on récupère la configuration <strong>[config]</strong> de l’application ;</li>
<li>lignes 10-21 : le script s’appelle avec deux paramètres <strong>[sgbd_name with_transaction]</strong> :</li>
<li><strong>[sgbd_name]</strong> : le nom du SGBD à utiliser ;</li>
<li><strong>[with_transaction]</strong> : True si on veut exécuter le fichier de commandes SQL au sein d’une transaction, False sinon ;</li>
<li>lignes 10-25 : les paramètres sont récupérés et vérifiés ;</li>
<li>ligne 28 : la configuration du SGBD choisi ;</li>
<li>ligne 30 : on importe le connecteur du SGBD choisi. On utilise pour cela la bibliothèque <strong>[importlib]</strong> (ligne 7) qui permet d’importer un module dont le nom est dans une variable. Le résultat de l’opération <strong>[</strong><strong>importlib</strong><strong>.import_module</strong><strong>]</strong> est un module. Ainsi après la ligne 30, tout se passe comme si l’instruction exécutée avait été :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sgbd_connector</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Ceci va nous permettre d’écrire ligne 52 <strong>[</strong><strong>sgbd_connector.connect</strong><strong>]</strong> où on utilise la fonction <strong>[connect]</strong> du module <strong>[</strong><strong>sgbd_connector</strong><strong>]</strong>. Il faut se rappeler ici que <strong>[</strong><strong>sgbd_connector</strong><strong>]</strong> est soit <strong>[mysql.connector]</strong> ou <strong>[psycopg2]</strong>. Ces deux modules ont la fonction <strong>[connect]</strong>. De même, ligne 60, on peut écrire <strong>[</strong><strong>sgbd_connector.InterfaceError, sgbd_connector.DatabaseError</strong><strong>]</strong>.</p>
<ul>
<li>ligne 32 : on importe le module des fonctions utilisées par le script ;</li>
<li>ligne 58 : on exécute la fonction <strong>[</strong><strong>execute_file_of_commands</strong><strong>]</strong> du module des fonctions utilisées par le script. Par rapport aux versions précédentes, la signature de cette fonction a un paramètre de plus, le premier. On passe à la fonction le connecteur Python <strong>[</strong><strong>sgbd_connector</strong><strong>]</strong> qu’elle doit utiliser ;</li>
<li>en-dehors de ces points, le script <strong>[any_04]</strong> reste ce qu’il était dans les versions précédentes ;
La bibliothèque de fonctions <strong>[any_module]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span>
<span class="normal"><a href="#__codelineno-4-35">35</a></span>
<span class="normal"><a href="#__codelineno-4-36">36</a></span>
<span class="normal"><a href="#__codelineno-4-37">37</a></span>
<span class="normal"><a href="#__codelineno-4-38">38</a></span>
<span class="normal"><a href="#__codelineno-4-39">39</a></span>
<span class="normal"><a href="#__codelineno-4-40">40</a></span>
<span class="normal"><a href="#__codelineno-4-41">41</a></span>
<span class="normal"><a href="#__codelineno-4-42">42</a></span>
<span class="normal"><a href="#__codelineno-4-43">43</a></span>
<span class="normal"><a href="#__codelineno-4-44">44</a></span>
<span class="normal"><a href="#__codelineno-4-45">45</a></span>
<span class="normal"><a href="#__codelineno-4-46">46</a></span>
<span class="normal"><a href="#__codelineno-4-47">47</a></span>
<span class="normal"><a href="#__codelineno-4-48">48</a></span>
<span class="normal"><a href="#__codelineno-4-49">49</a></span>
<span class="normal"><a href="#__codelineno-4-50">50</a></span>
<span class="normal"><a href="#__codelineno-4-51">51</a></span>
<span class="normal"><a href="#__codelineno-4-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># ---------------------------------------------------------------------------------</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">afficher_infos</span><span class="p">(</span><span class="n">curseur</span><span class="p">):</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>    <span class="err">…</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="c1"># ---------------------------------------------------------------------------------</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute_list_of_commands</span><span class="p">(</span><span class="n">sgbd_connector</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="n">sql_commands</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>                             <span class="n">suivi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">arrêt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">with_transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="err">…</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>    <span class="c1"># initialisations</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>    <span class="n">curseur</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>    <span class="n">connexion</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">with_transaction</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span class="n">erreurs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>        <span class="c1"># on demande un curseur</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>        <span class="n">curseur</span> <span class="o">=</span> <span class="n">connexion</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>        <span class="c1"># exécution des sql_commands SQL contenues dans sql_commands</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>        <span class="c1"># on les exécute une à une</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">sql_commands</span><span class="p">:</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>            <span class="c1"># on élimine les blancs de début et de fin de la commande courante</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>            <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>            <span class="c1"># a-t-on une commande vide ou un commentaire ? Si oui, on passe à la commande suivante</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>            <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>                <span class="k">continue</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a>            <span class="c1"># exécution de la commande courante</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a>            <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a>                <span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a>            <span class="k">except</span> <span class="p">(</span><span class="n">sgbd_connector</span><span class="o">.</span><span class="n">InterfaceError</span><span class="p">,</span> <span class="n">sgbd_connector</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a>                <span class="n">error</span> <span class="o">=</span> <span class="n">erreur</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a>            <span class="c1"># y-a-t-il eu une erreur ?</span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a>            <span class="err">…</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a>
<a id="__codelineno-4-37" name="__codelineno-4-37"></a><span class="c1"># ---------------------------------------------------------------------------------</span>
<a id="__codelineno-4-38" name="__codelineno-4-38"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute_file_of_commands</span><span class="p">(</span><span class="n">sgbd_connector</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="n">sql_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-4-39" name="__codelineno-4-39"></a>                             <span class="n">suivi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">arrêt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">with_transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-4-40" name="__codelineno-4-40"></a>    <span class="err">…</span>
<a id="__codelineno-4-41" name="__codelineno-4-41"></a>
<a id="__codelineno-4-42" name="__codelineno-4-42"></a>    <span class="c1"># exploitation du fichier SQL</span>
<a id="__codelineno-4-43" name="__codelineno-4-43"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-44" name="__codelineno-4-44"></a>        <span class="c1"># ouverture du fichier en lecture</span>
<a id="__codelineno-4-45" name="__codelineno-4-45"></a>        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sql_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<a id="__codelineno-4-46" name="__codelineno-4-46"></a>        <span class="c1"># exploitation</span>
<a id="__codelineno-4-47" name="__codelineno-4-47"></a>        <span class="k">return</span> <span class="n">execute_list_of_commands</span><span class="p">(</span><span class="n">sgbd_connector</span><span class="p">,</span> <span class="n">connexion</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">(),</span> <span class="n">suivi</span><span class="p">,</span> <span class="n">arrêt</span><span class="p">,</span> <span class="n">with_transaction</span><span class="p">)</span>
<a id="__codelineno-4-48" name="__codelineno-4-48"></a>    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-4-49" name="__codelineno-4-49"></a>        <span class="c1"># on rend un tableau d&#39;erreurs</span>
<a id="__codelineno-4-50" name="__codelineno-4-50"></a>        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Le fichier </span><span class="si">{</span><span class="n">sql_filename</span><span class="si">}</span><span class="s2"> n&#39;a pu être être exploité : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
<a id="__codelineno-4-51" name="__codelineno-4-51"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-4-52" name="__codelineno-4-52"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p>Le paramètre <strong>[sgbd_connector]</strong> a été utilisé ligne 31 pour préciser le type des exceptions interceptées.</p>
<p>L’exécution du script <strong>[any_04]</strong> avec les paramètres <strong>[mysql false]</strong> donne les résultats suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span>
<span class="normal"><a href="#__codelineno-5-31">31</a></span>
<span class="normal"><a href="#__codelineno-5-32">32</a></span>
<span class="normal"><a href="#__codelineno-5-33">33</a></span>
<span class="normal"><a href="#__codelineno-5-34">34</a></span>
<span class="normal"><a href="#__codelineno-5-35">35</a></span>
<span class="normal"><a href="#__codelineno-5-36">36</a></span>
<span class="normal"><a href="#__codelineno-5-37">37</a></span>
<span class="normal"><a href="#__codelineno-5-38">38</a></span>
<span class="normal"><a href="#__codelineno-5-39">39</a></span>
<span class="normal"><a href="#__codelineno-5-40">40</a></span>
<span class="normal"><a href="#__codelineno-5-41">41</a></span>
<span class="normal"><a href="#__codelineno-5-42">42</a></span>
<span class="normal"><a href="#__codelineno-5-43">43</a></span>
<span class="normal"><a href="#__codelineno-5-44">44</a></span>
<span class="normal"><a href="#__codelineno-5-45">45</a></span>
<span class="normal"><a href="#__codelineno-5-46">46</a></span>
<span class="normal"><a href="#__codelineno-5-47">47</a></span>
<span class="normal"><a href="#__codelineno-5-48">48</a></span>
<span class="normal"><a href="#__codelineno-5-49">49</a></span>
<span class="normal"><a href="#__codelineno-5-50">50</a></span>
<span class="normal"><a href="#__codelineno-5-51">51</a></span>
<span class="normal"><a href="#__codelineno-5-52">52</a></span>
<span class="normal"><a href="#__codelineno-5-53">53</a></span>
<span class="normal"><a href="#__codelineno-5-54">54</a></span>
<span class="normal"><a href="#__codelineno-5-55">55</a></span>
<span class="normal"><a href="#__codelineno-5-56">56</a></span>
<span class="normal"><a href="#__codelineno-5-57">57</a></span>
<span class="normal"><a href="#__codelineno-5-58">58</a></span>
<span class="normal"><a href="#__codelineno-5-59">59</a></span>
<span class="normal"><a href="#__codelineno-5-60">60</a></span>
<span class="normal"><a href="#__codelineno-5-61">61</a></span>
<span class="normal"><a href="#__codelineno-5-62">62</a></span>
<span class="normal"><a href="#__codelineno-5-63">63</a></span>
<span class="normal"><a href="#__codelineno-5-64">64</a></span>
<span class="normal"><a href="#__codelineno-5-65">65</a></span>
<span class="normal"><a href="#__codelineno-5-66">66</a></span>
<span class="normal"><a href="#__codelineno-5-67">67</a></span>
<span class="normal"><a href="#__codelineno-5-68">68</a></span>
<span class="normal"><a href="#__codelineno-5-69">69</a></span>
<span class="normal"><a href="#__codelineno-5-70">70</a></span>
<span class="normal"><a href="#__codelineno-5-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">databases</span><span class="o">/</span><span class="n">anysgbd</span><span class="o">/</span><span class="n">any_04</span><span class="o">.</span><span class="n">py</span> <span class="n">mysql</span> <span class="n">false</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">Exécution</span> <span class="n">du</span> <span class="n">fichier</span> <span class="n">SQL</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">databases</span>\<span class="n">anysgbd</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">commandes</span><span class="o">.</span><span class="n">sql</span> <span class="n">sans</span> <span class="n">transaction</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="p">[</span><span class="n">drop</span> <span class="n">table</span> <span class="k">if</span> <span class="n">exists</span> <span class="n">personnes</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="p">[</span><span class="n">create</span> <span class="n">table</span> <span class="n">personnes</span> <span class="p">(</span><span class="nb">id</span> <span class="nb">int</span> <span class="n">primary</span> <span class="n">key</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">nom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">age</span> <span class="n">integer</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">unique</span> <span class="p">(</span><span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">))]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Paul&#39;</span><span class="p">,</span><span class="s1">&#39;Langevin&#39;</span><span class="p">,</span><span class="mi">48</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Sylvie&#39;</span><span class="p">,</span><span class="s1">&#39;Lefur&#39;</span><span class="p">,</span><span class="mi">70</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="p">[</span><span class="n">select</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="o">*****************</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="p">(</span><span class="s1">&#39;Paul&#39;</span><span class="p">,</span> <span class="s1">&#39;Langevin&#39;</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="p">(</span><span class="s1">&#39;Sylvie&#39;</span><span class="p">,</span> <span class="s1">&#39;Lefur&#39;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="o">*****************</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="n">xx</span> <span class="p">:</span> <span class="n">Erreur</span> <span class="p">(</span><span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="n">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">your</span> <span class="n">MySQL</span> <span class="n">server</span> <span class="n">version</span> <span class="k">for</span> <span class="n">the</span> <span class="n">right</span> <span class="n">syntax</span> <span class="n">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">&#39;xx&#39;</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Pierre&#39;</span><span class="p">,</span><span class="s1">&#39;Nicazou&#39;</span><span class="p">,</span><span class="mi">35</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Geraldine&#39;</span><span class="p">,</span><span class="s1">&#39;Colou&#39;</span><span class="p">,</span><span class="mi">26</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Paulette&#39;</span><span class="p">,</span><span class="s1">&#39;Girond&#39;</span><span class="p">,</span><span class="mi">56</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="p">[</span><span class="n">select</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="o">*****************</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="p">(</span><span class="s1">&#39;Paul&#39;</span><span class="p">,</span> <span class="s1">&#39;Langevin&#39;</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="p">(</span><span class="s1">&#39;Sylvie&#39;</span><span class="p">,</span> <span class="s1">&#39;Lefur&#39;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="p">(</span><span class="s1">&#39;Pierre&#39;</span><span class="p">,</span> <span class="s1">&#39;Nicazou&#39;</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="p">(</span><span class="s1">&#39;Geraldine&#39;</span><span class="p">,</span> <span class="s1">&#39;Colou&#39;</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="p">(</span><span class="s1">&#39;Paulette&#39;</span><span class="p">,</span> <span class="s1">&#39;Girond&#39;</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="o">*****************</span>
<a id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="p">[</span><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">order</span> <span class="n">by</span> <span class="n">nom</span> <span class="n">asc</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">desc</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="n">nom</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span>
<a id="__codelineno-5-37" name="__codelineno-5-37"></a><span class="o">************</span>
<a id="__codelineno-5-38" name="__codelineno-5-38"></a><span class="p">(</span><span class="s1">&#39;Colou&#39;</span><span class="p">,</span> <span class="s1">&#39;Geraldine&#39;</span><span class="p">)</span>
<a id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="p">(</span><span class="s1">&#39;Girond&#39;</span><span class="p">,</span> <span class="s1">&#39;Paulette&#39;</span><span class="p">)</span>
<a id="__codelineno-5-40" name="__codelineno-5-40"></a><span class="p">(</span><span class="s1">&#39;Langevin&#39;</span><span class="p">,</span> <span class="s1">&#39;Paul&#39;</span><span class="p">)</span>
<a id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="p">(</span><span class="s1">&#39;Lefur&#39;</span><span class="p">,</span> <span class="s1">&#39;Sylvie&#39;</span><span class="p">)</span>
<a id="__codelineno-5-42" name="__codelineno-5-42"></a><span class="p">(</span><span class="s1">&#39;Nicazou&#39;</span><span class="p">,</span> <span class="s1">&#39;Pierre&#39;</span><span class="p">)</span>
<a id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="o">************</span>
<a id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="p">[</span><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">age</span> <span class="n">between</span> <span class="mi">20</span> <span class="ow">and</span> <span class="mi">40</span> <span class="n">order</span> <span class="n">by</span> <span class="n">age</span> <span class="n">desc</span><span class="p">,</span> <span class="n">nom</span> <span class="n">asc</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">asc</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="n">nom</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-5-46" name="__codelineno-5-46"></a><span class="o">*****************</span>
<a id="__codelineno-5-47" name="__codelineno-5-47"></a><span class="p">(</span><span class="s1">&#39;Nicazou&#39;</span><span class="p">,</span> <span class="s1">&#39;Pierre&#39;</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
<a id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="p">(</span><span class="s1">&#39;Colou&#39;</span><span class="p">,</span> <span class="s1">&#39;Geraldine&#39;</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<a id="__codelineno-5-49" name="__codelineno-5-49"></a><span class="o">*****************</span>
<a id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Josette&#39;</span><span class="p">,</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">,</span><span class="mi">46</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-51" name="__codelineno-5-51"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-5-52" name="__codelineno-5-52"></a><span class="p">[</span><span class="n">update</span> <span class="n">personnes</span> <span class="nb">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">47</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-53" name="__codelineno-5-53"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-5-54" name="__codelineno-5-54"></a><span class="p">[</span><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-55" name="__codelineno-5-55"></a><span class="n">nom</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-5-56" name="__codelineno-5-56"></a><span class="o">*****************</span>
<a id="__codelineno-5-57" name="__codelineno-5-57"></a><span class="p">(</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">,</span> <span class="s1">&#39;Josette&#39;</span><span class="p">,</span> <span class="mi">47</span><span class="p">)</span>
<a id="__codelineno-5-58" name="__codelineno-5-58"></a><span class="o">*****************</span>
<a id="__codelineno-5-59" name="__codelineno-5-59"></a><span class="p">[</span><span class="n">delete</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-60" name="__codelineno-5-60"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-5-61" name="__codelineno-5-61"></a><span class="p">[</span><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-5-62" name="__codelineno-5-62"></a><span class="n">nom</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-5-63" name="__codelineno-5-63"></a><span class="o">*****************</span>
<a id="__codelineno-5-64" name="__codelineno-5-64"></a><span class="o">*****************</span>
<a id="__codelineno-5-65" name="__codelineno-5-65"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-5-66" name="__codelineno-5-66"></a><span class="n">Exécution</span> <span class="n">terminée</span>
<a id="__codelineno-5-67" name="__codelineno-5-67"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-5-68" name="__codelineno-5-68"></a><span class="n">Il</span> <span class="n">y</span> <span class="n">a</span> <span class="n">eu</span> <span class="mi">1</span> <span class="n">erreur</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-5-69" name="__codelineno-5-69"></a><span class="n">xx</span> <span class="p">:</span> <span class="n">Erreur</span> <span class="p">(</span><span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="n">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">your</span> <span class="n">MySQL</span> <span class="n">server</span> <span class="n">version</span> <span class="k">for</span> <span class="n">the</span> <span class="n">right</span> <span class="n">syntax</span> <span class="n">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">&#39;xx&#39;</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-5-70" name="__codelineno-5-70"></a>
<a id="__codelineno-5-71" name="__codelineno-5-71"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>