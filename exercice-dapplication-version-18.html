
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Python 3 et au framework web Flask par l'exemple">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-flask-sept-2020/exercice-dapplication-version-18.html">
      
      
        <link rel="prev" href="exercice-dapplication-version-17.html">
      
      
        <link rel="next" href="conclusion.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>38. Exercice d’application : version 18 - Introduction au langage Python 3 et au framework web Flask par l'exemple</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#38-exercice-dapplication-version-18" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-header__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Python 3 et au framework web Flask par l'exemple
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              38. Exercice d’application : version 18
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-nav__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Python 3 et au framework web Flask par l'exemple
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="avant-propos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Avant-propos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dx27un-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Installation d&#x27;un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-bases-de-python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Les bases de Python
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-chaines-de-caracteres.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Les chaînes de caractères
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-exceptions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Les exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fonctions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Les fonctions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fichiers-texte.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Les fichiers texte
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Exercice d&#x27;application – version 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-imports.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Les imports
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Exercice d’application : version 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Exercice d’application : version 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-et-objets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. Les classes et objets
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-generiques-baseentity-et-myexception.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. Les classes génériques [BaseEntity] et [MyException]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture-en-couches-et-programmation-par-interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. Architecture en couches et programmation par interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. Exercice d&#x27;application - version 4
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-mysql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. Utilisation du SGBD MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-postgresql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. Utilisation du SGBD PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="ecrire-du-code-independant-du-sgbd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. Ecrire du code indépendant du SGBD
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-de-lorm-sqlalchemy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. Utilisation de l’ORM SQLALCHEMY
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application-version-5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Exercice d&#x27;application : version 5
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="fonctions-internet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Fonctions internet
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="services-web-avec-le-framework-flask.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Services web avec le framework Flask
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23. Exercice d’application : version 6
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24. Exercice d’application : version 7
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25. Exercice d’application : version 8
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="du-dictionnaire-a-xml-et-vice-versa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26. Du dictionnaire à XML et vice-versa
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-9.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27. Exercice d’application : version 9
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-10.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28. Exercice d’application : version 10
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-11.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    29. Exercice d’application : version 11
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30. Exercice d’application : version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="clients-web-pour-les-services-json-et-xml-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    31. Clients web pour les services jSON et XML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="le-mode-html-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    32. Le mode HTML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-13.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    33. Exercice d’application : version 13
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-14.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    34. Exercice d’application : version 14
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-15.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    35. Exercice d’application : version 15
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-16.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    36. Exercice d’application : version 16
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-17.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    37. Exercice d’application : version 17
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    38. Exercice d’application : version 18
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="exercice-dapplication-version-18.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    38. Exercice d’application : version 18
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#381-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.1. Implémentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#382-tests-console" class="md-nav__link">
    <span class="md-ellipsis">
      
        38.2. Tests console
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    39. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="38-exercice-dapplication-version-18">38. Exercice d’application : version 18</h1>
<h2 id="381-implementation">38.1. Implémentation</h2>
<p><img src="images/1000000000000118000001AD67D1DE88.png" style="width:3.241cm;height:4.961cm;" alt="Image" /></p>
<p>Le dossier <strong>[impots/http-servers/13]</strong> est obtenu initialement par recopie du dossier <strong>[impots/http-servers/12]</strong> puis modifié partiellement.</p>
<p>Nous commençons par ajouter un nouveau paramètre dans le fichier <strong>[configs/parameters]</strong> :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="err">…</span>        
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>        <span class="c1"># token csrf</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>        <span class="s2">&quot;with_csrftoken&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>        <span class="c1"># bases gérées MySQL (mysql), PostgreSQL (pgres)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>        <span class="s2">&quot;databases&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mysql&quot;</span><span class="p">,</span> <span class="s2">&quot;pgres&quot;</span><span class="p">],</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>        <span class="c1"># préfixe des URL de l&#39;application</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>        <span class="c1"># mettre la chaîne vide si on ne veut pas de préfixe ou /préfixe sinon</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>        <span class="s2">&quot;prefix_url&quot;</span><span class="p">:</span> <span class="s2">&quot;/do&quot;</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>        <span class="c1"># url racine du serveur Apache - mettre la chaîne vide pour une exécution en-dehors d&#39;Apache</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>        <span class="s2">&quot;application_root&quot;</span><span class="p">:</span> <span class="s2">&quot;/impots&quot;</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="err">…</span>
</code></pre></div></td></tr></table></div>
<p>Ligne 10, le paramètre <strong>[application_root]</strong> représentera l’alias WSGI du serveur virtuel Apache.</p>
<p>Avec ce paramètre, nous pouvons corriger l’instruction de <strong>[responses/HtmlResponse]</strong> qui avait provoqué l’erreur :</p>
<p><img src="images/100000000000016C000000C643BF36F2.png" style="width:4.211cm;height:2.281cm;" alt="Image" /></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="err">…</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="c1"># maintenant il faut générer l&#39;URL de redirection sans oublier le jeton CSRF s&#39;il est demandé</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="s1">&#39;with_csrftoken&#39;</span><span class="p">]:</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>            <span class="n">csrf_token</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">generate_csrf</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>            <span class="n">csrf_token</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>        <span class="c1"># réponse de redirection</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="s1">&#39;application_root&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="s1">&#39;prefix_url&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">ads</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">csrf_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_302_FOUND</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : nous avons ajouté la racine de l’application au début de l’URL cible de la redirection ;
Il nous faut également corriger tous les fragments pour que les URL qu’ils contiennent commencent par la racine de l’application (ou alias WSGI) :</li>
</ul>
<p><img src="images/10000000000001BB00000148EACBA41E.png" style="width:5.111cm;height:3.791cm;" alt="Image" /></p>
<p><strong>Le fragment </strong><strong>[v-authentification]</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">formulaire</span> <span class="n">HTML</span> <span class="o">-</span> <span class="n">on</span> <span class="n">poste</span> <span class="n">ses</span> <span class="n">valeurs</span> <span class="n">avec</span> <span class="n">l</span><span class="s1">&#39;action [authentifier-utilisateur] --&gt;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;{{modèle.application_root}}{{modèle.prefix_url}}/authentifier-utilisateur{{modèle.csrf_token}}&quot;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="o">&gt;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">titre</span> <span class="o">--&gt;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert alert-primary&quot;</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>        <span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">Veuillez</span> <span class="n">vous</span> <span class="n">authentifier</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="err">…</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Le fragment </strong><strong>[v-calcul-impot]</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span>
<span class="normal"><a href="#__codelineno-3-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">formulaire</span> <span class="n">HTML</span> <span class="n">posté</span> <span class="o">--&gt;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;{{modèle.application_root}}{{modèle.prefix_url}}/calculer-impot{{modèle.csrf_token}}&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">message</span> <span class="n">sur</span> <span class="mi">12</span> <span class="n">colonnes</span> <span class="n">sur</span> <span class="n">fond</span> <span class="n">bleu</span> <span class="o">--&gt;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>    <span class="err">…</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Le fragment </strong><strong>[v-liste-simulations]</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="err">…</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">modèle</span><span class="o">.</span><span class="n">simulations</span> <span class="ow">is</span> <span class="n">defined</span> <span class="ow">and</span> <span class="n">modèle</span><span class="o">.</span><span class="n">simulations</span><span class="o">|</span><span class="n">length</span><span class="o">!=</span><span class="mi">0</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="err">…</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">tableau</span> <span class="n">des</span> <span class="n">simulations</span> <span class="o">--&gt;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;table table-sm table-hover table-striped&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>    <span class="err">…</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">id</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">marié</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">enfants</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">salaire</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">impôt</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">surcôte</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">décôte</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">réduction</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">taux</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;{{modèle.application_root}}{{modèle.prefix_url}}/supprimer-simulation/{{simulation.id}}{{modèle.csrf_token}}&quot;</span><span class="o">&gt;</span><span class="n">Supprimer</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>    <span class="o">&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a><span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>Le fragment </strong><strong>[v-menu]</strong></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span>
<span class="normal"><a href="#__codelineno-5-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">menu</span> <span class="n">Bootstrap</span> <span class="o">--&gt;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="o">&lt;</span><span class="n">nav</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;nav flex-column&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">affichage</span> <span class="n">d</span><span class="s1">&#39;une liste de liens HTML --&gt;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>    <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">optionMenu</span> <span class="ow">in</span> <span class="n">modèle</span><span class="o">.</span><span class="n">optionsMenu</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>    <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;nav-link&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;{{modèle.application_root}}{{modèle.prefix_url}}{{optionMenu.url}}{{modèle.csrf_token}}&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">optionMenu</span><span class="o">.</span><span class="n">text</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="o">&lt;/</span><span class="n">nav</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Les fragments ci-dessus utilisent tous le modèle <strong>[</strong><strong>modèle.application_root</strong><strong>]</strong>. Pour l’instant la clé <strong>[application_root]</strong> n’existe pas dans les modèles générés par les classes de modèles.</p>
<p><img src="images/10000000000001D50000011BCFEDFB3E.png" style="width:5.421cm;height:3.271cm;" alt="Image" /></p>
<p>La classe <strong>[AbstractBaseModelForView]</strong> qui est la classe parent de toutes les classes générant un modèle devient la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstractmethod</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_wtf.csrf</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_csrf</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.local</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalProxy</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceModelForView</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceModelForView</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">AbstractBaseModelForView</span><span class="p">(</span><span class="n">InterfaceModelForView</span><span class="p">):</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_for_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">résultat</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>        <span class="k">pass</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modèle</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a>        <span class="c1"># calcul du jeton CSRF</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a>        <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;parameters&#39;</span><span class="p">][</span><span class="s1">&#39;with_csrftoken&#39;</span><span class="p">]:</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a>            <span class="n">csrf_token</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">generate_csrf</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a>            <span class="n">csrf_token</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a>        <span class="c1"># mise à jour du modèle passé en paramètre</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a>        <span class="n">modèle</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a>            <span class="c1"># jeton csrf</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a>            <span class="s1">&#39;csrf_token&#39;</span><span class="p">:</span> <span class="n">csrf_token</span><span class="p">,</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a>            <span class="c1"># prefix_url</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a>            <span class="s1">&#39;prefix_url&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">][</span><span class="s2">&quot;prefix_url&quot;</span><span class="p">],</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a>            <span class="c1"># application_root</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a>            <span class="s1">&#39;application_root&#39;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">][</span><span class="s2">&quot;application_root&quot;</span><span class="p">],</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a>        <span class="p">})</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 15 : la méthode <strong>[update_model]</strong> a pour rôle de mettre dans le modèle des vues :</li>
<li>ligne 24 : le jeton CSRF ;</li>
<li>ligne 26 : le préfixe des URL ;</li>
<li>ligne 28 : la racine de l’application ou alias WSGI ;
Les quatre classes filles font appel à la classe parent avec le code suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span>
<span class="normal"><a href="#__codelineno-7-7">7</a></span>
<span class="normal"><a href="#__codelineno-7-8">8</a></span>
<span class="normal"><a href="#__codelineno-7-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="err">…</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>        <span class="c1"># actions possibles à partir de la vue</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>        <span class="n">modèle</span><span class="p">[</span><span class="s1">&#39;actions_possibles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;afficher-vue-authentification&quot;</span><span class="p">,</span> <span class="s2">&quot;authentifier-utilisateur&quot;</span><span class="p">]</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>        <span class="c1"># finition du modèle par la classe parent</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">update_model</span><span class="p">(</span><span class="n">modèle</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>        <span class="c1"># on rend le modèle</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>        <span class="k">return</span> <span class="n">modèle</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 6 : chaque classe fille appelle sa classe parent pour mettre à jour le modèle qu’elle a créé ;
La version 18 est prête. Nous reprenons les deux serveurs virtuels d’Apache de la version 17 et nous les modifions :</li>
</ul>
<p><img src="images/10000000000002D30000012FDB676CCF.png" style="width:8.362cm;height:3.5cm;" alt="Image" /></p>
<p>Les deux fichiers <strong>[flask-impots-withXX.conf]</strong> ne sont modifiés qu’en un seul point :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span>
<span class="normal"><a href="#__codelineno-8-33">33</a></span>
<span class="normal"><a href="#__codelineno-8-34">34</a></span>
<span class="normal"><a href="#__codelineno-8-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># dossier du script .wsgi</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="n">define</span> <span class="n">ROOT</span> <span class="s2">&quot;C:/Data/st-2020/dev/python/cours-2020/python3-flask-2020/impots/http-servers/13/apache&quot;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="c1"># nom du site web configuré par ce fichier</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="c1"># ici il s&#39;appellera flask-impots-withmysql</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="c1"># les URL seront du type http(s)://flask-impots-withmysql/chemin</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="n">define</span> <span class="n">SITE</span> <span class="s2">&quot;flask-impots-withmysql&quot;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="c1"># mettre l&#39;adresse IP 127.0.0.1 pour site SITE dans c:/windows/system32/drivers/etc/hosts</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="c1"># mettre ici les chemins des bibliothèques Python à utiliser - les séparer par des virgules</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="c1"># ici les bibliothèques d&#39;un environnement virtuel Python</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="n">WSGIPythonPath</span>  <span class="s2">&quot;C:/Data/st-2020/dev/python/cours-2020/python3-flask-2020/venv/lib/site-packages&quot;</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="c1"># Python Home - nécessaire uniquement s&#39;il y a plusieurs versions de Python installées</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="c1"># WSGIPythonHome &quot;C:/Program Files/Python38&quot;</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="c1"># URL HTTP</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="o">&lt;</span><span class="n">VirtualHost</span> <span class="o">*</span><span class="p">:</span><span class="mi">80</span><span class="o">&gt;</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>    <span class="c1"># avec l&#39;alias / les URL auront la forme /{prefixe_url}/action/...</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a>    <span class="c1"># avec l&#39;alias /impots les URL auront la forme /impots/{prefixe_url}/action/...</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>    <span class="c1"># où [prefixe_url] est défini dans parameters.py</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a>    <span class="n">WSGIScriptAlias</span> <span class="o">/</span><span class="n">impots</span> <span class="s2">&quot;$</span><span class="si">{ROOT}</span><span class="s2">/main_withmysql.wsgi&quot;</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a>    <span class="err">…</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="o">&lt;/</span><span class="n">VirtualHost</span><span class="o">&gt;</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="c1"># URL sécurisées avec HTTPS</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="o">&lt;</span><span class="n">VirtualHost</span> <span class="o">*</span><span class="p">:</span><span class="mi">443</span><span class="o">&gt;</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a>    <span class="c1"># avec l&#39;alias / les URL auront la forme /{prefixe_url}/action/...</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a>    <span class="c1"># avec l&#39;alias /impots les URL auront la forme /impots/{prefixe_url}/action/...</span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a>    <span class="c1"># où [prefixe_url] est défini dans parameters.py</span>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a>    <span class="n">WSGIScriptAlias</span> <span class="o">/</span><span class="n">impots</span> <span class="s2">&quot;$</span><span class="si">{ROOT}</span><span class="s2">/main_withmysql.wsgi&quot;</span>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a>    <span class="o">..</span>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a><span class="o">&lt;/</span><span class="n">VirtualHost</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>
<p>ligne 12, on utilise maintenant le dossier <strong>[impots/http-servers/13/apache]</strong>.
Nous sommes prêts pour les tests de la version 18 portée sur Apache. La configuration est la suivante :</p>
</li>
<li>
<p>l’alias WSGI est /impots dans les deux fichiers de configuration des serveurs virtuels ;</p>
</li>
<li>dans le fichier de paramétrage <strong>[configs/parameters]</strong>, les paramètres sont les suivants :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>        <span class="c1"># token csrf</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>        <span class="s2">&quot;with_csrftoken&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>        <span class="c1"># préfixe des URL de l&#39;application</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>        <span class="c1"># mettre la chaîne vide si on ne veut pas de préfixe ou /préfixe sinon</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>        <span class="s2">&quot;prefix_url&quot;</span><span class="p">:</span> <span class="s2">&quot;/do&quot;</span><span class="p">,</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>        <span class="c1"># url racine du serveur Apache - mettre la chaîne vide pour une exécution en-dehors d&#39;Apache</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>        <span class="s2">&quot;application_root&quot;</span><span class="p">:</span> <span class="s2">&quot;/impots&quot;</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>On lance le serveur Apache ainsi que les deux SGBD. On demande l’URL <strong>[https://flask-impots-withmysql/impots/do]</strong>. La réponse du serveur est la suivante :</p>
<p><img src="images/10000000000005550000031920FB5EEA.png" style="width:15.781cm;height:9.161cm;" alt="Image" /></p>
<p>On obtient bien la vue d’authentification qu’on n’avait pu obtenir dans la version précédente. Le reste de l’application fonctionne normalement.</p>
<p>Maintenant on teste l’autre serveur virtuel. On demande l’URL <strong>[https://flask-impots-</strong><strong>withpgres</strong><strong>/impots/do]</strong>. La réponse du serveur est la suivante :</p>
<p><img src="images/10000000000005550000034336E21669.png" style="width:15.77cm;height:9.632cm;" alt="Image" /></p>
<p>Les notions d’alias WSGI et de préfixe d’URL jouent le même rôle. L’une de ces deux notions est redondante. Ainsi pour préfixer les URL du serveur Apache avec la chaîne <strong>[/impots/do]</strong>, on peut s’y prendre de trois manières :</p>
<p>1 – <strong>[WGSIAlias /impots]</strong> et <strong>[prefix_url=’/do’]</strong> ;</p>
<p>2 - <strong>[WGSIAlias /]</strong> et <strong>[prefix_url=’/impots/do’]</strong> ;</p>
<p>3 - <strong>[WGSIAlias /impots/do]</strong> et <strong>[prefix_url=’’]</strong> ;</p>
<h2 id="382-tests-console">38.2. Tests console</h2>
<p>On utilise de nouveau les tests console du client <strong>[http-clients/09]</strong> :</p>
<p><img src="images/100000000000020E00000241F37F82D2.png" style="width:6.07cm;height:6.661cm;" alt="Image" /></p>
<ul>
<li>l’URL du serveur doit être modifiée dans les configurations <strong>[1]</strong> et <strong>[3]</strong> ;</li>
<li>il faut apporter une modification à la couche <strong>[dao]</strong> pour qu’elle supporte le protocole HTTPS du serveur Apache ;
Dans les fichiers <strong>[config]</strong>, l’URL du serveur devient la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>        <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>            <span class="c1"># &quot;urlServer&quot;: &quot;http://127.0.0.1:5000&quot;,</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>            <span class="c1"># &quot;urlServer&quot;: &quot;http://127.0.0.1:5000/do&quot;,</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>            <span class="s2">&quot;urlServer&quot;</span><span class="p">:</span> <span class="s2">&quot;https://flask-impots-withmysql/impots/do&quot;</span><span class="p">,</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>                <span class="s2">&quot;login&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>            <span class="p">},</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>            <span class="s2">&quot;url_services&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>                <span class="err">…</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>            <span class="p">}</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a>        <span class="p">},</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>        <span class="c1"># mode debug</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a>        <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a>        <span class="c1"># csrf_token</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a>        <span class="s2">&quot;with_csrftoken&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 4 : la nouvelle URL du serveur. Pour la 1ère fois dans ce document, le client utilise le protocole HTTPS ;
La classe <strong>[ImpôtsDaoWihHttpSession]</strong> de la couche <strong>[dao]</strong> évolue de la façon suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="err">…</span>    
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>    <span class="c1"># étape request / response</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url_service</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_value</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">json_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>        <span class="c1"># [method] : méthode HTTP GET ou POST</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>        <span class="c1"># [url_service] : URL de service</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>        <span class="c1"># [data] : paramètres du POST en x-www-form-urlencoded</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>        <span class="c1"># [json] : paramètres du POST en json</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a>        <span class="c1"># [cookies]: cookies à inclure dans la requête</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a>        <span class="c1"># on doit avoir une session XML ou JSON, sinon on ne pourra pas gérer la réponse</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__session_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;xml&#39;</span><span class="p">]:</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">73</span><span class="p">,</span> <span class="s2">&quot;il n&#39;y a pas de session valide en cours&quot;</span><span class="p">)</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a>        <span class="c1"># on ajoute le jeton CSRF à l&#39;URL de service</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__csrf_token</span><span class="p">:</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a>            <span class="n">url_service</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url_service</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__csrf_token</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a>        <span class="c1"># exécution de la requête</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a>                                    <span class="n">url_service</span><span class="p">,</span>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a>                                    <span class="n">data</span><span class="o">=</span><span class="n">data_value</span><span class="p">,</span>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a>                                    <span class="n">json</span><span class="o">=</span><span class="n">json_value</span><span class="p">,</span>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a>                                    <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__cookies</span><span class="p">,</span>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a>                                    <span class="n">allow_redirects</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a>                                    <span class="c1"># pour le protocole https</span>
<a id="__codelineno-11-26" name="__codelineno-11-26"></a>                                    <span class="n">verify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-11-27" name="__codelineno-11-27"></a>
<a id="__codelineno-11-28" name="__codelineno-11-28"></a>        <span class="c1"># mode debug ?</span>
<a id="__codelineno-11-29" name="__codelineno-11-29"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__debug</span><span class="p">:</span>
<a id="__codelineno-11-30" name="__codelineno-11-30"></a>            <span class="c1"># logueur</span>
<a id="__codelineno-11-31" name="__codelineno-11-31"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="p">:</span>
<a id="__codelineno-11-32" name="__codelineno-11-32"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="s1">&#39;logger&#39;</span><span class="p">]</span>
<a id="__codelineno-11-33" name="__codelineno-11-33"></a>            <span class="c1"># on logue</span>
<a id="__codelineno-11-34" name="__codelineno-11-34"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-11-35" name="__codelineno-11-35"></a>
<a id="__codelineno-11-36" name="__codelineno-11-36"></a>        <span class="err">…</span>
<a id="__codelineno-11-37" name="__codelineno-11-37"></a>
<a id="__codelineno-11-38" name="__codelineno-11-38"></a>        <span class="c1"># on rend le résultat</span>
<a id="__codelineno-11-39" name="__codelineno-11-39"></a>        <span class="k">return</span> <span class="n">résultat</span><span class="p">[</span><span class="s1">&#39;réponse&#39;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 26, on ajoute le paramètre <strong>[verify=False]</strong> à cause du protocole HTTPS utilisé par le serveur Apache. Le module <strong>[requests]</strong> (ligne 19) sait gérer nativement le protocole HTTPS. Par défaut, il vérifie la validité du certificat de sécurité que lui envoie le serveur HTTPS et lance une exception si le certificat reçu n’est pas valide. C’est le cas ici où le serveur Apache de Laragon envoie un certificat auto-signé. Pour éviter l’exception, on utilise le paramètre <strong>[verify=False]</strong> pour dire au module <strong>[requests]</strong> de ne pas lancer d’exception. <strong>[requests]</strong> se contente alors d’afficher un avertissement (warning) sur la console.
Ces modifications faites, tous les tests console doivent fonctionner.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>