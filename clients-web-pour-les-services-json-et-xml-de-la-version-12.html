
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Python 3 et au framework web Flask par l'exemple">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-flask-sept-2020/clients-web-pour-les-services-json-et-xml-de-la-version-12.html">
      
      
        <link rel="prev" href="exercice-dapplication-version-12.html">
      
      
        <link rel="next" href="le-mode-html-de-la-version-12.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>31. Clients web pour les services jSON et XML de la version 12 - Introduction au langage Python 3 et au framework web Flask par l'exemple</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#31-clients-web-pour-les-services-json-et-xml-de-la-version-12" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-header__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Python 3 et au framework web Flask par l'exemple
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              31. Clients web pour les services jSON et XML de la version 12
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-nav__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Python 3 et au framework web Flask par l'exemple
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="avant-propos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Avant-propos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dx27un-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Installation d&#x27;un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-bases-de-python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Les bases de Python
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-chaines-de-caracteres.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Les chaînes de caractères
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-exceptions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Les exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fonctions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Les fonctions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fichiers-texte.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Les fichiers texte
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Exercice d&#x27;application – version 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-imports.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Les imports
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Exercice d’application : version 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Exercice d’application : version 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-et-objets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. Les classes et objets
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-generiques-baseentity-et-myexception.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. Les classes génériques [BaseEntity] et [MyException]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture-en-couches-et-programmation-par-interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. Architecture en couches et programmation par interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. Exercice d&#x27;application - version 4
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-mysql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. Utilisation du SGBD MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-postgresql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. Utilisation du SGBD PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="ecrire-du-code-independant-du-sgbd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. Ecrire du code indépendant du SGBD
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-de-lorm-sqlalchemy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. Utilisation de l’ORM SQLALCHEMY
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application-version-5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Exercice d&#x27;application : version 5
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="fonctions-internet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Fonctions internet
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="services-web-avec-le-framework-flask.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Services web avec le framework Flask
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23. Exercice d’application : version 6
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24. Exercice d’application : version 7
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25. Exercice d’application : version 8
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="du-dictionnaire-a-xml-et-vice-versa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26. Du dictionnaire à XML et vice-versa
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-9.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27. Exercice d’application : version 9
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-10.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28. Exercice d’application : version 10
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-11.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    29. Exercice d’application : version 11
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30. Exercice d’application : version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    31. Clients web pour les services jSON et XML de la version 12
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="clients-web-pour-les-services-json-et-xml-de-la-version-12.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    31. Clients web pour les services jSON et XML de la version 12
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#311-larborescence-des-scripts-des-clients" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.1. L’arborescence des scripts des clients
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#312-la-couche-dao-des-clients" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.2. La couche [dao] des clients
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="31.2. La couche [dao] des clients">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3121-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.2.1. Interface
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3122-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.2.2. Implémentation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3123-la-factory-de-la-couche-dao" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.2.3. La factory de la couche [dao]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#313-configuration-des-clients" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.3. Configuration des clients
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#314-le-client-main" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.4. Le client [main]
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#315-le-client-main2" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.5. Le client [main2]
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#316-le-client-main3" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.6. Le client [main3]
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#317-la-classe-de-test-test2httpclientdaowithsession" class="md-nav__link">
    <span class="md-ellipsis">
      
        31.7. La classe de test [Test2HttpClientDaoWithSession]
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="le-mode-html-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    32. Le mode HTML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-13.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    33. Exercice d’application : version 13
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-14.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    34. Exercice d’application : version 14
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-15.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    35. Exercice d’application : version 15
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-16.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    36. Exercice d’application : version 16
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-17.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    37. Exercice d’application : version 17
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-18.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    38. Exercice d’application : version 18
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    39. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="31-clients-web-pour-les-services-json-et-xml-de-la-version-12">31. Clients web pour les services jSON et XML de la version 12</h1>
<p>Nous allons écrire trois applications console clientes des services jSON et XML du serveur web que nous venons d’écrire. Nous reprenons l’architecture client / serveur de la version 11 :</p>
<p><img src="images/10000000000003CF000004E84943F545.png" style="width:11.261cm;height:14.511cm;" alt="Image" /></p>
<p>Nous écrirons trois scripts console :</p>
<ul>
<li>les scripts <strong>[main]</strong> et <strong>[main3]</strong> utiliseront la couche <strong>[métier]</strong> du serveur ;</li>
<li>le script <strong>[main2]</strong> utilisera la couche <strong>[métier]</strong> du client ;</li>
</ul>
<h2 id="311-larborescence-des-scripts-des-clients">31.1. L’arborescence des scripts des clients</h2>
<p>Le dossier <strong>[http-clients/07]</strong> est obtenu initialement par recopie du dossier <strong>[http-clients/06]</strong>. Il est ensuite modifié.</p>
<p><img src="images/10000000000005AB000001A8BBA86335.png" style="width:16.751cm;height:4.901cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong> : les données exploitées ou créées par le client ;</li>
<li>en <strong>[2]</strong>, la configuration et les scripts console du client ;</li>
<li>en <strong>[3]</strong>, la couche <strong>[dao]</strong> du client ;</li>
<li>en <strong>[4]</strong>, le dossier des tests de la couche <strong>[dao]</strong> du client ;</li>
</ul>
<h2 id="312-la-couche-dao-des-clients">31.2. La couche [dao] des clients</h2>
<p><img src="images/100000000000031C000002E26779CBAC.png" style="width:9.201cm;height:8.531cm;" alt="Image" /></p>
<p><img src="images/10000000000001F000000130004DC856.png" style="width:5.74cm;height:3.5cm;" alt="Image" /></p>
<h3 id="3121-interface">31.2.1. Interface</h3>
<p>La couche <strong>[dao]</strong> implémentera l’interface <strong>[</strong><strong>InterfaceImpôtsDaoWithHttpSession</strong><strong>]</strong> suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstractmethod</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AbstractImpôtsDao</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbstractImpôtsDao</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AdminData</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdminData</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">InterfaceImpôtsDaoWithHttpSession</span><span class="p">(</span><span class="n">AbstractImpôtsDao</span><span class="p">):</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="c1"># calcul de l&#39;impôt par unité</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_tax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayer</span><span class="p">:</span> <span class="n">TaxPayer</span><span class="p">):</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>        <span class="k">pass</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>    <span class="c1"># calcul de l&#39;impôt par lots</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_tax_in_bulk_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayers</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>        <span class="k">pass</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="c1"># initialisation d&#39;une session</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">init_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_session</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>        <span class="k">pass</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="c1"># fin de session</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">end_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="k">pass</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="c1"># authentification</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>        <span class="k">pass</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="c1"># liste des simulations</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="k">pass</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="c1"># supprimer une simulation</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="k">pass</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="c1"># obtenir les données permettant le calcul de l&#39;impôt</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_admindata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdminData</span><span class="p">:</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p>Chaque méthode de l’interface correspond à une URL de service du serveur de calcul de l’impôt.</p>
<ul>
<li>ligne 7 : l’interface étend la classe <strong>[AbstractDao]</strong> qui gère les accès au système de fichiers ;
La correspondance entre les méthodes et les URL de service est faite dans le fichier de configuration <strong>[config]</strong> :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>        <span class="c1"># le serveur de calcul de l&#39;impôt</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>        <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>            <span class="s2">&quot;urlServer&quot;</span><span class="p">:</span> <span class="s2">&quot;http://127.0.0.1:5000&quot;</span><span class="p">,</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>                <span class="s2">&quot;login&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>            <span class="p">},</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>            <span class="s2">&quot;url_services&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>                <span class="s2">&quot;calculate-tax&quot;</span><span class="p">:</span> <span class="s2">&quot;/calculer-impot&quot;</span><span class="p">,</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>                <span class="s2">&quot;get-admindata&quot;</span><span class="p">:</span> <span class="s2">&quot;/get-admindata&quot;</span><span class="p">,</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>                <span class="s2">&quot;calculate-tax-in-bulk-mode&quot;</span><span class="p">:</span> <span class="s2">&quot;/calculer-impots&quot;</span><span class="p">,</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>                <span class="s2">&quot;init-session&quot;</span><span class="p">:</span> <span class="s2">&quot;/init-session&quot;</span><span class="p">,</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a>                <span class="s2">&quot;end-session&quot;</span><span class="p">:</span> <span class="s2">&quot;/fin-session&quot;</span><span class="p">,</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>                <span class="s2">&quot;authenticate-user&quot;</span><span class="p">:</span> <span class="s2">&quot;/authentifier-utilisateur&quot;</span><span class="p">,</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>                <span class="s2">&quot;get-simulations&quot;</span><span class="p">:</span> <span class="s2">&quot;/lister-simulations&quot;</span><span class="p">,</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>                <span class="s2">&quot;delete-simulation&quot;</span><span class="p">:</span> <span class="s2">&quot;/supprimer-simulation&quot;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>            <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="3122-implementation">31.2.2. Implémentation</h3>
<p>L’interface <strong>[</strong><strong>InterfaceImpôtsDaoWithHttpSession</strong><strong>]</strong> est implémentée par la classe <strong>[</strong><strong>ImpôtsDaoWithHttpSession</strong><strong>]</strong> suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span>
<span class="normal"><a href="#__codelineno-2-31">31</a></span>
<span class="normal"><a href="#__codelineno-2-32">32</a></span>
<span class="normal"><a href="#__codelineno-2-33">33</a></span>
<span class="normal"><a href="#__codelineno-2-34">34</a></span>
<span class="normal"><a href="#__codelineno-2-35">35</a></span>
<span class="normal"><a href="#__codelineno-2-36">36</a></span>
<span class="normal"><a href="#__codelineno-2-37">37</a></span>
<span class="normal"><a href="#__codelineno-2-38">38</a></span>
<span class="normal"><a href="#__codelineno-2-39">39</a></span>
<span class="normal"><a href="#__codelineno-2-40">40</a></span>
<span class="normal"><a href="#__codelineno-2-41">41</a></span>
<span class="normal"><a href="#__codelineno-2-42">42</a></span>
<span class="normal"><a href="#__codelineno-2-43">43</a></span>
<span class="normal"><a href="#__codelineno-2-44">44</a></span>
<span class="normal"><a href="#__codelineno-2-45">45</a></span>
<span class="normal"><a href="#__codelineno-2-46">46</a></span>
<span class="normal"><a href="#__codelineno-2-47">47</a></span>
<span class="normal"><a href="#__codelineno-2-48">48</a></span>
<span class="normal"><a href="#__codelineno-2-49">49</a></span>
<span class="normal"><a href="#__codelineno-2-50">50</a></span>
<span class="normal"><a href="#__codelineno-2-51">51</a></span>
<span class="normal"><a href="#__codelineno-2-52">52</a></span>
<span class="normal"><a href="#__codelineno-2-53">53</a></span>
<span class="normal"><a href="#__codelineno-2-54">54</a></span>
<span class="normal"><a href="#__codelineno-2-55">55</a></span>
<span class="normal"><a href="#__codelineno-2-56">56</a></span>
<span class="normal"><a href="#__codelineno-2-57">57</a></span>
<span class="normal"><a href="#__codelineno-2-58">58</a></span>
<span class="normal"><a href="#__codelineno-2-59">59</a></span>
<span class="normal"><a href="#__codelineno-2-60">60</a></span>
<span class="normal"><a href="#__codelineno-2-61">61</a></span>
<span class="normal"><a href="#__codelineno-2-62">62</a></span>
<span class="normal"><a href="#__codelineno-2-63">63</a></span>
<span class="normal"><a href="#__codelineno-2-64">64</a></span>
<span class="normal"><a href="#__codelineno-2-65">65</a></span>
<span class="normal"><a href="#__codelineno-2-66">66</a></span>
<span class="normal"><a href="#__codelineno-2-67">67</a></span>
<span class="normal"><a href="#__codelineno-2-68">68</a></span>
<span class="normal"><a href="#__codelineno-2-69">69</a></span>
<span class="normal"><a href="#__codelineno-2-70">70</a></span>
<span class="normal"><a href="#__codelineno-2-71">71</a></span>
<span class="normal"><a href="#__codelineno-2-72">72</a></span>
<span class="normal"><a href="#__codelineno-2-73">73</a></span>
<span class="normal"><a href="#__codelineno-2-74">74</a></span>
<span class="normal"><a href="#__codelineno-2-75">75</a></span>
<span class="normal"><a href="#__codelineno-2-76">76</a></span>
<span class="normal"><a href="#__codelineno-2-77">77</a></span>
<span class="normal"><a href="#__codelineno-2-78">78</a></span>
<span class="normal"><a href="#__codelineno-2-79">79</a></span>
<span class="normal"><a href="#__codelineno-2-80">80</a></span>
<span class="normal"><a href="#__codelineno-2-81">81</a></span>
<span class="normal"><a href="#__codelineno-2-82">82</a></span>
<span class="normal"><a href="#__codelineno-2-83">83</a></span>
<span class="normal"><a href="#__codelineno-2-84">84</a></span>
<span class="normal"><a href="#__codelineno-2-85">85</a></span>
<span class="normal"><a href="#__codelineno-2-86">86</a></span>
<span class="normal"><a href="#__codelineno-2-87">87</a></span>
<span class="normal"><a href="#__codelineno-2-88">88</a></span>
<span class="normal"><a href="#__codelineno-2-89">89</a></span>
<span class="normal"><a href="#__codelineno-2-90">90</a></span>
<span class="normal"><a href="#__codelineno-2-91">91</a></span>
<span class="normal"><a href="#__codelineno-2-92">92</a></span>
<span class="normal"><a href="#__codelineno-2-93">93</a></span>
<span class="normal"><a href="#__codelineno-2-94">94</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># imports</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">xmltodict</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AbstractImpôtsDao</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbstractImpôtsDao</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AdminData</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdminData</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceImpôtsDaoWithHttpSession</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceImpôtsDaoWithHttpSession</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">ImpôtsDaoWithHttpSession</span><span class="p">(</span><span class="n">InterfaceImpôtsDaoWithHttpSession</span><span class="p">):</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a>    <span class="c1"># constructeur</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a>        <span class="c1"># initialisation parent</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a>        <span class="n">AbstractImpôtsDao</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a>        <span class="c1"># mémorisation éléments de la configuration</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a>        <span class="c1"># config générale</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__config</span> <span class="o">=</span> <span class="n">config</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a>        <span class="c1"># serveur</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__config_server</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a>        <span class="c1"># services</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__config_services</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">][</span><span class="s1">&#39;url_services&#39;</span><span class="p">]</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a>        <span class="c1"># mode debug</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__debug</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a>        <span class="c1"># logger</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a>        <span class="c1"># cookies</span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__cookies</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a>        <span class="c1"># type de session (json, xml)</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__session_type</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a>        <span class="c1"># étape request / response</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a>     <span class="k">def</span><span class="w"> </span><span class="nf">get_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">url_service</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_value</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">json_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a>        <span class="c1"># [method] : méthode HTTP GET ou POST</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a>        <span class="c1"># [url_service] : URL de service</span>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a>        <span class="c1"># [data] : paramètres du POST en x-www-form-urlencoded</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a>        <span class="c1"># [json] : paramètres du POST en json</span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a>        <span class="c1"># [cookies]: cookies à inclure dans la requête</span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a>        <span class="c1"># on doit avoir une session XML ou JSON, sinon on ne pourra pas gérer la réponse</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__session_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="s1">&#39;xml&#39;</span><span class="p">]:</span>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">73</span><span class="p">,</span> <span class="s2">&quot;il n&#39;y a pas de session valide en cours&quot;</span><span class="p">)</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a>        <span class="c1"># connexion</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a>            <span class="c1"># GET</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_service</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__cookies</span><span class="p">)</span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a>            <span class="c1"># POST</span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url_service</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data_value</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">json_value</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__cookies</span><span class="p">)</span>
<a id="__codelineno-2-55" name="__codelineno-2-55"></a>
<a id="__codelineno-2-56" name="__codelineno-2-56"></a>        <span class="c1"># mode debug ?</span>
<a id="__codelineno-2-57" name="__codelineno-2-57"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__debug</span><span class="p">:</span>
<a id="__codelineno-2-58" name="__codelineno-2-58"></a>            <span class="c1"># logueur</span>
<a id="__codelineno-2-59" name="__codelineno-2-59"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="p">:</span>
<a id="__codelineno-2-60" name="__codelineno-2-60"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="s1">&#39;logger&#39;</span><span class="p">]</span>
<a id="__codelineno-2-61" name="__codelineno-2-61"></a>            <span class="c1"># on logue</span>
<a id="__codelineno-2-62" name="__codelineno-2-62"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-2-63" name="__codelineno-2-63"></a>
<a id="__codelineno-2-64" name="__codelineno-2-64"></a>        <span class="c1"># résultat</span>
<a id="__codelineno-2-65" name="__codelineno-2-65"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__session_type</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">:</span>
<a id="__codelineno-2-66" name="__codelineno-2-66"></a>            <span class="n">résultat</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-2-67" name="__codelineno-2-67"></a>        <span class="k">else</span><span class="p">:</span>  <span class="c1"># xml</span>
<a id="__codelineno-2-68" name="__codelineno-2-68"></a>            <span class="n">résultat</span> <span class="o">=</span> <span class="n">xmltodict</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="mi">39</span><span class="p">:])[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span>
<a id="__codelineno-2-69" name="__codelineno-2-69"></a>
<a id="__codelineno-2-70" name="__codelineno-2-70"></a>        <span class="c1"># on récupère les cookies de la réponse s&#39;il y en a</span>
<a id="__codelineno-2-71" name="__codelineno-2-71"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">cookies</span><span class="p">:</span>
<a id="__codelineno-2-72" name="__codelineno-2-72"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__cookies</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">cookies</span>
<a id="__codelineno-2-73" name="__codelineno-2-73"></a>
<a id="__codelineno-2-74" name="__codelineno-2-74"></a>        <span class="c1"># code de statut</span>
<a id="__codelineno-2-75" name="__codelineno-2-75"></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
<a id="__codelineno-2-76" name="__codelineno-2-76"></a>
<a id="__codelineno-2-77" name="__codelineno-2-77"></a>        <span class="c1"># si code de statut différent de 200 OK</span>
<a id="__codelineno-2-78" name="__codelineno-2-78"></a>        <span class="k">if</span> <span class="n">status_code</span> <span class="o">!=</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">:</span>
<a id="__codelineno-2-79" name="__codelineno-2-79"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="n">résultat</span><span class="p">[</span><span class="s1">&#39;réponse&#39;</span><span class="p">])</span>
<a id="__codelineno-2-80" name="__codelineno-2-80"></a>
<a id="__codelineno-2-81" name="__codelineno-2-81"></a>        <span class="c1"># on rend le résultat</span>
<a id="__codelineno-2-82" name="__codelineno-2-82"></a>        <span class="k">return</span> <span class="n">résultat</span><span class="p">[</span><span class="s1">&#39;réponse&#39;</span><span class="p">]</span>
<a id="__codelineno-2-83" name="__codelineno-2-83"></a>
<a id="__codelineno-2-84" name="__codelineno-2-84"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">init_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-2-85" name="__codelineno-2-85"></a>        <span class="c1"># on note le type de la session</span>
<a id="__codelineno-2-86" name="__codelineno-2-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__session_type</span> <span class="o">=</span> <span class="n">session_type</span>
<a id="__codelineno-2-87" name="__codelineno-2-87"></a>
<a id="__codelineno-2-88" name="__codelineno-2-88"></a>        <span class="c1"># url de service</span>
<a id="__codelineno-2-89" name="__codelineno-2-89"></a>        <span class="n">config_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config_server</span>
<a id="__codelineno-2-90" name="__codelineno-2-90"></a>        <span class="n">url_service</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_server</span><span class="p">[</span><span class="s1">&#39;urlServer&#39;</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">__config_services</span><span class="p">[</span><span class="s1">&#39;init-session&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">session_type</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-2-91" name="__codelineno-2-91"></a>
<a id="__codelineno-2-92" name="__codelineno-2-92"></a>        <span class="c1"># exécution requête</span>
<a id="__codelineno-2-93" name="__codelineno-2-93"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url_service</span><span class="p">)</span>
<a id="__codelineno-2-94" name="__codelineno-2-94"></a><span class="err">…</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 16-34 : le constructeur de la classe ;</li>
<li>ligne 19 : la classe parent est initialisée ;</li>
<li>lignes 21-28 : on mémorise certaines données de la configuration ;</li>
<li>lignes 29-34 : on crée trois propriétés utilisées dans les méthodes de la classe ;</li>
<li>lignes 36-82 : la méthode <strong>[get_response]</strong> factorise ce qui est commun à toutes les méthodes de la couche <strong>[dao]</strong> : l’envoi d’une requête HTTP et la récupération de la réponse HTTP du serveur ;</li>
<li>lignes 38-42 : définition des 5 paramètres de la méthode <strong>[get_response]</strong> ;</li>
<li>ligne 42 : on notera que parce que le serveur maintient une session, le client a besoin de lire / renvoyer des cookies ;</li>
<li>lignes 44-46 : on vérifie qu’il y a bien une session en cours valide ;</li>
<li>ligne 51 : cas du GET. On renvoie les cookies reçus ;</li>
<li>ligne 54 : cas du POST. Celui-ci peut avoir deux types de paramètres :</li>
<li>le type <strong>[x-www-form-urlencoded]</strong>. C’est le cas des URL <strong>[/calculer-impot]</strong> et <strong>[/authentifier-utilisateur]</strong>. On utilise alors le paramètre <strong>[data_value]</strong> reçu par la méthode ;</li>
<li>
<p>le type <strong>[json]</strong>. C’est le cas de l’URL <strong>[/calculer-impots]</strong>. On utilise alors le paramètre <strong>[json_value]</strong> reçu par la méthode ;
Là également, le cookie de session est renvoyé.</p>
</li>
<li>
<p>lignes 56-62 : si on est en mode <strong>[debug]</strong>, la réponse du serveur est loguée. Ce log est important car il permet de savoir exactement ce qu’a renvoyé le serveur ;</p>
</li>
<li>lignes 64-68 : selon que l’on est en mode json ou xml, la réponse texte du serveur est transformée en dictionnaire. Prenons l’exemple de l’URL <strong>[/init-session]</strong> :
La réponse jSON est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">11</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">21.218116</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;init-session&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;session démarrée avec le type de réponse json&quot;</span><span class="p">]}</span>
</code></pre></div></td></tr></table></div>
<p>La réponse XML est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">11</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mf">54.671871</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">init</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">700</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">démarrée</span> <span class="n">avec</span> <span class="n">le</span> <span class="nb">type</span> <span class="n">de</span> <span class="n">réponse</span> <span class="n">xml</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Le code des lignes 64-68 assure que dans les deux cas, on obtient dans <strong>[résultat]</strong> un dictionnaire avec les clés <strong>[action, état, réponse]</strong> ;</p>
<ul>
<li>lignes 70-72 : si la réponse contient des cookies on les récupère. Il faudra les renvoyer lors de la prochaine requête ;</li>
<li>lignes 74-79 : si le statut HTTP de la réponse est différent de 200, on lève une exception avec le message d’erreur contenu dans résultat<strong>[’réponse’]</strong>. Ce peut être une erreur ou une liste d’erreurs ;</li>
<li>
<p>lignes 81-82 : on rend la réponse du serveur au code appelant ;
<u><strong>[init_session]</strong></u></p>
</li>
<li>
<p>ligne 84 : la méthode <strong>[init_session]</strong> sert à fixer le type de session json ou xml que veut commencer le client avec le serveur ;</p>
</li>
<li>ligne 86 : on note le type de session désiré au sein de la classe. En effet, toutes les méthodes ont besoin de cette information pour décoder correctement la réponse du serveur ;</li>
<li>lignes 88-90 : à l’aide de la configuration de l’application, on détermine l’URL de service qu’il faut interroger ;</li>
<li>ligne 93 : l’URL de service est interrogée. On ne récupère pas le résultat de la méthode <strong>[get_response]</strong> :</li>
<li>si elle lance une exception, alors l’opération a échoué. L’exception n’est pas gérée ici et remontera directement au code appelant qui arrêtera alors le client avec un message d’erreur ;</li>
<li>si elle ne lance pas d’exception, alors c’est que l’initialisation de la session a réussi ;
<u><strong>[authenticate_user]</strong></u></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>        <span class="c1"># url de service</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>        <span class="n">config_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config_server</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>        <span class="n">url_service</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_server</span><span class="p">[</span><span class="s1">&#39;urlServer&#39;</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">__config_services</span><span class="p">[</span><span class="s1">&#39;authenticate-user&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>        <span class="n">post_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">,</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>        <span class="p">}</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>        <span class="c1"># exécution requête</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url_service</span><span class="p">,</span> <span class="n">post_params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>la méthode <strong>[</strong><strong>authenticate_user</strong><strong>]</strong> sert à s’authentifier auprès du serveur. Pour cela elle reçoit les identifiants de connexion <strong>[user, password]</strong> en ligne 1 ;</li>
<li>lignes 2-4 : on détermine l’URL de service à interroger ;</li>
<li>lignes 5-8 : les paramètres du POST puisque l’URL <strong>[/authentifier-utilisateur]</strong> attend un POST avec des paramètres <strong>[user, password]</strong> ;</li>
<li>ligne 11 : la requête est exécutée. Là encore on ne récupère pas la réponse du serveur. C’est l’exception lancée par <strong>[get_response]</strong> qui indique si on a réussi ou pas ;
<u><strong>[calculate_tax]</strong></u></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_tax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayer</span><span class="p">:</span> <span class="n">TaxPayer</span><span class="p">):</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>        <span class="c1"># url de service</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>        <span class="n">config_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config_server</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>        <span class="n">url_service</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_server</span><span class="p">[</span><span class="s1">&#39;urlServer&#39;</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">__config_services</span><span class="p">[</span><span class="s1">&#39;calculate-tax&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>        <span class="c1"># paramètres du POST</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>        <span class="n">post_params</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>            <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">marié</span><span class="p">,</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>            <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">enfants</span><span class="p">,</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>            <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">salaire</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>        <span class="p">}</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>        <span class="c1"># exécution requête</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url_service</span><span class="p">,</span> <span class="n">post_params</span><span class="p">)</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>        <span class="c1"># mise à jour du TaxPayer avec la réponse</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>        <span class="n">taxpayer</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>la méthode <strong>[calculate_tax]</strong> permet de calculer l’impôt d’un contribuable <strong>[taxpayer]</strong> passé en paramètre. Ce paramètre est modifié par la méthode (ligne 15) et constitue donc le résultat de la méthode ;</li>
<li>lignes 2-4 : on définit l’URL de service à interroger ;</li>
<li>lignes 6-10 : les paramètres du POST à émettre. En effet, l’URL de service <strong>[/calculer-impot]</strong> attend un POST avec les paramètres <strong>[marié, enfants, salaire]</strong> ;</li>
<li>lignes 12-13 : la requête est exécutée et la réponse du serveur récupérée. L’URL de service <strong>[/calculer-impot]</strong> renvoie un dictionnaire avec les clés <strong>[impôt, décôte, surcôte, réduction, taux]</strong> de l’impôt ;</li>
<li>ligne 15 : le dictionnaire <strong>[response]</strong> obtenu est utilisé pour mettre à jour le contribuable <strong>[taxpayer]</strong> ;
<u><strong>[calculate_tax_in_bulk_mode]</strong></u></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>    <span class="c1"># calcul de l&#39;impôt en mode bulk</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_tax_in_bulk_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayers</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>        <span class="c1"># on laisse remonter les exceptions</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>        <span class="c1"># on transforme les taxpayers en liste de dictionnaires</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>        <span class="c1"># on ne garde que les propriétés [marié, enfants, salaire]</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>        <span class="n">list_dict_taxpayers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>            <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">taxpayer</span><span class="p">:</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>                <span class="n">taxpayer</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">included_keys</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>                    <span class="s1">&#39;_TaxPayer__marié&#39;</span><span class="p">,</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>                    <span class="s1">&#39;_TaxPayer__enfants&#39;</span><span class="p">,</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>                    <span class="s1">&#39;_TaxPayer__salaire&#39;</span><span class="p">]),</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>                <span class="n">taxpayers</span><span class="p">))</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>        <span class="c1"># url de service</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>        <span class="n">config_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config_server</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>        <span class="n">url_service</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_server</span><span class="p">[</span><span class="s1">&#39;urlServer&#39;</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">__config_services</span><span class="p">[</span><span class="s1">&#39;calculate-tax-in-bulk-mode&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a>        <span class="c1"># exécution requête</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a>        <span class="n">list_dict_taxpayers2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="n">url_service</span><span class="p">,</span> <span class="n">data_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">json_value</span><span class="o">=</span><span class="n">list_dict_taxpayers</span><span class="p">)</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a>        <span class="c1"># lorsqu&#39;il n&#39;y a qu&#39;un contribuable et qu&#39;on est dans une session xml, [list_dict_taxpayers2] n&#39;est pas une liste</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a>        <span class="c1"># dans ce cas on en fait une liste</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_dict_taxpayers2</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a>            <span class="n">list_dict_taxpayers2</span> <span class="o">=</span> <span class="p">[</span><span class="n">list_dict_taxpayers2</span><span class="p">]</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a>        <span class="c1"># on met à jour la liste initiale des taxpayers avec les résultats reçus</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">)):</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a>            <span class="c1"># mise à jour de taxpayers[i]</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a>            <span class="n">taxpayers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span><span class="n">list_dict_taxpayers2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a>        <span class="c1"># ici le paramètre [taxpayers] a été mis à jour avec les résultats du serveur</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 2 : la méthode reçoit une liste de contribuables de type TaxPayer ;</li>
<li>lignes 7-13 : cette liste d’élements de type <strong>[TaxPayer]</strong> est transformée en liste de dictionnaires <strong>[marié, enfants, salaire]</strong> ;</li>
<li>lignes 15-17 : on fixe l’URL de service ;</li>
<li>lignes 19-20 : on exécute une requête POST dont le corps jSON est formé de la liste des dictionnaires créée ligne 7. On récupère la réponse du serveur ;</li>
<li>lignes 23-24 : les tests ont montré un problème lorsque la session est de type XML :</li>
<li>si la liste initiale des contribuables a N éléments (N&gt;1) on obtient comme résultat une liste de N dictionnaires de type <strong>[OrderedDict]</strong> ;</li>
<li>
<p>si la liste initiale n’a qu’un élément, on obtient non pas une liste mais un élément de type <strong>[OrderedDict]</strong> ;
lignes 23-24 : si on est dans ce dernier cas (1 élément), on transforme le résultat en liste de 1 élément ;</p>
</li>
<li>
<p>lignes 25-28 : cette liste de dictionnaires reçus contient l’impôt de chaque contribuable de la liste initiale. On met à jour alors chacun d’eux avec les résultats reçus ;
<u><strong>[get_simulations]</strong></u></p>
</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>        <span class="c1"># url de service</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>        <span class="n">config_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config_server</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>        <span class="n">url_service</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_server</span><span class="p">[</span><span class="s1">&#39;urlServer&#39;</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">__config_services</span><span class="p">[</span><span class="s1">&#39;get-simulations&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>        <span class="c1"># exécution requête</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url_service</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : la méthode demande la liste des simulations faites dans la session courante ;</li>
<li>ligne 2 : la méthode rend la réponse du serveur ;
<u><strong>[delete_simulation]</strong></u></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>        <span class="c1"># url de service</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>        <span class="n">config_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config_server</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>        <span class="n">url_service</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_server</span><span class="p">[</span><span class="s1">&#39;urlServer&#39;</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">__config_services</span><span class="p">[</span><span class="s1">&#39;delete-simulation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>        <span class="c1"># exécution requête</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url_service</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : la méthode supprime la simulation dont on passe l’identifiant ;</li>
<li>ligne 7 : elle rend la réponse du serveur, la liste des simulations restantes après la suppression demandée ;
<u><strong>[get-admindata]</strong></u></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_admindata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdminData</span><span class="p">:</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>        <span class="c1"># on laisse remonter les exceptions</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>        <span class="c1"># url de service</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>        <span class="n">config_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config_server</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>        <span class="n">url_service</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_server</span><span class="p">[</span><span class="s1">&#39;urlServer&#39;</span><span class="p">]</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">__config_services</span><span class="p">[</span><span class="s1">&#39;get-admindata&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>        <span class="c1"># exécution requête</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>        <span class="n">résultat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">url_service</span><span class="p">)</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>        <span class="c1"># résultat est un dictionnaire de valeurs de type str si session xml</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__session_type</span> <span class="o">==</span> <span class="s1">&#39;xml&#39;</span><span class="p">:</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>            <span class="c1"># nouveau dictionnaire</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a>            <span class="n">résultat2</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a>            <span class="c1"># on passe tout en numérique</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">résultat</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a>                <span class="c1"># certains éléments du dictionnaire sont des listes</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a>                    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a>                    <span class="k">for</span> <span class="n">value2</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a>                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value2</span><span class="p">))</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a>                    <span class="n">résultat2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a>                    <span class="c1"># d&#39;autres de simples éléments</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a>                    <span class="n">résultat2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a>            <span class="n">résultat2</span> <span class="o">=</span> <span class="n">résultat</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a>        <span class="c1"># résultat de type AdminData</span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a>        <span class="k">return</span> <span class="n">AdminData</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span><span class="n">résultat2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : la méthode demande au serveur les constantes fiscales permettant le calcul de l’impôt ;</li>
<li>ligne 29 : elle rend un type <strong>[AdminData]</strong> ;</li>
<li>ligne 9 : on récupère la réponse du serveur sous la forme d’un dictionnaire. Les tests montrent qu’il y a un problème lorsque la session est une session XML : au lieu d’être des valeurs numériques, les valeurs du dictionnaire sont des chaînes de caractères. Nous avions signalé ce problème lors de l’étude du module <strong>[xmltodict]</strong> et constaté que c’était un fonctionnement normal. <strong>[xmltodict]</strong> n’a pas d’informations de types dans le flux XML qu’on lui donne. Ceci dit, dans ce cas précis, il faut convertir en numérique toutes les valeurs du dictionnaire reçu. Celui-ci contient trois listes <strong>[limites, coeffr, coeffn]</strong> et une suite de propriétés numériques ;</li>
<li>lignes 13-25 : création d’un dictionnaire <strong>[résultat2]</strong> à valeurs numériques à partir du dictionnaire <strong>[résultat]</strong> à valeurs de type chaîne de caractères ;</li>
<li>ligne 29 : le dictionnaire <strong>[resultat2]</strong> est utilisé pour initialiser un type <strong>[AdminData]</strong> ;</li>
</ul>
<h3 id="3123-la-factory-de-la-couche-dao">31.2.3. La factory de la couche [dao]</h3>
<p>Nos clients seront multi-threadés. Comme la couche <strong>[dao]</strong> est implémentée par une classe ayant un état en lecture / écriture (= des propriétés en lecture / écriture), chaque thread doit avoir sa propre couche <strong>[dao]</strong> ou alors il faut synchroniser l’accès aux données partagées entre les threads. Ici nous prenons la première solution. Nous utilisons une classe <strong>[ImpôtsDaoWithHttpSessionFactory]</strong> capable de créer des instances de la couche <strong>[dao]</strong> :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsDaoWithHttpSession</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsDaoWithHttpSession</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">ImpôtsDaoWithHttpSessionFactory</span><span class="p">:</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>        <span class="c1"># on mémorise le paramètre</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__config</span> <span class="o">=</span> <span class="n">config</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">new_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a>        <span class="c1"># on rend une instance de la couche [dao]</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a>        <span class="k">return</span> <span class="n">ImpôtsDaoWithHttpSession</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<h2 id="313-configuration-des-clients">31.3. Configuration des clients</h2>
<p><img src="images/100000000000015200000132DC9186C1.png" style="width:3.901cm;height:3.53cm;" alt="Image" /></p>
<p>Les clients sont configurés par les fichiers <strong>[config]</strong> et <strong>[config_layers]</strong>. Le fichier <strong>[config]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span>
<span class="normal"><a href="#__codelineno-12-27">27</a></span>
<span class="normal"><a href="#__codelineno-12-28">28</a></span>
<span class="normal"><a href="#__codelineno-12-29">29</a></span>
<span class="normal"><a href="#__codelineno-12-30">30</a></span>
<span class="normal"><a href="#__codelineno-12-31">31</a></span>
<span class="normal"><a href="#__codelineno-12-32">32</a></span>
<span class="normal"><a href="#__codelineno-12-33">33</a></span>
<span class="normal"><a href="#__codelineno-12-34">34</a></span>
<span class="normal"><a href="#__codelineno-12-35">35</a></span>
<span class="normal"><a href="#__codelineno-12-36">36</a></span>
<span class="normal"><a href="#__codelineno-12-37">37</a></span>
<span class="normal"><a href="#__codelineno-12-38">38</a></span>
<span class="normal"><a href="#__codelineno-12-39">39</a></span>
<span class="normal"><a href="#__codelineno-12-40">40</a></span>
<span class="normal"><a href="#__codelineno-12-41">41</a></span>
<span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span>
<span class="normal"><a href="#__codelineno-12-44">44</a></span>
<span class="normal"><a href="#__codelineno-12-45">45</a></span>
<span class="normal"><a href="#__codelineno-12-46">46</a></span>
<span class="normal"><a href="#__codelineno-12-47">47</a></span>
<span class="normal"><a href="#__codelineno-12-48">48</a></span>
<span class="normal"><a href="#__codelineno-12-49">49</a></span>
<span class="normal"><a href="#__codelineno-12-50">50</a></span>
<span class="normal"><a href="#__codelineno-12-51">51</a></span>
<span class="normal"><a href="#__codelineno-12-52">52</a></span>
<span class="normal"><a href="#__codelineno-12-53">53</a></span>
<span class="normal"><a href="#__codelineno-12-54">54</a></span>
<span class="normal"><a href="#__codelineno-12-55">55</a></span>
<span class="normal"><a href="#__codelineno-12-56">56</a></span>
<span class="normal"><a href="#__codelineno-12-57">57</a></span>
<span class="normal"><a href="#__codelineno-12-58">58</a></span>
<span class="normal"><a href="#__codelineno-12-59">59</a></span>
<span class="normal"><a href="#__codelineno-12-60">60</a></span>
<span class="normal"><a href="#__codelineno-12-61">61</a></span>
<span class="normal"><a href="#__codelineno-12-62">62</a></span>
<span class="normal"><a href="#__codelineno-12-63">63</a></span>
<span class="normal"><a href="#__codelineno-12-64">64</a></span>
<span class="normal"><a href="#__codelineno-12-65">65</a></span>
<span class="normal"><a href="#__codelineno-12-66">66</a></span>
<span class="normal"><a href="#__codelineno-12-67">67</a></span>
<span class="normal"><a href="#__codelineno-12-68">68</a></span>
<span class="normal"><a href="#__codelineno-12-69">69</a></span>
<span class="normal"><a href="#__codelineno-12-70">70</a></span>
<span class="normal"><a href="#__codelineno-12-71">71</a></span>
<span class="normal"><a href="#__codelineno-12-72">72</a></span>
<span class="normal"><a href="#__codelineno-12-73">73</a></span>
<span class="normal"><a href="#__codelineno-12-74">74</a></span>
<span class="normal"><a href="#__codelineno-12-75">75</a></span>
<span class="normal"><a href="#__codelineno-12-76">76</a></span>
<span class="normal"><a href="#__codelineno-12-77">77</a></span>
<span class="normal"><a href="#__codelineno-12-78">78</a></span>
<span class="normal"><a href="#__codelineno-12-79">79</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>    <span class="c1"># étape 1 ------</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>    <span class="c1"># dossier de ce fichier</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a>    <span class="c1"># chemin racine</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>    <span class="n">root_dir</span> <span class="o">=</span> <span class="s2">&quot;C:/Data/st-2020/dev/python/cours-2020/python3-flask-2020&quot;</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>    <span class="c1"># dépendances absolues</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a>        <span class="c1"># dossiers du projet</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a>        <span class="c1"># BaseEntity, MyException</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/classes/02/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>        <span class="c1"># InterfaceImpôtsDao, InterfaceImpôtsMétier, InterfaceImpôtsUi</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/v04/interfaces&quot;</span><span class="p">,</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a>        <span class="c1"># AbstractImpôtsdao, ImpôtsConsole, ImpôtsMétier</span>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/v04/services&quot;</span><span class="p">,</span>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a>        <span class="c1"># ImpotsDaoWithAdminDataInDatabase</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/v05/services&quot;</span><span class="p">,</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a>        <span class="c1"># AdminData, ImpôtsError, TaxPayer</span>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/v04/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a>        <span class="c1"># Constantes, tranches</span>
<a id="__codelineno-12-26" name="__codelineno-12-26"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/v05/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-12-27" name="__codelineno-12-27"></a>        <span class="c1"># ImpôtsDaoWithHttpSession, ImpôtsDaoWithHttpSessionFactory, InterfaceImpôtsDaoWithHttpSession</span>
<a id="__codelineno-12-28" name="__codelineno-12-28"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../services&quot;</span><span class="p">,</span>
<a id="__codelineno-12-29" name="__codelineno-12-29"></a>        <span class="c1"># scripts de configuration</span>
<a id="__codelineno-12-30" name="__codelineno-12-30"></a>        <span class="n">script_dir</span><span class="p">,</span>
<a id="__codelineno-12-31" name="__codelineno-12-31"></a>        <span class="c1"># Logger</span>
<a id="__codelineno-12-32" name="__codelineno-12-32"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/http-servers/02/utilities&quot;</span><span class="p">,</span>
<a id="__codelineno-12-33" name="__codelineno-12-33"></a>    <span class="p">]</span>
<a id="__codelineno-12-34" name="__codelineno-12-34"></a>
<a id="__codelineno-12-35" name="__codelineno-12-35"></a>    <span class="c1"># on fixe le syspath</span>
<a id="__codelineno-12-36" name="__codelineno-12-36"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-12-37" name="__codelineno-12-37"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-12-38" name="__codelineno-12-38"></a>
<a id="__codelineno-12-39" name="__codelineno-12-39"></a>    <span class="c1"># étape 2 ------</span>
<a id="__codelineno-12-40" name="__codelineno-12-40"></a>    <span class="c1"># configuration de l&#39;application avec des constantes</span>
<a id="__codelineno-12-41" name="__codelineno-12-41"></a>    <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
<a id="__codelineno-12-42" name="__codelineno-12-42"></a>        <span class="c1"># fichier des contribuables</span>
<a id="__codelineno-12-43" name="__codelineno-12-43"></a>        <span class="s2">&quot;taxpayersFilename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../data/input/taxpayersdata.txt&quot;</span><span class="p">,</span>
<a id="__codelineno-12-44" name="__codelineno-12-44"></a>        <span class="c1"># fichier des résultats</span>
<a id="__codelineno-12-45" name="__codelineno-12-45"></a>        <span class="s2">&quot;resultsFilename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../data/output/résultats.json&quot;</span><span class="p">,</span>
<a id="__codelineno-12-46" name="__codelineno-12-46"></a>        <span class="c1"># fichier des erreurs</span>
<a id="__codelineno-12-47" name="__codelineno-12-47"></a>        <span class="s2">&quot;errorsFilename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../data/output/errors.txt&quot;</span><span class="p">,</span>
<a id="__codelineno-12-48" name="__codelineno-12-48"></a>        <span class="c1"># fichier de logs</span>
<a id="__codelineno-12-49" name="__codelineno-12-49"></a>        <span class="s2">&quot;logsFilename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../data/logs/logs.txt&quot;</span><span class="p">,</span>
<a id="__codelineno-12-50" name="__codelineno-12-50"></a>        <span class="c1"># le serveur de calcul de l&#39;impôt</span>
<a id="__codelineno-12-51" name="__codelineno-12-51"></a>        <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-12-52" name="__codelineno-12-52"></a>            <span class="s2">&quot;urlServer&quot;</span><span class="p">:</span> <span class="s2">&quot;http://127.0.0.1:5000&quot;</span><span class="p">,</span>
<a id="__codelineno-12-53" name="__codelineno-12-53"></a>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-12-54" name="__codelineno-12-54"></a>                <span class="s2">&quot;login&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<a id="__codelineno-12-55" name="__codelineno-12-55"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span>
<a id="__codelineno-12-56" name="__codelineno-12-56"></a>            <span class="p">},</span>
<a id="__codelineno-12-57" name="__codelineno-12-57"></a>            <span class="s2">&quot;url_services&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-12-58" name="__codelineno-12-58"></a>                <span class="s2">&quot;calculate-tax&quot;</span><span class="p">:</span> <span class="s2">&quot;/calculer-impot&quot;</span><span class="p">,</span>
<a id="__codelineno-12-59" name="__codelineno-12-59"></a>                <span class="s2">&quot;get-admindata&quot;</span><span class="p">:</span> <span class="s2">&quot;/get-admindata&quot;</span><span class="p">,</span>
<a id="__codelineno-12-60" name="__codelineno-12-60"></a>                <span class="s2">&quot;calculate-tax-in-bulk-mode&quot;</span><span class="p">:</span> <span class="s2">&quot;/calculer-impots&quot;</span><span class="p">,</span>
<a id="__codelineno-12-61" name="__codelineno-12-61"></a>                <span class="s2">&quot;init-session&quot;</span><span class="p">:</span> <span class="s2">&quot;/init-session&quot;</span><span class="p">,</span>
<a id="__codelineno-12-62" name="__codelineno-12-62"></a>                <span class="s2">&quot;end-session&quot;</span><span class="p">:</span> <span class="s2">&quot;/fin-session&quot;</span><span class="p">,</span>
<a id="__codelineno-12-63" name="__codelineno-12-63"></a>                <span class="s2">&quot;authenticate-user&quot;</span><span class="p">:</span> <span class="s2">&quot;/authentifier-utilisateur&quot;</span><span class="p">,</span>
<a id="__codelineno-12-64" name="__codelineno-12-64"></a>                <span class="s2">&quot;get-simulations&quot;</span><span class="p">:</span> <span class="s2">&quot;/lister-simulations&quot;</span><span class="p">,</span>
<a id="__codelineno-12-65" name="__codelineno-12-65"></a>                <span class="s2">&quot;delete-simulation&quot;</span><span class="p">:</span> <span class="s2">&quot;/supprimer-simulation&quot;</span>
<a id="__codelineno-12-66" name="__codelineno-12-66"></a>            <span class="p">}</span>
<a id="__codelineno-12-67" name="__codelineno-12-67"></a>        <span class="p">},</span>
<a id="__codelineno-12-68" name="__codelineno-12-68"></a>        <span class="c1"># mode debug</span>
<a id="__codelineno-12-69" name="__codelineno-12-69"></a>        <span class="s2">&quot;debug&quot;</span><span class="p">:</span> <span class="kc">True</span>
<a id="__codelineno-12-70" name="__codelineno-12-70"></a>    <span class="p">}</span>
<a id="__codelineno-12-71" name="__codelineno-12-71"></a>    <span class="p">)</span>
<a id="__codelineno-12-72" name="__codelineno-12-72"></a>
<a id="__codelineno-12-73" name="__codelineno-12-73"></a>    <span class="c1"># étape 3 ------</span>
<a id="__codelineno-12-74" name="__codelineno-12-74"></a>    <span class="c1"># instanciation des couches</span>
<a id="__codelineno-12-75" name="__codelineno-12-75"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">config_layers</span>
<a id="__codelineno-12-76" name="__codelineno-12-76"></a>    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config_layers</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-12-77" name="__codelineno-12-77"></a>
<a id="__codelineno-12-78" name="__codelineno-12-78"></a>    <span class="c1"># on rend la configuation</span>
<a id="__codelineno-12-79" name="__codelineno-12-79"></a>    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<p>Le fichier <strong>[config_layers]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>    <span class="c1"># instanciation des couches de l&#39;applicatuon</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>    <span class="c1"># couche [métier]</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsMétier</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsMétier</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>    <span class="n">métier</span> <span class="o">=</span> <span class="n">ImpôtsMétier</span><span class="p">()</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>    <span class="c1"># factory de la couche dao</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsDaoWithHttpSessionFactory</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsDaoWithHttpSessionFactory</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>    <span class="n">dao_factory</span> <span class="o">=</span> <span class="n">ImpôtsDaoWithHttpSessionFactory</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>    <span class="c1"># on rend la configuration des couches</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a>        <span class="s2">&quot;dao_factory&quot;</span><span class="p">:</span> <span class="n">dao_factory</span><span class="p">,</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a>        <span class="s2">&quot;métier&quot;</span><span class="p">:</span> <span class="n">métier</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>les clients n’auront pas un accès direct à la couche <strong>[dao]</strong>. Pour en avoir une, ils devront passer par la factory de la couche <strong>[dao]</strong> ;</li>
</ul>
<h2 id="314-le-client-main">31.4. Le client [main]</h2>
<p>Le client <strong>[main]</strong> permet de tester les URL <strong>[/init-session, /authentifier-utilisateur, /calculer-impots, /fin-session]</strong> :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">  1</a></span>
<span class="normal"><a href="#__codelineno-14-2">  2</a></span>
<span class="normal"><a href="#__codelineno-14-3">  3</a></span>
<span class="normal"><a href="#__codelineno-14-4">  4</a></span>
<span class="normal"><a href="#__codelineno-14-5">  5</a></span>
<span class="normal"><a href="#__codelineno-14-6">  6</a></span>
<span class="normal"><a href="#__codelineno-14-7">  7</a></span>
<span class="normal"><a href="#__codelineno-14-8">  8</a></span>
<span class="normal"><a href="#__codelineno-14-9">  9</a></span>
<span class="normal"><a href="#__codelineno-14-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-14-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-14-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-14-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-14-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-14-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-14-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-14-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-14-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-14-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-14-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-14-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-14-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-14-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-14-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-14-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-14-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-14-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-14-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-14-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-14-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-14-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-14-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-14-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-14-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-14-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-14-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-14-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-14-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-14-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-14-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-14-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-14-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-14-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-14-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-14-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-14-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-14-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-14-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-14-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-14-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-14-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-14-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-14-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-14-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-14-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-14-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-14-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-14-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-14-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-14-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-14-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-14-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-14-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-14-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-14-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-14-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-14-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-14-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-14-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-14-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-14-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-14-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-14-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-14-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-14-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-14-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-14-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-14-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-14-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-14-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-14-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-14-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-14-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-14-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-14-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-14-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-14-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-14-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-14-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-14-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-14-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-14-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-14-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-14-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-14-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-14-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-14-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-14-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-14-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-14-100">100</a></span>
<span class="normal"><a href="#__codelineno-14-101">101</a></span>
<span class="normal"><a href="#__codelineno-14-102">102</a></span>
<span class="normal"><a href="#__codelineno-14-103">103</a></span>
<span class="normal"><a href="#__codelineno-14-104">104</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># on attend un paramètre json ou xml</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="n">syntaxe</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> json / xml&quot;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="n">erreur</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>    <span class="n">session_type</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>    <span class="n">erreur</span> <span class="o">=</span> <span class="n">session_type</span> <span class="o">!=</span> <span class="s2">&quot;json&quot;</span> <span class="ow">and</span> <span class="n">session_type</span> <span class="o">!=</span> <span class="s2">&quot;xml&quot;</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="k">if</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;syntaxe : </span><span class="si">{</span><span class="n">syntaxe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">({</span><span class="s2">&quot;session_type&quot;</span><span class="p">:</span> <span class="n">session_type</span><span class="p">})</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="c1"># dépendances</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">Logger</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a><span class="c1"># exécution de la couche [dao] dans un thread</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="c1"># taxpayers est une liste de contribuables</span>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">thread_function</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">taxpayers</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a>    <span class="c1"># on récupère la factory de la couche [dao]</span>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a>    <span class="n">dao_factory</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">][</span><span class="s1">&#39;dao_factory&#39;</span><span class="p">]</span>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a>    <span class="c1"># on crée une instance de couche [dao]</span>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a>    <span class="n">dao</span> <span class="o">=</span> <span class="n">dao_factory</span><span class="o">.</span><span class="n">new_instance</span><span class="p">()</span>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a>    <span class="c1"># type de la session</span>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a>    <span class="n">session_type</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;session_type&#39;</span><span class="p">]</span>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a>    <span class="c1"># nombre de contribuables</span>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a>    <span class="n">nb_taxpayers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">)</span>
<a id="__codelineno-14-35" name="__codelineno-14-35"></a>    <span class="c1"># log</span>
<a id="__codelineno-14-36" name="__codelineno-14-36"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;début du calcul de l&#39;impôt des </span><span class="si">{</span><span class="n">nb_taxpayers</span><span class="si">}</span><span class="s2"> contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-37" name="__codelineno-14-37"></a>    <span class="c1"># on initialise la session</span>
<a id="__codelineno-14-38" name="__codelineno-14-38"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">init_session</span><span class="p">(</span><span class="n">session_type</span><span class="p">)</span>
<a id="__codelineno-14-39" name="__codelineno-14-39"></a>    <span class="c1"># on s&#39;authentifie</span>
<a id="__codelineno-14-40" name="__codelineno-14-40"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;login&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
<a id="__codelineno-14-41" name="__codelineno-14-41"></a>    <span class="c1"># on calcule l&#39;impôt des contribuables</span>
<a id="__codelineno-14-42" name="__codelineno-14-42"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">calculate_tax_in_bulk_mode</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">)</span>
<a id="__codelineno-14-43" name="__codelineno-14-43"></a>    <span class="c1"># fin de session</span>
<a id="__codelineno-14-44" name="__codelineno-14-44"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">end_session</span><span class="p">()</span>
<a id="__codelineno-14-45" name="__codelineno-14-45"></a>    <span class="c1"># log</span>
<a id="__codelineno-14-46" name="__codelineno-14-46"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fin du calcul de l&#39;impôt des </span><span class="si">{</span><span class="n">nb_taxpayers</span><span class="si">}</span><span class="s2"> contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-47" name="__codelineno-14-47"></a>
<a id="__codelineno-14-48" name="__codelineno-14-48"></a><span class="c1"># liste des threads du client</span>
<a id="__codelineno-14-49" name="__codelineno-14-49"></a><span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-14-50" name="__codelineno-14-50"></a><span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-14-51" name="__codelineno-14-51"></a><span class="c1"># code</span>
<a id="__codelineno-14-52" name="__codelineno-14-52"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-14-53" name="__codelineno-14-53"></a>    <span class="c1"># logger</span>
<a id="__codelineno-14-54" name="__codelineno-14-54"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;logsFilename&quot;</span><span class="p">])</span>
<a id="__codelineno-14-55" name="__codelineno-14-55"></a>    <span class="c1"># on le mémorise dans la config</span>
<a id="__codelineno-14-56" name="__codelineno-14-56"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;logger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-14-57" name="__codelineno-14-57"></a>    <span class="c1"># log de début</span>
<a id="__codelineno-14-58" name="__codelineno-14-58"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;début du calcul de l&#39;impôt des contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-59" name="__codelineno-14-59"></a>    <span class="c1"># on récupère la factory de la couche [dao]</span>
<a id="__codelineno-14-60" name="__codelineno-14-60"></a>    <span class="n">dao_factory</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;layers&quot;</span><span class="p">][</span><span class="s2">&quot;dao_factory&quot;</span><span class="p">]</span>
<a id="__codelineno-14-61" name="__codelineno-14-61"></a>    <span class="c1"># on crée une instance de la couche [dao]</span>
<a id="__codelineno-14-62" name="__codelineno-14-62"></a>    <span class="n">dao</span> <span class="o">=</span> <span class="n">dao_factory</span><span class="o">.</span><span class="n">new_instance</span><span class="p">()</span>
<a id="__codelineno-14-63" name="__codelineno-14-63"></a>    <span class="c1"># lecture des données des contribuables</span>
<a id="__codelineno-14-64" name="__codelineno-14-64"></a>    <span class="n">taxpayers</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_taxpayers_data</span><span class="p">()[</span><span class="s2">&quot;taxpayers&quot;</span><span class="p">]</span>
<a id="__codelineno-14-65" name="__codelineno-14-65"></a>    <span class="c1"># des contribuables ?</span>
<a id="__codelineno-14-66" name="__codelineno-14-66"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">taxpayers</span><span class="p">:</span>
<a id="__codelineno-14-67" name="__codelineno-14-67"></a>        <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Pas de contribuables valides dans le fichier </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;taxpayersFilename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-68" name="__codelineno-14-68"></a>    <span class="c1"># calcul de l&#39;impôt des contribuables avec plusieurs threads</span>
<a id="__codelineno-14-69" name="__codelineno-14-69"></a>    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-14-70" name="__codelineno-14-70"></a>    <span class="n">l_taxpayers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">)</span>
<a id="__codelineno-14-71" name="__codelineno-14-71"></a>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">):</span>
<a id="__codelineno-14-72" name="__codelineno-14-72"></a>        <span class="c1"># chaque thread va traiter de 1 à 4 contribuables</span>
<a id="__codelineno-14-73" name="__codelineno-14-73"></a>        <span class="n">nb_taxpayers</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">l_taxpayers</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<a id="__codelineno-14-74" name="__codelineno-14-74"></a>        <span class="c1"># la liste des contribuables traités par le thread</span>
<a id="__codelineno-14-75" name="__codelineno-14-75"></a>        <span class="n">thread_taxpayers</span> <span class="o">=</span> <span class="n">taxpayers</span><span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">nb_taxpayers</span><span class="p">)]</span>
<a id="__codelineno-14-76" name="__codelineno-14-76"></a>        <span class="c1"># on incrémente i pour le thread suivant</span>
<a id="__codelineno-14-77" name="__codelineno-14-77"></a>        <span class="n">i</span> <span class="o">+=</span> <span class="n">nb_taxpayers</span>
<a id="__codelineno-14-78" name="__codelineno-14-78"></a>        <span class="c1"># on crée le thread</span>
<a id="__codelineno-14-79" name="__codelineno-14-79"></a>        <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">thread_function</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">thread_taxpayers</span><span class="p">))</span>
<a id="__codelineno-14-80" name="__codelineno-14-80"></a>        <span class="c1"># on l&#39;ajoute à la liste des threads du script principal</span>
<a id="__codelineno-14-81" name="__codelineno-14-81"></a>        <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
<a id="__codelineno-14-82" name="__codelineno-14-82"></a>        <span class="c1"># on lance le thread - cette opération est asynchrone - on n&#39;attend pas le résultat du thread</span>
<a id="__codelineno-14-83" name="__codelineno-14-83"></a>        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<a id="__codelineno-14-84" name="__codelineno-14-84"></a>    <span class="c1"># le thread principal attend la fin de tous les threads qu&#39;il a lancés</span>
<a id="__codelineno-14-85" name="__codelineno-14-85"></a>    <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
<a id="__codelineno-14-86" name="__codelineno-14-86"></a>        <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<a id="__codelineno-14-87" name="__codelineno-14-87"></a>    <span class="c1"># ici tous les threads ont fini leur travail - chacun a modifié un ou plusieurs objets [taxpayer]</span>
<a id="__codelineno-14-88" name="__codelineno-14-88"></a>    <span class="c1"># on enregistre les résultats dans le fichier jSON</span>
<a id="__codelineno-14-89" name="__codelineno-14-89"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">write_taxpayers_results</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">)</span>
<a id="__codelineno-14-90" name="__codelineno-14-90"></a>    <span class="c1"># fin</span>
<a id="__codelineno-14-91" name="__codelineno-14-91"></a><span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-14-92" name="__codelineno-14-92"></a>    <span class="c1"># affichage de l&#39;erreur</span>
<a id="__codelineno-14-93" name="__codelineno-14-93"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-94" name="__codelineno-14-94"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-14-95" name="__codelineno-14-95"></a>    <span class="c1"># on ferme le logueur</span>
<a id="__codelineno-14-96" name="__codelineno-14-96"></a>    <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
<a id="__codelineno-14-97" name="__codelineno-14-97"></a>        <span class="c1"># log de fin</span>
<a id="__codelineno-14-98" name="__codelineno-14-98"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;fin du calcul de l&#39;impôt des contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-99" name="__codelineno-14-99"></a>        <span class="c1"># fermeture du logueur</span>
<a id="__codelineno-14-100" name="__codelineno-14-100"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-14-101" name="__codelineno-14-101"></a>    <span class="c1"># on a fini</span>
<a id="__codelineno-14-102" name="__codelineno-14-102"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Travail terminé...&quot;</span><span class="p">)</span>
<a id="__codelineno-14-103" name="__codelineno-14-103"></a>    <span class="c1"># fin des threads qui pourraient encore exister si on s&#39;est arrêté sur erreur</span>
<a id="__codelineno-14-104" name="__codelineno-14-104"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 4-11 : le client attend un paramètre lui indiquant le type de session, json ou xml, à utiliser avec le serveur ;</li>
<li>lignes 13-15 : le client est configuré ;</li>
<li>lignes 48-104 : ce code est connu. Il a été utilisé de nombreuses fois. Il répartit les contribuables pour lesquels on veut calculer l’impôt sur plusieurs threads ;</li>
<li>ligne 26 : la méthode <strong>[thread_function]</strong> est la méthode exécutée par chaque thread pour calculer l’impôt des contribuables qui lui ont été attribués ;</li>
<li>lignes 27-30 : chaque thread a sa propre couche <strong>[dao]</strong> ;</li>
<li>le calcul de l’impôt se fait en quatre étapes :</li>
<li>lignes 37-38 : initialisation d’une session, json ou xml, avec le serveur ;</li>
<li>lignes 39-40 : authentification auprès du serveur ;</li>
<li>lignes 41-42 : calcul de l’impôt ;</li>
<li>lignes 43-44 : fermeture de la session avec le serveur ;
Lorsqu’on exécute ce code en mode <strong>[json]</strong>, on obtient les logs suivants :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.320751</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.328749</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 4 contribuables</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.328749</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 4 contribuables</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.333592</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 3 contribuables</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.368651</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;init-session&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;session démarrée avec le type de réponse json&quot;</span><span class="p">]}</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.375699</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;init-session&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;session démarrée avec le type de réponse json&quot;</span><span class="p">]}</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.377432</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;init-session&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;session démarrée avec le type de réponse json&quot;</span><span class="p">]}</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.385653</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;authentifier-utilisateur&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="s2">&quot;Authentification réussie&quot;</span><span class="p">}</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.392656</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;authentifier-utilisateur&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="s2">&quot;Authentification réussie&quot;</span><span class="p">}</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.396377</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;authentifier-utilisateur&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="s2">&quot;Authentification réussie&quot;</span><span class="p">}</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.406528</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;calculer-impots&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">16782</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7176</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">4230</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]}</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.413837</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;calculer-impots&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">55555</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">2814</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">720</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}]}</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.416695</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;calculer-impots&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}]}</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.425747</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;fin-session&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="s2">&quot;session réinitialisée&quot;</span><span class="p">}</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.425747</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 4 contribuables</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.428956</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;fin-session&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="s2">&quot;session réinitialisée&quot;</span><span class="p">}</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.428956</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 4 contribuables</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.428956</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;fin-session&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="s2">&quot;session réinitialisée&quot;</span><span class="p">}</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.428956</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 3 contribuables</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">34.428956</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
</code></pre></div></td></tr></table></div>
<p>On voit ci-dessus le parcours du thread <strong>[Thread-2]</strong>.</p>
<p>Si on exécute <strong>[main]</strong> en mode XML, les logs sont les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span>
<span class="normal"><a href="#__codelineno-16-27">27</a></span>
<span class="normal"><a href="#__codelineno-16-28">28</a></span>
<span class="normal"><a href="#__codelineno-16-29">29</a></span>
<span class="normal"><a href="#__codelineno-16-30">30</a></span>
<span class="normal"><a href="#__codelineno-16-31">31</a></span>
<span class="normal"><a href="#__codelineno-16-32">32</a></span>
<span class="normal"><a href="#__codelineno-16-33">33</a></span>
<span class="normal"><a href="#__codelineno-16-34">34</a></span>
<span class="normal"><a href="#__codelineno-16-35">35</a></span>
<span class="normal"><a href="#__codelineno-16-36">36</a></span>
<span class="normal"><a href="#__codelineno-16-37">37</a></span>
<span class="normal"><a href="#__codelineno-16-38">38</a></span>
<span class="normal"><a href="#__codelineno-16-39">39</a></span>
<span class="normal"><a href="#__codelineno-16-40">40</a></span>
<span class="normal"><a href="#__codelineno-16-41">41</a></span>
<span class="normal"><a href="#__codelineno-16-42">42</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.495316</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.496452</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 2 contribuables</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.498992</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 2 contribuables</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.498992</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 4 contribuables</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.498992</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 3 contribuables</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.538637</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">init</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">700</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">démarrée</span> <span class="n">avec</span> <span class="n">le</span> <span class="nb">type</span> <span class="n">de</span> <span class="n">réponse</span> <span class="n">xml</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.540783</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">init</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">700</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">démarrée</span> <span class="n">avec</span> <span class="n">le</span> <span class="nb">type</span> <span class="n">de</span> <span class="n">réponse</span> <span class="n">xml</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.547811</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">init</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">700</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">démarrée</span> <span class="n">avec</span> <span class="n">le</span> <span class="nb">type</span> <span class="n">de</span> <span class="n">réponse</span> <span class="n">xml</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.547811</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">init</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">700</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">démarrée</span> <span class="n">avec</span> <span class="n">le</span> <span class="nb">type</span> <span class="n">de</span> <span class="n">réponse</span> <span class="n">xml</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.555184</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">authentifier</span><span class="o">-</span><span class="n">utilisateur</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">200</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">Authentification</span> <span class="n">réussie</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.564793</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">authentifier</span><span class="o">-</span><span class="n">utilisateur</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">200</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">Authentification</span> <span class="n">réussie</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.564793</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">authentifier</span><span class="o">-</span><span class="n">utilisateur</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">200</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">Authentification</span> <span class="n">réussie</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.568333</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">authentifier</span><span class="o">-</span><span class="n">utilisateur</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">200</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">Authentification</span> <span class="n">réussie</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.568333</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">calculer</span><span class="o">-</span><span class="n">impots</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">1500</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">oui</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">55555</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">2814</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.14</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">oui</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">50000</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">1384</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.14</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">384</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">347</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.579205</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">calculer</span><span class="o">-</span><span class="n">impots</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">1500</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">oui</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">50000</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.14</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">720</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">non</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">100000</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">19884</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">4480</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.41</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.579205</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">calculer</span><span class="o">-</span><span class="n">impots</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">1500</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">non</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">100000</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">16782</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">7176</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.41</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">oui</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">100000</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">9200</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">2180</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.3</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">oui</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">5</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">100000</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">4230</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.14</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">non</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">100000</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">22986</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.41</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">4</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-28" name="__codelineno-16-28"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.588051</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-29" name="__codelineno-16-29"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">calculer</span><span class="o">-</span><span class="n">impots</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">1500</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">oui</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">30000</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">non</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">200000</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">64210</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">7498</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.45</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">2</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">marié</span><span class="o">&gt;</span><span class="n">oui</span><span class="o">&lt;/</span><span class="n">marié</span><span class="o">&gt;&lt;</span><span class="n">enfants</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">enfants</span><span class="o">&gt;&lt;</span><span class="n">salaire</span><span class="o">&gt;</span><span class="mi">200000</span><span class="o">&lt;/</span><span class="n">salaire</span><span class="o">&gt;&lt;</span><span class="n">impôt</span><span class="o">&gt;</span><span class="mi">42842</span><span class="o">&lt;/</span><span class="n">impôt</span><span class="o">&gt;&lt;</span><span class="n">surcôte</span><span class="o">&gt;</span><span class="mi">17283</span><span class="o">&lt;/</span><span class="n">surcôte</span><span class="o">&gt;&lt;</span><span class="n">taux</span><span class="o">&gt;</span><span class="mf">0.41</span><span class="o">&lt;/</span><span class="n">taux</span><span class="o">&gt;&lt;</span><span class="n">décôte</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">décôte</span><span class="o">&gt;&lt;</span><span class="n">réduction</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">&lt;/</span><span class="n">réduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">3</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-30" name="__codelineno-16-30"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.594058</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-31" name="__codelineno-16-31"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">fin</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">400</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">réinitialisée</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-32" name="__codelineno-16-32"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.595198</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 2 contribuables</span>
<a id="__codelineno-16-33" name="__codelineno-16-33"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.595198</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-34" name="__codelineno-16-34"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">fin</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">400</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">réinitialisée</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-35" name="__codelineno-16-35"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.595198</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 2 contribuables</span>
<a id="__codelineno-16-36" name="__codelineno-16-36"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.595198</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-37" name="__codelineno-16-37"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">fin</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">400</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">réinitialisée</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-38" name="__codelineno-16-38"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.595198</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 4 contribuables</span>
<a id="__codelineno-16-39" name="__codelineno-16-39"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.603351</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-16-40" name="__codelineno-16-40"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">fin</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">400</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">réinitialisée</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-16-41" name="__codelineno-16-41"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.603351</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 3 contribuables</span>
<a id="__codelineno-16-42" name="__codelineno-16-42"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mf">48.603351</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
</code></pre></div></td></tr></table></div>
<p>Ci-dessus, le parcours du thread <strong>[Thread-2]</strong>.</p>
<h2 id="315-le-client-main2">31.5. Le client [main2]</h2>
<p><img src="images/1000000000000152000001320FFD0FE9.png" style="width:3.901cm;height:3.53cm;" alt="Image" /></p>
<p>Le client <strong>[main2]</strong> permet de tester les URL <strong>[/init-session, /authentifier-utilisateur, /get-admindata, /fin-session]</strong> :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span>
<span class="normal"><a href="#__codelineno-17-26">26</a></span>
<span class="normal"><a href="#__codelineno-17-27">27</a></span>
<span class="normal"><a href="#__codelineno-17-28">28</a></span>
<span class="normal"><a href="#__codelineno-17-29">29</a></span>
<span class="normal"><a href="#__codelineno-17-30">30</a></span>
<span class="normal"><a href="#__codelineno-17-31">31</a></span>
<span class="normal"><a href="#__codelineno-17-32">32</a></span>
<span class="normal"><a href="#__codelineno-17-33">33</a></span>
<span class="normal"><a href="#__codelineno-17-34">34</a></span>
<span class="normal"><a href="#__codelineno-17-35">35</a></span>
<span class="normal"><a href="#__codelineno-17-36">36</a></span>
<span class="normal"><a href="#__codelineno-17-37">37</a></span>
<span class="normal"><a href="#__codelineno-17-38">38</a></span>
<span class="normal"><a href="#__codelineno-17-39">39</a></span>
<span class="normal"><a href="#__codelineno-17-40">40</a></span>
<span class="normal"><a href="#__codelineno-17-41">41</a></span>
<span class="normal"><a href="#__codelineno-17-42">42</a></span>
<span class="normal"><a href="#__codelineno-17-43">43</a></span>
<span class="normal"><a href="#__codelineno-17-44">44</a></span>
<span class="normal"><a href="#__codelineno-17-45">45</a></span>
<span class="normal"><a href="#__codelineno-17-46">46</a></span>
<span class="normal"><a href="#__codelineno-17-47">47</a></span>
<span class="normal"><a href="#__codelineno-17-48">48</a></span>
<span class="normal"><a href="#__codelineno-17-49">49</a></span>
<span class="normal"><a href="#__codelineno-17-50">50</a></span>
<span class="normal"><a href="#__codelineno-17-51">51</a></span>
<span class="normal"><a href="#__codelineno-17-52">52</a></span>
<span class="normal"><a href="#__codelineno-17-53">53</a></span>
<span class="normal"><a href="#__codelineno-17-54">54</a></span>
<span class="normal"><a href="#__codelineno-17-55">55</a></span>
<span class="normal"><a href="#__codelineno-17-56">56</a></span>
<span class="normal"><a href="#__codelineno-17-57">57</a></span>
<span class="normal"><a href="#__codelineno-17-58">58</a></span>
<span class="normal"><a href="#__codelineno-17-59">59</a></span>
<span class="normal"><a href="#__codelineno-17-60">60</a></span>
<span class="normal"><a href="#__codelineno-17-61">61</a></span>
<span class="normal"><a href="#__codelineno-17-62">62</a></span>
<span class="normal"><a href="#__codelineno-17-63">63</a></span>
<span class="normal"><a href="#__codelineno-17-64">64</a></span>
<span class="normal"><a href="#__codelineno-17-65">65</a></span>
<span class="normal"><a href="#__codelineno-17-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># on attend un paramètre json ou xml</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="n">syntaxe</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> json / xml&quot;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="n">erreur</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>    <span class="n">session_type</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>    <span class="n">erreur</span> <span class="o">=</span> <span class="n">session_type</span> <span class="o">!=</span> <span class="s2">&quot;json&quot;</span> <span class="ow">and</span> <span class="n">session_type</span> <span class="o">!=</span> <span class="s2">&quot;xml&quot;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="k">if</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;syntaxe : </span><span class="si">{</span><span class="n">syntaxe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">({</span><span class="s2">&quot;session_type&quot;</span><span class="p">:</span> <span class="n">session_type</span><span class="p">})</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="c1"># dépendances</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">Logger</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="c1"># code</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a>    <span class="c1"># logger</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;logsFilename&quot;</span><span class="p">])</span>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a>    <span class="c1"># on le mémorise dans la config</span>
<a id="__codelineno-17-27" name="__codelineno-17-27"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;logger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a>    <span class="c1"># log de début</span>
<a id="__codelineno-17-29" name="__codelineno-17-29"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;début du calcul de l&#39;impôt des contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-30" name="__codelineno-17-30"></a>    <span class="c1"># on récupère la factory de la couche [dao]</span>
<a id="__codelineno-17-31" name="__codelineno-17-31"></a>    <span class="n">dao_factory</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">][</span><span class="s1">&#39;dao_factory&#39;</span><span class="p">]</span>
<a id="__codelineno-17-32" name="__codelineno-17-32"></a>    <span class="c1"># on crée une instance de la couche [dao]</span>
<a id="__codelineno-17-33" name="__codelineno-17-33"></a>    <span class="n">dao</span> <span class="o">=</span> <span class="n">dao_factory</span><span class="o">.</span><span class="n">new_instance</span><span class="p">()</span>
<a id="__codelineno-17-34" name="__codelineno-17-34"></a>    <span class="c1"># on récupère les contribuables</span>
<a id="__codelineno-17-35" name="__codelineno-17-35"></a>    <span class="n">taxpayers</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_taxpayers_data</span><span class="p">()[</span><span class="s2">&quot;taxpayers&quot;</span><span class="p">]</span>
<a id="__codelineno-17-36" name="__codelineno-17-36"></a>    <span class="c1"># des contribuables ?</span>
<a id="__codelineno-17-37" name="__codelineno-17-37"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">taxpayers</span><span class="p">:</span>
<a id="__codelineno-17-38" name="__codelineno-17-38"></a>        <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Pas de contribuables valides dans le fichier </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;taxpayersFilename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-39" name="__codelineno-17-39"></a>    <span class="c1"># type de la session</span>
<a id="__codelineno-17-40" name="__codelineno-17-40"></a>    <span class="n">session_type</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;session_type&#39;</span><span class="p">]</span>
<a id="__codelineno-17-41" name="__codelineno-17-41"></a>    <span class="c1"># on initialise la session</span>
<a id="__codelineno-17-42" name="__codelineno-17-42"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">init_session</span><span class="p">(</span><span class="n">session_type</span><span class="p">)</span>
<a id="__codelineno-17-43" name="__codelineno-17-43"></a>    <span class="c1"># on s&#39;authentifie</span>
<a id="__codelineno-17-44" name="__codelineno-17-44"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;login&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
<a id="__codelineno-17-45" name="__codelineno-17-45"></a>    <span class="c1"># on récupère les données de l&#39;administration fiscale</span>
<a id="__codelineno-17-46" name="__codelineno-17-46"></a>    <span class="n">admindata</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_admindata</span><span class="p">()</span>
<a id="__codelineno-17-47" name="__codelineno-17-47"></a>    <span class="c1"># fin de session</span>
<a id="__codelineno-17-48" name="__codelineno-17-48"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">end_session</span><span class="p">()</span>
<a id="__codelineno-17-49" name="__codelineno-17-49"></a>    <span class="c1"># calcul de l&#39;impôt des contribuables par la couche [métier]</span>
<a id="__codelineno-17-50" name="__codelineno-17-50"></a>    <span class="n">métier</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">][</span><span class="s1">&#39;métier&#39;</span><span class="p">]</span>
<a id="__codelineno-17-51" name="__codelineno-17-51"></a>    <span class="k">for</span> <span class="n">taxpayer</span> <span class="ow">in</span> <span class="n">taxpayers</span><span class="p">:</span>
<a id="__codelineno-17-52" name="__codelineno-17-52"></a>        <span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-17-53" name="__codelineno-17-53"></a>    <span class="c1"># on enregistre les résultats dans le fichier jSON</span>
<a id="__codelineno-17-54" name="__codelineno-17-54"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">write_taxpayers_results</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">)</span>
<a id="__codelineno-17-55" name="__codelineno-17-55"></a> <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-17-56" name="__codelineno-17-56"></a>     <span class="c1"># affichage de l&#39;erreur</span>
<a id="__codelineno-17-57" name="__codelineno-17-57"></a>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-58" name="__codelineno-17-58"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-17-59" name="__codelineno-17-59"></a>    <span class="c1"># on ferme le logueur</span>
<a id="__codelineno-17-60" name="__codelineno-17-60"></a>    <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
<a id="__codelineno-17-61" name="__codelineno-17-61"></a>        <span class="c1"># log de fin</span>
<a id="__codelineno-17-62" name="__codelineno-17-62"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;fin du calcul de l&#39;impôt des contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-17-63" name="__codelineno-17-63"></a>        <span class="c1"># fermeture du logueur</span>
<a id="__codelineno-17-64" name="__codelineno-17-64"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-17-65" name="__codelineno-17-65"></a>    <span class="c1"># on a fini</span>
<a id="__codelineno-17-66" name="__codelineno-17-66"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Travail terminé...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 1-11 : on récupère le paramètre <strong>[json, xml]</strong> qui fixe le type de la session à établir avec le serveur ;</li>
<li>lignes 13-15 : on configure le client ;</li>
<li>lignes 30-33 : on crée une couche <strong>[dao]</strong> ;</li>
<li>lignes 34-35 : avec elle, on récupère la liste des contribuables pour lesquels il faut calculer l’impôt ;</li>
<li>on retrouve ensuite les quatre étapes du dialogue avec le serveur ;</li>
<li>lignes 41-42 : une session est démarrée avec le serveur ;</li>
<li>lignes 43-44 : on s’authentifie auprès du serveur ;</li>
<li>lignes 45-46 : on demande au serveur les constantes fiscales permettant le calcul de l’impôt ;</li>
<li>lignes 47-48 : on ferme la session avec le serveur ;</li>
<li>lignes 49-52 : avec ces constantes, on est capables de calculer l’impôt des contribuables à l’aide de la couche <strong>[métier]</strong> locale au client ;</li>
<li>lignes 53-54 : on enregistre les résultats obtenus ;
Pour une session XML, les résultats sont les suivants :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mf">43.194294</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mf">43.231633</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">init</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">700</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">démarrée</span> <span class="n">avec</span> <span class="n">le</span> <span class="nb">type</span> <span class="n">de</span> <span class="n">réponse</span> <span class="n">xml</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mf">43.240872</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">authentifier</span><span class="o">-</span><span class="n">utilisateur</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">200</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">Authentification</span> <span class="n">réussie</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mf">43.250061</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">get</span><span class="o">-</span><span class="n">admindata</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">1000</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;&lt;</span><span class="n">limites</span><span class="o">&gt;</span><span class="mf">9964.0</span><span class="o">&lt;/</span><span class="n">limites</span><span class="o">&gt;&lt;</span><span class="n">limites</span><span class="o">&gt;</span><span class="mf">27519.0</span><span class="o">&lt;/</span><span class="n">limites</span><span class="o">&gt;&lt;</span><span class="n">limites</span><span class="o">&gt;</span><span class="mf">73779.0</span><span class="o">&lt;/</span><span class="n">limites</span><span class="o">&gt;&lt;</span><span class="n">limites</span><span class="o">&gt;</span><span class="mf">156244.0</span><span class="o">&lt;/</span><span class="n">limites</span><span class="o">&gt;&lt;</span><span class="n">limites</span><span class="o">&gt;</span><span class="mf">93749.0</span><span class="o">&lt;/</span><span class="n">limites</span><span class="o">&gt;&lt;</span><span class="n">coeffr</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="o">&lt;/</span><span class="n">coeffr</span><span class="o">&gt;&lt;</span><span class="n">coeffr</span><span class="o">&gt;</span><span class="mf">0.14</span><span class="o">&lt;/</span><span class="n">coeffr</span><span class="o">&gt;&lt;</span><span class="n">coeffr</span><span class="o">&gt;</span><span class="mf">0.3</span><span class="o">&lt;/</span><span class="n">coeffr</span><span class="o">&gt;&lt;</span><span class="n">coeffr</span><span class="o">&gt;</span><span class="mf">0.41</span><span class="o">&lt;/</span><span class="n">coeffr</span><span class="o">&gt;&lt;</span><span class="n">coeffr</span><span class="o">&gt;</span><span class="mf">0.45</span><span class="o">&lt;/</span><span class="n">coeffr</span><span class="o">&gt;&lt;</span><span class="n">coeffn</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="o">&lt;/</span><span class="n">coeffn</span><span class="o">&gt;&lt;</span><span class="n">coeffn</span><span class="o">&gt;</span><span class="mf">1394.96</span><span class="o">&lt;/</span><span class="n">coeffn</span><span class="o">&gt;&lt;</span><span class="n">coeffn</span><span class="o">&gt;</span><span class="mf">5798.0</span><span class="o">&lt;/</span><span class="n">coeffn</span><span class="o">&gt;&lt;</span><span class="n">coeffn</span><span class="o">&gt;</span><span class="mf">13913.7</span><span class="o">&lt;/</span><span class="n">coeffn</span><span class="o">&gt;&lt;</span><span class="n">coeffn</span><span class="o">&gt;</span><span class="mf">20163.4</span><span class="o">&lt;/</span><span class="n">coeffn</span><span class="o">&gt;&lt;</span><span class="n">abattement_dixpourcent_min</span><span class="o">&gt;</span><span class="mf">437.0</span><span class="o">&lt;/</span><span class="n">abattement_dixpourcent_min</span><span class="o">&gt;&lt;</span><span class="n">plafond_impot_couple_pour_decote</span><span class="o">&gt;</span><span class="mf">2627.0</span><span class="o">&lt;/</span><span class="n">plafond_impot_couple_pour_decote</span><span class="o">&gt;&lt;</span><span class="n">plafond_decote_couple</span><span class="o">&gt;</span><span class="mf">1970.0</span><span class="o">&lt;/</span><span class="n">plafond_decote_couple</span><span class="o">&gt;&lt;</span><span class="n">valeur_reduc_demi_part</span><span class="o">&gt;</span><span class="mf">3797.0</span><span class="o">&lt;/</span><span class="n">valeur_reduc_demi_part</span><span class="o">&gt;&lt;</span><span class="n">plafond_revenus_celibataire_pour_reduction</span><span class="o">&gt;</span><span class="mf">21037.0</span><span class="o">&lt;/</span><span class="n">plafond_revenus_celibataire_pour_reduction</span><span class="o">&gt;&lt;</span><span class="nb">id</span><span class="o">&gt;</span><span class="mi">1</span><span class="o">&lt;/</span><span class="nb">id</span><span class="o">&gt;&lt;</span><span class="n">abattement_dixpourcent_max</span><span class="o">&gt;</span><span class="mf">12502.0</span><span class="o">&lt;/</span><span class="n">abattement_dixpourcent_max</span><span class="o">&gt;&lt;</span><span class="n">plafond_impot_celibataire_pour_decote</span><span class="o">&gt;</span><span class="mf">1595.0</span><span class="o">&lt;/</span><span class="n">plafond_impot_celibataire_pour_decote</span><span class="o">&gt;&lt;</span><span class="n">plafond_decote_celibataire</span><span class="o">&gt;</span><span class="mf">1196.0</span><span class="o">&lt;/</span><span class="n">plafond_decote_celibataire</span><span class="o">&gt;&lt;</span><span class="n">plafond_revenus_couple_pour_reduction</span><span class="o">&gt;</span><span class="mf">42074.0</span><span class="o">&lt;/</span><span class="n">plafond_revenus_couple_pour_reduction</span><span class="o">&gt;&lt;</span><span class="n">plafond_qf_demi_part</span><span class="o">&gt;</span><span class="mf">1551.0</span><span class="o">&lt;/</span><span class="n">plafond_qf_demi_part</span><span class="o">&gt;&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mf">43.269850</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="o">&lt;</span><span class="err">?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="err">?</span><span class="o">&gt;</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="o">&lt;</span><span class="n">root</span><span class="o">&gt;&lt;</span><span class="n">action</span><span class="o">&gt;</span><span class="n">fin</span><span class="o">-</span><span class="n">session</span><span class="o">&lt;/</span><span class="n">action</span><span class="o">&gt;&lt;</span><span class="n">état</span><span class="o">&gt;</span><span class="mi">400</span><span class="o">&lt;/</span><span class="n">état</span><span class="o">&gt;&lt;</span><span class="n">réponse</span><span class="o">&gt;</span><span class="n">session</span> <span class="n">réinitialisée</span><span class="o">&lt;/</span><span class="n">réponse</span><span class="o">&gt;&lt;/</span><span class="n">root</span><span class="o">&gt;</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">14</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mf">43.269850</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
</code></pre></div></td></tr></table></div>
<h2 id="316-le-client-main3">31.6. Le client [main3]</h2>
<p>Le client <strong>[main3]</strong> permet de tester les URL <strong>[/init-session, /calculer-impots, /get-simulations, /delete-simulation, /fin-session]</strong> :</p>
<p><img src="images/1000000000000150000001310FF136AB.png" style="width:3.89cm;height:3.521cm;" alt="Image" /></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span>
<span class="normal"><a href="#__codelineno-19-28">28</a></span>
<span class="normal"><a href="#__codelineno-19-29">29</a></span>
<span class="normal"><a href="#__codelineno-19-30">30</a></span>
<span class="normal"><a href="#__codelineno-19-31">31</a></span>
<span class="normal"><a href="#__codelineno-19-32">32</a></span>
<span class="normal"><a href="#__codelineno-19-33">33</a></span>
<span class="normal"><a href="#__codelineno-19-34">34</a></span>
<span class="normal"><a href="#__codelineno-19-35">35</a></span>
<span class="normal"><a href="#__codelineno-19-36">36</a></span>
<span class="normal"><a href="#__codelineno-19-37">37</a></span>
<span class="normal"><a href="#__codelineno-19-38">38</a></span>
<span class="normal"><a href="#__codelineno-19-39">39</a></span>
<span class="normal"><a href="#__codelineno-19-40">40</a></span>
<span class="normal"><a href="#__codelineno-19-41">41</a></span>
<span class="normal"><a href="#__codelineno-19-42">42</a></span>
<span class="normal"><a href="#__codelineno-19-43">43</a></span>
<span class="normal"><a href="#__codelineno-19-44">44</a></span>
<span class="normal"><a href="#__codelineno-19-45">45</a></span>
<span class="normal"><a href="#__codelineno-19-46">46</a></span>
<span class="normal"><a href="#__codelineno-19-47">47</a></span>
<span class="normal"><a href="#__codelineno-19-48">48</a></span>
<span class="normal"><a href="#__codelineno-19-49">49</a></span>
<span class="normal"><a href="#__codelineno-19-50">50</a></span>
<span class="normal"><a href="#__codelineno-19-51">51</a></span>
<span class="normal"><a href="#__codelineno-19-52">52</a></span>
<span class="normal"><a href="#__codelineno-19-53">53</a></span>
<span class="normal"><a href="#__codelineno-19-54">54</a></span>
<span class="normal"><a href="#__codelineno-19-55">55</a></span>
<span class="normal"><a href="#__codelineno-19-56">56</a></span>
<span class="normal"><a href="#__codelineno-19-57">57</a></span>
<span class="normal"><a href="#__codelineno-19-58">58</a></span>
<span class="normal"><a href="#__codelineno-19-59">59</a></span>
<span class="normal"><a href="#__codelineno-19-60">60</a></span>
<span class="normal"><a href="#__codelineno-19-61">61</a></span>
<span class="normal"><a href="#__codelineno-19-62">62</a></span>
<span class="normal"><a href="#__codelineno-19-63">63</a></span>
<span class="normal"><a href="#__codelineno-19-64">64</a></span>
<span class="normal"><a href="#__codelineno-19-65">65</a></span>
<span class="normal"><a href="#__codelineno-19-66">66</a></span>
<span class="normal"><a href="#__codelineno-19-67">67</a></span>
<span class="normal"><a href="#__codelineno-19-68">68</a></span>
<span class="normal"><a href="#__codelineno-19-69">69</a></span>
<span class="normal"><a href="#__codelineno-19-70">70</a></span>
<span class="normal"><a href="#__codelineno-19-71">71</a></span>
<span class="normal"><a href="#__codelineno-19-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1"># on attend un paramètre json ou xml</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="n">syntaxe</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> json / xml&quot;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="n">erreur</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>    <span class="n">session_type</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>    <span class="n">erreur</span> <span class="o">=</span> <span class="n">session_type</span> <span class="o">!=</span> <span class="s2">&quot;json&quot;</span> <span class="ow">and</span> <span class="n">session_type</span> <span class="o">!=</span> <span class="s2">&quot;xml&quot;</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="k">if</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;syntaxe : </span><span class="si">{</span><span class="n">syntaxe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">({</span><span class="s2">&quot;session_type&quot;</span><span class="p">:</span> <span class="n">session_type</span><span class="p">})</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="c1"># dépendances</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">Logger</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="c1"># code</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a>    <span class="c1"># logger</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;logsFilename&quot;</span><span class="p">])</span>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a>    <span class="c1"># on le mémorise dans la config</span>
<a id="__codelineno-19-28" name="__codelineno-19-28"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;logger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-19-29" name="__codelineno-19-29"></a>    <span class="c1"># log de début</span>
<a id="__codelineno-19-30" name="__codelineno-19-30"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;début du calcul de l&#39;impôt des contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-31" name="__codelineno-19-31"></a>    <span class="c1"># on récupère la factory de la couche [dao]</span>
<a id="__codelineno-19-32" name="__codelineno-19-32"></a>    <span class="n">dao_factory</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;layers&quot;</span><span class="p">][</span><span class="s2">&quot;dao_factory&quot;</span><span class="p">]</span>
<a id="__codelineno-19-33" name="__codelineno-19-33"></a>    <span class="c1"># on crée une instance de la couche [dao]</span>
<a id="__codelineno-19-34" name="__codelineno-19-34"></a>    <span class="n">dao</span> <span class="o">=</span> <span class="n">dao_factory</span><span class="o">.</span><span class="n">new_instance</span><span class="p">()</span>
<a id="__codelineno-19-35" name="__codelineno-19-35"></a>    <span class="c1"># lecture des données des contribuables</span>
<a id="__codelineno-19-36" name="__codelineno-19-36"></a>    <span class="n">taxpayers</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_taxpayers_data</span><span class="p">()[</span><span class="s2">&quot;taxpayers&quot;</span><span class="p">]</span>
<a id="__codelineno-19-37" name="__codelineno-19-37"></a>    <span class="c1"># des contribuables ?</span>
<a id="__codelineno-19-38" name="__codelineno-19-38"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">taxpayers</span><span class="p">:</span>
<a id="__codelineno-19-39" name="__codelineno-19-39"></a>        <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Pas de contribuables valides dans le fichier </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;taxpayersFilename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-40" name="__codelineno-19-40"></a>    <span class="c1"># calcul de l&#39;impôt des contribuables</span>
<a id="__codelineno-19-41" name="__codelineno-19-41"></a>    <span class="c1"># nombre de contribuables</span>
<a id="__codelineno-19-42" name="__codelineno-19-42"></a>    <span class="n">nb_taxpayers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">)</span>
<a id="__codelineno-19-43" name="__codelineno-19-43"></a>    <span class="c1"># log</span>
<a id="__codelineno-19-44" name="__codelineno-19-44"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;début du calcul de l&#39;impôt des </span><span class="si">{</span><span class="n">nb_taxpayers</span><span class="si">}</span><span class="s2"> contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-45" name="__codelineno-19-45"></a>    <span class="c1"># on initialise la session</span>
<a id="__codelineno-19-46" name="__codelineno-19-46"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">init_session</span><span class="p">(</span><span class="n">session_type</span><span class="p">)</span>
<a id="__codelineno-19-47" name="__codelineno-19-47"></a>    <span class="c1"># on s&#39;authentifie</span>
<a id="__codelineno-19-48" name="__codelineno-19-48"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;login&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
<a id="__codelineno-19-49" name="__codelineno-19-49"></a>    <span class="c1"># on calcule l&#39;impôt des contribuables</span>
<a id="__codelineno-19-50" name="__codelineno-19-50"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">calculate_tax_in_bulk_mode</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">)</span>
<a id="__codelineno-19-51" name="__codelineno-19-51"></a>    <span class="c1"># on demande la liste des simulations</span>
<a id="__codelineno-19-52" name="__codelineno-19-52"></a>    <span class="n">simulations</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_simulations</span><span class="p">()</span>
<a id="__codelineno-19-53" name="__codelineno-19-53"></a>    <span class="c1"># on en supprime une sur deux</span>
<a id="__codelineno-19-54" name="__codelineno-19-54"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">simulations</span><span class="p">)):</span>
<a id="__codelineno-19-55" name="__codelineno-19-55"></a>        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-19-56" name="__codelineno-19-56"></a>            <span class="c1"># on supprime la simulation</span>
<a id="__codelineno-19-57" name="__codelineno-19-57"></a>            <span class="n">dao</span><span class="o">.</span><span class="n">delete_simulation</span><span class="p">(</span><span class="n">simulations</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<a id="__codelineno-19-58" name="__codelineno-19-58"></a>    <span class="c1"># fin de session</span>
<a id="__codelineno-19-59" name="__codelineno-19-59"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">end_session</span><span class="p">()</span>
<a id="__codelineno-19-60" name="__codelineno-19-60"></a>    <span class="c1"># consultez les logs pour voir les différents résultats (mode debug=True)</span>
<a id="__codelineno-19-61" name="__codelineno-19-61"></a><span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-19-62" name="__codelineno-19-62"></a>    <span class="c1"># affichage de l&#39;erreur</span>
<a id="__codelineno-19-63" name="__codelineno-19-63"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-64" name="__codelineno-19-64"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-19-65" name="__codelineno-19-65"></a>    <span class="c1"># on ferme le logueur</span>
<a id="__codelineno-19-66" name="__codelineno-19-66"></a>    <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
<a id="__codelineno-19-67" name="__codelineno-19-67"></a>        <span class="c1"># log de fin</span>
<a id="__codelineno-19-68" name="__codelineno-19-68"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;fin du calcul de l&#39;impôt des contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-19-69" name="__codelineno-19-69"></a>        <span class="c1"># fermeture du logueur</span>
<a id="__codelineno-19-70" name="__codelineno-19-70"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-19-71" name="__codelineno-19-71"></a>    <span class="c1"># on a fini</span>
<a id="__codelineno-19-72" name="__codelineno-19-72"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Travail terminé...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 1-11 : on récupère le type de la session dans les paramètres du script ;</li>
<li>lignes 13-15 : on configure l’application ;</li>
<li>lignes 25-50 : on retrouve du code déjà expliqué à un moment ou à un autre ;</li>
<li>lignes 51-52 : on demande la liste des simulations faites dans la session courante ;</li>
<li>lignes 53-57 : on supprime une simulation sur deux ;</li>
<li>lignes 58-59 : on termine la session ;
Lors d’une session jSON, les logs sont les suivants :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.702297</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.702297</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 11 contribuables</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.734806</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;init-session&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">700</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;session démarrée avec le type de réponse json&quot;</span><span class="p">]}</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.747961</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;authentifier-utilisateur&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="s2">&quot;Authentification réussie&quot;</span><span class="p">}</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.765721</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;calculer-impots&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">55555</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">2814</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">720</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">16782</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7176</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">4230</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">}]}</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.785505</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;lister-simulations&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">2814</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">55555</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">720</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">16782</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7176</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">4230</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">}]}</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.801475</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;supprimer-simulation&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">720</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">16782</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7176</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">4230</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">}]}</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.810129</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;supprimer-simulation&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">16782</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7176</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">4230</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">}]}</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.818803</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;supprimer-simulation&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">4230</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">}]}</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.834604</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;supprimer-simulation&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">}]}</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.843803</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;supprimer-simulation&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">}]}</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.851855</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;supprimer-simulation&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">}]}</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.863165</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="s2">&quot;fin-session&quot;</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="s2">&quot;session réinitialisée&quot;</span><span class="p">}</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">03</span> <span class="mi">15</span><span class="p">:</span><span class="mi">01</span><span class="p">:</span><span class="mf">52.863165</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 6 : nous avons 11 simulations ;</li>
<li>ligne 12 : après les différentes suppressions, il n’y en a plus que 5 ;</li>
</ul>
<h2 id="317-la-classe-de-test-test2httpclientdaowithsession">31.7. La classe de test [Test2HttpClientDaoWithSession]</h2>
<p><img src="images/10000000000001F30000014473BE1068.png" style="width:5.762cm;height:3.74cm;" alt="Image" /></p>
<p>La classe <strong>[Test2HttpClientDaoWithSession]</strong> teste la couche <strong>[dao]</strong> des clients de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">  1</a></span>
<span class="normal"><a href="#__codelineno-21-2">  2</a></span>
<span class="normal"><a href="#__codelineno-21-3">  3</a></span>
<span class="normal"><a href="#__codelineno-21-4">  4</a></span>
<span class="normal"><a href="#__codelineno-21-5">  5</a></span>
<span class="normal"><a href="#__codelineno-21-6">  6</a></span>
<span class="normal"><a href="#__codelineno-21-7">  7</a></span>
<span class="normal"><a href="#__codelineno-21-8">  8</a></span>
<span class="normal"><a href="#__codelineno-21-9">  9</a></span>
<span class="normal"><a href="#__codelineno-21-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-21-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-21-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-21-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-21-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-21-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-21-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-21-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-21-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-21-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-21-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-21-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-21-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-21-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-21-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-21-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-21-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-21-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-21-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-21-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-21-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-21-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-21-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-21-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-21-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-21-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-21-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-21-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-21-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-21-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-21-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-21-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-21-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-21-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-21-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-21-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-21-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-21-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-21-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-21-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-21-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-21-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-21-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-21-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-21-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-21-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-21-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-21-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-21-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-21-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-21-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-21-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-21-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-21-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-21-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-21-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-21-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-21-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-21-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-21-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-21-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-21-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-21-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-21-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-21-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-21-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-21-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-21-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-21-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-21-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-21-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-21-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-21-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-21-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-21-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-21-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-21-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-21-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-21-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-21-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-21-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-21-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-21-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-21-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-21-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-21-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-21-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-21-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-21-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-21-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-21-100">100</a></span>
<span class="normal"><a href="#__codelineno-21-101">101</a></span>
<span class="normal"><a href="#__codelineno-21-102">102</a></span>
<span class="normal"><a href="#__codelineno-21-103">103</a></span>
<span class="normal"><a href="#__codelineno-21-104">104</a></span>
<span class="normal"><a href="#__codelineno-21-105">105</a></span>
<span class="normal"><a href="#__codelineno-21-106">106</a></span>
<span class="normal"><a href="#__codelineno-21-107">107</a></span>
<span class="normal"><a href="#__codelineno-21-108">108</a></span>
<span class="normal"><a href="#__codelineno-21-109">109</a></span>
<span class="normal"><a href="#__codelineno-21-110">110</a></span>
<span class="normal"><a href="#__codelineno-21-111">111</a></span>
<span class="normal"><a href="#__codelineno-21-112">112</a></span>
<span class="normal"><a href="#__codelineno-21-113">113</a></span>
<span class="normal"><a href="#__codelineno-21-114">114</a></span>
<span class="normal"><a href="#__codelineno-21-115">115</a></span>
<span class="normal"><a href="#__codelineno-21-116">116</a></span>
<span class="normal"><a href="#__codelineno-21-117">117</a></span>
<span class="normal"><a href="#__codelineno-21-118">118</a></span>
<span class="normal"><a href="#__codelineno-21-119">119</a></span>
<span class="normal"><a href="#__codelineno-21-120">120</a></span>
<span class="normal"><a href="#__codelineno-21-121">121</a></span>
<span class="normal"><a href="#__codelineno-21-122">122</a></span>
<span class="normal"><a href="#__codelineno-21-123">123</a></span>
<span class="normal"><a href="#__codelineno-21-124">124</a></span>
<span class="normal"><a href="#__codelineno-21-125">125</a></span>
<span class="normal"><a href="#__codelineno-21-126">126</a></span>
<span class="normal"><a href="#__codelineno-21-127">127</a></span>
<span class="normal"><a href="#__codelineno-21-128">128</a></span>
<span class="normal"><a href="#__codelineno-21-129">129</a></span>
<span class="normal"><a href="#__codelineno-21-130">130</a></span>
<span class="normal"><a href="#__codelineno-21-131">131</a></span>
<span class="normal"><a href="#__codelineno-21-132">132</a></span>
<span class="normal"><a href="#__codelineno-21-133">133</a></span>
<span class="normal"><a href="#__codelineno-21-134">134</a></span>
<span class="normal"><a href="#__codelineno-21-135">135</a></span>
<span class="normal"><a href="#__codelineno-21-136">136</a></span>
<span class="normal"><a href="#__codelineno-21-137">137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">Logger</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">Test2HttpClientDaoWithSession</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_init_session_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test_init_session_json&#39;</span><span class="p">)</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>        <span class="n">erreur</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a>            <span class="n">dao</span><span class="o">.</span><span class="n">init_session</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a>        <span class="k">except</span> <span class="n">ImpôtsError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a>        <span class="c1"># il ne doit oas y avoir d&#39;erreur</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">erreur</span><span class="p">)</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_init_session_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-21" name="__codelineno-21-21"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test_init_session_xml&#39;</span><span class="p">)</span>
<a id="__codelineno-21-22" name="__codelineno-21-22"></a>        <span class="n">erreur</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-21-23" name="__codelineno-21-23"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-21-24" name="__codelineno-21-24"></a>            <span class="n">dao</span><span class="o">.</span><span class="n">init_session</span><span class="p">(</span><span class="s1">&#39;xml&#39;</span><span class="p">)</span>
<a id="__codelineno-21-25" name="__codelineno-21-25"></a>        <span class="k">except</span> <span class="n">ImpôtsError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-21-26" name="__codelineno-21-26"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<a id="__codelineno-21-27" name="__codelineno-21-27"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-21-28" name="__codelineno-21-28"></a>        <span class="c1"># in ne doit pas y avoir d&#39;erreur</span>
<a id="__codelineno-21-29" name="__codelineno-21-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">erreur</span><span class="p">)</span>
<a id="__codelineno-21-30" name="__codelineno-21-30"></a>
<a id="__codelineno-21-31" name="__codelineno-21-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_init_session_xxx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-32" name="__codelineno-21-32"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test_init_session_xxx&#39;</span><span class="p">)</span>
<a id="__codelineno-21-33" name="__codelineno-21-33"></a>        <span class="n">erreur</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-21-34" name="__codelineno-21-34"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-21-35" name="__codelineno-21-35"></a>            <span class="n">dao</span><span class="o">.</span><span class="n">init_session</span><span class="p">(</span><span class="s1">&#39;xxx&#39;</span><span class="p">)</span>
<a id="__codelineno-21-36" name="__codelineno-21-36"></a>        <span class="k">except</span> <span class="n">ImpôtsError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-21-37" name="__codelineno-21-37"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<a id="__codelineno-21-38" name="__codelineno-21-38"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-21-39" name="__codelineno-21-39"></a>        <span class="c1"># il doit y avoir une erreur</span>
<a id="__codelineno-21-40" name="__codelineno-21-40"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">erreur</span><span class="p">)</span>
<a id="__codelineno-21-41" name="__codelineno-21-41"></a>
<a id="__codelineno-21-42" name="__codelineno-21-42"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_success</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-43" name="__codelineno-21-43"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test_authenticate_user_success&#39;</span><span class="p">)</span>
<a id="__codelineno-21-44" name="__codelineno-21-44"></a>        <span class="c1"># init session</span>
<a id="__codelineno-21-45" name="__codelineno-21-45"></a>        <span class="n">dao</span><span class="o">.</span><span class="n">init_session</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
<a id="__codelineno-21-46" name="__codelineno-21-46"></a>        <span class="c1"># test</span>
<a id="__codelineno-21-47" name="__codelineno-21-47"></a>        <span class="n">erreur</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-21-48" name="__codelineno-21-48"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-21-49" name="__codelineno-21-49"></a>            <span class="n">dao</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;login&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">][</span><span class="s1">&#39;user&#39;</span><span class="p">][</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
<a id="__codelineno-21-50" name="__codelineno-21-50"></a>        <span class="k">except</span> <span class="n">ImpôtsError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-21-51" name="__codelineno-21-51"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<a id="__codelineno-21-52" name="__codelineno-21-52"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-21-53" name="__codelineno-21-53"></a>        <span class="c1"># il ne doit pas y avoir d&#39;erreur</span>
<a id="__codelineno-21-54" name="__codelineno-21-54"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">erreur</span><span class="p">)</span>
<a id="__codelineno-21-55" name="__codelineno-21-55"></a>
<a id="__codelineno-21-56" name="__codelineno-21-56"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_authenticate_user_failed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-57" name="__codelineno-21-57"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test_authenticate_user_failed&#39;</span><span class="p">)</span>
<a id="__codelineno-21-58" name="__codelineno-21-58"></a>        <span class="c1"># init session</span>
<a id="__codelineno-21-59" name="__codelineno-21-59"></a>        <span class="n">dao</span><span class="o">.</span><span class="n">init_session</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
<a id="__codelineno-21-60" name="__codelineno-21-60"></a>        <span class="c1"># test</span>
<a id="__codelineno-21-61" name="__codelineno-21-61"></a>        <span class="n">erreur</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-21-62" name="__codelineno-21-62"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-21-63" name="__codelineno-21-63"></a>            <span class="n">dao</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
<a id="__codelineno-21-64" name="__codelineno-21-64"></a>        <span class="k">except</span> <span class="n">ImpôtsError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-21-65" name="__codelineno-21-65"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<a id="__codelineno-21-66" name="__codelineno-21-66"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-21-67" name="__codelineno-21-67"></a>        <span class="c1"># il doit y avoir une erreur</span>
<a id="__codelineno-21-68" name="__codelineno-21-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">erreur</span><span class="p">)</span>
<a id="__codelineno-21-69" name="__codelineno-21-69"></a>
<a id="__codelineno-21-70" name="__codelineno-21-70"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_get_simulations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-71" name="__codelineno-21-71"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test_get_simulations&#39;</span><span class="p">)</span>
<a id="__codelineno-21-72" name="__codelineno-21-72"></a>        <span class="c1"># init session</span>
<a id="__codelineno-21-73" name="__codelineno-21-73"></a>        <span class="n">dao</span><span class="o">.</span><span class="n">init_session</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
<a id="__codelineno-21-74" name="__codelineno-21-74"></a>        <span class="c1"># authentification</span>
<a id="__codelineno-21-75" name="__codelineno-21-75"></a>        <span class="n">dao</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span>
<a id="__codelineno-21-76" name="__codelineno-21-76"></a>        <span class="c1"># calcul impôt</span>
<a id="__codelineno-21-77" name="__codelineno-21-77"></a>        <span class="c1"># {&#39;marié&#39;: &#39;oui&#39;, &#39;enfants&#39;: 2, &#39;salaire&#39;: 55555,</span>
<a id="__codelineno-21-78" name="__codelineno-21-78"></a>        <span class="c1"># &#39;impôt&#39;: 2814, &#39;surcôte&#39;: 0, &#39;décôte&#39;: 0, &#39;réduction&#39;: 0, &#39;taux&#39;: 0.14}</span>
<a id="__codelineno-21-79" name="__codelineno-21-79"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">55555</span><span class="p">})</span>
<a id="__codelineno-21-80" name="__codelineno-21-80"></a>        <span class="n">dao</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">)</span>
<a id="__codelineno-21-81" name="__codelineno-21-81"></a>        <span class="c1"># get_simulations</span>
<a id="__codelineno-21-82" name="__codelineno-21-82"></a>        <span class="n">simulations</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_simulations</span><span class="p">()</span>
<a id="__codelineno-21-83" name="__codelineno-21-83"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-21-84" name="__codelineno-21-84"></a>        <span class="c1"># il doit y avoir 1 simulation</span>
<a id="__codelineno-21-85" name="__codelineno-21-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">simulations</span><span class="p">))</span>
<a id="__codelineno-21-86" name="__codelineno-21-86"></a>        <span class="n">simulation</span> <span class="o">=</span> <span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-21-87" name="__codelineno-21-87"></a>        <span class="c1"># vérification de l&#39;impôt calculé</span>
<a id="__codelineno-21-88" name="__codelineno-21-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">simulation</span><span class="p">[</span><span class="s1">&#39;impôt&#39;</span><span class="p">],</span> <span class="mi">2815</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-21-89" name="__codelineno-21-89"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">simulation</span><span class="p">[</span><span class="s1">&#39;décôte&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-21-90" name="__codelineno-21-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">simulation</span><span class="p">[</span><span class="s1">&#39;réduction&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-21-91" name="__codelineno-21-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">simulation</span><span class="p">[</span><span class="s1">&#39;taux&#39;</span><span class="p">],</span> <span class="mf">0.14</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-21-92" name="__codelineno-21-92"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">simulation</span><span class="p">[</span><span class="s1">&#39;surcôte&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-21-93" name="__codelineno-21-93"></a>
<a id="__codelineno-21-94" name="__codelineno-21-94"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_delete_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-21-95" name="__codelineno-21-95"></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test_delete_simulation&#39;</span><span class="p">)</span>
<a id="__codelineno-21-96" name="__codelineno-21-96"></a>        <span class="c1"># init session</span>
<a id="__codelineno-21-97" name="__codelineno-21-97"></a>        <span class="n">dao</span><span class="o">.</span><span class="n">init_session</span><span class="p">(</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
<a id="__codelineno-21-98" name="__codelineno-21-98"></a>        <span class="c1"># authentification</span>
<a id="__codelineno-21-99" name="__codelineno-21-99"></a>        <span class="n">dao</span><span class="o">.</span><span class="n">authenticate_user</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span>
<a id="__codelineno-21-100" name="__codelineno-21-100"></a>        <span class="c1"># calcul impôt</span>
<a id="__codelineno-21-101" name="__codelineno-21-101"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">55555</span><span class="p">})</span>
<a id="__codelineno-21-102" name="__codelineno-21-102"></a>        <span class="n">dao</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">)</span>
<a id="__codelineno-21-103" name="__codelineno-21-103"></a>        <span class="c1"># get_simulations</span>
<a id="__codelineno-21-104" name="__codelineno-21-104"></a>        <span class="n">simulations</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_simulations</span><span class="p">()</span>
<a id="__codelineno-21-105" name="__codelineno-21-105"></a>        <span class="c1"># delete_simulation</span>
<a id="__codelineno-21-106" name="__codelineno-21-106"></a>        <span class="n">dao</span><span class="o">.</span><span class="n">delete_simulation</span><span class="p">(</span><span class="n">simulations</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<a id="__codelineno-21-107" name="__codelineno-21-107"></a>        <span class="c1"># get_simulations</span>
<a id="__codelineno-21-108" name="__codelineno-21-108"></a>        <span class="n">simulations</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_simulations</span><span class="p">()</span>
<a id="__codelineno-21-109" name="__codelineno-21-109"></a>        <span class="c1"># vérification - il ne doit plus y avoir de simulations</span>
<a id="__codelineno-21-110" name="__codelineno-21-110"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">simulations</span><span class="p">))</span>
<a id="__codelineno-21-111" name="__codelineno-21-111"></a>        <span class="c1"># on supprime une simulation qui n&#39;existe pas</span>
<a id="__codelineno-21-112" name="__codelineno-21-112"></a>        <span class="n">erreur</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-21-113" name="__codelineno-21-113"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-21-114" name="__codelineno-21-114"></a>            <span class="n">dao</span><span class="o">.</span><span class="n">delete_simulation</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-21-115" name="__codelineno-21-115"></a>        <span class="k">except</span> <span class="n">ImpôtsError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-21-116" name="__codelineno-21-116"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<a id="__codelineno-21-117" name="__codelineno-21-117"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-21-118" name="__codelineno-21-118"></a>        <span class="c1"># il doit y avoir une erreur</span>
<a id="__codelineno-21-119" name="__codelineno-21-119"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">erreur</span><span class="p">)</span>
<a id="__codelineno-21-120" name="__codelineno-21-120"></a>
<a id="__codelineno-21-121" name="__codelineno-21-121"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-21-122" name="__codelineno-21-122"></a>    <span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-21-123" name="__codelineno-21-123"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-21-124" name="__codelineno-21-124"></a>    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">({})</span>
<a id="__codelineno-21-125" name="__codelineno-21-125"></a>
<a id="__codelineno-21-126" name="__codelineno-21-126"></a>    <span class="c1"># logger</span>
<a id="__codelineno-21-127" name="__codelineno-21-127"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;logsFilename&quot;</span><span class="p">])</span>
<a id="__codelineno-21-128" name="__codelineno-21-128"></a>    <span class="c1"># on le mémorise dans la config</span>
<a id="__codelineno-21-129" name="__codelineno-21-129"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;logger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-21-130" name="__codelineno-21-130"></a>
<a id="__codelineno-21-131" name="__codelineno-21-131"></a>    <span class="c1"># couche [dao]</span>
<a id="__codelineno-21-132" name="__codelineno-21-132"></a>    <span class="n">dao_factory</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">][</span><span class="s1">&#39;dao_factory&#39;</span><span class="p">]</span>
<a id="__codelineno-21-133" name="__codelineno-21-133"></a>    <span class="n">dao</span> <span class="o">=</span> <span class="n">dao_factory</span><span class="o">.</span><span class="n">new_instance</span><span class="p">()</span>
<a id="__codelineno-21-134" name="__codelineno-21-134"></a>
<a id="__codelineno-21-135" name="__codelineno-21-135"></a>    <span class="c1"># on exécute les méthodes de test</span>
<a id="__codelineno-21-136" name="__codelineno-21-136"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;tests en cours...&quot;</span><span class="p">)</span>
<a id="__codelineno-21-137" name="__codelineno-21-137"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>la couche <strong>[dao]</strong> envoie une requête au serveur, réceptionne sa réponse et la met en forme pour la rendre au code appelant. Lorsque le serveur envoie un réponse avec un code de statut différent de 200, la couche <strong>[dao]</strong> lance une exception. Aussi un certain nombre de tests consiste à savoir s’il y a eu exception ou pas ;</li>
<li>lignes 9-18 : on initialise une session jSON. On ne doit pas avoir d’erreur ;</li>
<li>lignes 20-29 : on initialise une session XML. On ne doit pas avoir d’erreur ;</li>
<li>lignes 31-40 : on initialise une session avec un type incorrect. on doit avoir une erreur ;</li>
<li>lignes 42-54 : on s’authentifie avec les bons identifiants. On ne doit pas avoir d’erreur ;</li>
<li>lignes 56-68 : on s’authentifie avec des identifiants incorrects. On doit avoir une erreur ;</li>
<li>lignes 70-92 : on fait un calcul d’impôt puis on demande la liste des simulations. On doit en avoir une. Par ailleurs on verifie que cette simulation contient bien l’impôt demandé ;</li>
<li>lignes 94-119 : on fait une simulation qu’on supprime ensuite. Puis on essaie ensuite de supprimer une simulation alors qu’il n’y en a plus. On doit avoir une erreur ;</li>
<li>lignes 121-137 : le test est lancé comme un script console classique ;</li>
<li>lignes 122-124 : on configure l’application ;</li>
<li>lignes 126-129 : on configure le logger. Cela nous permettra de suivre les logs ;</li>
<li>lignes 131-133 : on instancie la couche <strong>[dao]</strong> qui va être testée ;</li>
<li>lignes 135-137 : on lance les tests ;
Les résultats console sont les suivants :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">impots</span><span class="o">/</span><span class="n">http</span><span class="o">-</span><span class="n">clients</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">Test2HttpClientDaoWithSession</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="n">tests</span> <span class="n">en</span> <span class="n">cours</span><span class="o">...</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="n">test_authenticate_user_failed</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="o">..</span><span class="n">MyException</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Echec de l&#39;authentification&quot;</span><span class="p">]]</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="n">test_authenticate_user_success</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="n">test_delete_simulation</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="n">MyException</span><span class="p">[</span><span class="mi">35</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;la simulation n° [100] n&#39;existe pas&quot;</span><span class="p">]]</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="n">test_get_simulations</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="n">test_init_session_json</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="n">test_init_session_xml</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="n">test_init_session_xxx</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="n">MyException</span><span class="p">[</span><span class="mi">73</span><span class="p">,</span> <span class="n">il</span> <span class="n">n</span><span class="s1">&#39;y a pas de session valide en cours]</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="o">----------------------------------------------------------------------</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="n">Ran</span> <span class="mi">7</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">0.171</span><span class="n">s</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a><span class="n">OK</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>