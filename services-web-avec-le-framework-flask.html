
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Python 3 et au framework web Flask par l'exemple">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-flask-sept-2020/services-web-avec-le-framework-flask.html">
      
      
        <link rel="prev" href="fonctions-internet.html">
      
      
        <link rel="next" href="exercice-dapplication-version-6.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>22. Services web avec le framework Flask - Introduction au langage Python 3 et au framework web Flask par l'exemple</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#22-services-web-avec-le-framework-flask" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-header__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Python 3 et au framework web Flask par l'exemple
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              22. Services web avec le framework Flask
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-nav__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Python 3 et au framework web Flask par l'exemple
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="avant-propos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Avant-propos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dx27un-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Installation d&#x27;un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-bases-de-python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Les bases de Python
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-chaines-de-caracteres.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Les chaînes de caractères
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-exceptions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Les exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fonctions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Les fonctions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fichiers-texte.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Les fichiers texte
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Exercice d&#x27;application – version 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-imports.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Les imports
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Exercice d’application : version 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Exercice d’application : version 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-et-objets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. Les classes et objets
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-generiques-baseentity-et-myexception.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. Les classes génériques [BaseEntity] et [MyException]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture-en-couches-et-programmation-par-interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. Architecture en couches et programmation par interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. Exercice d&#x27;application - version 4
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-mysql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. Utilisation du SGBD MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-postgresql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. Utilisation du SGBD PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="ecrire-du-code-independant-du-sgbd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. Ecrire du code indépendant du SGBD
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-de-lorm-sqlalchemy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. Utilisation de l’ORM SQLALCHEMY
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application-version-5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Exercice d&#x27;application : version 5
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="fonctions-internet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Fonctions internet
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    22. Services web avec le framework Flask
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="services-web-avec-le-framework-flask.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Services web avec le framework Flask
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#221-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.1. Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#222-scripts-flask01-premiers-elements-de-programmation-web" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.2. scripts [flask/01] : premiers éléments de programmation web
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.2. scripts [flask/01] : premiers éléments de programmation web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2221-script-exemple_01-rudiments-du-langage-html" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.2.1. script [exemple_01] : rudiments du langage HTML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2222-script-exemple_02-generer-un-document-html-dynamiquement" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.2.2. script [exemple_02] : générer un document HTML dynamiquement
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2223-script-exemple_03-utiliser-des-fragments-de-page" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.2.3. script [exemple_03] : utiliser des fragments de page
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#223-scripts-flask02-service-web-de-date-et-heure" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.3. scripts [flask/02] : service web de date et heure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#224-scripts-flask03-services-web-generant-du-texte-brut" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4. scripts [flask/03] : services web générant du texte brut
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.4. scripts [flask/03] : services web générant du texte brut">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2241-script-main_01" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4.1. script [main_01]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2242-postman" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4.2. Postman
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2243-script-main_02" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4.3. script [main_02]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2244-script-main_03" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.4.4. script [main_03]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#225-scripts-flask04-informations-encapsulees-dans-la-requete" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.5. scripts [flask/04] : informations encapsulées dans la requête
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#226-scripts-flask-05-gestion-de-la-memoire-de-lutilisateur" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.6. scripts [flask-05] : gestion de la mémoire de l’utilisateur
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.6. scripts [flask-05] : gestion de la mémoire de l’utilisateur">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2261-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.6.1. Introduction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2262-script-session_scope_01" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.6.2. script [session_scope_01]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2263-script-session_scope_02" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.6.3. script [session_scope_02]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2264-script-session_scope_03" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.6.4. script [session_scope_03]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#227-scripts-flask06-informations-partagees-par-tous-les-utilisateurs" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.7. scripts [flask/06] : informations partagées par tous les utilisateurs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.7. scripts [flask/06] : informations partagées par tous les utilisateurs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2271-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.7.1. Introduction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2272-script-application_scope_01" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.7.2. script [application_scope_01]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2273-script-application_scope_02" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.7.3. script [application_scope_02]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2274-script-application_scope_03" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.7.4. script [application_scope_03]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#228-scripts-flask07-gestion-des-routes" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.8. scripts [flask/07] : gestion des routes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="22.8. scripts [flask/07] : gestion des routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2281-script-main_01-routes-parametrees" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.8.1. script [main_01] : routes paramétrées
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2282-script-main_02-externalisation-des-routes" class="md-nav__link">
    <span class="md-ellipsis">
      
        22.8.2. script [main_02] : externalisation des routes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23. Exercice d’application : version 6
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24. Exercice d’application : version 7
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25. Exercice d’application : version 8
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="du-dictionnaire-a-xml-et-vice-versa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26. Du dictionnaire à XML et vice-versa
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-9.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27. Exercice d’application : version 9
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-10.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28. Exercice d’application : version 10
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-11.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    29. Exercice d’application : version 11
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30. Exercice d’application : version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="clients-web-pour-les-services-json-et-xml-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    31. Clients web pour les services jSON et XML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="le-mode-html-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    32. Le mode HTML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-13.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    33. Exercice d’application : version 13
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-14.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    34. Exercice d’application : version 14
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-15.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    35. Exercice d’application : version 15
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-16.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    36. Exercice d’application : version 16
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-17.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    37. Exercice d’application : version 17
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-18.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    38. Exercice d’application : version 18
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    39. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="22-services-web-avec-le-framework-flask">22. Services web avec le framework Flask</h1>
<p>Par service web, on entend ici tout application web délivrant des données brutes consommées par un client, souvent un script console dans les exemples qui vont suivre. On ne s’intéresse pas à une technologie particulière, REST (<strong>RE</strong>presentational <strong>S</strong>tate <strong>T</strong>ransfer) ou SOAP (<strong>S</strong>imple <strong>O</strong>bject <strong>A</strong>ccess <strong>P</strong>rotocol) par exemple, qui délivrent des données plus ou moins brutes dans un format bien défini. REST délivre du jSON alors que pour SOAP c’est du XML. Chacune de ces technologies décrit précisément la façon dont le client doit interroger le serveur et la forme que doit prendre la réponse de celui-ci. Dans ce cours, on sera beaucoup plus souple quant à la nature de la requête du client et celle de la réponse du serveur. Cependant, les scripts écrits et les outils utilisés sont proches de ceux de la technologie REST.</p>
<h2 id="221-introduction">22.1. Introduction</h2>
<p>Les scripts Python peuvent être exécutés par un serveur Web. Un tel script devient un programme serveur pouvant servir plusieurs clients. Du point de vue du client, appeler un service web revient à demander l&#x27;URL de ce service. Le client peut être écrit avec n&#x27;importe quel langage, notamment en Python. Dans ce dernier cas, on utilise alors les fonctions internet que nous venons de voir. Il nous faut par ailleurs savoir &quot;converser&quot; avec un service web, c&#x27;est à dire comprendre le protocole HTTP de communication entre un serveur Web et ses clients. C&#x27;était le but du paragraphe |<a href="#_Le_protocole_HTTP"><u><u>le protocole HTTP</u></u></a>|. Les clients web décrits dans cette partie du cours nous ont permis de découvrir une partie du protocole HTTP.</p>
<p><img src="images/10000000000004C0000000D8D0B12F00.png" style="width:14.011cm;height:2.5cm;" alt="Image" /></p>
<p>Dans leur version la plus simple, les échanges client / serveur sont les suivants :</p>
<ul>
<li>le client ouvre une connexion avec le port 80 du serveur web ;</li>
<li>il fait une requête concernant un document ;</li>
<li>le serveur web envoie le document demandé et ferme la connexion ;</li>
<li>le client ferme à son tour la connexion ;
Le document peut être de nature diverse : un texte au format HTML, une image, une vidéo, ... Ce peut être un document existant (document statique) ou bien un document généré à la volée par un script (document dynamique). Dans ce dernier cas, on parle de programmation web. Le script de génération dynamique de documents peut être écrit dans divers langages : PHP, Python, Perl, Java, Ruby, C#, VB.net, ...</li>
</ul>
<p>Dans la suite, nous allons utiliser des scripts Python pour générer dynamiquement des documents texte.</p>
<p><img src="images/1000000000000515000000F4B94EC5A2.png" style="width:15.011cm;height:2.821cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, le client ouvre une connexion avec le serveur, demande un script Python, envoie ou non des paramètres à destination de ce script ;</li>
<li>en <strong>[3]</strong>, le serveur web fait exécuter le script Python par l&#x27;interpréteur Python. Le script génère un document qui est envoyé au client <strong>[2]</strong><strong> ;</strong></li>
<li>le serveur clôt la connexion. Le client en fait autant ;
Le serveur web peut traiter plusieurs clients à la fois.</li>
</ul>
<p>Dans la suite, nous utiliserons deux serveurs web :</p>
<ul>
<li>le serveur léger <strong>Werkzeug</strong> [<a href="https://werkzeug.palletsprojects.com/en/1.0.x/"><u><u>https://werkzeug.palletsprojects.com/en/1.0.x/</u></u></a>]. Ce serveur est utilisé par le framework web Flask [<a href="https://flask.palletsprojects.com/en/1.1.x/"><u><u>https://flask.palletsprojects.com/en/1.1.x/</u></u></a>]. Nous l’appellerons plus fréquemment serveur <strong>Flask</strong> ;</li>
<li>le serveur Apache 2 [<a href="https://httpd.apache.org/"><u><u>https://httpd.apache.org/</u></u></a>] ;
Le serveur Flask sera utilisé dans la totalité des exemples. Le serveur Apache sera utilisé pour héberger l’application web que nous allons développer.</li>
</ul>
<p>Le framework Flask est développé en Python. C’est un module qu’on installe dans un terminal PyCharm :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">pip</span> <span class="n">install</span> <span class="n">flask</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="n">Collecting</span> <span class="n">flask</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>  <span class="n">Downloading</span> <span class="n">Flask</span><span class="o">-</span><span class="mf">1.1.2</span><span class="o">-</span><span class="n">py2</span><span class="o">.</span><span class="n">py3</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="nb">any</span><span class="o">.</span><span class="n">whl</span> <span class="p">(</span><span class="mi">94</span> <span class="n">kB</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>     <span class="o">||</span> <span class="mi">94</span> <span class="n">kB</span> <span class="mf">1.1</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="n">Collecting</span> <span class="n">click</span><span class="o">&gt;=</span><span class="mf">5.1</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>  <span class="n">Downloading</span> <span class="n">click</span><span class="o">-</span><span class="mf">7.1.2</span><span class="o">-</span><span class="n">py2</span><span class="o">.</span><span class="n">py3</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="nb">any</span><span class="o">.</span><span class="n">whl</span> <span class="p">(</span><span class="mi">82</span> <span class="n">kB</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>     <span class="o">||</span> <span class="mi">82</span> <span class="n">kB</span> <span class="mf">5.8</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="n">Collecting</span> <span class="n">itsdangerous</span><span class="o">&gt;=</span><span class="mf">0.24</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>  <span class="n">Downloading</span> <span class="n">itsdangerous</span><span class="o">-</span><span class="mf">1.1.0</span><span class="o">-</span><span class="n">py2</span><span class="o">.</span><span class="n">py3</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="nb">any</span><span class="o">.</span><span class="n">whl</span> <span class="p">(</span><span class="mi">16</span> <span class="n">kB</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="n">Collecting</span> <span class="n">Jinja2</span><span class="o">&gt;=</span><span class="mf">2.10.1</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>  <span class="n">Downloading</span> <span class="n">Jinja2</span><span class="o">-</span><span class="mf">2.11.2</span><span class="o">-</span><span class="n">py2</span><span class="o">.</span><span class="n">py3</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="nb">any</span><span class="o">.</span><span class="n">whl</span> <span class="p">(</span><span class="mi">125</span> <span class="n">kB</span><span class="p">)</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>     <span class="o">||</span> <span class="mi">125</span> <span class="n">kB</span> <span class="mf">6.4</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="n">Collecting</span> <span class="n">Werkzeug</span><span class="o">&gt;=</span><span class="mf">0.15</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>  <span class="n">Downloading</span> <span class="n">Werkzeug</span><span class="o">-</span><span class="mf">1.0.1</span><span class="o">-</span><span class="n">py2</span><span class="o">.</span><span class="n">py3</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="nb">any</span><span class="o">.</span><span class="n">whl</span> <span class="p">(</span><span class="mi">298</span> <span class="n">kB</span><span class="p">)</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>     <span class="o">||</span> <span class="mi">298</span> <span class="n">kB</span> <span class="mf">6.4</span> <span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="n">Collecting</span> <span class="n">MarkupSafe</span><span class="o">&gt;=</span><span class="mf">0.23</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>  <span class="n">Downloading</span> <span class="n">MarkupSafe</span><span class="o">-</span><span class="mf">1.1.1</span><span class="o">-</span><span class="n">cp38</span><span class="o">-</span><span class="n">cp38</span><span class="o">-</span><span class="n">win_amd64</span><span class="o">.</span><span class="n">whl</span> <span class="p">(</span><span class="mi">16</span> <span class="n">kB</span><span class="p">)</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="n">Installing</span> <span class="n">collected</span> <span class="n">packages</span><span class="p">:</span> <span class="n">click</span><span class="p">,</span> <span class="n">itsdangerous</span><span class="p">,</span> <span class="n">MarkupSafe</span><span class="p">,</span> <span class="n">Jinja2</span><span class="p">,</span> <span class="n">Werkzeug</span><span class="p">,</span> <span class="n">flask</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="n">Successfully</span> <span class="n">installed</span> <span class="n">Jinja2</span><span class="o">-</span><span class="mf">2.11.2</span> <span class="n">MarkupSafe</span><span class="o">-</span><span class="mf">1.1.1</span> <span class="n">Werkzeug</span><span class="o">-</span><span class="mf">1.0.1</span> <span class="n">click</span><span class="o">-</span><span class="mf">7.1.2</span> <span class="n">flask</span><span class="o">-</span><span class="mf">1.1.2</span> <span class="n">itsdangerous</span><span class="o">-</span><span class="mf">1.1.0</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : la commande exécutée ;</li>
<li>ligne 19 : les éléments qui ont été installés :</li>
<li><strong>[</strong><strong>flask-1.1.2</strong><strong>]</strong> : est un framework de développement web en Python ;</li>
<li><strong>[</strong><strong>Werkzeug-1.0.1</strong><strong>]</strong> : est le serveur web qui va répondre aux demandes des clients ;</li>
<li><strong>[</strong><strong>Jinja2-2.11.2</strong><strong>]</strong> : est un outil permetant d’insérer des éléments dynamiques dans des pages qui seraient autrement des pages statiques ;</li>
</ul>
<h2 id="222-scripts-flask01-premiers-elements-de-programmation-web">22.2. scripts [flask/01] : premiers éléments de programmation web</h2>
<p><img src="images/10000000000001BA0000029951F70989.png" style="width:4.601cm;height:6.921cm;" alt="Image" /></p>
<p>Nos exemples seront exécutés dans l’architecture suivante :</p>
<p><img src="images/10000000000003CE00000164CCB42750.png" style="width:11.261cm;height:4.111cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, un script Python sera exécuté comme l’est un script console classique ;</li>
<li>en <strong>[2]</strong>, de façon transparente, un serveur web est instancié et attend des requêtes. En fait il n’acceptera qu’une unique URL ;</li>
<li>en <strong>[3]</strong>, le navigateur demandera au serveur son unique URL ;</li>
<li>en <strong>[4]</strong>, le serveur fera exécuter le script Python désigné par la console <strong>[1]</strong> ;</li>
<li>en <strong>[5]</strong>, le script rendra ses résultats au serveur web, un document texte ;</li>
<li>en <strong>[6]</strong>, le serveur web enverra au navigateur ce document texte ;</li>
</ul>
<h3 id="2221-script-exemple_01-rudiments-du-langage-html">22.2.1. script [exemple_01] : rudiments du langage HTML</h3>
<p>Un navigateur web peut afficher divers documents, le plus courant étant le document HTML (HyperText Markup Language). Celui-ci est un texte formaté avec des balises de la forme &lt;balise&gt;texte&lt;/balise&gt;. Ainsi le texte &lt;b&gt;important&lt;/b&gt; affichera le texte <strong>important</strong> en gras. Il existe des balises seules, telles que la balise &lt;hr/&gt; qui affiche une ligne horizontale. Nous ne passerons pas en revue les balises que l&#x27;on peut trouver dans un texte HTML. Il existe de nombreux logiciels WYSIWYG permettant de construire une page WEB sans écrire une ligne de code HTML. Ces outils génèrent automatiquement le code HTML d&#x27;une mise en page faite à l&#x27;aide de la souris et de contrôles prédéfinis. On peut ainsi insérer (avec la souris) dans la page un tableau puis consulter le code HTML généré par le logiciel pour découvrir les balises à utiliser pour définir un tableau dans une page WEB. Ce n&#x27;est pas plus compliqué que cela. Par ailleurs, la connaissance du langage HTML est indispensable puisque les applications web dynamiques doivent générer elles-mêmes le code HTML à envoyer aux clients web. Ce code est généré par programme et il faut bien sûr savoir ce qu&#x27;il faut générer pour que le client ait la page web qu&#x27;il désire.</p>
<p>Pour résumer, il n&#x27;est nul besoin de connaître la totalité du langage HTML pour démarrer la programmation web. Cependant cette connaissance est nécessaire et peut être acquise au travers de l&#x27;utilisation de logiciels WYSIWYG de construction de pages WEB tels que DreamWeaver et des dizaines d&#x27;autres. Une autre façon de découvrir les subtilités du langage HTML est de parcourir le web et d&#x27;afficher le code source des pages qui présentent des caractéristiques intéressantes et encore inconnues pour vous.</p>
<p>Considérons l&#x27;exemple suivant qui présente quelques éléments qu&#x27;on peut trouver dans un document web tels que :</p>
<ul>
<li>un tableau ;</li>
<li>une image ;</li>
<li>un lien ;</li>
</ul>
<p><img src="images/100000000000033D00000324D3468915.png" style="width:9.561cm;height:9.27cm;" alt="Image" /></p>
<p>Un document HTML est encadré par les balises <strong>&lt;html&gt;…&lt;/html&gt;</strong>. Il est formé de deux parties :</p>
<ul>
<li><strong>&lt;head&gt;…&lt;/head&gt;</strong> : c&#x27;est la partie non affichable du document. Elle donne des renseignements au navigateur qui va afficher le document. On y trouve souvent la balise <strong>&lt;title&gt;…&lt;/title&gt;</strong> qui fixe le texte qui sera affiché dans la barre de titre du navigateur. On peut y trouver d&#x27;autres balises notamment des balises définissant les mots clés du document, mot clés utilisés ensuite par les moteurs de recherche. On peut trouver également dans cette partie des scripts, écrits le plus souvent en javascript ou vbscript et qui seront exécutés par le navigateur ;</li>
<li><strong>&lt;body attributs&gt;…&lt;/body&gt;</strong> : c&#x27;est la partie qui sera affichée par le navigateur. Les balises HTML contenues dans cette partie indiquent au navigateur la forme visuelle &quot;souhaitée&quot; pour le document. Chaque navigateur va interpréter ces balises à sa façon. Deux navigateurs peuvent alors visualiser différemment un même document web. C&#x27;est généralement l&#x27;un des casse-têtes des concepteurs web ;
Le code HTML de notre document exemple est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">xmlns</span><span class="o">=</span><span class="s2">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>  <span class="o">&lt;</span><span class="n">meta</span> <span class="n">http</span><span class="o">-</span><span class="n">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=utf-8&quot;</span> <span class="o">/&gt;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>  <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Quelques</span> <span class="n">balises</span> <span class="n">HTML</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="o">&lt;</span><span class="n">body</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;background-image: url(/static/images/standard.jpg)&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>  <span class="o">&lt;</span><span class="n">h1</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;text-align: left&quot;</span><span class="o">&gt;</span><span class="n">Quelques</span> <span class="n">balises</span> <span class="n">HTML</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>  <span class="o">&lt;</span><span class="n">hr</span> <span class="o">/&gt;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>  <span class="o">&lt;</span><span class="n">table</span> <span class="n">border</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a>    <span class="o">&lt;</span><span class="n">thead</span><span class="o">&gt;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>      <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>        <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Colonne</span> <span class="mi">1</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>        <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Colonne</span> <span class="mi">2</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>        <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Colonne</span> <span class="mi">3</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>      <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>    <span class="o">&lt;/</span><span class="n">thead</span><span class="o">&gt;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>    <span class="o">&lt;</span><span class="n">tbody</span><span class="o">&gt;</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a>      <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">cellule</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>        <span class="o">&lt;</span><span class="n">td</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;text-align: center;&quot;</span><span class="o">&gt;</span><span class="n">cellule</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">cellule</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a>      <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>      <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">cellule</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">cellule</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">cellule</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a>      <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a>    <span class="o">&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a>  <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a>  <span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a>  <span class="o">&lt;</span><span class="n">table</span> <span class="n">border</span><span class="o">=</span><span class="s2">&quot;0&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a>    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a>      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Une</span> <span class="n">image</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a>      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a>        <span class="o">&lt;</span><span class="n">img</span> <span class="n">border</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;/static/images/cerisier.jpg&quot;</span> <span class="o">/&gt;</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>      <span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a>    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a>    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a>      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="n">Le</span> <span class="n">site</span> <span class="n">de</span> <span class="n">Polytech</span><span class="s1">&#39;Angers&lt;/td&gt;</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a>      <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;http://www.polytech-angers.fr/fr/index.html&quot;</span><span class="o">&gt;</span><span class="n">ici</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a>    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a>  <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><u><b>Elément</b></u></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><u><b>balises et exemples HTML</b></u></p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">titre</span> <span class="n">du</span> <span class="n">document</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">&lt;title&gt;Quelques balises HTML&lt;/title&gt; (ligne 5)</p><p style="margin:0;">le texte <b>[Quelques balises HTML]</b> apparaîtra dans la barre de titre du navigateur qui affichera le document</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">barre</span> <span class="n">horizontale</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">&lt;hr /&gt; : affiche un trait horizontal (ligne 10)</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">tableau</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">&lt;table attributs&gt;….&lt;/table&gt; : pour définir le tableau (lignes 12, 32)</p><p style="margin:0;">&lt;thead&gt;…&lt;/thead&gt; : pour définir les entêtes des colonnes (lignes 13, 19)</p><p style="margin:0;">&lt;tbody&gt;…&lt;/tbody&gt; : pour définir le contenu du tableau (ligne 20, 31)</p><p style="margin:0;">&lt;tr attributs&gt;…&lt;/tr&gt; : pour définir une ligne (lignes 21, 25)</p><p style="margin:0;">&lt;td attributs&gt;…&lt;/td&gt; : pour définir une cellule (ligne 22)</p><p style="margin:0;"><b>exemples</b> :</p><p style="margin:0;">&lt;table border=&quot;1&quot;&gt;…&lt;/table&gt; : l&#x27;attribut border définit l&#x27;épaisseur de la bordure du tableau</p><p style="margin:0;">&lt;td style=&quot;text-align: center;&quot;&gt;cellule(1,2)&lt;/td&gt; (ligne 23) : définit une cellule dont le contenu sera <b>cellule(1,2)</b>. Ce contenu sera centré horizontalement (text-align: center).</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">image</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">&lt;img border=&quot;0&quot; src=&quot;/static/images/cerisier.jpg&quot;/&gt; (ligne 38) : définit une image sans bordure (border=0&quot;) dont le fichier source est <b>[/static/images/cerisier.jpg]</b> sur le serveur web (src=&quot;/static/images/cerisier.jpg&quot;). Si ce lien se trouve sur un document web obtenu avec l&#x27;URL <b>[</b><b>http://server/chemin/balises.html</b><b>]</b>, alors le navigateur demandera l&#x27;URL <b>[</b><b>http://server/ static/images/cerisier.jpg</b><b>]</b> pour avoir l&#x27;image référencée ici.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="n">lien</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">&lt;a href=&quot;http://www.polytech-angers.fr/fr/index.html&quot;&gt;ici&lt;/a&gt; (ligne 43) : fait que le texte ici sert de lien vers l&#x27;URL http://www.polytech-angers.fr/fr/index.html.</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><div markdown="block">
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">fond</span> <span class="n">de</span> <span class="n">page</span>
</code></pre></div></td></tr></table></div>
</div></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">&lt;body style=&quot;background-image: url(/static/images/standard.jpg)&quot;&gt; (ligne 8) : indique que l&#x27;image qui doit servir de fond de page se trouve à l&#x27;URL <b>[/static/images/standard.jpg]</b> du serveur web. Dans le contexte de notre exemple, le navigateur demandera l&#x27;URL <b>[http://server/static/images/standard.jpg]</b> pour obtenir cette image de fond.</p></td></tr></table>

<p>On voit dans ce simple exemple que pour construire l&#x27;intégralité du document, le navigateur doit faire trois requêtes au serveur :</p>
<ul>
<li><strong>[http://server/chemin/balises.html]</strong> pour avoir le source HTML du document ;</li>
<li><strong>[http://server/static/images/cerisier.jpg]</strong> pour avoir l&#x27;image cerisier.jpg ;</li>
<li><strong>[http://server/static/images/standard.jpg]</strong> pour obtenir l&#x27;image de fond standard.jpg ;
Le script <strong>[exemple_01]</strong> va nous permettre d’afficher la page statique <strong>[balises.html]</strong> précédente :</li>
</ul>
<p><img src="images/10000000000001750000026E22E6123F.png" style="width:4.301cm;height:7.171cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, le script <strong>[exemple_01]</strong> qui va être exécuté ;</li>
<li>en <strong>[3]</strong>, le document HTML qui va être affiché par le script ;</li>
<li>en <strong>[2]</strong>, les images du document HTML ;
Le script <strong>[exemple_01]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">render_template</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="c1"># application Flask</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../templates&quot;</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../static&quot;</span><span class="p">)</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="c1"># Home URL</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>    <span class="c1"># affichage de la page</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;balises.html&quot;</span><span class="p">))</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="c1"># main</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 7 : on instancie une application Flask. Une application Flask est une application web ;</li>
<li>le 1er paramètre est le nom donné à l’application. On peut donner le nom que l’on veut. Ici on a utilisé l’attribut prédéfini <strong>[<strong>name</strong>]</strong> qui vaut <strong>[<strong>main</strong>]</strong> (ligne 18) ;</li>
<li>le second paramètre est un paramètre nommé, ç-à-d que sa position dans l’ordre des paramètres n’a pas d’importance. Le paramètre nommé <strong>[template_folder]</strong> désigne le dossier où trouver les pages statiques de l’application web. Les pages statiques sont délivrées telles quelles au navigateur. Ici, les pages statiques seront trouvées dans le dossier <strong>[templates]</strong> de l’arborescence du projet. Ligne 7, nous avons mis un chemin relatif au dossier <strong>[script_dir]</strong> contenant le script <strong>[exemple_01]</strong> exécuté ;</li>
<li>le troisième paramètre est également un paramètre nommé. <strong>[static_folder]</strong> désigne le dossier où on va trouver les ressources du document HTML (images, vidéos, …). La également, nous avons mis un chemin relatif au dossier <strong>[script_dir]</strong> contenant le script <strong>[exemple_01]</strong> exécuté ;</li>
<li>lignes 10-14 : on définit les URL acceptées par l’application web. Chaque URL est associée à une fonction qui s’exécute lorsque l’URL est demandée par un navigateur web ;</li>
<li>ligne 11 : l’unique URL de l’application est l’URL <strong>[/]</strong>. Notez que dans <strong>[</strong><strong>@app.route(</strong><strong>&#x27;/&#x27;</strong><strong>)</strong><strong>]</strong>, <strong>[app]</strong> est la variable initialisée ligne 7. La définition des routes (les différentes URL gérées par l’application) vient donc forcément après la définition de l’application <strong>[app]</strong>. Ce dernier nom est libre ;</li>
<li>lignes 12-14 : la fonction qui s’exécute lorsqu’on demande l’URL <strong>[/]</strong> à l’application web <strong>[exemple_01]</strong> ;</li>
<li>ligne 12 : la fonction associée à une URL peut porter un nom quelconque. Elle peut parfois avoir des paramètres pour récupérer des éléments de l’URL qui lui est associée. Ici elle n’en a pas ;</li>
<li>ligne 14 :</li>
<li>la fonction <strong>[render_template]</strong> rend une chaîne de caractères qui est le document texte produit par son paramètre. Celui-ci est ici <strong>[balises.html]</strong>. A cause du <strong>[template_folder]</strong> de la ligne 7, ce document sera cherché dans le dossier <strong>[</strong><strong>f&quot;{script_dir}/../templates&quot;</strong><strong>]</strong>. C’est effectivement là qu’il se trouve ;</li>
<li>la fonction <strong>[make_response]</strong> génère une réponse HTTP pour le navigateur qui lui a demandé l’URL <strong>[/]</strong>. On a vu dans le paragraphe |<a href="#_Le_protocole_HTTP"><u><u>le protocole HTTP</u></u></a>| qu’une réponse HTTP a deux éléments :</li>
<li>des entêtes HTTP ;</li>
<li>
<p>le document demandé par le navigateur, ici un document HTML ;
Ligne 14, on a donné aucun paramètre à la fonction <strong>[make_response]</strong> pour générer des entêtes HTTP. Elle va alors en générer par défaut. On verra ultérieurement comment fixer ces entêtes HTTP.</p>
</li>
<li>
<p>finalement, lorsque le navigateur demande l’URL / à l’application Flask, il obtient la page <strong>[balises.html]</strong> ;</p>
</li>
<li>lignes 17-20 : ces lignes servent à lancer le serveur web qui va exécuter l’application web <strong>[exemple_01]</strong> ;</li>
<li>ligne 18 : cette condition n’est vraie que lorsque le script <strong>[exemple_01]</strong> est lancé au sein d’une console ;</li>
<li>ligne 19 : l’application <strong>[app]</strong> de la ligne 7 est configurée :</li>
<li>le paramètre nommé <strong>[</strong><strong>ENV=</strong><strong>&quot;development&quot;</strong><strong>]</strong> met le serveur web en mode développement : dès que le développeur modifie un élément de l’application celle-ci est régénérée et délivrée au serveur web. Le développeur n’a pas besoin de demander une nouvelle exécution ;</li>
<li>le paramètre nommé <strong>[</strong><strong>DEBUG=</strong><strong>True]</strong> va permettre au développeur de mettre des points d’arrêt dans le code de l’application ;</li>
<li>ligne 20 : l’application web est lancée : un serveur web est instancié et l’application web est déployée dessus afin de répondre aux requêtes de clients web ;
Voici un exemple d’exécution :</li>
</ul>
<p><img src="images/10000000000002DA00000256CACE3193.png" style="width:8.422cm;height:6.91cm;" alt="Image" /></p>
<p>Les logs suivants apparaissent alors dans la console d’exécution :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span>
<span class="normal"><a href="#__codelineno-9-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">flask</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">exemple_01</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a> <span class="o">*</span> <span class="n">Serving</span> <span class="n">Flask</span> <span class="n">app</span> <span class="s2">&quot;exemple_01&quot;</span> <span class="p">(</span><span class="n">lazy</span> <span class="n">loading</span><span class="p">)</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a> <span class="o">*</span> <span class="n">Environment</span><span class="p">:</span> <span class="n">development</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a> <span class="o">*</span> <span class="n">Debug</span> <span class="n">mode</span><span class="p">:</span> <span class="n">on</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a> <span class="o">*</span> <span class="n">Restarting</span> <span class="k">with</span> <span class="n">stat</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a> <span class="o">*</span> <span class="n">Debugger</span> <span class="ow">is</span> <span class="n">active</span><span class="err">!</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a> <span class="o">*</span> <span class="n">Debugger</span> <span class="n">PIN</span><span class="p">:</span> <span class="mi">334</span><span class="o">-</span><span class="mi">263</span><span class="o">-</span><span class="mi">283</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a> <span class="o">*</span> <span class="n">Running</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span> <span class="p">(</span><span class="n">Press</span> <span class="n">CTRL</span><span class="o">+</span><span class="n">C</span> <span class="n">to</span> <span class="n">quit</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 2 : le serveur affiche le script exécuté ;</li>
<li>ligne 3 : on est en mode développement ;</li>
<li>lignes 4-5 : le serveur voit qu’on l’a lancé en mode <strong>[debug]</strong>. Il redémarre alors (ligne 5). Le mode <strong>[debug]</strong> ralentit donc un peu le démarrage ;</li>
<li>ligne 8 : l’URL où l’application web déployée <strong>[exemple_01]</strong> est disponible ;
Avec un navigateur web demandons l’URL <strong>[</strong><strong>http://127.0.0.1:5000/</strong><strong>]</strong> :</li>
</ul>
<p><img src="images/100000000000033C000003A564DC961D.png" style="width:9.542cm;height:10.76cm;" alt="Image" /></p>
<p>On obtient bien le document <strong>[balises.html]</strong> attendu.</p>
<h3 id="2222-script-exemple_02-generer-un-document-html-dynamiquement">22.2.2. script [exemple_02] : générer un document HTML dynamiquement</h3>
<p><img src="images/100000000000017D000001D207493827.png" style="width:4.391cm;height:5.381cm;" alt="Image" /></p>
<p>Le script <strong>[exemple_02]</strong> <strong>[1]</strong> va générer le document <strong>[exemple_02.html]</strong> <strong>[2]</strong> suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">page</span><span class="o">.</span><span class="n">title</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>    <span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">page</span><span class="o">.</span><span class="n">contents</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Ce document est dynamique parce que son contenu n’est totalement connu qu’au moment où le serveur web le sert. On y trouve en effet aux lignes 5 et 8 deux éléments non connus au moment de l’écriture de la page. Ils ne sont connus qu’au moment où la page est envoyée à un client. Ils sont alors remplacés par leurs valeurs, celles-ci étant des chaînes de caractères.</p>
<ul>
<li>lignes 5, 8 : la syntaxe <strong>{{expression}}</strong> est une syntaxe du langage de templates Jinja2 [<a href="https://jinja.palletsprojects.com/en/2.11.x/"><u><u>https://jinja.palletsprojects.com/en/2.11.x/</u></u></a>]. Avant que la page ne soit envoyée à un client, les éléments dynamiques de la page (lignes 5 et 8) sont évalués et remplacés par leurs valeurs ;</li>
<li>ligne 5 : on a utilisé la syntaxe <strong>[page.title]</strong>. On a donc supposé qu’à la génération de la page avant son envoi, une variable <strong>[page]</strong> est connue, on verra comment. Dans la syntaxe <strong>{{expression}}</strong> on peut utiliser les noms de variables que l’on veut. Aux lignes 5 et 8, on pourrait ainsi avoir <strong>{{title}}</strong> et <strong>{{contents}}</strong>. On pourrait dire alors que <strong>[title]</strong> et <strong>[contents]</strong> sont des paramètres de la page. Dans la suite, nous utiliserons toujours la même technique :</li>
<li>l’unique paramètre de la page sera un dictionnaire <strong>[page]</strong> ;</li>
<li>les attributs de ce dictionnaire seront utilisés dans la page. Ici <strong>[page.title]</strong> ligne 5 et <strong>[page.contents]</strong> ligne 8 ;
L’application web <strong>[exemple_02.py]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">render_template</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="c1"># application Flask</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../templates&quot;</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../static&quot;</span><span class="p">)</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="c1"># Home URL</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a>    <span class="c1"># contenu de la page sous la forme d&#39;un dictionnaire</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>    <span class="n">page</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;un titre&quot;</span><span class="p">,</span> <span class="s2">&quot;contents&quot;</span><span class="p">:</span> <span class="s2">&quot;un contenu&quot;</span><span class="p">}</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a>    <span class="c1"># affichage de la page</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;exemple_02.html&quot;</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">))</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="c1"># main</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>nous avons déjà expliqué dans l’exemple précédent, les lignes 4-5 et 18-20. Nous utiliserons toujours ce schéma dans nos exemples ;</li>
<li>ligne 9 : la seule URL servie par l’application web est l’URL / ;</li>
<li>ligne 14 : le document servi à l’URL / est le document <strong>[exemple_02.html]</strong> que nous venons de commenter. Nous savons qu’il a un paramètre, un dictionnaire appelé <strong>[page]</strong> ;</li>
<li>ligne 12 : nous définissons le dictionnaire qui va être passé en paramètre à la page <strong>[exemple_02.html]</strong>. Il peut porter n’importe quel nom. Il doit cependant avoir les attributs <strong>[title, contents]</strong> utilisés dans le document HTML ;</li>
<li>ligne 14 : la fonction <strong>[render_template]</strong> a pour rôle de rendre la chaîne de caractères du document <strong>[exemple_02.html]</strong>. Comme celui-ci est un document paramétré, on transmet à la fonction <strong>[render_template]</strong> le ou les paramètres attendus. Nous le faisons ici en donnant une valeur au paramètre nommé <strong>[page]</strong>. Dans l’opération <strong>[page=page]</strong> :</li>
<li>à gauche du signe =, on a le paramètre <strong>[page]</strong> utilisé dans le document <strong>[exemple_02.html]</strong> ;</li>
<li>à droite du signe =, on a la valeur <strong>[page]</strong> définie ligne 12 ;</li>
<li>de façon générale, si un document HTML a les paramètres <strong>[param1, param2, …, paramn]</strong>, on passera leurs valeurs à la fonction <strong>[render_template]</strong> sous la forme <strong>[render_template(document, param1=valeur1, param2=valeur2, …]</strong> ;
Avant d’exécuter <strong>[exemple_02]</strong>, nous devons arrêter l’exécution de <strong>[exemple_01]</strong> :</li>
</ul>
<p><img src="images/100000000000035500000120DF568597.png" style="width:9.85cm;height:3.32cm;" alt="Image" /></p>
<p>Si lors de l’exécution d’un script 1, vous avez l’impression que c’est un script 2 qui s’exécute c’est probablement parce que celui-ci est toujours en exécution. Pour revenir à un état connu, vous pouvez arrêter tous les processus en cours d’exécution dans PyCharm (en haut et à droite dans fenêtre PyCharm) :</p>
<p><img src="images/100000000000022B000001002425A870.png" style="width:6.421cm;height:2.961cm;" alt="Image" /></p>
<p>Exécutons le script <strong>[exemple_02]</strong> :</p>
<p><img src="images/100000000000027C0000024F12190A9C.png" style="width:7.351cm;height:6.831cm;" alt="Image" /></p>
<p>Les logs console sont alors les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span>
<span class="normal"><a href="#__codelineno-12-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">flask</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">exemple_02</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a> <span class="o">*</span> <span class="n">Serving</span> <span class="n">Flask</span> <span class="n">app</span> <span class="s2">&quot;exemple_02&quot;</span> <span class="p">(</span><span class="n">lazy</span> <span class="n">loading</span><span class="p">)</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a> <span class="o">*</span> <span class="n">Environment</span><span class="p">:</span> <span class="n">development</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a> <span class="o">*</span> <span class="n">Debug</span> <span class="n">mode</span><span class="p">:</span> <span class="n">on</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a> <span class="o">*</span> <span class="n">Restarting</span> <span class="k">with</span> <span class="n">stat</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a> <span class="o">*</span> <span class="n">Debugger</span> <span class="ow">is</span> <span class="n">active</span><span class="err">!</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a> <span class="o">*</span> <span class="n">Debugger</span> <span class="n">PIN</span><span class="p">:</span> <span class="mi">334</span><span class="o">-</span><span class="mi">263</span><span class="o">-</span><span class="mi">283</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a> <span class="o">*</span> <span class="n">Running</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span> <span class="p">(</span><span class="n">Press</span> <span class="n">CTRL</span><span class="o">+</span><span class="n">C</span> <span class="n">to</span> <span class="n">quit</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>La ligne 8 indique le port de déploiement (5000) de l’application <strong>[exemple_02]</strong> (ligne 1) sur la machine <strong>[localhost]</strong>. Les lignes précédentes étant toujours les mêmes, nous ne les remontrerons plus.</p>
<p>Avec un navigateur, nous demandons l’URL <strong>[</strong><strong>http://localhost:5000/</strong><strong>]</strong> :</p>
<p><img src="images/100000000000025F000001379F673CC6.png" style="width:7.01cm;height:3.581cm;" alt="Image" /></p>
<ul>
<li>l’expression {{page.title}} a produit <strong>[1]</strong> ;</li>
<li>l’expression {{page.contents}} a produit <strong>[2]</strong> ;</li>
</ul>
<h3 id="2223-script-exemple_03-utiliser-des-fragments-de-page">22.2.3. script [exemple_03] : utiliser des fragments de page</h3>
<ul>
<li>en <strong>[1]</strong>, le script <strong>[exemple_03.py]</strong> va générer le document dynamique <strong>[exemple_03.html]</strong> <strong>[2]</strong>. Celui-ci sera construit à partir des fragments de page <strong>[fragment_01.html, fragment_02.html]</strong> <strong>[3]</strong> ;
Le document <strong>[exemple_03.html]</strong> sera le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/fragment_01.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/fragment_02.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 3 et 5, on utilise la directive <strong>[include]</strong> de Jinja2 pour inclure dans le document des éléments externes à celui-ci ;</li>
<li>la syntaxe est {% include … %}. Le paramètre de la directive <strong>[include]</strong> est le chemin du document à incorporer. Ce chemin est relatif au paramètre <strong>[template_folder]</strong> de l’application Flask :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="s2">&quot;../templates&quot;</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s2">&quot;../static&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Donc ici, les chemins des documents sont mesurés par rapport au dossier <strong>[templates]</strong>.</p>
<p>Le fragment <strong>[fragment_01.html]</strong> (les noms sont bien sûr libres) est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">page</span><span class="o">.</span><span class="n">title</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Le fragment <strong>[fragment_02.html]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">page</span><span class="o">.</span><span class="n">contents</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Si on reconstitue le document <strong>[exemple_03.html]</strong> avec ces fragments, on obtient le code suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span>
<span class="normal"><a href="#__codelineno-17-7">7</a></span>
<span class="normal"><a href="#__codelineno-17-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">page</span><span class="o">.</span><span class="n">title</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">page</span><span class="o">.</span><span class="n">contents</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>On a donc un document identique à <strong>[exemple_02.html]</strong> mais construit à partir de fragments.</p>
<p>Le script web <strong>[exemple_03.py]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">render_template</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="c1"># application Flask</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../templates&quot;</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../static&quot;</span><span class="p">)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="c1"># Home URL</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>    <span class="c1"># contenu de la page</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>    <span class="n">page</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;un autre titre&quot;</span><span class="p">,</span> <span class="s2">&quot;contents&quot;</span><span class="p">:</span> <span class="s2">&quot;un autre contenu&quot;</span><span class="p">}</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>    <span class="c1"># affichage de la page</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;views/exemple_03.html&quot;</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">))</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="c1"># main</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>Le code est analogue à celui de <strong>[exemple_02.py]</strong>. Ligne 16, on montre comment on peut référencer des documents présents dans des sous-dossiers de <strong>[template_folder]</strong> de la ligne 7.</p>
<p>L’exécution du script <strong>[exemple_03.py]</strong> donne les résultats suivants dans le navigateur :</p>
<p><img src="images/10000000000002BD0000013796E39F0B.png" style="width:8.09cm;height:3.601cm;" alt="Image" /></p>
<h2 id="223-scripts-flask02-service-web-de-date-et-heure">22.3. scripts [flask/02] : service web de date et heure</h2>
<p>Le document <strong>[date_time_server.html]</strong> est le suivant :</p>
<p><img src="images/10000000000001B20000014487040A34.png" style="width:5.01cm;height:3.74cm;" alt="Image" /></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Date</span> <span class="n">et</span> <span class="n">heure</span> <span class="n">du</span> <span class="n">moment</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>    <span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">Date</span> <span class="n">et</span> <span class="n">heure</span> <span class="n">du</span> <span class="n">moment</span> <span class="p">:</span> <span class="p">{{</span><span class="n">page</span><span class="o">.</span><span class="n">date_heure</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 8 : la page admet le paramètre <strong>[</strong><strong>page.date_heure</strong><strong>]</strong> ;
Le service web <strong>[date_time_server.py]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span>
<span class="normal"><a href="#__codelineno-20-30">30</a></span>
<span class="normal"><a href="#__codelineno-20-31">31</a></span>
<span class="normal"><a href="#__codelineno-20-32">32</a></span>
<span class="normal"><a href="#__codelineno-20-33">33</a></span>
<span class="normal"><a href="#__codelineno-20-34">34</a></span>
<span class="normal"><a href="#__codelineno-20-35">35</a></span>
<span class="normal"><a href="#__codelineno-20-36">36</a></span>
<span class="normal"><a href="#__codelineno-20-37">37</a></span>
<span class="normal"><a href="#__codelineno-20-38">38</a></span>
<span class="normal"><a href="#__codelineno-20-39">39</a></span>
<span class="normal"><a href="#__codelineno-20-40">40</a></span>
<span class="normal"><a href="#__codelineno-20-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># imports</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">render_template</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="c1"># application Flask</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="c1"># Home URL</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a>    <span class="c1"># envoi heure au client</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a>    <span class="c1"># time.localtime : nb de millisecondes depuis 01/01/1970</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a>    <span class="c1"># time.strftime permet de formater l&#39;heure et la date</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>    <span class="c1"># format affichage date-heure</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a>    <span class="c1"># d: jour sur 2 chiffres</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a>    <span class="c1"># m: mois sur 2 chiffres</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a>    <span class="c1"># y : année sur 2 chiffres</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a>    <span class="c1"># H : heure 0,23</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a>    <span class="c1"># M : minutes</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a>    <span class="c1"># S: secondes</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a>    <span class="c1"># date / heure du moment</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a>    <span class="n">time_of_day</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">/%m/%y %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">())</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a>    <span class="c1"># on génère le document à envoyer au client</span>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a>    <span class="n">page</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;date_heure&quot;</span><span class="p">:</span> <span class="n">time_of_day</span><span class="p">}</span>
<a id="__codelineno-20-30" name="__codelineno-20-30"></a>    <span class="n">document</span> <span class="o">=</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;date_time_server.html&quot;</span><span class="p">,</span> <span class="n">page</span><span class="o">=</span><span class="n">page</span><span class="p">)</span>
<a id="__codelineno-20-31" name="__codelineno-20-31"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">document</span><span class="p">),</span> <span class="n">document</span><span class="p">)</span>
<a id="__codelineno-20-32" name="__codelineno-20-32"></a>    <span class="c1"># réponse HTTP au client</span>
<a id="__codelineno-20-33" name="__codelineno-20-33"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<a id="__codelineno-20-34" name="__codelineno-20-34"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">response</span><span class="p">),</span> <span class="n">response</span><span class="p">)</span>
<a id="__codelineno-20-35" name="__codelineno-20-35"></a>    <span class="k">return</span> <span class="n">response</span>
<a id="__codelineno-20-36" name="__codelineno-20-36"></a>
<a id="__codelineno-20-37" name="__codelineno-20-37"></a>
<a id="__codelineno-20-38" name="__codelineno-20-38"></a><span class="c1"># main seulement</span>
<a id="__codelineno-20-39" name="__codelineno-20-39"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-20-40" name="__codelineno-20-40"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-20-41" name="__codelineno-20-41"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 13 : l’application web ne sert que l’URL / ;</li>
<li>lignes 15-24 : expliquent comment obtenir date et heure et comment les afficher ;</li>
<li>ligne 27 : chaîne de caractères représentant la date et l’heure du moment ;</li>
<li>lignes 28-30 : on génère le document dynamique <strong>[date_time_server.html]</strong> en lui passant le dictionnaire <strong>[page]</strong> de la ligne 29 ;</li>
<li>ligne 31 : on affiche le type de <strong>[document]</strong> et le document lui-même. On veut montrer que c’est une chaîne de caractères ;</li>
<li>ligne 33 : on génère la réponse HTTP qui va être envoyée au client (elle n’est pas encore envoyée) ;</li>
<li>ligne 34 : on affiche son type et sa valeur ;</li>
<li>ligne 35 : la réponse HTTP est envoyée au client ;
L’exécution du script donne le résultat suivant dans un navigateur :</li>
</ul>
<p><img src="images/100000000000028900000130DB158B5F.png" style="width:7.511cm;height:3.511cm;" alt="Image" /></p>
<p>Les logs dans la console sont les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">flask</span>\<span class="mi">02</span>\<span class="n">date_time_server</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a> <span class="o">*</span> <span class="n">Serving</span> <span class="n">Flask</span> <span class="n">app</span> <span class="s2">&quot;date_time_server&quot;</span> <span class="p">(</span><span class="n">lazy</span> <span class="n">loading</span><span class="p">)</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a> <span class="o">*</span> <span class="n">Environment</span><span class="p">:</span> <span class="n">development</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a> <span class="o">*</span> <span class="n">Debug</span> <span class="n">mode</span><span class="p">:</span> <span class="n">on</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a> <span class="o">*</span> <span class="n">Restarting</span> <span class="k">with</span> <span class="n">stat</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a> <span class="o">*</span> <span class="n">Debugger</span> <span class="ow">is</span> <span class="n">active</span><span class="err">!</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a> <span class="o">*</span> <span class="n">Debugger</span> <span class="n">PIN</span><span class="p">:</span> <span class="mi">334</span><span class="o">-</span><span class="mi">263</span><span class="o">-</span><span class="mi">283</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a> <span class="o">*</span> <span class="n">Running</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span> <span class="p">(</span><span class="n">Press</span> <span class="n">CTRL</span><span class="o">+</span><span class="n">C</span> <span class="n">to</span> <span class="n">quit</span><span class="p">)</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">10</span><span class="o">/</span><span class="n">Jul</span><span class="o">/</span><span class="mi">2020</span> <span class="mi">09</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">09</span><span class="p">]</span> <span class="s2">&quot;GET / HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="o">-</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="n">document</span> <span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="err">&#39;</span><span class="nc">str</span><span class="s1">&#39;&gt; &lt;!DOCTYPE html&gt;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a>    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Date</span> <span class="n">et</span> <span class="n">heure</span> <span class="n">du</span> <span class="n">moment</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a>    <span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">Date</span> <span class="n">et</span> <span class="n">heure</span> <span class="n">du</span> <span class="n">moment</span> <span class="p">:</span> <span class="mi">10</span><span class="o">/</span><span class="mi">07</span><span class="o">/</span><span class="mi">20</span> <span class="mi">09</span><span class="p">:</span><span class="mi">42</span><span class="p">:</span><span class="mi">33</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="n">response</span> <span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="err">&#39;</span><span class="nc">flask</span><span class="o">.</span><span class="n">wrappers</span><span class="o">.</span><span class="n">Response</span><span class="s1">&#39;&gt; &lt;Response 195 bytes [200 OK]&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 10 : on voit que le type de la valeur rendue par <strong>[render_template]</strong> est de type <strong>[str]</strong>. Cette chaîne de caractères n’est autre que le document <strong>[date_time_server.html]</strong> une fois interprété (lignes 10-19) ;</li>
<li>ligne 20 : on voit que le type de la valeur rendue par <strong>[make_response]</strong> est de type <strong>[</strong><strong>flask.wrappers.Response</strong><strong>]</strong>. La fonction <strong>[Response.<strong>str</strong>]</strong> a été implicitement appelée pour afficher l’objet <strong>[Response]</strong>. La chaîne rendue par cette fonction donne deux informations sur la réponse HTTP qui va être faite :</li>
<li>le document envoyé fait 195 octets ;</li>
<li>le statut de la réponse HTTP est <strong>[200 OK]</strong>. On verra ultérieurement qu’on a accès à ce code de statut ;</li>
</ul>
<h2 id="224-scripts-flask03-services-web-generant-du-texte-brut">22.4. scripts [flask/03] : services web générant du texte brut</h2>
<p>Nous avons vu dans un précédent exemple que le service web délivrait le document suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">DOCTYPE</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Date</span> <span class="n">et</span> <span class="n">heure</span> <span class="n">du</span> <span class="n">moment</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a>    <span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">Date</span> <span class="n">et</span> <span class="n">heure</span> <span class="n">du</span> <span class="n">moment</span> <span class="p">:</span> <span class="p">{{</span><span class="n">page</span><span class="o">.</span><span class="n">date_heure</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Un client web pourrait n’être intéressé que par l’information <strong>[page.date_heure]</strong> de la ligne 8 et pas par l’habillage HTML qu’il y a autour. Le service web pourrait délivrer cette information comme une simple chaîne de caractères. Nous allons présenter ici des exemples de ce type de service web.</p>
<h3 id="2241-script-main_01">22.4.1. script [main_01]</h3>
<p><img src="images/10000000000004DB000001DACF851B95.png" style="width:14.331cm;height:5.471cm;" alt="Image" /></p>
<ul>
<li><strong>[main_01]</strong> est le service web ;</li>
<li><strong>[config]</strong> est le script de configuration de l’application web ;</li>
<li>le service web utilise certaines des entités définies en <strong>[2]</strong> ;
Le script <strong>[config]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">():</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>    <span class="c1"># chemin absolu référence des chemins relatifs de la configuration</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>    <span class="n">rootDir</span> <span class="o">=</span> <span class="s2">&quot;C:/Data/st-2020/dev/python/cours-2020/python3-flask-2020&quot;</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>    <span class="c1"># dépendances de l&#39;application</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>        <span class="c1"># Personne, Utils, MyException</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">rootDir</span><span class="si">}</span><span class="s2">/classes/02/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>    <span class="p">]</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>    <span class="c1"># on fixe le syspath</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a>    <span class="c1"># on rend la config</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>    <span class="k">return</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
<p>Le rôle premier de cette configuration est de définir le Python Path du service web. Il faut qu’on puisse trouver les entités <strong>[2]</strong> (ligne 8).</p>
<p>Le script web <strong>[main_01]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span>
<span class="normal"><a href="#__codelineno-24-22">22</a></span>
<span class="normal"><a href="#__codelineno-24-23">23</a></span>
<span class="normal"><a href="#__codelineno-24-24">24</a></span>
<span class="normal"><a href="#__codelineno-24-25">25</a></span>
<span class="normal"><a href="#__codelineno-24-26">26</a></span>
<span class="normal"><a href="#__codelineno-24-27">27</a></span>
<span class="normal"><a href="#__codelineno-24-28">28</a></span>
<span class="normal"><a href="#__codelineno-24-29">29</a></span>
<span class="normal"><a href="#__codelineno-24-30">30</a></span>
<span class="normal"><a href="#__codelineno-24-31">31</a></span>
<span class="normal"><a href="#__codelineno-24-32">32</a></span>
<span class="normal"><a href="#__codelineno-24-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="c1"># imports</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="c1"># dépendances</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Personne</span><span class="w"> </span><span class="kn">import</span> <span class="n">Personne</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="c1"># application Flask (pas de documents statiques ici)</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="c1"># Home URL</span>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a>    <span class="c1"># une personne</span>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a>    <span class="n">personne</span> <span class="o">=</span> <span class="n">Personne</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s2">&quot;prénom&quot;</span><span class="p">:</span> <span class="s2">&quot;Aglaë&quot;</span><span class="p">,</span> <span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="s2">&quot;de la Hûche&quot;</span><span class="p">,</span> <span class="s2">&quot;âge&quot;</span><span class="p">:</span> <span class="mi">87</span><span class="p">})</span>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a>    <span class="c1"># réponse HTTP</span>
<a id="__codelineno-24-22" name="__codelineno-24-22"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">personne</span><span class="p">))</span>
<a id="__codelineno-24-23" name="__codelineno-24-23"></a>    <span class="c1"># headers HTTP</span>
<a id="__codelineno-24-24" name="__codelineno-24-24"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json; charser=utf8&quot;</span><span class="p">)</span>
<a id="__codelineno-24-25" name="__codelineno-24-25"></a>    <span class="c1"># on rend la réponse HTTP</span>
<a id="__codelineno-24-26" name="__codelineno-24-26"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-24-27" name="__codelineno-24-27"></a>
<a id="__codelineno-24-28" name="__codelineno-24-28"></a>
<a id="__codelineno-24-29" name="__codelineno-24-29"></a><span class="c1"># main uniquement</span>
<a id="__codelineno-24-30" name="__codelineno-24-30"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-24-31" name="__codelineno-24-31"></a>    <span class="c1"># on lance le serveur</span>
<a id="__codelineno-24-32" name="__codelineno-24-32"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-24-33" name="__codelineno-24-33"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 1-3 : le Python Path de l’application est fixé ;</li>
<li>lignes 5-10 : on importe les éléments dont a besoin le script ;</li>
<li>ligne 17 : le service web ne sert que l’URL / ;</li>
<li>ligne 20 : on crée un objet <strong>[Personne]</strong> ;</li>
<li>ligne 22 : on crée une réponse HTTP avec la chaîne de caractères représentant la personne. La fonction <strong>[Personne.<strong>str</strong>]</strong> va être appelée. Celle-ci rend la chaîne jSON du dictionnaire <strong>[asdict]</strong> de la personne (cf. |<a href="#_La_classe_[BaseEntity]"><u><u>classe BaseEntity</u></u></a>|). Le paramètre de la fonction <strong>[make_response]</strong> est le document texte envoyé au client, donc ici la chaîne jSON d’une personne ;</li>
<li>ligne 24 : on met dans les entêtes HTTP de la réponse, un entête <strong>[</strong><strong>Content-type</strong><strong>]</strong> qui indique au client quel type de document il va recevoir, ici un document jSON codé en UTF-8 ;</li>
<li>ligne  26 : on rend un tuple de deux éléments :</li>
<li>la réponse au client, entêtes HTTP et document ;</li>
<li>le code de statut de la réponse. Ici on veut rendre le code de statut <strong>[200 OK]</strong>. Les différents codes de statut sont définis par des constantes dans le module <strong>[flask_api]</strong> importé ligne 7 ;
Le module <strong>[flask_api]</strong> n’est pas disponible nativement. Il faut l’installer. On fait cela dans un terminal PyCharm :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="p">(</span><span class="n">venv</span><span class="p">)</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">inet</span>\<span class="n">utilitaires</span><span class="o">&gt;</span><span class="n">pip</span> <span class="n">install</span> <span class="n">flask_api</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="n">Collecting</span> <span class="n">flask_api</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>  <span class="n">Downloading</span> <span class="n">Flask_API</span><span class="o">-</span><span class="mf">2.0</span><span class="o">-</span><span class="n">py3</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="nb">any</span><span class="o">.</span><span class="n">whl</span> <span class="p">(</span><span class="mi">119</span> <span class="n">kB</span><span class="p">)</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>     <span class="o">||</span> <span class="mi">119</span> <span class="n">kB</span> <span class="mi">544</span> <span class="n">kB</span><span class="o">/</span><span class="n">s</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">Flask</span><span class="o">&gt;=</span><span class="mf">1.1</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>\<span class="n">data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.1.2</span><span class="p">)</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">Jinja2</span><span class="o">&gt;=</span><span class="mf">2.10.1</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>\<span class="n">data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">Flask</span><span class="o">&gt;=</span><span class="mf">1.1</span><span class="o">-&gt;</span><span class="n">flask_api</span><span class="p">)</span> <span class="p">(</span><span class="mf">2.11.2</span><span class="p">)</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">&gt;=</span><span class="mf">0.15</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>\<span class="n">data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">Flask</span><span class="o">&gt;=</span><span class="mf">1.1</span><span class="o">-&gt;</span><span class="n">flask_api</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.0.1</span><span class="p">)</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">click</span><span class="o">&gt;=</span><span class="mf">5.1</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>\<span class="n">data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">Flask</span><span class="o">&gt;=</span><span class="mf">1.1</span><span class="o">-&gt;</span><span class="n">flask_api</span><span class="p">)</span> <span class="p">(</span><span class="mf">7.1.2</span><span class="p">)</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">itsdangerous</span><span class="o">&gt;=</span><span class="mf">0.24</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>\<span class="n">data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">Flask</span><span class="o">&gt;=</span><span class="mf">1.1</span><span class="o">-&gt;</span><span class="n">flask_api</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.1.0</span><span class="p">)</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">:</span> <span class="n">MarkupSafe</span><span class="o">&gt;=</span><span class="mf">0.23</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>\<span class="n">data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">Jinja2</span><span class="o">&gt;=</span><span class="mf">2.10.1</span><span class="o">-&gt;</span><span class="n">Flask</span><span class="o">&gt;=</span><span class="mf">1.1</span><span class="o">-&gt;</span><span class="n">flask_api</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.1.1</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="p">)</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="n">Installing</span> <span class="n">collected</span> <span class="n">packages</span><span class="p">:</span> <span class="n">flask</span><span class="o">-</span><span class="n">api</span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="n">Successfully</span> <span class="n">installed</span> <span class="n">flask</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="mf">2.0</span>
</code></pre></div></td></tr></table></div>
<p>Lorsqu’on exécute le script web <strong>[main_01]</strong>, on obtient les résultats suivants dans un navigateur :</p>
<p><img src="images/10000000000005A4000001099A9AA9EF.png" style="width:16.701cm;height:3.061cm;" alt="Image" /></p>
<ul>
<li>en <strong>[2]</strong>, la chaîne jSON reçue ;</li>
<li>en <strong>[3-4]</strong>, on fait afficher le contenu du document reçu. On voit qu’il n’y a aucun habillage HTML, seulement la chaîne jSON ;
Voyons maintenant le rôle de l’entête <strong>[Content-Type]</strong> envoyé au client par le service web. On met le navigateur en mode développeur (F12 en général) et on redemande la même URL. Ci-dessous une copie d’écran d’un navigateur Chrome :</li>
</ul>
<p><img src="images/1000000000000562000002AD6FAA7357.png" style="width:15.9cm;height:7.901cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, sélectionner l’onglet <strong>[Network]</strong> ;</li>
<li>en <strong>[2, 4]</strong> : l’URL demandée par le navigateur ;</li>
<li>en <strong>[3]</strong>, sélectionner l’onglet <strong>[Headers]</strong> (entêtes HTTP) ;</li>
<li>en <strong>[5]</strong>, le code de statut de la réponse HTTP reçue ;</li>
<li>en <strong>[6]</strong>, l’entête indiquant au client qu’il va recevoir un texte jSON. Cela permet au client de s’adapter à la réponse. Ainsi la police de caractères utilisée par Chrome pour afficher une réponse jSON ou une réponse texte basique n’est pas la même ;</li>
</ul>
<p><img src="images/1000000000000356000000E0A8767336.png" style="width:9.871cm;height:2.59cm;" alt="Image" /></p>
<ul>
<li>en <strong>[8]</strong>, on sélectionne l’onglet <strong>[Response]</strong> pour avoir accès au document envoyé par le serveice web, ici une simple chaîne jSON ;</li>
</ul>
<h3 id="2242-postman">22.4.2. Postman</h3>
<p><strong>[Postman]</strong> est l’outil qui va nous permettre d’interroger les différentes URL d’une application web. Il nous permet :</p>
<ul>
<li>d’utiliser n’importe quelle URL : celles-ci sont fabriquées à la main ;</li>
<li>de requêter le serveur web par un GET, POST, PUT, OPTIONS… ;</li>
<li>de préciser les paramètres du GET ou du POST ;</li>
<li>de fixer les entêtes HTTP de la requête ;</li>
<li>de recevoir une réponse au format jSON, XML, HTML,</li>
<li>d’avoir accès aux entêtes HTTP de la réponse. On a donc ainsi accès à la réponse HTTP complète du serveur ;
<strong>[Postman]</strong> est un excellent outil pédagogique pour comprendre la communication client / serveur du protocole HTTP.</li>
</ul>
<p><strong>[Postman]</strong> est disponible à l’URL <strong>[https://www.getpostman.com/downloads/]</strong>. Procédez à l’installation de votre version de <strong>[Postman]</strong>. Au cours de l’installation, on vous demandera de créer un compte : celui-ci sera inutile ici. Le compte <strong>[Postman]</strong> sert à synchroniser différents appareils afin que la configuration de l’un soit répliqué sur un autre. Rien de tout ceci n’est utile ici.</p>
<p>Une fois installé, <strong>[Postman]</strong> présente l’interface suivante :</p>
<p><img src="images/10000001000003C6000001933234FC0D.png" style="width:16.391cm;height:6.831cm;" alt="Image" /></p>
<ul>
<li>en <strong>[2-3]</strong>, on a accès au paramétrage du produit ;</li>
</ul>
<p><img src="images/10000000000003D1000001C6516A9EF0.png" style="width:11.27cm;height:5.241cm;" alt="Image" /></p>
<ul>
<li>
<p>en <strong>[6]</strong>, la version utilisée dans ce document ;
Nous allons ici utiliser <strong>[Postman]</strong> pour tester le service web jSON précédent :</p>
</li>
<li>
<p>noux exécutons le script <strong>[flask/03/main_01]</strong> ;</p>
</li>
<li>puis nous demandons l’URL <strong>[</strong><strong>http://localhost:5000/</strong><strong>]</strong> avec Postman ;</li>
</ul>
<p><img src="images/10000000000005900000019CB152F71C.png" style="width:16.421cm;height:4.762cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, on crée une requête ;</li>
<li>en <strong>[2]</strong>, ce sera une requête HTTP GET ;</li>
<li>en <strong>[3]</strong>, l’URL du service web interrogé ;</li>
<li>en <strong>[4]</strong>, on envoie la requête au service web ;</li>
</ul>
<p><img src="images/100000000000055600000297F2FCFFBB.png" style="width:15.77cm;height:7.651cm;" alt="Image" /></p>
<ul>
<li>en <strong>[5]</strong>, on sélectionne l’onglet <strong>[Body]</strong> qui affiche le document reçu ;</li>
<li>en <strong>[6]</strong>, on sélectionne l’onglet <strong>[Pretty]</strong> qui affiche le document reçu avec une mise en forme appropriée, ici une forme appropriée à une chaîne jSON ;</li>
<li>en <strong>[7]</strong>, le document jSON reçu ;</li>
<li>en <strong>[8-9]</strong>, le document reçu sans mise en forme ;</li>
</ul>
<p><img src="images/100000000000047100000134D111797C.png" style="width:13.131cm;height:3.551cm;" alt="Image" /></p>
<ul>
<li>en <strong>[10]</strong>, on affiche les entêtes HTTP reçus par Postman ;</li>
<li>en <strong>[11]</strong>, le statut HTTP de la réponse reçue ;</li>
<li>en <strong>[12]</strong>, les entêtes HTTP reçus ;</li>
<li>en <strong>[13]</strong>, l’entête <strong>[Content-type]</strong> qui a permis à Postman de savoir qu’il allait recevoir une chaîne jSON. Postman a utilisé cette information pour mettre en forme, d’une certaine façon, le document reçu ;
Il y a une autre façon d’utiliser Postman. Elle consiste à utiliser la console Postman (Ctrl-Alt-C). Celle-ci permet de voir le dialogue client / serveur. Outre la séquence Ctrl-Alt-C, la console Postman est disponible via une icône en bas à gauche de la fenêtre principale de Postman :</li>
</ul>
<p><img src="images/10000000000001C7000001166D0BCD60.png" style="width:5.255cm;height:3.209cm;" alt="Image" /></p>
<p>La console Postman mémorise les dialogues client / serveur qui ont lieu lorsqu’une requête Postman est exécutée :</p>
<p><img src="images/1000000000000471000002F877167F67.png" style="width:13.14cm;height:8.781cm;" alt="Image" /></p>
<ul>
<li>en <strong>[3]</strong>, la liste des requêtes faites par Postman depuis qu’il a été lancé. Les plus récentes sont en bas de la liste ;</li>
<li>en <strong>[4]</strong>, la requête HTTP faite par Postman ;</li>
<li>en <strong>[5-6]</strong>, la réponse HTTP faite par le serveur web ;</li>
<li>en <strong>[7]</strong>, on peut voir les logs en mode <strong>[raw]</strong>, ç-à-d sans artifice de présentation ;
En mode <strong>[raw]</strong> la fenêtre de la console devient la suivante :</li>
</ul>
<p><img src="images/1000000000000475000001F5CC193074.png" style="width:13.151cm;height:5.792cm;" alt="Image" /></p>
<ul>
<li>en <strong>[8]</strong>, la requête HTTP faite par Postman au serveur web ;</li>
<li>en <strong>[9]</strong>, la réponse HTTP faite par le serveur web ;</li>
<li>en <strong>[10]</strong>, on peut revenir au mode <strong>[pretty logs]</strong> ;
Afin de faciliter les explications, nous numéroterons les lignes obtenues à partir de la console Postman.</li>
</ul>
<p>Pour le client :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span>
<span class="normal"><a href="#__codelineno-26-6">6</a></span>
<span class="normal"><a href="#__codelineno-26-7">7</a></span>
<span class="normal"><a href="#__codelineno-26-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="mf">70e2</span><span class="n">acaa</span><span class="o">-</span><span class="n">b3e5</span><span class="o">-</span><span class="mi">46</span><span class="n">f6</span><span class="o">-</span><span class="mi">8375</span><span class="o">-</span><span class="mf">989e6</span><span class="n">b94e694</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
</code></pre></div></td></tr></table></div>
<p>Pour le serveur :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span>
<span class="normal"><a href="#__codelineno-27-2">2</a></span>
<span class="normal"><a href="#__codelineno-27-3">3</a></span>
<span class="normal"><a href="#__codelineno-27-4">4</a></span>
<span class="normal"><a href="#__codelineno-27-5">5</a></span>
<span class="normal"><a href="#__codelineno-27-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="n">Content</span><span class="o">-</span><span class="nb">type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span> <span class="n">charser</span><span class="o">=</span><span class="n">utf8</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">56</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">13</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">17</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">56</span> <span class="n">GMT</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="p">{</span><span class="s2">&quot;prénom&quot;</span><span class="p">:</span> <span class="s2">&quot;Aglaë&quot;</span><span class="p">,</span> <span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="s2">&quot;de la Hûche&quot;</span><span class="p">,</span> <span class="s2">&quot;âge&quot;</span><span class="p">:</span> <span class="mi">87</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A partir de maintenant, nous utiliserons principalement :</p>
<ul>
<li><strong>[Postman]</strong> comme client web ;</li>
<li>la console <strong>[Postman]</strong> en <strong>[raw mode]</strong> pour expliquer le dialogue client / serveur ;</li>
</ul>
<h3 id="2243-script-main_02">22.4.3. script [main_02]</h3>
<p><img src="images/10000000000001100000012C5A3D3274.png" style="width:3.151cm;height:3.47cm;" alt="Image" /></p>
<p>Le script web <strong>[main_02]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span>
<span class="normal"><a href="#__codelineno-28-16">16</a></span>
<span class="normal"><a href="#__codelineno-28-17">17</a></span>
<span class="normal"><a href="#__codelineno-28-18">18</a></span>
<span class="normal"><a href="#__codelineno-28-19">19</a></span>
<span class="normal"><a href="#__codelineno-28-20">20</a></span>
<span class="normal"><a href="#__codelineno-28-21">21</a></span>
<span class="normal"><a href="#__codelineno-28-22">22</a></span>
<span class="normal"><a href="#__codelineno-28-23">23</a></span>
<span class="normal"><a href="#__codelineno-28-24">24</a></span>
<span class="normal"><a href="#__codelineno-28-25">25</a></span>
<span class="normal"><a href="#__codelineno-28-26">26</a></span>
<span class="normal"><a href="#__codelineno-28-27">27</a></span>
<span class="normal"><a href="#__codelineno-28-28">28</a></span>
<span class="normal"><a href="#__codelineno-28-29">29</a></span>
<span class="normal"><a href="#__codelineno-28-30">30</a></span>
<span class="normal"><a href="#__codelineno-28-31">31</a></span>
<span class="normal"><a href="#__codelineno-28-32">32</a></span>
<span class="normal"><a href="#__codelineno-28-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="c1"># imports</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="c1"># dépendances</span>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Personne</span><span class="w"> </span><span class="kn">import</span> <span class="n">Personne</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a><span class="c1"># application Flask</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a><span class="c1"># Home URL</span>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-28-19" name="__codelineno-28-19"></a>    <span class="c1"># une personne</span>
<a id="__codelineno-28-20" name="__codelineno-28-20"></a>    <span class="n">personne</span> <span class="o">=</span> <span class="n">Personne</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s2">&quot;prénom&quot;</span><span class="p">:</span> <span class="s2">&quot;Aglaë&quot;</span><span class="p">,</span> <span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="s2">&quot;de la Hûche&quot;</span><span class="p">,</span> <span class="s2">&quot;âge&quot;</span><span class="p">:</span> <span class="mi">87</span><span class="p">})</span>
<a id="__codelineno-28-21" name="__codelineno-28-21"></a>    <span class="c1"># contenu</span>
<a id="__codelineno-28-22" name="__codelineno-28-22"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;personne[</span><span class="si">{</span><span class="n">personne</span><span class="o">.</span><span class="n">prénom</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">personne</span><span class="o">.</span><span class="n">nom</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">personne</span><span class="o">.</span><span class="n">âge</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-28-23" name="__codelineno-28-23"></a>    <span class="c1"># headers HTTP</span>
<a id="__codelineno-28-24" name="__codelineno-28-24"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain; charset=utf8&quot;</span><span class="p">)</span>
<a id="__codelineno-28-25" name="__codelineno-28-25"></a>    <span class="c1"># réponse HTTP</span>
<a id="__codelineno-28-26" name="__codelineno-28-26"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-28-27" name="__codelineno-28-27"></a>
<a id="__codelineno-28-28" name="__codelineno-28-28"></a>
<a id="__codelineno-28-29" name="__codelineno-28-29"></a><span class="c1"># main uniquement</span>
<a id="__codelineno-28-30" name="__codelineno-28-30"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-28-31" name="__codelineno-28-31"></a>    <span class="c1"># on lance le serveur</span>
<a id="__codelineno-28-32" name="__codelineno-28-32"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-28-33" name="__codelineno-28-33"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>le script <strong>[main_02]</strong>est analogue au script <strong>[main_01]</strong>. Il en diffère sur deux points :</li>
<li>ligne 22 : le document envoyé au client est une chaîne de caractères brute, pas une chaîne jSON ;</li>
<li>ligne 24 : ceci est reflété dans l’entête HTTP <strong>[Content-Type]</strong> qui indique le type <strong>[text/plain]</strong> pour le document ;
Nous exécutons le script web <strong>[main_02]</strong> puis utilisons <strong>[Postman]</strong> pour l’interroger :</li>
</ul>
<p><img src="images/1000000000000591000002258E75C96F.png" style="width:16.431cm;height:6.34cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1-3]</strong>, on fait la requête au service web ;</li>
<li>en <strong>[5]</strong>, le statut OK de la réponse ;</li>
<li>en <strong>[4, 6]</strong>, les entêtes HTTP de la réponse ;</li>
<li>en <strong>[7]</strong>, l’entête <strong>[Content-Type]</strong> ;</li>
<li>en <strong>[8-10]</strong>, le document envoyé par le service web, une chaîne de caractères ;
La console Postman donne les logs suivants :</li>
</ul>
<p>Requête du client :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span>
<span class="normal"><a href="#__codelineno-29-4">4</a></span>
<span class="normal"><a href="#__codelineno-29-5">5</a></span>
<span class="normal"><a href="#__codelineno-29-6">6</a></span>
<span class="normal"><a href="#__codelineno-29-7">7</a></span>
<span class="normal"><a href="#__codelineno-29-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="mi">7</span><span class="n">c7fc9f3</span><span class="o">-</span><span class="mi">8</span><span class="n">df8</span><span class="o">-</span><span class="mi">49</span><span class="n">ae</span><span class="o">-</span><span class="mi">9</span><span class="n">dc8</span><span class="o">-</span><span class="mi">53</span><span class="n">c2d87d111a</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
</code></pre></div></td></tr></table></div>
<p>Réponse du serveur :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1">1</a></span>
<span class="normal"><a href="#__codelineno-30-2">2</a></span>
<span class="normal"><a href="#__codelineno-30-3">3</a></span>
<span class="normal"><a href="#__codelineno-30-4">4</a></span>
<span class="normal"><a href="#__codelineno-30-5">5</a></span>
<span class="normal"><a href="#__codelineno-30-6">6</a></span>
<span class="normal"><a href="#__codelineno-30-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf8</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">34</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">13</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">17</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">22</span> <span class="n">GMT</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="n">personne</span><span class="p">[</span><span class="n">Aglaë</span><span class="p">,</span> <span class="n">de</span> <span class="n">la</span> <span class="n">Hûche</span><span class="p">,</span> <span class="mi">87</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<h3 id="2244-script-main_03">22.4.4. script [main_03]</h3>
<p><img src="images/10000000000000D4000000E9B2521BDF.png" style="width:2.44cm;height:2.691cm;" alt="Image" /></p>
<p>Le script web <strong>[main_03]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span>
<span class="normal"><a href="#__codelineno-31-22">22</a></span>
<span class="normal"><a href="#__codelineno-31-23">23</a></span>
<span class="normal"><a href="#__codelineno-31-24">24</a></span>
<span class="normal"><a href="#__codelineno-31-25">25</a></span>
<span class="normal"><a href="#__codelineno-31-26">26</a></span>
<span class="normal"><a href="#__codelineno-31-27">27</a></span>
<span class="normal"><a href="#__codelineno-31-28">28</a></span>
<span class="normal"><a href="#__codelineno-31-29">29</a></span>
<span class="normal"><a href="#__codelineno-31-30">30</a></span>
<span class="normal"><a href="#__codelineno-31-31">31</a></span>
<span class="normal"><a href="#__codelineno-31-32">32</a></span>
<span class="normal"><a href="#__codelineno-31-33">33</a></span>
<span class="normal"><a href="#__codelineno-31-34">34</a></span>
<span class="normal"><a href="#__codelineno-31-35">35</a></span>
<span class="normal"><a href="#__codelineno-31-36">36</a></span>
<span class="normal"><a href="#__codelineno-31-37">37</a></span>
<span class="normal"><a href="#__codelineno-31-38">38</a></span>
<span class="normal"><a href="#__codelineno-31-39">39</a></span>
<span class="normal"><a href="#__codelineno-31-40">40</a></span>
<span class="normal"><a href="#__codelineno-31-41">41</a></span>
<span class="normal"><a href="#__codelineno-31-42">42</a></span>
<span class="normal"><a href="#__codelineno-31-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="c1"># imports</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="c1"># dépendances</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">MyException</span><span class="w"> </span><span class="kn">import</span> <span class="n">MyException</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Personne</span><span class="w"> </span><span class="kn">import</span> <span class="n">Personne</span>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="c1"># application Flask</span>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="c1"># Home URL</span>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-31-20" name="__codelineno-31-20"></a>    <span class="c1"># une personne incorrecte</span>
<a id="__codelineno-31-21" name="__codelineno-31-21"></a>    <span class="n">msg_erreur</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-31-22" name="__codelineno-31-22"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-31-23" name="__codelineno-31-23"></a>        <span class="n">personne</span> <span class="o">=</span> <span class="n">Personne</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s2">&quot;prénom&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;âge&quot;</span><span class="p">:</span> <span class="mi">87</span><span class="p">})</span>
<a id="__codelineno-31-24" name="__codelineno-31-24"></a>    <span class="k">except</span> <span class="n">MyException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-31-25" name="__codelineno-31-25"></a>        <span class="n">msg_erreur</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-31-26" name="__codelineno-31-26"></a>    <span class="c1"># erreur ?</span>
<a id="__codelineno-31-27" name="__codelineno-31-27"></a>    <span class="k">if</span> <span class="n">msg_erreur</span><span class="p">:</span>
<a id="__codelineno-31-28" name="__codelineno-31-28"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">msg_erreur</span><span class="p">)</span>
<a id="__codelineno-31-29" name="__codelineno-31-29"></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span>
<a id="__codelineno-31-30" name="__codelineno-31-30"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-31-31" name="__codelineno-31-31"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;personne[</span><span class="si">{</span><span class="n">personne</span><span class="o">.</span><span class="n">prénom</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">personne</span><span class="o">.</span><span class="n">nom</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">personne</span><span class="o">.</span><span class="n">âge</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<a id="__codelineno-31-32" name="__codelineno-31-32"></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-31-33" name="__codelineno-31-33"></a>    <span class="c1"># headers HTTP</span>
<a id="__codelineno-31-34" name="__codelineno-31-34"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;text/plain; charset=utf8&quot;</span><span class="p">)</span>
<a id="__codelineno-31-35" name="__codelineno-31-35"></a>    <span class="c1"># réponse HTTP</span>
<a id="__codelineno-31-36" name="__codelineno-31-36"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status_code</span>
<a id="__codelineno-31-37" name="__codelineno-31-37"></a>
<a id="__codelineno-31-38" name="__codelineno-31-38"></a>
<a id="__codelineno-31-39" name="__codelineno-31-39"></a><span class="c1"># main uniquement</span>
<a id="__codelineno-31-40" name="__codelineno-31-40"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-31-41" name="__codelineno-31-41"></a>    <span class="c1"># on lance le serveur</span>
<a id="__codelineno-31-42" name="__codelineno-31-42"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-31-43" name="__codelineno-31-43"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 23 : on provoque une erreur en instanciant une personne incorrecte ;</li>
<li>lignes 27-29 : à cause de l’erreur :</li>
<li>ligne 28 : on prépare une réponse HTTP ayant comme contenu le message d’erreur ;</li>
<li>ligne 29 : on donne au code de statut HTTP une valeur d’erreur <strong>[500 Internal Server Error]</strong> ;</li>
<li>ligne 34 : on indique au client qu’on lui envoie un texte brut ;</li>
<li>ligne 36 : on envoie la réponse HTTP au client ;
Nous lançons le service web <strong>[main_03]</strong> et nous utilisons Postman pour l’interroger :</li>
</ul>
<p><img src="images/100000000000047000000196AB227CD6.png" style="width:13.131cm;height:4.68cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1-3]</strong>, nous envoyons la requête ;</li>
<li>en <strong>[4]</strong>, on obtient une réponse avec un code de statut <strong>[500 INTERNAL SERVER ERROR]</strong> ;</li>
<li>en <strong>[5-7]</strong> : la réponse est un texte décrivant l’erreur qui s’est produite ;</li>
</ul>
<p><img src="images/10000000000004730000010EBBAEA7D2.png" style="width:13.131cm;height:3.121cm;" alt="Image" /></p>
<ul>
<li>en <strong>[8-10]</strong>, les entêtes HTTP de la réponse du service web ;
Dans la console Postman, les résultats en mode <strong>[raw]</strong> sont les suivants :</li>
</ul>
<p>Requête du client :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span>
<span class="normal"><a href="#__codelineno-32-6">6</a></span>
<span class="normal"><a href="#__codelineno-32-7">7</a></span>
<span class="normal"><a href="#__codelineno-32-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="mi">925</span><span class="n">ff036</span><span class="o">-</span><span class="n">a360</span><span class="o">-</span><span class="mi">47</span><span class="n">af</span><span class="o">-</span><span class="n">adf6</span><span class="o">-</span><span class="mi">78173</span><span class="n">c01a247</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
</code></pre></div></td></tr></table></div>
<p>Réponse du serveur :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span>
<span class="normal"><a href="#__codelineno-33-2">2</a></span>
<span class="normal"><a href="#__codelineno-33-3">3</a></span>
<span class="normal"><a href="#__codelineno-33-4">4</a></span>
<span class="normal"><a href="#__codelineno-33-5">5</a></span>
<span class="normal"><a href="#__codelineno-33-6">6</a></span>
<span class="normal"><a href="#__codelineno-33-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">500</span> <span class="n">INTERNAL</span> <span class="n">SERVER</span> <span class="n">ERROR</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf8</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">74</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Mon</span><span class="p">,</span> <span class="mi">13</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">17</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">24</span> <span class="n">GMT</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="n">MyException</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="n">Le</span> <span class="n">prénom</span> <span class="n">doit</span> <span class="n">être</span> <span class="n">une</span> <span class="n">chaîne</span> <span class="n">de</span> <span class="n">caractères</span> <span class="n">non</span> <span class="n">vide</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<h2 id="225-scripts-flask04-informations-encapsulees-dans-la-requete">22.5. scripts [flask/04] : informations encapsulées dans la requête</h2>
<p><img src="images/1000000000000129000000E646EF8C1E.png" style="width:3.432cm;height:2.661cm;" alt="Image" /></p>
<p>Le script <strong>[request_parameters.py]</strong> se propose de montrer que le service web a accès à diverses informations encapsulées dans la requête d’un client web. Le code est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span>
<span class="normal"><a href="#__codelineno-34-18">18</a></span>
<span class="normal"><a href="#__codelineno-34-19">19</a></span>
<span class="normal"><a href="#__codelineno-34-20">20</a></span>
<span class="normal"><a href="#__codelineno-34-21">21</a></span>
<span class="normal"><a href="#__codelineno-34-22">22</a></span>
<span class="normal"><a href="#__codelineno-34-23">23</a></span>
<span class="normal"><a href="#__codelineno-34-24">24</a></span>
<span class="normal"><a href="#__codelineno-34-25">25</a></span>
<span class="normal"><a href="#__codelineno-34-26">26</a></span>
<span class="normal"><a href="#__codelineno-34-27">27</a></span>
<span class="normal"><a href="#__codelineno-34-28">28</a></span>
<span class="normal"><a href="#__codelineno-34-29">29</a></span>
<span class="normal"><a href="#__codelineno-34-30">30</a></span>
<span class="normal"><a href="#__codelineno-34-31">31</a></span>
<span class="normal"><a href="#__codelineno-34-32">32</a></span>
<span class="normal"><a href="#__codelineno-34-33">33</a></span>
<span class="normal"><a href="#__codelineno-34-34">34</a></span>
<span class="normal"><a href="#__codelineno-34-35">35</a></span>
<span class="normal"><a href="#__codelineno-34-36">36</a></span>
<span class="normal"><a href="#__codelineno-34-37">37</a></span>
<span class="normal"><a href="#__codelineno-34-38">38</a></span>
<span class="normal"><a href="#__codelineno-34-39">39</a></span>
<span class="normal"><a href="#__codelineno-34-40">40</a></span>
<span class="normal"><a href="#__codelineno-34-41">41</a></span>
<span class="normal"><a href="#__codelineno-34-42">42</a></span>
<span class="normal"><a href="#__codelineno-34-43">43</a></span>
<span class="normal"><a href="#__codelineno-34-44">44</a></span>
<span class="normal"><a href="#__codelineno-34-45">45</a></span>
<span class="normal"><a href="#__codelineno-34-46">46</a></span>
<span class="normal"><a href="#__codelineno-34-47">47</a></span>
<span class="normal"><a href="#__codelineno-34-48">48</a></span>
<span class="normal"><a href="#__codelineno-34-49">49</a></span>
<span class="normal"><a href="#__codelineno-34-50">50</a></span>
<span class="normal"><a href="#__codelineno-34-51">51</a></span>
<span class="normal"><a href="#__codelineno-34-52">52</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="c1"># import</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">request</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="c1"># application Flask</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="c1"># Home URL</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a>    <span class="c1"># paramètres de la requête</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a>    <span class="n">request_data</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;environ&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;full_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">full_path</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;script_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">script_root</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span>
<a id="__codelineno-34-18" name="__codelineno-34-18"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;base_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">base_url</span>
<a id="__codelineno-34-19" name="__codelineno-34-19"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;url_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url_root</span>
<a id="__codelineno-34-20" name="__codelineno-34-20"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;accept_charsets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">accept_charsets</span>
<a id="__codelineno-34-21" name="__codelineno-34-21"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;accept_encodings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">accept_encodings</span>
<a id="__codelineno-34-22" name="__codelineno-34-22"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;accept_languages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">accept_languages</span>
<a id="__codelineno-34-23" name="__codelineno-34-23"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;accept_mimetypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">accept_mimetypes</span>
<a id="__codelineno-34-24" name="__codelineno-34-24"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;args&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span>
<a id="__codelineno-34-25" name="__codelineno-34-25"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;content_encoding&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">content_encoding</span>
<a id="__codelineno-34-26" name="__codelineno-34-26"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;content_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">content_length</span>
<a id="__codelineno-34-27" name="__codelineno-34-27"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;content_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">content_type</span>
<a id="__codelineno-34-28" name="__codelineno-34-28"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;endpoint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">endpoint</span>
<a id="__codelineno-34-29" name="__codelineno-34-29"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span>
<a id="__codelineno-34-30" name="__codelineno-34-30"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;form&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span>
<a id="__codelineno-34-31" name="__codelineno-34-31"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">host</span>
<a id="__codelineno-34-32" name="__codelineno-34-32"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span>
<a id="__codelineno-34-33" name="__codelineno-34-33"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;query_string&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_string</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<a id="__codelineno-34-34" name="__codelineno-34-34"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;referrer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">referrer</span>
<a id="__codelineno-34-35" name="__codelineno-34-35"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;remote_addr&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
<a id="__codelineno-34-36" name="__codelineno-34-36"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;remote_user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">remote_user</span>
<a id="__codelineno-34-37" name="__codelineno-34-37"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;scheme&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">scheme</span>
<a id="__codelineno-34-38" name="__codelineno-34-38"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;script_root&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">script_root</span>
<a id="__codelineno-34-39" name="__codelineno-34-39"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;user_agent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">user_agent</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-34-40" name="__codelineno-34-40"></a>    <span class="n">request_data</span><span class="p">[</span><span class="s2">&quot;values&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-34-41" name="__codelineno-34-41"></a>    <span class="c1"># réponse HTTP</span>
<a id="__codelineno-34-42" name="__codelineno-34-42"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">request_data</span><span class="p">)</span>
<a id="__codelineno-34-43" name="__codelineno-34-43"></a>    <span class="c1"># headers HTTP</span>
<a id="__codelineno-34-44" name="__codelineno-34-44"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;application/json; charset=utf-8&quot;</span>
<a id="__codelineno-34-45" name="__codelineno-34-45"></a>    <span class="c1"># envoi réponse HTTP</span>
<a id="__codelineno-34-46" name="__codelineno-34-46"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-34-47" name="__codelineno-34-47"></a>
<a id="__codelineno-34-48" name="__codelineno-34-48"></a>
<a id="__codelineno-34-49" name="__codelineno-34-49"></a><span class="c1"># main</span>
<a id="__codelineno-34-50" name="__codelineno-34-50"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-34-51" name="__codelineno-34-51"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-34-52" name="__codelineno-34-52"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : nous introduisons un changement. Nous précisons quelles sont les verbes autorisés dans la requête du client. Postman en donne la liste :</li>
</ul>
<p><img src="images/100000000000011B0000030AF9D48BCD.png" style="width:3.26cm;height:8.97cm;" alt="Image" /></p>
<p>Les deux premiers <strong>[GET, POST]</strong> sont les plus utilisés et seront également les seuls à être utilisés dans ce document. Pour en revenir à la ligne 9 du code, le paramètre <strong>[methods]</strong> contient la liste des méthodes de la liste ci-dessus autorisées par l’URL. En l’absence de ce paramètre, seule la méthode <strong>[GET]</strong> est autorisée. C’est ce qui s’est passé jusqu’à maintenant ;</p>
<ul>
<li>ligne 12 : nous allons construire le dictionnaire <strong>[request_data]</strong> ;</li>
<li>ligne 13 : la requête du client est disponible dans un objet prédéfini <strong>[request]</strong>, importé ligne 2, de type <strong>[werkzeug.local.LocalProxy]</strong>.  Les lignes qui suivent récupèrent divers attributs de cet objet ;</li>
<li>plutôt que de détailler chaque attribut de l’objet <strong>[request]</strong>, nous allons exécuter ce code et regarder les résultats. On comprendra alors mieux la signification des différents attributs affichés ;</li>
<li>ligne 42 : le dictionnaire <strong>[request_data]</strong> sera le contenu de la réponse HTTP. On se rappelle que celui-ci doit être du texte. Flask transforme automatiquement les dictionnaires en chaînes jSON ;</li>
<li>ligne 44 : on dit au client qu’il va recevoir du jSON ;</li>
<li>ligne 46 : on envoie la réponse au client ;
Avec le client Postman, nous envoyons la requête suivante au service web précédent :</li>
</ul>
<p><img src="images/1000000000000355000001279C3C2397.png" style="width:9.861cm;height:3.402cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1-2]</strong>, la requête envoyée ;</li>
<li>en <strong>[2]</strong>, la requête est paramétrée. Les paramètres sont accolés à l’URL sous la forme <strong>[ ?param1=valeur1&amp;param2=valeur2]</strong>. Il y a deux façons de saisir ces paramètres dans Postman :</li>
<li>les écrire directement dans l’URL ;</li>
<li>les écrire en <strong>[3-4]</strong> ;
Les deux méthodes sont équivalentes ;</li>
</ul>
<p>Nous ajoutons d’autres paramètres à la requête :</p>
<p><img src="images/10000000000003550000016362893FC7.png" style="width:9.842cm;height:4.089cm;" alt="Image" /></p>
<ul>
<li>en <strong>[5-7]</strong>, nous ajoutons des paramètres dans le corps (=body) de le requête. Alors que les paramètres de l’URL sont visibles par l’utilisateur d’un navigateur web, ceux qui font partie du corps de la requête ne sont pas visibles. Le navigateur (ou Postman ici) les envoie au serveur après les entêtes HTTP. La requête du client web a alors la même structure que la réponse du serveur web : des entêtes HTTP suivis par un document. Cela va faire apparaître deux nouveaux entêtes HTTP dans la requête du client :</li>
<li><strong>[Content-Type]</strong> : le client dit au serveur quel type de document il envoie ;</li>
<li><strong>[Content-Length]</strong> : la taille du document en octets ;</li>
<li>en <strong>[6]</strong>, le codage à employer pour les paramètres déclarés en <strong>[7]</strong>. Ceux-ci peuvent être codés de diverses façons. <strong>[x-www-form-urlencoded]</strong> est une méthode utilisée fréquemment par les navigateurs ;
On peut voir la requête qui va être générée :</li>
</ul>
<p><img src="images/10000000000005C5000001E4CE668DE2.png" style="width:17.061cm;height:5.591cm;" alt="Image" /></p>
<p>La réponse à cette requête est la suivante :</p>
<p><img src="images/100000000000029400000327DAF520BB.png" style="width:7.61cm;height:9.311cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1-5]</strong>, on a reçu une chaîne jSON <strong>[3]</strong> ;</li>
<li>ce qui généralement intéresse le service web, ce sont les paramètres de l’URL <strong>[ ?param1=valeur1&amp;param2=valeur2]</strong> et ceux qui ont été transmis dans le corps de la requête (document). C’est comme ça, en général, que le client lui transmet des informations. On voit en <strong>[5]</strong> que les paramètres de l’URL sont disponibles dans <strong>[request.args]</strong> ;
Le reste de la réponse est le suivant :</li>
</ul>
<p><img src="images/10000000000005A900000371BAFD4484.png" style="width:16.731cm;height:10.171cm;" alt="Image" /></p>
<ul>
<li>en <strong>[9]</strong>, les attributs des paramètres mis dans le corps de la requête :</li>
<li><strong>[content_type]</strong> est le type du document accompagnant la requête. On a vu que ce document contenait des informations de type <strong>[param=valeur]</strong> encodées sous la forme <strong>[x-www-form-urlencoded]</strong>. Postman a donc généré un entête HTTP <strong>[Content-Type]</strong> indiquant la nature du document ;</li>
<li><strong>[content_length]</strong> est la taille en octets de ce document ;</li>
<li>en <strong>[10]</strong>, l’attribut <strong>[request.environ]</strong> contient de nombreuses informations sur l’environnement dans lequel la requête du client est traitée. La plupart de ces informations se retrouvent dans les autres attributs de l’objet <strong>[request]</strong> ;</li>
<li>en <strong>[11]</strong>, les paramètres présents dans le corps de la requête sont disponibles dans l’attribut <strong>[request.form]</strong> ;</li>
<li>en <strong>[12]</strong>, la méthode utilisée pour envoyer la requête, ici la méthode <strong>[GET]</strong> ;</li>
<li>en <strong>[13]</strong>, l’attribut <strong>[request.values]</strong> est le dictionnaire de tous les paramètres, ceux de l’URL et ceux du corps du document. Pour obtenir les paramètres de la requête, on utilisera l’attribut :</li>
<li><strong>[request.args]</strong> pour avoir ceux présents dans l’URL ;</li>
<li><strong>[request.form]</strong> pour avoir ceux présents dans le corps du document ;
Dans la console Postman, les logs sont les suivants :</li>
</ul>
<p>Requête du client :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="n">GET</span> <span class="o">/</span><span class="err">?</span><span class="n">param1</span><span class="o">=</span><span class="n">valeur1</span><span class="o">&amp;</span><span class="n">param2</span><span class="o">=</span><span class="n">valeur2</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="n">cbfac6aa</span><span class="o">-</span><span class="mi">71</span><span class="n">a0</span><span class="o">-</span><span class="mi">4076</span><span class="o">-</span><span class="n">a0c3</span><span class="o">-</span><span class="mi">91</span><span class="n">d36d74a4c0</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">www</span><span class="o">-</span><span class="n">form</span><span class="o">-</span><span class="n">urlencoded</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">60</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="n">nom</span><span class="o">=</span><span class="n">s</span><span class="o">%</span><span class="n">C3</span><span class="o">%</span><span class="n">A9l</span><span class="o">%</span><span class="n">C3</span><span class="o">%</span><span class="n">A9n</span><span class="o">%</span><span class="n">C3</span><span class="o">%</span><span class="n">A9</span><span class="o">&amp;</span><span class="n">pr</span><span class="o">%</span><span class="n">C3</span><span class="o">%</span><span class="n">A9nom</span><span class="o">=</span><span class="n">agla</span><span class="o">%</span><span class="n">C3</span><span class="o">%</span><span class="n">AB</span><span class="o">&amp;%</span><span class="n">C3</span><span class="o">%</span><span class="n">A2ge</span><span class="o">=</span><span class="mi">77</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : le type du document envoyé ligne 12 au serveur ;</li>
<li>ligne 11 : les entêtes HTTP de la requête sont séparés du document envoyé par une ligne vide. C’est comme cela que le serveur repère la fin des entêtes HTTP du client ;</li>
<li>ligne 12 : le document ‘url-encodé’. Tous les caractères accentués ont subi un encodage ;
La réponse du client est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-36-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-36-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-36-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span>
<span class="normal"><a href="#__codelineno-36-17">17</a></span>
<span class="normal"><a href="#__codelineno-36-18">18</a></span>
<span class="normal"><a href="#__codelineno-36-19">19</a></span>
<span class="normal"><a href="#__codelineno-36-20">20</a></span>
<span class="normal"><a href="#__codelineno-36-21">21</a></span>
<span class="normal"><a href="#__codelineno-36-22">22</a></span>
<span class="normal"><a href="#__codelineno-36-23">23</a></span>
<span class="normal"><a href="#__codelineno-36-24">24</a></span>
<span class="normal"><a href="#__codelineno-36-25">25</a></span>
<span class="normal"><a href="#__codelineno-36-26">26</a></span>
<span class="normal"><a href="#__codelineno-36-27">27</a></span>
<span class="normal"><a href="#__codelineno-36-28">28</a></span>
<span class="normal"><a href="#__codelineno-36-29">29</a></span>
<span class="normal"><a href="#__codelineno-36-30">30</a></span>
<span class="normal"><a href="#__codelineno-36-31">31</a></span>
<span class="normal"><a href="#__codelineno-36-32">32</a></span>
<span class="normal"><a href="#__codelineno-36-33">33</a></span>
<span class="normal"><a href="#__codelineno-36-34">34</a></span>
<span class="normal"><a href="#__codelineno-36-35">35</a></span>
<span class="normal"><a href="#__codelineno-36-36">36</a></span>
<span class="normal"><a href="#__codelineno-36-37">37</a></span>
<span class="normal"><a href="#__codelineno-36-38">38</a></span>
<span class="normal"><a href="#__codelineno-36-39">39</a></span>
<span class="normal"><a href="#__codelineno-36-40">40</a></span>
<span class="normal"><a href="#__codelineno-36-41">41</a></span>
<span class="normal"><a href="#__codelineno-36-42">42</a></span>
<span class="normal"><a href="#__codelineno-36-43">43</a></span>
<span class="normal"><a href="#__codelineno-36-44">44</a></span>
<span class="normal"><a href="#__codelineno-36-45">45</a></span>
<span class="normal"><a href="#__codelineno-36-46">46</a></span>
<span class="normal"><a href="#__codelineno-36-47">47</a></span>
<span class="normal"><a href="#__codelineno-36-48">48</a></span>
<span class="normal"><a href="#__codelineno-36-49">49</a></span>
<span class="normal"><a href="#__codelineno-36-50">50</a></span>
<span class="normal"><a href="#__codelineno-36-51">51</a></span>
<span class="normal"><a href="#__codelineno-36-52">52</a></span>
<span class="normal"><a href="#__codelineno-36-53">53</a></span>
<span class="normal"><a href="#__codelineno-36-54">54</a></span>
<span class="normal"><a href="#__codelineno-36-55">55</a></span>
<span class="normal"><a href="#__codelineno-36-56">56</a></span>
<span class="normal"><a href="#__codelineno-36-57">57</a></span>
<span class="normal"><a href="#__codelineno-36-58">58</a></span>
<span class="normal"><a href="#__codelineno-36-59">59</a></span>
<span class="normal"><a href="#__codelineno-36-60">60</a></span>
<span class="normal"><a href="#__codelineno-36-61">61</a></span>
<span class="normal"><a href="#__codelineno-36-62">62</a></span>
<span class="normal"><a href="#__codelineno-36-63">63</a></span>
<span class="normal"><a href="#__codelineno-36-64">64</a></span>
<span class="normal"><a href="#__codelineno-36-65">65</a></span>
<span class="normal"><a href="#__codelineno-36-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-36-3" name="__codelineno-36-3"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">2433</span>
<a id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">15</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">09</span> <span class="n">GMT</span>
<a id="__codelineno-36-6" name="__codelineno-36-6"></a>
<a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="p">{</span>
<a id="__codelineno-36-8" name="__codelineno-36-8"></a>  <span class="s2">&quot;accept_charsets&quot;</span><span class="p">:</span> <span class="p">[],</span> 
<a id="__codelineno-36-9" name="__codelineno-36-9"></a>  <span class="s2">&quot;accept_encodings&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-36-10" name="__codelineno-36-10"></a>    <span class="p">[</span>
<a id="__codelineno-36-11" name="__codelineno-36-11"></a>      <span class="s2">&quot;gzip&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-12" name="__codelineno-36-12"></a>      <span class="mi">1</span>
<a id="__codelineno-36-13" name="__codelineno-36-13"></a>    <span class="p">],</span> 
<a id="__codelineno-36-14" name="__codelineno-36-14"></a>    <span class="p">[</span>
<a id="__codelineno-36-15" name="__codelineno-36-15"></a>      <span class="s2">&quot;deflate&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-16" name="__codelineno-36-16"></a>      <span class="mi">1</span>
<a id="__codelineno-36-17" name="__codelineno-36-17"></a>    <span class="p">],</span> 
<a id="__codelineno-36-18" name="__codelineno-36-18"></a>    <span class="p">[</span>
<a id="__codelineno-36-19" name="__codelineno-36-19"></a>      <span class="s2">&quot;br&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-20" name="__codelineno-36-20"></a>      <span class="mi">1</span>
<a id="__codelineno-36-21" name="__codelineno-36-21"></a>    <span class="p">]</span>
<a id="__codelineno-36-22" name="__codelineno-36-22"></a>  <span class="p">],</span> 
<a id="__codelineno-36-23" name="__codelineno-36-23"></a>  <span class="s2">&quot;accept_languages&quot;</span><span class="p">:</span> <span class="p">[],</span> 
<a id="__codelineno-36-24" name="__codelineno-36-24"></a>  <span class="s2">&quot;accept_mimetypes&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-36-25" name="__codelineno-36-25"></a>    <span class="p">[</span>
<a id="__codelineno-36-26" name="__codelineno-36-26"></a>      <span class="s2">&quot;*/*&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-27" name="__codelineno-36-27"></a>      <span class="mi">1</span>
<a id="__codelineno-36-28" name="__codelineno-36-28"></a>    <span class="p">]</span>
<a id="__codelineno-36-29" name="__codelineno-36-29"></a>  <span class="p">],</span> 
<a id="__codelineno-36-30" name="__codelineno-36-30"></a>  <span class="s2">&quot;args&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-36-31" name="__codelineno-36-31"></a>    <span class="s2">&quot;param1&quot;</span><span class="p">:</span> <span class="s2">&quot;valeur1&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-32" name="__codelineno-36-32"></a>    <span class="s2">&quot;param2&quot;</span><span class="p">:</span> <span class="s2">&quot;valeur2&quot;</span>
<a id="__codelineno-36-33" name="__codelineno-36-33"></a>  <span class="p">},</span> 
<a id="__codelineno-36-34" name="__codelineno-36-34"></a>  <span class="s2">&quot;base_url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:5000/&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-35" name="__codelineno-36-35"></a>  <span class="s2">&quot;content_encoding&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> 
<a id="__codelineno-36-36" name="__codelineno-36-36"></a>  <span class="s2">&quot;content_length&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> 
<a id="__codelineno-36-37" name="__codelineno-36-37"></a>  <span class="s2">&quot;content_type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-38" name="__codelineno-36-38"></a>  <span class="s2">&quot;endpoint&quot;</span><span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-39" name="__codelineno-36-39"></a>  <span class="s2">&quot;environ&quot;</span><span class="p">:</span> <span class="s2">&quot;{&#39;wsgi.version&#39;: (1, 0), &#39;wsgi.url_scheme&#39;: &#39;http&#39;, &#39;wsgi.input&#39;: &lt;_io.BufferedReader name=908&gt;, &#39;wsgi.errors&#39;: &lt;_io.TextIOWrapper name=&#39;&lt;stderr&gt;&#39; mode=&#39;w&#39; encoding=&#39;utf-8&#39;&gt;, &#39;wsgi.multithread&#39;: True, &#39;wsgi.multiprocess&#39;: False, &#39;wsgi.run_once&#39;: False, &#39;werkzeug.server.shutdown&#39;: &lt;function WSGIRequestHandler.make_environ.&lt;locals&gt;.shutdown_server at 0x00000173CA6E5160&gt;, &#39;SERVER_SOFTWARE&#39;: &#39;Werkzeug/1.0.1&#39;, &#39;REQUEST_METHOD&#39;: &#39;GET&#39;, &#39;SCRIPT_NAME&#39;: &#39;&#39;, &#39;PATH_INFO&#39;: &#39;/&#39;, &#39;QUERY_STRING&#39;: &#39;param1=valeur1&amp;param2=valeur2&#39;, &#39;REQUEST_URI&#39;: &#39;/?param1=valeur1&amp;param2=valeur2&#39;, &#39;RAW_URI&#39;: &#39;/?param1=valeur1&amp;param2=valeur2&#39;, &#39;REMOTE_ADDR&#39;: &#39;127.0.0.1&#39;, &#39;REMOTE_PORT&#39;: 50592, &#39;SERVER_NAME&#39;: &#39;127.0.0.1&#39;, &#39;SERVER_PORT&#39;: &#39;5000&#39;, &#39;SERVER_PROTOCOL&#39;: &#39;HTTP/1.1&#39;, &#39;HTTP_USER_AGENT&#39;: &#39;PostmanRuntime/7.26.1&#39;, &#39;HTTP_ACCEPT&#39;: &#39;*/*&#39;, &#39;HTTP_CACHE_CONTROL&#39;: &#39;no-cache&#39;, &#39;HTTP_POSTMAN_TOKEN&#39;: &#39;cbfac6aa-71a0-4076-a0c3-91d36d74a4c0&#39;, &#39;HTTP_HOST&#39;: &#39;localhost:5000&#39;, &#39;HTTP_ACCEPT_ENCODING&#39;: &#39;gzip, deflate, br&#39;, &#39;HTTP_CONNECTION&#39;: &#39;keep-alive&#39;, &#39;CONTENT_TYPE&#39;: &#39;application/x-www-form-urlencoded&#39;, &#39;CONTENT_LENGTH&#39;: &#39;60&#39;, &#39;werkzeug.request&#39;: &lt;Request &#39;http://localhost:5000/?param1=valeur1&amp;param2=valeur2&#39; [GET]&gt;}&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-40" name="__codelineno-36-40"></a>  <span class="s2">&quot;files&quot;</span><span class="p">:</span> <span class="p">{},</span> 
<a id="__codelineno-36-41" name="__codelineno-36-41"></a>  <span class="s2">&quot;form&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-36-42" name="__codelineno-36-42"></a>    <span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="s2">&quot;s</span><span class="se">\u00e9</span><span class="s2">l</span><span class="se">\u00e9</span><span class="s2">n</span><span class="se">\u00e9</span><span class="s2">&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-43" name="__codelineno-36-43"></a>    <span class="s2">&quot;pr</span><span class="se">\u00e9</span><span class="s2">nom&quot;</span><span class="p">:</span> <span class="s2">&quot;agla</span><span class="se">\u00eb</span><span class="s2">&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-44" name="__codelineno-36-44"></a>    <span class="s2">&quot;</span><span class="se">\u00e2</span><span class="s2">ge&quot;</span><span class="p">:</span> <span class="s2">&quot;77&quot;</span>
<a id="__codelineno-36-45" name="__codelineno-36-45"></a>  <span class="p">},</span> 
<a id="__codelineno-36-46" name="__codelineno-36-46"></a>  <span class="s2">&quot;full_path&quot;</span><span class="p">:</span> <span class="s2">&quot;/?param1=valeur1&amp;param2=valeur2&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-47" name="__codelineno-36-47"></a>  <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost:5000&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-48" name="__codelineno-36-48"></a>  <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-49" name="__codelineno-36-49"></a>  <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-50" name="__codelineno-36-50"></a>  <span class="s2">&quot;query_string&quot;</span><span class="p">:</span> <span class="s2">&quot;param1=valeur1&amp;param2=valeur2&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-51" name="__codelineno-36-51"></a>  <span class="s2">&quot;referrer&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> 
<a id="__codelineno-36-52" name="__codelineno-36-52"></a>  <span class="s2">&quot;remote_addr&quot;</span><span class="p">:</span> <span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-53" name="__codelineno-36-53"></a>  <span class="s2">&quot;remote_user&quot;</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span> 
<a id="__codelineno-36-54" name="__codelineno-36-54"></a>  <span class="s2">&quot;scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-55" name="__codelineno-36-55"></a>  <span class="s2">&quot;script_root&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-56" name="__codelineno-36-56"></a>  <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:5000/?param1=valeur1&amp;param2=valeur2&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-57" name="__codelineno-36-57"></a>  <span class="s2">&quot;url_root&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:5000/&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-58" name="__codelineno-36-58"></a>  <span class="s2">&quot;user_agent&quot;</span><span class="p">:</span> <span class="s2">&quot;PostmanRuntime/7.26.1&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-59" name="__codelineno-36-59"></a>  <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-36-60" name="__codelineno-36-60"></a>    <span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="s2">&quot;s</span><span class="se">\u00e9</span><span class="s2">l</span><span class="se">\u00e9</span><span class="s2">n</span><span class="se">\u00e9</span><span class="s2">&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-61" name="__codelineno-36-61"></a>    <span class="s2">&quot;param1&quot;</span><span class="p">:</span> <span class="s2">&quot;valeur1&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-62" name="__codelineno-36-62"></a>    <span class="s2">&quot;param2&quot;</span><span class="p">:</span> <span class="s2">&quot;valeur2&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-63" name="__codelineno-36-63"></a>    <span class="s2">&quot;pr</span><span class="se">\u00e9</span><span class="s2">nom&quot;</span><span class="p">:</span> <span class="s2">&quot;agla</span><span class="se">\u00eb</span><span class="s2">&quot;</span><span class="p">,</span> 
<a id="__codelineno-36-64" name="__codelineno-36-64"></a>    <span class="s2">&quot;</span><span class="se">\u00e2</span><span class="s2">ge&quot;</span><span class="p">:</span> <span class="s2">&quot;77&quot;</span>
<a id="__codelineno-36-65" name="__codelineno-36-65"></a>  <span class="p">}</span>
<a id="__codelineno-36-66" name="__codelineno-36-66"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 1-5 : les entêtes HTTP de la réponse terminés par une ligne vide ;</li>
<li>lignes 41-45 : les éléments accentués ont subi un encodage UTF-8 ;
Si maintenant on utilise la méthode <strong>[POST]</strong> pour envoyer la même requête avec les mêmes paramètres, on obtiendra la même réponse si ce n’est qu’en <strong>[12]</strong>, on aura <strong>[‘method’ : ‘POST’]</strong>.</li>
</ul>
<p>Aussi quelle est la différence entre les méthodes GET et POST ? La différence est mince et a été instituée par l’usage qu’en ont fait historiquement les navigateurs :</p>
<ul>
<li>les paramètres dans l’URL sont pratiques parce qu’une URL ainsi paramétrée peut servir de lien dans un document HTML. L’utilisateur peut également changer les paramètres lui-même pour obtenir des réponses différentes du serveur. Dans ce cas, les navigateurs utilisent couramment la méthode <strong>[GET]</strong> et il n’y a pas de corps (content_length=0) dans la requête envoyée au serveur web (pas de paramètres cachés) ;</li>
<li>
<p>parfois on ne veut pas que les paramètres soient affichés dans l’URL. C’est le cas des mots de passe envoyés au serveur. Par ailleurs, la taille occupée par les paramètres de l’URL est limitée (une URL ne peut dépasser une certaine taille). Les paramètres du corps de la requête n’ont pas cette limitation. Egalement, beaucoup de paramètres dans l’URL la rendent illisible. Prenons le cas courant d’un formulaire d’inscription à un site web. Historiquement, lorsque les pages HTML n’embarquaient pas encore du Javascript, les navigateurs envoyaient les renseignements saisis par un POST. On parlait alors de valeurs postées ;
Donc au début de la programmation web :</p>
</li>
<li>
<p>les méthodes GET étaient plutôt associées à la demande d’informations délivrées par un serveur web ;</p>
</li>
<li>les méthodes POST étaient plutôt associées à l’envoi d’informations du navigateur vers le serveur. Le serveur était alors ‘enrichi’ par celles-ci ;
Depuis Javascript est passé par là. Alors que dans les exemples précédents, le développeur n’avait pas la main (cliquer sur un lien déclenchait forcément un GET, valider un formulaire passait forcément par un POST), le Javascript leur a redonné la main. Dans ce modèle, la page HTML est associée à du code Javascript qui peut court-circuiter le navigateur. Ainsi le clic sur un lien peut-il être intercepté par le code Javascript qui peut ensuite exécuter un code faisant une requête au serveur. Cette requête sera transparente pour l’utilisateur. Il ne la verra pas. Ce code est un client web et comme nous l’avons fait avec Postman le développeur peut créer la requête qu’il veut. Pour revenir sur le clic sur un lien, il peut réaliser un POST alors que par défaut le navigateur aurait réalisé un GET. Ces évolutions ont rendu les différences entre GET et POST moins pertinentes.</li>
</ul>
<p>Cependant, les développeurs adoptent souvent les règles suivantes :</p>
<ul>
<li>un GET ne doit pas modifier l’état du serveur. Des GET successifs réalisés avec les mêmes paramètres dans l’URL divent ramener le même document. De plus le GET n’a le plus souvent pas de corps (pas de document associé), seulement des paramètres dans l’URL ;</li>
<li>le POST peut modifier l’état du serveur. Les paramètres sont le plus souvent envoyés dans le corps de la requête. On parle alors de valeurs postées. L’exemple du formulaire est le plus éloquent : les valeurs saisies par l’utilisateur vont être mises dans le corps du POST et le serveur va les enregistrer quelque part, souvent une base de données ; 
Dans la suite du document, nous ne nous astreignons à respecter aucune règle particulière.</li>
</ul>
<h2 id="226-scripts-flask-05-gestion-de-la-memoire-de-lutilisateur">22.6. scripts [flask-05] : gestion de la mémoire de l’utilisateur</h2>
<h3 id="2261-introduction">22.6.1. Introduction</h3>
<p>Dans les exemples client / serveur précédents on avait le fonctionnement suivant :</p>
<ul>
<li>le client ouvre une connexion vers le port 80 de la machine du service web ;</li>
<li>il envoie la séquence de texte : en-têtes HTTP, ligne vide, <strong>[document]</strong><strong> ;</strong></li>
<li>en réponse, le serveur envoie une séquence du même type ;</li>
<li>le serveur clôt la connexion vers le client ;</li>
<li>le client clôt la connexion vers le serveur ;
Si le même client fait peu après une nouvelle demande au serveur web, une nouvelle connexion est créée entre le client et le serveur. Celui-ci ne peut pas savoir si le client qui se connecte est déjà venu ou si c&#x27;est une première demande. Entre deux connexions, le serveur &quot;oublie&quot; son client. Pour cette raison, on dit que le protocole HTTP est un <strong>protocole sans état</strong>. Il est pourtant utile que le serveur se souvienne de ses clients. Ainsi si une application est sécurisée, le client va envoyer au serveur un login et un mot de passe pour s&#x27;identifier. Si le serveur &quot;oublie&quot; son client entre deux connexions, celui-ci devra s&#x27;identifier à chaque nouvelle connexion, ce qui n&#x27;est pas envisageable.</li>
</ul>
<p>Pour faire le suivi d&#x27;un client, le serveur peut procéder de diverses façons :</p>
<ul>
<li>lors d&#x27;une première demande d&#x27;un client, il inclut dans sa réponse un identifiant que le client doit ensuite lui renvoyer à chaque nouvelle demande. Grâce à cet identifiant, différent pour chaque client, le serveur peut reconnaître un client. Il peut alors gérer une mémoire pour ce client sous la forme d&#x27;une mémoire associée de façon unique à l&#x27;identifiant du client. C’est ainsi que fonctionnent, par exemple, les services PHP ;</li>
<li>
<p>lors d&#x27;une première demande d&#x27;un client, il inclut dans sa réponse non pas un identifiant mais la mémoire de l’utilisateur elle-même. Il ne garde rien côté serveur. Pour maintenir sa mémoire, le client web doit renvoyer cette mémoire à chaque nouvelle requête. Celle-ci est modifiée (ou non) à chaque nouvelle requête et renvoyée (ou non) au client. C’est la méthode utilisée par le framework Flask ;
Les différences entre les deux méthodes sont les suivantes :</p>
</li>
<li>
<p>la méthode 1 est moins gourmande en bande passante. Seul est échangé entre le client et le serveur un identifiant. Lorsque la mémoire de l’utilisateur grandit, cela n’a aucune conséquence sur l’identifiant qui reste le même. Ce n’est pas le cas de la méthode 2 où la mémoire de l’utilisateur est échangée à chaque requête et peut grossir au fil des requêtes ;</p>
</li>
<li>
<p>la méthode 1 est plus gourmande en espace mémoire. En effet, le serveur stocke la mémoire de l’utilisateur sur ses systèmes de fichiers. S’il y a un million d’utilisateurs, cela peut peut-être poser un problème. La méthode 2 ne stocke rien sur le serveur ;
Techniquement cela se passe ainsi dans les deux méthodes :</p>
</li>
<li>
<p>dans la réponse à un nouveau client, le serveur inclut l&#x27;en-tête HTTP <strong>[Set-Cookie : MotClé=Identifiant]</strong> ou <strong>[Set-Cookie : mémoire]</strong>. Avec la méthode 1, il ne fait cela qu&#x27;à la première demande. Avec la méthode 2, il le fait à chaque fois que la mémoire de l’utilisateur change ;</p>
</li>
<li>dans ses demandes, le client renvoie systématiquement ce qu’il a reçu, un identifiant ou une mémoire. Il le fait via l&#x27;en-tête HTTP <strong>[Cookie : MotClé=Valeur]</strong> ;
On peut se demander comment le serveur fait pour savoir qu&#x27;il a affaire à un nouveau client plutôt qu&#x27;à un client déjà venu. C&#x27;est la présence de l&#x27;en-tête HTTP Cookie dans les en-têtes HTTP du client qui le lui indique. Pour un nouveau client, cet en-tête est absent.</li>
</ul>
<p>L&#x27;ensemble des connexions d&#x27;un client donné est appelé une <strong>session</strong>.</p>
<p>Le serveur peut maintenir d’autres types de mémoire :</p>
<p><img src="images/10000000000003CF000001C54567FD75.png" style="width:11.261cm;height:5.22cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, la mémoire de la requête est particulière. Elle est utilisée lorsque la demande du client web est traitée non pas par un service (ou application) mais par plusieurs. Pour passer des informations au service i+1, le service i peut enrichir la requête traitée (request) avec ces informations. C’est ce qu’on appelle la mémoire de niveau requête. Nous n’utiliserons pas ce type de mémoire dans ce document ;</li>
<li>en <strong>[2, 4]</strong>, la mémoire de l’utilisateur que nous venons de décrire. Elle peut être implémentée localement <strong>[2]</strong> ou maintenue à l’aide du client <strong>[4]</strong> ;</li>
<li>en <strong>[3]</strong>, la mémoire de niveau ‘application’ est très généralement une mémoire en lecture seule. Elle est partagée par tous les utilisateurs. On y retrouve souvent des éléments de la configuration de l’application web, configuration partagée par tous les utilisateurs de l’application. On doit être prudents avec ce type de mémoire : l’écriture dedans doit se faire à un moment où les utilisateurs n’ont pas encore envoyé de requêtes, au démarrage de l’application le plus souvent. Ensuite, lorsque les requêtes arrivent, il est difficile d’écrire dans cette mémoire. Lorsque le serveur web sert simultanément plusieurs utilisateurs et que deux d’entre-eux veulent écrire dans la mémoire de niveau ‘application’, il y a un risque que cette mémoire soit corrompue. En effet, alors que l’utilisateur 1 a commencé à écrire dans la mémoire de niveau ‘application’, il peut être interrompu avant même d’avoir fini. On a alors une mémoire d’application incomplète. Comme elle est partagée, un utilisateur 2 peut la lire et obtenir un état incorrect ;</li>
</ul>
<h3 id="2262-script-session_scope_01">22.6.2. script [session_scope_01]</h3>
<p><img src="images/1000000000000197000000E16061FCB8.png" style="width:4.702cm;height:2.59cm;" alt="Image" /></p>
<p>Les scripts <strong>[session_scope_xx]</strong> illustrent la gestion des mémoires utilisateurs.</p>
<p>Le script <strong>[session_scope_01]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span>
<span class="normal"><a href="#__codelineno-37-22">22</a></span>
<span class="normal"><a href="#__codelineno-37-23">23</a></span>
<span class="normal"><a href="#__codelineno-37-24">24</a></span>
<span class="normal"><a href="#__codelineno-37-25">25</a></span>
<span class="normal"><a href="#__codelineno-37-26">26</a></span>
<span class="normal"><a href="#__codelineno-37-27">27</a></span>
<span class="normal"><a href="#__codelineno-37-28">28</a></span>
<span class="normal"><a href="#__codelineno-37-29">29</a></span>
<span class="normal"><a href="#__codelineno-37-30">30</a></span>
<span class="normal"><a href="#__codelineno-37-31">31</a></span>
<span class="normal"><a href="#__codelineno-37-32">32</a></span>
<span class="normal"><a href="#__codelineno-37-33">33</a></span>
<span class="normal"><a href="#__codelineno-37-34">34</a></span>
<span class="normal"><a href="#__codelineno-37-35">35</a></span>
<span class="normal"><a href="#__codelineno-37-36">36</a></span>
<span class="normal"><a href="#__codelineno-37-37">37</a></span>
<span class="normal"><a href="#__codelineno-37-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a><span class="c1"># dépendances</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">session</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="c1"># application Flask</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="c1"># clé secrète de la session</span>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;SECRET_KEY&quot;</span><span class="p">]</span>
<a id="__codelineno-37-15" name="__codelineno-37-15"></a>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a>
<a id="__codelineno-37-17" name="__codelineno-37-17"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/set-session&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-37-18" name="__codelineno-37-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_session</span><span class="p">():</span>
<a id="__codelineno-37-19" name="__codelineno-37-19"></a>    <span class="c1"># on met qq chose dans la session</span>
<a id="__codelineno-37-20" name="__codelineno-37-20"></a>    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;nom&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;séléné&#39;</span>
<a id="__codelineno-37-21" name="__codelineno-37-21"></a>    <span class="c1"># on envoie une réponse vide</span>
<a id="__codelineno-37-22" name="__codelineno-37-22"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">()</span>
<a id="__codelineno-37-23" name="__codelineno-37-23"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Length&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-37-24" name="__codelineno-37-24"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-37-25" name="__codelineno-37-25"></a>
<a id="__codelineno-37-26" name="__codelineno-37-26"></a>
<a id="__codelineno-37-27" name="__codelineno-37-27"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get-session&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-37-28" name="__codelineno-37-28"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_session</span><span class="p">():</span>
<a id="__codelineno-37-29" name="__codelineno-37-29"></a>    <span class="c1"># on récupère la session et on envoie la réponse</span>
<a id="__codelineno-37-30" name="__codelineno-37-30"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;nom&#39;</span><span class="p">]},</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<a id="__codelineno-37-31" name="__codelineno-37-31"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span>
<a id="__codelineno-37-32" name="__codelineno-37-32"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-37-33" name="__codelineno-37-33"></a>
<a id="__codelineno-37-34" name="__codelineno-37-34"></a>
<a id="__codelineno-37-35" name="__codelineno-37-35"></a><span class="c1"># main seulement</span>
<a id="__codelineno-37-36" name="__codelineno-37-36"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-37-37" name="__codelineno-37-37"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-37-38" name="__codelineno-37-38"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 11 : une application Flask est instanciée ;</li>
<li>
<p>ligne 14 : l’attribut <strong>[secret_key]</strong> de cette application reçoit une valeur prise dans le fichier de configuration exploité aux lignes 1-3. Une session Flask n’est possible que si cet attribut est initialisé. On peut mettre n’importe quoi dedans. Il sert à crypter une partie de la ‘mémoire utilisateur’ qui sera envoyée au client. On met en général quelque chose difficile à deviner. Dans le fichier <strong>[config]</strong>, la clé secrète est définie de la façon suivante :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1">1</a></span>
<span class="normal"><a href="#__codelineno-38-2">2</a></span>
<span class="normal"><a href="#__codelineno-38-3">3</a></span>
<span class="normal"><a href="#__codelineno-38-4">4</a></span>
<span class="normal"><a href="#__codelineno-38-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a>    <span class="c1"># on rend la config</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a>        <span class="c1"># configuration Flask</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a>        <span class="s2">&quot;SECRET_KEY&quot;</span><span class="p">:</span> <span class="s2">&quot;vibnFfrdWYUp?*LQ&quot;</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>pour la première fois, nous définissons une application web qui sert autre chose que l’URL /</p>
</li>
<li>ligne 17 : l’URL <strong>[/set-session]</strong> sert à initialiser la session de l’utilisateur ;</li>
<li>ligne 27 : l’URL <strong>[/get-session]</strong> sert à retrouver la mémoire de l’utilisateur (ou session de l’utilisateur) ;</li>
<li>ligne 20 : on met quelque chose dans la mémoire (= la session) de l’utilisateur, ici un nom. La session se gère un peu comme un dictionnaire. On ne peut pas mettre n’importe quoi dans la session. Il faut que les valeurs qu’on y met puissent être transformées en jSON. Pour les types prédéfinis de Python, cela se fait sans intervention du développeur. Pour des objets propriétaires que Python ne connaît pas, il faut faire soi-même la conversion jSON ;</li>
<li>ligne 22 : on crée une réponse HTTP sans contenu (absence de paramètre à make_response) ;</li>
<li>ligne 23 : on dit au client qu’il va recevoir un document vide (taille de 0 octet) ;</li>
<li>ligne 24 : on envoie la réponse HTTP au client. L’URL <strong>[/set-session]</strong> ne fait donc rien d’autres que d’initialiser une session utilisateur ;</li>
<li>ligne 27 : l’URL <strong>[/get-session]</strong> permet à l’utilisateur de savoir ce qu’il y a dans sa session ;</li>
<li>ligne 30 : on crée une réponse HTTP contenant la chaîne jSON de la session de l’utilisateur. Ici on a créé la chaîne jSON nous-mêmes au lieu de laisser Flask la générer. En effet, on ne veut pas que les caractères accentués soient échappés (ensure_ascii=False) ;</li>
<li>ligne 31 : on dit au client qu’on lui envoie du jSON ;</li>
<li>
<p>ligne 32 : on envoie la réponse HTTP au client ;
Le but de ce script est de montrer que la session utilisateur permet de faire le lien entre les requêtes successives de celui-ci :</p>
</li>
<li>
<p>la requête 1 demandera l’URL <strong>[/set-session]</strong> ;</p>
</li>
<li>la requête 2 demandera l’URL <strong>[/get-session]</strong> et va récupérer le nom que la requête 1 aura initialisé ;
Le script <strong>[config]</strong> qui configure les scripts du dossier <strong>[flask/05]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span>
<span class="normal"><a href="#__codelineno-39-12">12</a></span>
<span class="normal"><a href="#__codelineno-39-13">13</a></span>
<span class="normal"><a href="#__codelineno-39-14">14</a></span>
<span class="normal"><a href="#__codelineno-39-15">15</a></span>
<span class="normal"><a href="#__codelineno-39-16">16</a></span>
<span class="normal"><a href="#__codelineno-39-17">17</a></span>
<span class="normal"><a href="#__codelineno-39-18">18</a></span>
<span class="normal"><a href="#__codelineno-39-19">19</a></span>
<span class="normal"><a href="#__codelineno-39-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">():</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a>    <span class="c1"># chemin absolu référence des chemins relatifs de la configuration</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a>    <span class="n">root_dir</span> <span class="o">=</span> <span class="s2">&quot;C:/Data/st-2020/dev/python/cours-2020/python3-flask-2020&quot;</span>
<a id="__codelineno-39-4" name="__codelineno-39-4"></a>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a>    <span class="c1"># dépendances de l&#39;application</span>
<a id="__codelineno-39-6" name="__codelineno-39-6"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-39-7" name="__codelineno-39-7"></a>        <span class="c1"># Personne, Utils, MyException</span>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/classes/02/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-39-9" name="__codelineno-39-9"></a>    <span class="p">]</span>
<a id="__codelineno-39-10" name="__codelineno-39-10"></a>    <span class="c1"># on fixe le syspath</span>
<a id="__codelineno-39-11" name="__codelineno-39-11"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-39-12" name="__codelineno-39-12"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a>    <span class="c1"># on rend la config</span>
<a id="__codelineno-39-15" name="__codelineno-39-15"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-39-16" name="__codelineno-39-16"></a>        <span class="c1"># configuration Flask</span>
<a id="__codelineno-39-17" name="__codelineno-39-17"></a>        <span class="s2">&quot;SECRET_KEY&quot;</span><span class="p">:</span> <span class="s2">&quot;vibnFfrdWYUp?*LQ&quot;</span>
<a id="__codelineno-39-18" name="__codelineno-39-18"></a>    <span class="p">}</span>
<a id="__codelineno-39-19" name="__codelineno-39-19"></a>
<a id="__codelineno-39-20" name="__codelineno-39-20"></a>    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<p>Nous lançons le script <strong>[session_scope_01]</strong> puis avec Postman nous allons demander l’URL <strong>[/set-session]</strong>. Auparavant nous allons vérifier quelques éléments de la requête qui va être faite :</p>
<p><img src="images/1000000000000536000000710D6491F8.png" style="width:15.391cm;height:1.301cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, accéder aux cookies de Postman ;</li>
</ul>
<p><img src="images/1000000000000489000001BCCF1162E9.png" style="width:13.39cm;height:5.13cm;" alt="Image" /></p>
<ul>
<li>en <strong>[2-4]</strong>, on vérifie les cookies connus de Postman et on les supprime tous <strong>[4-5]</strong> ;
Maintenant vérifions la requête HTTP qui va être générée :</li>
</ul>
<p><img src="images/1000000000000428000001A309EFEFCA.png" style="width:12.27cm;height:4.841cm;" alt="Image" /></p>
<ul>
<li>en <strong>[9]</strong> : une partie des entêtes HTTP que Postman va mettre dans la requête à partir de la configuration que nous avons pu faire pour celle-ci. Cette vérification vous permet de vérifier que vous n’avez pas omis des paramètres ou au contraire laissé des paramètres inutiles ;
Ceci fait, on peut exécuter la requête :</li>
</ul>
<p><img src="images/10000000000005E80000004D50276CC2.png" style="width:17.47cm;height:0.892cm;" alt="Image" /></p>
<p>Il y a différentes façons de vérifier le résultat. On peut déjà regarder la fenêtre principale :</p>
<p><img src="images/100000000000055500000233D2CC752C.png" style="width:15.77cm;height:6.501cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1-2]</strong>, la requête faite au service web ;</li>
<li>en <strong>[3-6]</strong>, les entêtes HTTP de la réponse ;</li>
<li>en <strong>[4]</strong>, comme dans le code on n’a pas précisé le type de la réponse, Flask a utilisé par défaut le type <strong>[text/html]</strong> ;</li>
<li>en <strong>[5]</strong>, le client sait qu’il n’y a pas de document dans la réponse ;</li>
<li>ligne 6 : l’entête <strong>[Set-Cookie]</strong> a été envoyé par le serveur Flask. Sa valeur est appelée un <strong>cookie de session</strong>. Elle est constituée de trois éléments :</li>
<li><strong>[session=valeur]</strong> : valeur représente la mémoire de l’utilisateur sous une forme codée. Cette mémoire est décodable (cf. |<a href="https://blog.miguelgrinberg.com/post/how-secure-is-the-flask-user-session"><u><u>https://blog.miguelgrinberg.com/post/how-secure-is-the-flask-user-session</u></u></a>|). Néanmoins à cause de la clé secrète utilisée par le serveur, l’utilisateur ne peut pas modifier la mémoire reçue pour la renvoyer ensuite au serveur. Lorsque le serveur reçoit une session, il est ainsi assuré de recevoir une session non corrompue ;</li>
<li><strong>[HttpOnly]</strong> : la présence de cet élément indique au navigateur qui le reçoit que le cookie ne doit pas être accessible au Javascript que peut contenir la page qu’il affiche ;</li>
<li><strong>[Path=/]</strong> est le chemin pour lequel il faut renvoyer le cookie de session donc ici tout chemin de l’application web. A chaque fois que l’utilisateur au clavier demandera explicitement (il tape une URL) ou implicitement (il clique sur un lien) une URL de ce domaine, le navigateur renverra <strong>automatiquement</strong> le cookie de session qu’il a reçu ;
L’inconvénient de la fenêtre principale est qu’on n’a pas accès à la requête complète qui a amené à cette réponse. Ce qui est présenté dans cette fenêtre prête à confusion :</li>
</ul>
<p><img src="images/100000000000045600000222B4C97413.png" style="width:12.81cm;height:6.31cm;" alt="Image" /></p>
<ul>
<li>dans les entêtes HTTP <strong>[3-4]</strong> est présenté en <strong>[5]</strong> un cookie de session. On pourrait croire alors que Postman a mis dans la requête un cookie de session alors que ce n’est pas le cas. Les entêtes <strong>[3]</strong> représentent en fait les entêtes HTTP qui seront envoyés lors de la prochaine requête telle que celle-ci est actuellement configurée. Postman vient de recevoir un cookie de session qu’il renverra lors de la prochaine requête. C’est pourquoi on a <strong>[5]</strong> ;
On peut avoir accès au dialogue client / serveur dans la console Postman qu’on obtient avec Ctrl-Alt-C :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-40-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-40-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-40-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-40-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-40-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-40-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-40-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-40-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-40-10">10</a></span>
<span class="normal"><a href="#__codelineno-40-11">11</a></span>
<span class="normal"><a href="#__codelineno-40-12">12</a></span>
<span class="normal"><a href="#__codelineno-40-13">13</a></span>
<span class="normal"><a href="#__codelineno-40-14">14</a></span>
<span class="normal"><a href="#__codelineno-40-15">15</a></span>
<span class="normal"><a href="#__codelineno-40-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a><span class="n">GET</span> <span class="o">/</span><span class="nb">set</span><span class="o">-</span><span class="n">session</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-40-2" name="__codelineno-40-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-40-3" name="__codelineno-40-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-40-4" name="__codelineno-40-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-40-5" name="__codelineno-40-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="mi">3673</span><span class="n">b73f</span><span class="o">-</span><span class="mi">7600</span><span class="o">-</span><span class="mi">4</span><span class="n">df4</span><span class="o">-</span><span class="mi">8</span><span class="n">c4b</span><span class="o">-</span><span class="n">c37973e50df8</span>
<a id="__codelineno-40-6" name="__codelineno-40-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-40-7" name="__codelineno-40-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-40-8" name="__codelineno-40-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
<a id="__codelineno-40-9" name="__codelineno-40-9"></a>
<a id="__codelineno-40-10" name="__codelineno-40-10"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-40-11" name="__codelineno-40-11"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-40-12" name="__codelineno-40-12"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-40-13" name="__codelineno-40-13"></a><span class="n">Vary</span><span class="p">:</span> <span class="n">Cookie</span>
<a id="__codelineno-40-14" name="__codelineno-40-14"></a><span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">session</span><span class="o">=</span><span class="n">eyJub20iOiJzXHUwMGU5bFx1MDBlOW5cdTAwZTkifQ</span><span class="o">.</span><span class="n">Xw6jGQ</span><span class="o">.</span><span class="n">y5Icu70wTIN</span><span class="o">-</span><span class="n">B0o_hwx0xDH247I</span><span class="p">;</span> <span class="n">HttpOnly</span><span class="p">;</span> <span class="n">Path</span><span class="o">=/</span>
<a id="__codelineno-40-15" name="__codelineno-40-15"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-40-16" name="__codelineno-40-16"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">15</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">57</span> <span class="n">GMT</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 14 : le cookie de session envoyé par le serveur ;
Maintenant demandons l’URL <strong>[/get-session]</strong> :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-41-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-41-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-41-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-41-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-41-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-41-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-41-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-41-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-41-10">10</a></span>
<span class="normal"><a href="#__codelineno-41-11">11</a></span>
<span class="normal"><a href="#__codelineno-41-12">12</a></span>
<span class="normal"><a href="#__codelineno-41-13">13</a></span>
<span class="normal"><a href="#__codelineno-41-14">14</a></span>
<span class="normal"><a href="#__codelineno-41-15">15</a></span>
<span class="normal"><a href="#__codelineno-41-16">16</a></span>
<span class="normal"><a href="#__codelineno-41-17">17</a></span>
<span class="normal"><a href="#__codelineno-41-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="n">GET</span> <span class="o">/</span><span class="n">get</span><span class="o">-</span><span class="n">session</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="n">ce991398</span><span class="o">-</span><span class="mi">2</span><span class="n">d9a</span><span class="o">-</span><span class="mi">46</span><span class="n">d0</span><span class="o">-</span><span class="mi">9</span><span class="n">ccd</span><span class="o">-</span><span class="n">c7ff3c7f4d6d</span>
<a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
<a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="n">Cookie</span><span class="p">:</span> <span class="n">session</span><span class="o">=</span><span class="n">eyJub20iOiJzXHUwMGU5bFx1MDBlOW5cdTAwZTkifQ</span><span class="o">.</span><span class="n">Xw6jGQ</span><span class="o">.</span><span class="n">y5Icu70wTIN</span><span class="o">-</span><span class="n">B0o_hwx0xDH247I</span>
<a id="__codelineno-41-10" name="__codelineno-41-10"></a>
<a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">20</span>
<a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="n">Vary</span><span class="p">:</span> <span class="n">Cookie</span>
<a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">15</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">52</span> <span class="n">GMT</span>
<a id="__codelineno-41-17" name="__codelineno-41-17"></a>
<a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="p">{</span><span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="s2">&quot;séléné&quot;</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : le client Postman a renvoyé au serveur le cookie de session qu’il avait reçu ;</li>
<li>
<p>ligne 18 : la chaîne jSON envoyée par le serveur ;
Cet exemple nous montre divers points :</p>
</li>
<li>
<p>le client Postman renvoie le cookie de session qu’il reçoit du serveur Flask. Les navigateurs web procèdent toujours ainsi ;</p>
</li>
<li>nous voyons que la requête 2 <strong>[/get-session]</strong> a permis de récupérer une information créée lors de la requête 1 <strong>[/set-session]</strong>. On a donc là une mémoire de l’utilisateur ;</li>
<li>lignes 11-16 : le serveur Flask n’a pas renvoyé de cookie de session. Ce n’est pas systématique. Le serveur Flask ne renvoie le cookie de session que si la dernière requête a modifié la mémoire de l’utilisateur ;</li>
</ul>
<h3 id="2263-script-session_scope_02">22.6.3. script [session_scope_02]</h3>
<p><img src="images/100000000000019E000000E3A7F2CAD5.png" style="width:4.77cm;height:2.631cm;" alt="Image" /></p>
<p>Le script <strong>[session_02]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-42-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-42-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-42-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-42-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-42-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-42-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-42-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-42-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-42-10">10</a></span>
<span class="normal"><a href="#__codelineno-42-11">11</a></span>
<span class="normal"><a href="#__codelineno-42-12">12</a></span>
<span class="normal"><a href="#__codelineno-42-13">13</a></span>
<span class="normal"><a href="#__codelineno-42-14">14</a></span>
<span class="normal"><a href="#__codelineno-42-15">15</a></span>
<span class="normal"><a href="#__codelineno-42-16">16</a></span>
<span class="normal"><a href="#__codelineno-42-17">17</a></span>
<span class="normal"><a href="#__codelineno-42-18">18</a></span>
<span class="normal"><a href="#__codelineno-42-19">19</a></span>
<span class="normal"><a href="#__codelineno-42-20">20</a></span>
<span class="normal"><a href="#__codelineno-42-21">21</a></span>
<span class="normal"><a href="#__codelineno-42-22">22</a></span>
<span class="normal"><a href="#__codelineno-42-23">23</a></span>
<span class="normal"><a href="#__codelineno-42-24">24</a></span>
<span class="normal"><a href="#__codelineno-42-25">25</a></span>
<span class="normal"><a href="#__codelineno-42-26">26</a></span>
<span class="normal"><a href="#__codelineno-42-27">27</a></span>
<span class="normal"><a href="#__codelineno-42-28">28</a></span>
<span class="normal"><a href="#__codelineno-42-29">29</a></span>
<span class="normal"><a href="#__codelineno-42-30">30</a></span>
<span class="normal"><a href="#__codelineno-42-31">31</a></span>
<span class="normal"><a href="#__codelineno-42-32">32</a></span>
<span class="normal"><a href="#__codelineno-42-33">33</a></span>
<span class="normal"><a href="#__codelineno-42-34">34</a></span>
<span class="normal"><a href="#__codelineno-42-35">35</a></span>
<span class="normal"><a href="#__codelineno-42-36">36</a></span>
<span class="normal"><a href="#__codelineno-42-37">37</a></span>
<span class="normal"><a href="#__codelineno-42-38">38</a></span>
<span class="normal"><a href="#__codelineno-42-39">39</a></span>
<span class="normal"><a href="#__codelineno-42-40">40</a></span>
<span class="normal"><a href="#__codelineno-42-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1"># dépendances</span>
<a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-42-3" name="__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">session</span>
<a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-42-6" name="__codelineno-42-6"></a>
<a id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="c1"># application Flask</span>
<a id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-42-9" name="__codelineno-42-9"></a>
<a id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="c1"># clé secrète de la session</span>
<a id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
<a id="__codelineno-42-12" name="__codelineno-42-12"></a>
<a id="__codelineno-42-13" name="__codelineno-42-13"></a>
<a id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="c1"># Home URL</span>
<a id="__codelineno-42-15" name="__codelineno-42-15"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-42-16" name="__codelineno-42-16"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-42-17" name="__codelineno-42-17"></a>    <span class="c1"># on gère tois compteurs</span>
<a id="__codelineno-42-18" name="__codelineno-42-18"></a>    <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n1&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-42-19" name="__codelineno-42-19"></a>        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-42-20" name="__codelineno-42-20"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-42-21" name="__codelineno-42-21"></a>        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-42-22" name="__codelineno-42-22"></a>    <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n2&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-42-23" name="__codelineno-42-23"></a>        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-42-24" name="__codelineno-42-24"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-42-25" name="__codelineno-42-25"></a>        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-42-26" name="__codelineno-42-26"></a>    <span class="k">if</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;n3&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-42-27" name="__codelineno-42-27"></a>        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<a id="__codelineno-42-28" name="__codelineno-42-28"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-42-29" name="__codelineno-42-29"></a>        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n3&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-42-30" name="__codelineno-42-30"></a>    <span class="c1"># dictionnaire des compteurs</span>
<a id="__codelineno-42-31" name="__codelineno-42-31"></a>    <span class="n">compteurs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;n1&quot;</span><span class="p">:</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n1&#39;</span><span class="p">],</span> <span class="s2">&quot;n2&quot;</span><span class="p">:</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n2&#39;</span><span class="p">],</span> <span class="s2">&quot;n3&quot;</span><span class="p">:</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;n3&#39;</span><span class="p">]}</span>
<a id="__codelineno-42-32" name="__codelineno-42-32"></a>    <span class="c1"># on envoie la réponse</span>
<a id="__codelineno-42-33" name="__codelineno-42-33"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">compteurs</span><span class="p">)</span>
<a id="__codelineno-42-34" name="__codelineno-42-34"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span>
<a id="__codelineno-42-35" name="__codelineno-42-35"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-42-36" name="__codelineno-42-36"></a>
<a id="__codelineno-42-37" name="__codelineno-42-37"></a>
<a id="__codelineno-42-38" name="__codelineno-42-38"></a><span class="c1"># main</span>
<a id="__codelineno-42-39" name="__codelineno-42-39"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-42-40" name="__codelineno-42-40"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-42-41" name="__codelineno-42-41"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 11 : ici la clé secrète est générée à l’aide d’une fonction. L’intérêt de celle-ci est qu’elle génère une chaîne de caractères complexe de façon aléatoire. On rappelle que la variable <strong>[app]</strong> est l’instance de classe Flask créée ligne 8 ;</li>
<li>ligne 15 : cette fois-ci, il n’y aura qu’une route, la route / ;</li>
<li>lignes 17-29 : on gère une session contenant trois compteurs <strong>[n1, n2, n3]</strong>. Lors du 1er appel de l’utilisateur <strong>[n1, n2, n3]</strong>=<strong>[0, 10, 100]</strong> puis à chaque appel ces compteurs sont incrémentés de 1 ;</li>
<li>ligne 18 : lors de la 1ère requête, la session de l’application est vide. L’expression <strong>[session.get(‘clé’)]</strong> rend la valeur <strong>[None]</strong>. Pour les requêtes suivantes, cette expression rendra la valeur associée à la clé ;</li>
<li>ligne 31 : ces compteurs sont mis dans un dictionnaire ;</li>
<li>ligne 33 : ce dictionnaire est le document de la réponse HTTP. On rappelle, que Flask transforme automatiquement les dictionnaires en chaîne jSON ;</li>
<li>ligne 34 : on dit au client web qu’il va recevoir du jSON ;</li>
<li>ligne 35 : on envoie la réponse HTTP au client ;
Exécutons ce script et interrogeons l’application web ainsi créée avec Postman après avoir supprimé tous les cookies du client Postman <strong>[1-3]</strong> :</li>
</ul>
<p><img src="images/1000000000000554000001C99B65D309.png" style="width:15.751cm;height:5.28cm;" alt="Image" /></p>
<p>Dans la console Postman, les échanges client / serveur sont les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-43-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-43-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-43-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-43-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-43-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-43-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-43-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-43-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-43-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-43-10">10</a></span>
<span class="normal"><a href="#__codelineno-43-11">11</a></span>
<span class="normal"><a href="#__codelineno-43-12">12</a></span>
<span class="normal"><a href="#__codelineno-43-13">13</a></span>
<span class="normal"><a href="#__codelineno-43-14">14</a></span>
<span class="normal"><a href="#__codelineno-43-15">15</a></span>
<span class="normal"><a href="#__codelineno-43-16">16</a></span>
<span class="normal"><a href="#__codelineno-43-17">17</a></span>
<span class="normal"><a href="#__codelineno-43-18">18</a></span>
<span class="normal"><a href="#__codelineno-43-19">19</a></span>
<span class="normal"><a href="#__codelineno-43-20">20</a></span>
<span class="normal"><a href="#__codelineno-43-21">21</a></span>
<span class="normal"><a href="#__codelineno-43-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1"></a><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-43-2" name="__codelineno-43-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-43-3" name="__codelineno-43-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-43-4" name="__codelineno-43-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-43-5" name="__codelineno-43-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="n">c7db536d</span><span class="o">-</span><span class="mi">9352</span><span class="o">-</span><span class="mi">4</span><span class="n">aa6</span><span class="o">-</span><span class="mi">9877</span><span class="o">-</span><span class="mf">04560e03</span><span class="n">d935</span>
<a id="__codelineno-43-6" name="__codelineno-43-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-43-7" name="__codelineno-43-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-43-8" name="__codelineno-43-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
<a id="__codelineno-43-9" name="__codelineno-43-9"></a>
<a id="__codelineno-43-10" name="__codelineno-43-10"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-43-11" name="__codelineno-43-11"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-43-12" name="__codelineno-43-12"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">41</span>
<a id="__codelineno-43-13" name="__codelineno-43-13"></a><span class="n">Vary</span><span class="p">:</span> <span class="n">Cookie</span>
<a id="__codelineno-43-14" name="__codelineno-43-14"></a><span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">session</span><span class="o">=</span><span class="n">eyJuMSI6MCwibjIiOjEwLCJuMyI6MTAwfQ</span><span class="o">.</span><span class="n">Xw6nLg</span><span class="o">.</span><span class="n">v49CeDWwqP</span><span class="o">-</span><span class="mi">6</span><span class="n">Dp9Qt330GAe</span><span class="o">-</span><span class="n">dNA</span><span class="p">;</span> <span class="n">HttpOnly</span><span class="p">;</span> <span class="n">Path</span><span class="o">=/</span>
<a id="__codelineno-43-15" name="__codelineno-43-15"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-43-16" name="__codelineno-43-16"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">15</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">50</span><span class="p">:</span><span class="mi">22</span> <span class="n">GMT</span>
<a id="__codelineno-43-17" name="__codelineno-43-17"></a>
<a id="__codelineno-43-18" name="__codelineno-43-18"></a><span class="p">{</span>
<a id="__codelineno-43-19" name="__codelineno-43-19"></a><span class="s2">&quot;n1&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> 
<a id="__codelineno-43-20" name="__codelineno-43-20"></a><span class="s2">&quot;n2&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> 
<a id="__codelineno-43-21" name="__codelineno-43-21"></a><span class="s2">&quot;n3&quot;</span><span class="p">:</span> <span class="mi">100</span>
<a id="__codelineno-43-22" name="__codelineno-43-22"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>en <strong>[14]</strong>, le cookie de session envoyé par le serveur ;</li>
<li>en <strong>[18-22]</strong>, la réponse du serveur sous la forme d’une chaîne jSON ;
Refaisons une deuxième fois la même requête. Les logs évoluent de la façon suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-44-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-44-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-44-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-44-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-44-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-44-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-44-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-44-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-44-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-44-10">10</a></span>
<span class="normal"><a href="#__codelineno-44-11">11</a></span>
<span class="normal"><a href="#__codelineno-44-12">12</a></span>
<span class="normal"><a href="#__codelineno-44-13">13</a></span>
<span class="normal"><a href="#__codelineno-44-14">14</a></span>
<span class="normal"><a href="#__codelineno-44-15">15</a></span>
<span class="normal"><a href="#__codelineno-44-16">16</a></span>
<span class="normal"><a href="#__codelineno-44-17">17</a></span>
<span class="normal"><a href="#__codelineno-44-18">18</a></span>
<span class="normal"><a href="#__codelineno-44-19">19</a></span>
<span class="normal"><a href="#__codelineno-44-20">20</a></span>
<span class="normal"><a href="#__codelineno-44-21">21</a></span>
<span class="normal"><a href="#__codelineno-44-22">22</a></span>
<span class="normal"><a href="#__codelineno-44-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-44-2" name="__codelineno-44-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-44-5" name="__codelineno-44-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="mi">8205</span><span class="n">ad85</span><span class="o">-</span><span class="mi">37</span><span class="n">b3</span><span class="o">-</span><span class="mi">41</span><span class="n">f2</span><span class="o">-</span><span class="n">a171</span><span class="o">-</span><span class="mi">70</span><span class="n">dd3b3a1679</span>
<a id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-44-8" name="__codelineno-44-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
<a id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="n">Cookie</span><span class="p">:</span> <span class="n">session</span><span class="o">=</span><span class="n">eyJuMSI6MCwibjIiOjEwLCJuMyI6MTAwfQ</span><span class="o">.</span><span class="n">Xw6nLg</span><span class="o">.</span><span class="n">v49CeDWwqP</span><span class="o">-</span><span class="mi">6</span><span class="n">Dp9Qt330GAe</span><span class="o">-</span><span class="n">dNA</span>
<a id="__codelineno-44-10" name="__codelineno-44-10"></a>
<a id="__codelineno-44-11" name="__codelineno-44-11"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">41</span>
<a id="__codelineno-44-14" name="__codelineno-44-14"></a><span class="n">Vary</span><span class="p">:</span> <span class="n">Cookie</span>
<a id="__codelineno-44-15" name="__codelineno-44-15"></a><span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">session</span><span class="o">=</span><span class="n">eyJuMSI6MSwibjIiOjExLCJuMyI6MTAxfQ</span><span class="o">.</span><span class="n">Xw6nsw</span><span class="o">.</span><span class="n">OuxIQnGhmhSsan5Qu_FL3Iyu</span><span class="o">-</span><span class="mi">9</span><span class="n">k</span><span class="p">;</span> <span class="n">HttpOnly</span><span class="p">;</span> <span class="n">Path</span><span class="o">=/</span>
<a id="__codelineno-44-16" name="__codelineno-44-16"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-44-17" name="__codelineno-44-17"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">15</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">06</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">35</span> <span class="n">GMT</span>
<a id="__codelineno-44-18" name="__codelineno-44-18"></a>
<a id="__codelineno-44-19" name="__codelineno-44-19"></a><span class="p">{</span>
<a id="__codelineno-44-20" name="__codelineno-44-20"></a><span class="s2">&quot;n1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> 
<a id="__codelineno-44-21" name="__codelineno-44-21"></a><span class="s2">&quot;n2&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> 
<a id="__codelineno-44-22" name="__codelineno-44-22"></a><span class="s2">&quot;n3&quot;</span><span class="p">:</span> <span class="mi">101</span>
<a id="__codelineno-44-23" name="__codelineno-44-23"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : le client Postman renvoie le cookie de session qu’il a reçu ;</li>
<li>ligne 15 : dans sa réponse, le serveur envoie un nouveau cookie de session, ceci parce que la requête du client a modifié la mémoire de l’utilisateur (= la session) ;</li>
<li>lignes 19-23 : les nouvelles valeurs des compteurs ;</li>
</ul>
<h3 id="2264-script-session_scope_03">22.6.4. script [session_scope_03]</h3>
<p>Ce nouveau script vise à montrer qu’on peut mettre différents types Python dans une session : liste, dictionnaire, objet. La seule contrainte est que les objets mis en session soient sérialisables en jSON. S’ils ne le sont pas par défaut (listes, dictionnaires), il faut alors faire soi-même la conversion en jSON.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-45-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-45-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-45-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-45-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-45-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-45-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-45-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-45-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-45-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-45-10">10</a></span>
<span class="normal"><a href="#__codelineno-45-11">11</a></span>
<span class="normal"><a href="#__codelineno-45-12">12</a></span>
<span class="normal"><a href="#__codelineno-45-13">13</a></span>
<span class="normal"><a href="#__codelineno-45-14">14</a></span>
<span class="normal"><a href="#__codelineno-45-15">15</a></span>
<span class="normal"><a href="#__codelineno-45-16">16</a></span>
<span class="normal"><a href="#__codelineno-45-17">17</a></span>
<span class="normal"><a href="#__codelineno-45-18">18</a></span>
<span class="normal"><a href="#__codelineno-45-19">19</a></span>
<span class="normal"><a href="#__codelineno-45-20">20</a></span>
<span class="normal"><a href="#__codelineno-45-21">21</a></span>
<span class="normal"><a href="#__codelineno-45-22">22</a></span>
<span class="normal"><a href="#__codelineno-45-23">23</a></span>
<span class="normal"><a href="#__codelineno-45-24">24</a></span>
<span class="normal"><a href="#__codelineno-45-25">25</a></span>
<span class="normal"><a href="#__codelineno-45-26">26</a></span>
<span class="normal"><a href="#__codelineno-45-27">27</a></span>
<span class="normal"><a href="#__codelineno-45-28">28</a></span>
<span class="normal"><a href="#__codelineno-45-29">29</a></span>
<span class="normal"><a href="#__codelineno-45-30">30</a></span>
<span class="normal"><a href="#__codelineno-45-31">31</a></span>
<span class="normal"><a href="#__codelineno-45-32">32</a></span>
<span class="normal"><a href="#__codelineno-45-33">33</a></span>
<span class="normal"><a href="#__codelineno-45-34">34</a></span>
<span class="normal"><a href="#__codelineno-45-35">35</a></span>
<span class="normal"><a href="#__codelineno-45-36">36</a></span>
<span class="normal"><a href="#__codelineno-45-37">37</a></span>
<span class="normal"><a href="#__codelineno-45-38">38</a></span>
<span class="normal"><a href="#__codelineno-45-39">39</a></span>
<span class="normal"><a href="#__codelineno-45-40">40</a></span>
<span class="normal"><a href="#__codelineno-45-41">41</a></span>
<span class="normal"><a href="#__codelineno-45-42">42</a></span>
<span class="normal"><a href="#__codelineno-45-43">43</a></span>
<span class="normal"><a href="#__codelineno-45-44">44</a></span>
<span class="normal"><a href="#__codelineno-45-45">45</a></span>
<span class="normal"><a href="#__codelineno-45-46">46</a></span>
<span class="normal"><a href="#__codelineno-45-47">47</a></span>
<span class="normal"><a href="#__codelineno-45-48">48</a></span>
<span class="normal"><a href="#__codelineno-45-49">49</a></span>
<span class="normal"><a href="#__codelineno-45-50">50</a></span>
<span class="normal"><a href="#__codelineno-45-51">51</a></span>
<span class="normal"><a href="#__codelineno-45-52">52</a></span>
<span class="normal"><a href="#__codelineno-45-53">53</a></span>
<span class="normal"><a href="#__codelineno-45-54">54</a></span>
<span class="normal"><a href="#__codelineno-45-55">55</a></span>
<span class="normal"><a href="#__codelineno-45-56">56</a></span>
<span class="normal"><a href="#__codelineno-45-57">57</a></span>
<span class="normal"><a href="#__codelineno-45-58">58</a></span>
<span class="normal"><a href="#__codelineno-45-59">59</a></span>
<span class="normal"><a href="#__codelineno-45-60">60</a></span>
<span class="normal"><a href="#__codelineno-45-61">61</a></span>
<span class="normal"><a href="#__codelineno-45-62">62</a></span>
<span class="normal"><a href="#__codelineno-45-63">63</a></span>
<span class="normal"><a href="#__codelineno-45-64">64</a></span>
<span class="normal"><a href="#__codelineno-45-65">65</a></span>
<span class="normal"><a href="#__codelineno-45-66">66</a></span>
<span class="normal"><a href="#__codelineno-45-67">67</a></span>
<span class="normal"><a href="#__codelineno-45-68">68</a></span>
<span class="normal"><a href="#__codelineno-45-69">69</a></span>
<span class="normal"><a href="#__codelineno-45-70">70</a></span>
<span class="normal"><a href="#__codelineno-45-71">71</a></span>
<span class="normal"><a href="#__codelineno-45-72">72</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-45-4" name="__codelineno-45-4"></a>
<a id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="c1"># dépendances</span>
<a id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-45-8" name="__codelineno-45-8"></a>
<a id="__codelineno-45-9" name="__codelineno-45-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">session</span>
<a id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-45-11" name="__codelineno-45-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Personne</span><span class="w"> </span><span class="kn">import</span> <span class="n">Personne</span>
<a id="__codelineno-45-12" name="__codelineno-45-12"></a>
<a id="__codelineno-45-13" name="__codelineno-45-13"></a><span class="c1"># application Flask</span>
<a id="__codelineno-45-14" name="__codelineno-45-14"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-45-15" name="__codelineno-45-15"></a>
<a id="__codelineno-45-16" name="__codelineno-45-16"></a><span class="c1"># clé secrète de la session</span>
<a id="__codelineno-45-17" name="__codelineno-45-17"></a><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
<a id="__codelineno-45-18" name="__codelineno-45-18"></a>
<a id="__codelineno-45-19" name="__codelineno-45-19"></a>
<a id="__codelineno-45-20" name="__codelineno-45-20"></a><span class="c1"># Home URL</span>
<a id="__codelineno-45-21" name="__codelineno-45-21"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-45-22" name="__codelineno-45-22"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-45-23" name="__codelineno-45-23"></a>    <span class="c1"># gestion d&#39;une liste</span>
<a id="__codelineno-45-24" name="__codelineno-45-24"></a>    <span class="n">liste</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;liste&#39;</span><span class="p">)</span>
<a id="__codelineno-45-25" name="__codelineno-45-25"></a>    <span class="k">if</span> <span class="n">liste</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-45-26" name="__codelineno-45-26"></a>        <span class="c1"># 1ère requête</span>
<a id="__codelineno-45-27" name="__codelineno-45-27"></a>        <span class="n">liste</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<a id="__codelineno-45-28" name="__codelineno-45-28"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-45-29" name="__codelineno-45-29"></a>        <span class="c1"># requêtes suivantes</span>
<a id="__codelineno-45-30" name="__codelineno-45-30"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">liste</span><span class="p">)):</span>
<a id="__codelineno-45-31" name="__codelineno-45-31"></a>            <span class="n">liste</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-45-32" name="__codelineno-45-32"></a>    <span class="c1"># on remet la liste dans la session</span>
<a id="__codelineno-45-33" name="__codelineno-45-33"></a>    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;liste&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">liste</span>
<a id="__codelineno-45-34" name="__codelineno-45-34"></a>
<a id="__codelineno-45-35" name="__codelineno-45-35"></a>    <span class="c1"># gestion d&#39;un dictionnaire</span>
<a id="__codelineno-45-36" name="__codelineno-45-36"></a>    <span class="n">dico</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;dico&#39;</span><span class="p">)</span>
<a id="__codelineno-45-37" name="__codelineno-45-37"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">dico</span><span class="p">:</span>
<a id="__codelineno-45-38" name="__codelineno-45-38"></a>        <span class="c1"># 1ère requête</span>
<a id="__codelineno-45-39" name="__codelineno-45-39"></a>        <span class="n">dico</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;un&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;deux&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;trois&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">}</span>
<a id="__codelineno-45-40" name="__codelineno-45-40"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-45-41" name="__codelineno-45-41"></a>        <span class="c1"># requêtes suivantes</span>
<a id="__codelineno-45-42" name="__codelineno-45-42"></a>        <span class="n">dico</span> <span class="o">=</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;dico&#39;</span><span class="p">]</span>
<a id="__codelineno-45-43" name="__codelineno-45-43"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dico</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<a id="__codelineno-45-44" name="__codelineno-45-44"></a>            <span class="n">dico</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-45-45" name="__codelineno-45-45"></a>    <span class="c1"># on remet le dictionnaire dans la session</span>
<a id="__codelineno-45-46" name="__codelineno-45-46"></a>    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;dico&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dico</span>
<a id="__codelineno-45-47" name="__codelineno-45-47"></a>
<a id="__codelineno-45-48" name="__codelineno-45-48"></a>    <span class="c1"># gestion d&#39;une personne</span>
<a id="__codelineno-45-49" name="__codelineno-45-49"></a>    <span class="n">personne_json</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;personne&#39;</span><span class="p">)</span>
<a id="__codelineno-45-50" name="__codelineno-45-50"></a>    <span class="k">if</span> <span class="n">personne_json</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-45-51" name="__codelineno-45-51"></a>        <span class="c1"># 1ère requête</span>
<a id="__codelineno-45-52" name="__codelineno-45-52"></a>        <span class="n">personne</span> <span class="o">=</span> <span class="n">Personne</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s2">&quot;prénom&quot;</span><span class="p">:</span> <span class="s2">&quot;aglaë&quot;</span><span class="p">,</span> <span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="s2">&quot;séléné&quot;</span><span class="p">,</span> <span class="s2">&quot;âge&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">})</span>
<a id="__codelineno-45-53" name="__codelineno-45-53"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-45-54" name="__codelineno-45-54"></a>        <span class="c1"># requêtes suivantes</span>
<a id="__codelineno-45-55" name="__codelineno-45-55"></a>        <span class="n">personne</span> <span class="o">=</span> <span class="n">Personne</span><span class="p">()</span><span class="o">.</span><span class="n">fromjson</span><span class="p">(</span><span class="n">personne_json</span><span class="p">)</span>
<a id="__codelineno-45-56" name="__codelineno-45-56"></a>        <span class="n">personne</span><span class="o">.</span><span class="n">âge</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-45-57" name="__codelineno-45-57"></a>    <span class="c1"># on remet la personne dans la session</span>
<a id="__codelineno-45-58" name="__codelineno-45-58"></a>    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;personne&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">personne</span><span class="o">.</span><span class="n">asjson</span><span class="p">()</span>
<a id="__codelineno-45-59" name="__codelineno-45-59"></a>
<a id="__codelineno-45-60" name="__codelineno-45-60"></a>    <span class="c1"># dictionnaire des résultats</span>
<a id="__codelineno-45-61" name="__codelineno-45-61"></a>    <span class="n">résultats</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;liste&quot;</span><span class="p">:</span> <span class="n">liste</span><span class="p">,</span> <span class="s2">&quot;dict&quot;</span><span class="p">:</span> <span class="n">dico</span><span class="p">,</span> <span class="s2">&quot;personne&quot;</span><span class="p">:</span> <span class="n">personne</span><span class="o">.</span><span class="n">asdict</span><span class="p">()}</span>
<a id="__codelineno-45-62" name="__codelineno-45-62"></a>
<a id="__codelineno-45-63" name="__codelineno-45-63"></a>    <span class="c1"># on envoie une réponse jSON</span>
<a id="__codelineno-45-64" name="__codelineno-45-64"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">résultats</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<a id="__codelineno-45-65" name="__codelineno-45-65"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span>
<a id="__codelineno-45-66" name="__codelineno-45-66"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-45-67" name="__codelineno-45-67"></a>
<a id="__codelineno-45-68" name="__codelineno-45-68"></a>
<a id="__codelineno-45-69" name="__codelineno-45-69"></a><span class="c1"># main</span>
<a id="__codelineno-45-70" name="__codelineno-45-70"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-45-71" name="__codelineno-45-71"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-45-72" name="__codelineno-45-72"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 1-3 : l’application web est configurée ;</li>
<li>lignes 5-11 : les dépendances sont importées ;</li>
<li>ligne 14 : l’application Flask est instanciée ;</li>
<li>ligne 17 : l’attribut <strong>[secret_key]</strong> est initialisé. C’est ce qui permet l’utilisation de sessions ;</li>
<li>ligne 21 : l’unique route de l’application ;</li>
<li>lignes 23-33 : gestion d’une liste dans la session. On a mis dans celle-ci des éléments sérialisables par défaut en jSON ;</li>
<li>lignes 35-46 : gestion d’un dictionnaire dans la session. On a mis dans celui-ci des éléments sérialisables par défaut en jSON ;</li>
<li>lignes 48-58 : gestion d’une personne. Un objet <strong>[Personne]</strong> n’est pas sérialisable par défaut en jSON. Il faut donc prendre des précautions ;</li>
<li>ligne 58 : on utilise la méthode <strong>[BaseEntity.asjson]</strong> pour stocker dans la session la chaîne jSON de la personne. Noter qu’on aurait pu utiliser <strong>[personne.asdict]</strong> car <strong>[personne.asdict]</strong> est un dictionnaire contenant des valeurs sérialisables par défaut en jSON ;</li>
<li>ligne 55 : parce qu’on a stocké une chaîne jSON dans la session, on récupère la personne dans celle-ci en utilisant la méthode <strong>[BaseEntity.fromjson]</strong> ;</li>
<li>ligne 61 : on crée le dictionnaire <strong>[résultats]</strong> qui sera envoyé comme réponse au client. On sait que dans ce cas là, Flask envoie la chaîne jSON du dictionnaire. Il faut donc que celui-ci ne contienne que des valeurs sérialisables par défaut en jSON ;</li>
<li>ligne 64 : on met explicitement la chaîne jSON du dictionnaire <strong>[résultats]</strong> dans a réponse HTTP. Flask l’aurait fait par défaut. Seulement, toujours par défaut, il utilise le paramètre <strong>[</strong><strong>ensure_ascii=</strong><strong>True</strong><strong>]</strong>, ce qui ne nous convenait pas ;</li>
<li>ligne 65 : on dit au client qu’il va recevoir du jSON ;</li>
<li>ligne 66 : on lui envoie la réponse ;
On lance l’application web. On supprime tous les cookies du client Postman. Puis celui-ci demande l’URL <strong>[</strong><strong>http://localhost:5000</strong><strong>]</strong>. Le dialogue client / serveur dans la console Postman est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-46-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-46-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-46-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-46-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-46-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-46-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-46-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-46-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-46-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-46-10">10</a></span>
<span class="normal"><a href="#__codelineno-46-11">11</a></span>
<span class="normal"><a href="#__codelineno-46-12">12</a></span>
<span class="normal"><a href="#__codelineno-46-13">13</a></span>
<span class="normal"><a href="#__codelineno-46-14">14</a></span>
<span class="normal"><a href="#__codelineno-46-15">15</a></span>
<span class="normal"><a href="#__codelineno-46-16">16</a></span>
<span class="normal"><a href="#__codelineno-46-17">17</a></span>
<span class="normal"><a href="#__codelineno-46-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-46-2" name="__codelineno-46-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-46-4" name="__codelineno-46-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-46-5" name="__codelineno-46-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="mi">5</span><span class="n">f8b7c63</span><span class="o">-</span><span class="n">aa8a</span><span class="o">-</span><span class="mi">4429</span><span class="o">-</span><span class="n">a2fa</span><span class="o">-</span><span class="mi">62141423</span><span class="n">d933</span>
<a id="__codelineno-46-6" name="__codelineno-46-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-46-7" name="__codelineno-46-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-46-8" name="__codelineno-46-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
<a id="__codelineno-46-9" name="__codelineno-46-9"></a>
<a id="__codelineno-46-10" name="__codelineno-46-10"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-46-11" name="__codelineno-46-11"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-46-12" name="__codelineno-46-12"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">135</span>
<a id="__codelineno-46-13" name="__codelineno-46-13"></a><span class="n">Vary</span><span class="p">:</span> <span class="n">Cookie</span>
<a id="__codelineno-46-14" name="__codelineno-46-14"></a><span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">session</span><span class="o">=.</span><span class="n">eJw9isEKwyAQRH</span><span class="o">-</span><span class="n">lzHkPm15K91dqD2mzBMFq0AgF8d</span><span class="o">-</span><span class="n">jsRQG9u3MK1jsO0AKFs1fyMSEPQabOjbOHsKV4GzaFfJgmnr4Sdg0puB9a1EMtmgys959</span><span class="o">-</span><span class="n">BjIxWBe3XxWLwNq_39IQ3Q_f5zhnHxdtYs3rqgH4gQvMg</span><span class="o">.</span><span class="n">Xw6yGw</span><span class="o">.</span><span class="n">Bwpt3q</span><span class="o">-</span><span class="n">sH03gFLmg2FIPXV_ZNt8</span><span class="p">;</span> <span class="n">HttpOnly</span><span class="p">;</span> <span class="n">Path</span><span class="o">=/</span>
<a id="__codelineno-46-15" name="__codelineno-46-15"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-46-16" name="__codelineno-46-16"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">15</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">07</span><span class="p">:</span><span class="mi">36</span><span class="p">:</span><span class="mi">59</span> <span class="n">GMT</span>
<a id="__codelineno-46-17" name="__codelineno-46-17"></a>
<a id="__codelineno-46-18" name="__codelineno-46-18"></a><span class="p">{</span><span class="s2">&quot;liste&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="s2">&quot;dict&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;un&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;deux&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;trois&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span> <span class="s2">&quot;personne&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;prénom&quot;</span><span class="p">:</span> <span class="s2">&quot;aglaë&quot;</span><span class="p">,</span> <span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="s2">&quot;séléné&quot;</span><span class="p">,</span> <span class="s2">&quot;âge&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">}}</span>
</code></pre></div></td></tr></table></div>
<p>Nous faisons la requête une seconde fois :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-47-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-47-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-47-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-47-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-47-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-47-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-47-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-47-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-47-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-47-10">10</a></span>
<span class="normal"><a href="#__codelineno-47-11">11</a></span>
<span class="normal"><a href="#__codelineno-47-12">12</a></span>
<span class="normal"><a href="#__codelineno-47-13">13</a></span>
<span class="normal"><a href="#__codelineno-47-14">14</a></span>
<span class="normal"><a href="#__codelineno-47-15">15</a></span>
<span class="normal"><a href="#__codelineno-47-16">16</a></span>
<span class="normal"><a href="#__codelineno-47-17">17</a></span>
<span class="normal"><a href="#__codelineno-47-18">18</a></span>
<span class="normal"><a href="#__codelineno-47-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-47-3" name="__codelineno-47-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-47-5" name="__codelineno-47-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="mi">40</span><span class="n">fd00ea</span><span class="o">-</span><span class="n">d45c</span><span class="o">-</span><span class="mi">46</span><span class="n">b7</span><span class="o">-</span><span class="n">a51e</span><span class="o">-</span><span class="n">d4d433a37b5c</span>
<a id="__codelineno-47-6" name="__codelineno-47-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-47-7" name="__codelineno-47-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-47-8" name="__codelineno-47-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
<a id="__codelineno-47-9" name="__codelineno-47-9"></a><span class="n">Cookie</span><span class="p">:</span> <span class="n">session</span><span class="o">=.</span><span class="n">eJw9isEKwyAQRH</span><span class="o">-</span><span class="n">lzHkPm15K91dqD2mzBMFq0AgF8d</span><span class="o">-</span><span class="n">jsRQG9u3MK1jsO0AKFs1fyMSEPQabOjbOHsKV4GzaFfJgmnr4Sdg0puB9a1EMtmgys959</span><span class="o">-</span><span class="n">BjIxWBe3XxWLwNq_39IQ3Q_f5zhnHxdtYs3rqgH4gQvMg</span><span class="o">.</span><span class="n">Xw6yGw</span><span class="o">.</span><span class="n">Bwpt3q</span><span class="o">-</span><span class="n">sH03gFLmg2FIPXV_ZNt8</span>
<a id="__codelineno-47-10" name="__codelineno-47-10"></a>
<a id="__codelineno-47-11" name="__codelineno-47-11"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-47-12" name="__codelineno-47-12"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-47-13" name="__codelineno-47-13"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">135</span>
<a id="__codelineno-47-14" name="__codelineno-47-14"></a><span class="n">Vary</span><span class="p">:</span> <span class="n">Cookie</span>
<a id="__codelineno-47-15" name="__codelineno-47-15"></a><span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">session</span><span class="o">=.</span><span class="n">eJw9isEKwyAQRH</span><span class="o">-</span><span class="n">lzHkP2kupv9LtIW2WIBgNGqEg_nu3seQ0b2Zew</span><span class="o">-</span><span class="n">zfCa5hlvqBs5aw5</span><span class="o">-</span><span class="n">SLolGuUaETgi</span><span class="o">-</span><span class="mi">7</span><span class="n">wD0sqaHPk7BJLilGXdEYW</span><span class="o">-</span><span class="n">ZqjNxjWhnuwpiWMB3Ti0Haz6MMMfz9EcM5</span><span class="o">-</span><span class="n">LrIT7zZjv4F5NYvOQ</span><span class="o">.</span><span class="n">Xw6ydQ</span><span class="o">.</span><span class="n">PMWRCqKx9HNnb_DyK</span><span class="o">-</span><span class="n">ha</span><span class="o">-</span><span class="mi">9</span><span class="n">pCF7M</span><span class="p">;</span> <span class="n">HttpOnly</span><span class="p">;</span> <span class="n">Path</span><span class="o">=/</span>
<a id="__codelineno-47-16" name="__codelineno-47-16"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-47-17" name="__codelineno-47-17"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">15</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">07</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">29</span> <span class="n">GMT</span>
<a id="__codelineno-47-18" name="__codelineno-47-18"></a>
<a id="__codelineno-47-19" name="__codelineno-47-19"></a><span class="p">{</span><span class="s2">&quot;liste&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">101</span><span class="p">],</span> <span class="s2">&quot;dict&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;deux&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;trois&quot;</span><span class="p">:</span> <span class="mi">101</span><span class="p">,</span> <span class="s2">&quot;un&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> <span class="s2">&quot;personne&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;prénom&quot;</span><span class="p">:</span> <span class="s2">&quot;aglaë&quot;</span><span class="p">,</span> <span class="s2">&quot;nom&quot;</span><span class="p">:</span> <span class="s2">&quot;séléné&quot;</span><span class="p">,</span> <span class="s2">&quot;âge&quot;</span><span class="p">:</span> <span class="mi">71</span><span class="p">}}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : le client renvoie le cookie de session qu’il a reçu ;</li>
<li>ligne 15 : le serveur lui en renvoie un autre car le contenu de la session a changé (ligne 19). On rappelle que ce contenu est présent dans le cookie de session sous forme codée ;</li>
</ul>
<h2 id="227-scripts-flask06-informations-partagees-par-tous-les-utilisateurs">22.7. scripts [flask/06] : informations partagées par tous les utilisateurs</h2>
<h3 id="2271-introduction">22.7.1. Introduction</h3>
<p>Cette section vise à montrer comment gérer des informations de portée application, ç-à-d partagées par tous les utilisateurs. Ces informations sont typiquement des informations de configuration de l’application. Nous avons vu qu’une application web pouvait maintenir différents types de mémoire :</p>
<p><img src="images/10000000000003CF000001C54567FD75.png" style="width:11.261cm;height:5.22cm;" alt="Image" /></p>
<p>Nous nous intéressons ici à la mémoire de l’application <strong>[3]</strong>.</p>
<h3 id="2272-script-application_scope_01">22.7.2. script [application_scope_01]</h3>
<p>Le script <strong>[application_scope_01]</strong> montre une façon de gérer des données de portée ‘application’ :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-48-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-48-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-48-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-48-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-48-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-48-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-48-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-48-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-48-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-48-10">10</a></span>
<span class="normal"><a href="#__codelineno-48-11">11</a></span>
<span class="normal"><a href="#__codelineno-48-12">12</a></span>
<span class="normal"><a href="#__codelineno-48-13">13</a></span>
<span class="normal"><a href="#__codelineno-48-14">14</a></span>
<span class="normal"><a href="#__codelineno-48-15">15</a></span>
<span class="normal"><a href="#__codelineno-48-16">16</a></span>
<span class="normal"><a href="#__codelineno-48-17">17</a></span>
<span class="normal"><a href="#__codelineno-48-18">18</a></span>
<span class="normal"><a href="#__codelineno-48-19">19</a></span>
<span class="normal"><a href="#__codelineno-48-20">20</a></span>
<span class="normal"><a href="#__codelineno-48-21">21</a></span>
<span class="normal"><a href="#__codelineno-48-22">22</a></span>
<span class="normal"><a href="#__codelineno-48-23">23</a></span>
<span class="normal"><a href="#__codelineno-48-24">24</a></span>
<span class="normal"><a href="#__codelineno-48-25">25</a></span>
<span class="normal"><a href="#__codelineno-48-26">26</a></span>
<span class="normal"><a href="#__codelineno-48-27">27</a></span>
<span class="normal"><a href="#__codelineno-48-28">28</a></span>
<span class="normal"><a href="#__codelineno-48-29">29</a></span>
<span class="normal"><a href="#__codelineno-48-30">30</a></span>
<span class="normal"><a href="#__codelineno-48-31">31</a></span>
<span class="normal"><a href="#__codelineno-48-32">32</a></span>
<span class="normal"><a href="#__codelineno-48-33">33</a></span>
<span class="normal"><a href="#__codelineno-48-34">34</a></span>
<span class="normal"><a href="#__codelineno-48-35">35</a></span>
<span class="normal"><a href="#__codelineno-48-36">36</a></span>
<span class="normal"><a href="#__codelineno-48-37">37</a></span>
<span class="normal"><a href="#__codelineno-48-38">38</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-48-2" name="__codelineno-48-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-48-4" name="__codelineno-48-4"></a>
<a id="__codelineno-48-5" name="__codelineno-48-5"></a><span class="c1"># dépendances</span>
<a id="__codelineno-48-6" name="__codelineno-48-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span>
<a id="__codelineno-48-7" name="__codelineno-48-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-48-8" name="__codelineno-48-8"></a>
<a id="__codelineno-48-9" name="__codelineno-48-9"></a><span class="c1"># application Flask</span>
<a id="__codelineno-48-10" name="__codelineno-48-10"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-48-11" name="__codelineno-48-11"></a>
<a id="__codelineno-48-12" name="__codelineno-48-12"></a>
<a id="__codelineno-48-13" name="__codelineno-48-13"></a><span class="c1"># Home URL</span>
<a id="__codelineno-48-14" name="__codelineno-48-14"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-48-15" name="__codelineno-48-15"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-48-16" name="__codelineno-48-16"></a>    <span class="c1"># on vise à montrer que l&#39;application reste en mémoire entre les requêtes des différents clients</span>
<a id="__codelineno-48-17" name="__codelineno-48-17"></a>    <span class="c1"># chaque client a affaire à la même application</span>
<a id="__codelineno-48-18" name="__codelineno-48-18"></a>
<a id="__codelineno-48-19" name="__codelineno-48-19"></a>    <span class="c1"># app_infos représente des informations de niveau application et non de niveau session</span>
<a id="__codelineno-48-20" name="__codelineno-48-20"></a>    <span class="c1"># c-à-d qu&#39;elle concerne tous les utilisateurs et non un en particulier</span>
<a id="__codelineno-48-21" name="__codelineno-48-21"></a>    <span class="c1"># cette information est ici stockée dans [config] (pas obligatoire)</span>
<a id="__codelineno-48-22" name="__codelineno-48-22"></a>
<a id="__codelineno-48-23" name="__codelineno-48-23"></a>    <span class="c1"># dictionnaire des résultats</span>
<a id="__codelineno-48-24" name="__codelineno-48-24"></a>    <span class="n">résultats</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">}</span>
<a id="__codelineno-48-25" name="__codelineno-48-25"></a>
<a id="__codelineno-48-26" name="__codelineno-48-26"></a>    <span class="c1"># on envoie la réponse</span>
<a id="__codelineno-48-27" name="__codelineno-48-27"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">résultats</span><span class="p">)</span>
<a id="__codelineno-48-28" name="__codelineno-48-28"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span>
<a id="__codelineno-48-29" name="__codelineno-48-29"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-48-30" name="__codelineno-48-30"></a>
<a id="__codelineno-48-31" name="__codelineno-48-31"></a>
<a id="__codelineno-48-32" name="__codelineno-48-32"></a><span class="c1"># main</span>
<a id="__codelineno-48-33" name="__codelineno-48-33"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-48-34" name="__codelineno-48-34"></a>    <span class="c1"># on vérifie si ce code est exécuté plusieurs fois</span>
<a id="__codelineno-48-35" name="__codelineno-48-35"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;application app lancée&quot;</span><span class="p">)</span>
<a id="__codelineno-48-36" name="__codelineno-48-36"></a>    <span class="c1"># on lance l&#39;application web</span>
<a id="__codelineno-48-37" name="__codelineno-48-37"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-48-38" name="__codelineno-48-38"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 1-3 : on récupère le dictionnaire de la configuration. On va montrer que le code situé en-dehors des fonctions de routage n’est exécuté qu’une fois. L’application Flask reste en mémoire. Toutes les informations initialisées en-dehors des routes sont globales à celles-ci et donc connues de celles-ci. Ainsi le dictionnaire <strong>[config]</strong> de la ligne 3 va-t-il être rendu par la route / (ligne 24). On va montrer que tous les clients web vont recevoir le même dictionnaire et que celui-ci est donc partagé par tous les clients. C’est donc une information de portée ‘application’ ;</li>
<li>ligne 35 : on met un log pour voir si le code des lignes en-dehors de la fonction de routage (lignes 1-10, 32-38) est exécuté plusieurs fois ;
La configuration <strong>[config]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">1</a></span>
<span class="normal"><a href="#__codelineno-49-2">2</a></span>
<span class="normal"><a href="#__codelineno-49-3">3</a></span>
<span class="normal"><a href="#__codelineno-49-4">4</a></span>
<span class="normal"><a href="#__codelineno-49-5">5</a></span>
<span class="normal"><a href="#__codelineno-49-6">6</a></span>
<span class="normal"><a href="#__codelineno-49-7">7</a></span>
<span class="normal"><a href="#__codelineno-49-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">():</span>
<a id="__codelineno-49-2" name="__codelineno-49-2"></a>    <span class="c1"># on rend la config</span>
<a id="__codelineno-49-3" name="__codelineno-49-3"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-49-4" name="__codelineno-49-4"></a>        <span class="c1"># configuration Flask</span>
<a id="__codelineno-49-5" name="__codelineno-49-5"></a>        <span class="s2">&quot;SECRET_KEY&quot;</span><span class="p">:</span> <span class="s2">&quot;vibnFfrdWYUp?*LQ&quot;</span>
<a id="__codelineno-49-6" name="__codelineno-49-6"></a>    <span class="p">}</span>
<a id="__codelineno-49-7" name="__codelineno-49-7"></a>
<a id="__codelineno-49-8" name="__codelineno-49-8"></a>    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<p>Nous lançons cette application. Les logs dans la console PyCharm sont les suivants :</p>
<p><img src="images/100000000000035400000178F614043D.png" style="width:9.85cm;height:4.351cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, lancement initial de l’application ;</li>
<li>en <strong>[2]</strong> parce qu’on a demandé le mode <strong>[Debug]</strong>, l’application est relancée en mode <strong>[Debug]</strong> ;
Maintenant avec un navigateur (Chrome ci-dessous), on demande l’URL [<a href="http://127.0.0.1:5000/"><u><u>http://127.0.0.1:5000/</u></u></a>] :</li>
</ul>
<p><img src="images/10000000000002190000015107212566.png" style="width:6.19cm;height:3.901cm;" alt="Image" /></p>
<p>Maintenant avec un navigateur Firefox :</p>
<p><img src="images/10000000000002BD00000133B8E0A113.png" style="width:8.081cm;height:3.541cm;" alt="Image" /></p>
<p>Maintenant avec le client Postman :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-50-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-50-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-50-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-50-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-50-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-50-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-50-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-50-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-50-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-50-10">10</a></span>
<span class="normal"><a href="#__codelineno-50-11">11</a></span>
<span class="normal"><a href="#__codelineno-50-12">12</a></span>
<span class="normal"><a href="#__codelineno-50-13">13</a></span>
<span class="normal"><a href="#__codelineno-50-14">14</a></span>
<span class="normal"><a href="#__codelineno-50-15">15</a></span>
<span class="normal"><a href="#__codelineno-50-16">16</a></span>
<span class="normal"><a href="#__codelineno-50-17">17</a></span>
<span class="normal"><a href="#__codelineno-50-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="n">GET</span> <span class="o">/</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.1</span>
<a id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-50-4" name="__codelineno-50-4"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="mf">51e75099</span><span class="o">-</span><span class="mi">8</span><span class="n">ecb</span><span class="o">-</span><span class="mi">4</span><span class="n">f27</span><span class="o">-</span><span class="n">ae3b</span><span class="o">-</span><span class="mf">9386e982</span><span class="n">ede4</span>
<a id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-50-8" name="__codelineno-50-8"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
<a id="__codelineno-50-9" name="__codelineno-50-9"></a>
<a id="__codelineno-50-10" name="__codelineno-50-10"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-50-11" name="__codelineno-50-11"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-50-12" name="__codelineno-50-12"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">39</span>
<a id="__codelineno-50-13" name="__codelineno-50-13"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-50-14" name="__codelineno-50-14"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">15</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">10</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">26</span> <span class="n">GMT</span>
<a id="__codelineno-50-15" name="__codelineno-50-15"></a>
<a id="__codelineno-50-16" name="__codelineno-50-16"></a><span class="p">{</span>
<a id="__codelineno-50-17" name="__codelineno-50-17"></a><span class="s2">&quot;SECRET_KEY&quot;</span><span class="p">:</span> <span class="s2">&quot;vibnFfrdWYUp?*LQ&quot;</span>
<a id="__codelineno-50-18" name="__codelineno-50-18"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Maintenant, on revient dans la console <strong>[Run]</strong> de Pycharm :</p>
<p><img src="images/10000000000003D0000001EC8893BB2B.png" style="width:11.261cm;height:5.691cm;" alt="Image" /></p>
<ul>
<li>les deux logs <strong>[1, 2]</strong> sont toujours là mais il n’y en a pas d’autres alors que l’on voit les trois requêtes reçues par le serveur web ;
Pour être totalement sûrs que l’application n’est pas rechargée à chaque nouvelle requête, on peut mettre un compteur dans la configuration et l’incrémenter à chaque nouvelle requête. On verra alors que chaque client voit le compteur dans l’état où l’a laissé le précédent client. On rappelle cependant que les clients ne devraient pas modifier des données de portée application parce qu’elles sont partagées entre tous les clients et que dans un contexte où le serveur sert simultanément plusieurs clients sans garantie que la requête d’un client soit exécutée entièrement sans être interrompue, un client 1 qui a émis une requête 1 interrompue avant sa fin peut laisser les données partagées dans un état corrompu pour les clients suivants.</li>
</ul>
<h3 id="2273-script-application_scope_02">22.7.3. script [application_scope_02]</h3>
<p><img src="images/10000000000001370000013718162EC8.png" style="width:3.59cm;height:3.59cm;" alt="Image" /></p>
<p>Le script <strong>[application_scope_02]</strong> va faire ce qu’il ne faut pas faire : permettre aux clients de modifier des informations partagées avec les autres utilisateurs. On va partager un compteur entre les utilisateurs qui vont l’incrémenter. On va voir que chaque utilisateur voit les modifications apportées par les autres utilisateurs au compteur.</p>
<p>Le script est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-51-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-51-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-51-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-51-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-51-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-51-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-51-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-51-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-51-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-51-10">10</a></span>
<span class="normal"><a href="#__codelineno-51-11">11</a></span>
<span class="normal"><a href="#__codelineno-51-12">12</a></span>
<span class="normal"><a href="#__codelineno-51-13">13</a></span>
<span class="normal"><a href="#__codelineno-51-14">14</a></span>
<span class="normal"><a href="#__codelineno-51-15">15</a></span>
<span class="normal"><a href="#__codelineno-51-16">16</a></span>
<span class="normal"><a href="#__codelineno-51-17">17</a></span>
<span class="normal"><a href="#__codelineno-51-18">18</a></span>
<span class="normal"><a href="#__codelineno-51-19">19</a></span>
<span class="normal"><a href="#__codelineno-51-20">20</a></span>
<span class="normal"><a href="#__codelineno-51-21">21</a></span>
<span class="normal"><a href="#__codelineno-51-22">22</a></span>
<span class="normal"><a href="#__codelineno-51-23">23</a></span>
<span class="normal"><a href="#__codelineno-51-24">24</a></span>
<span class="normal"><a href="#__codelineno-51-25">25</a></span>
<span class="normal"><a href="#__codelineno-51-26">26</a></span>
<span class="normal"><a href="#__codelineno-51-27">27</a></span>
<span class="normal"><a href="#__codelineno-51-28">28</a></span>
<span class="normal"><a href="#__codelineno-51-29">29</a></span>
<span class="normal"><a href="#__codelineno-51-30">30</a></span>
<span class="normal"><a href="#__codelineno-51-31">31</a></span>
<span class="normal"><a href="#__codelineno-51-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="c1"># dépendances</span>
<a id="__codelineno-51-2" name="__codelineno-51-2"></a>
<a id="__codelineno-51-3" name="__codelineno-51-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span>
<a id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-51-5" name="__codelineno-51-5"></a>
<a id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="c1"># application Flask</span>
<a id="__codelineno-51-7" name="__codelineno-51-7"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-51-8" name="__codelineno-51-8"></a>
<a id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="c1"># données de portée application</span>
<a id="__codelineno-51-10" name="__codelineno-51-10"></a><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-51-11" name="__codelineno-51-11"></a>    <span class="s2">&quot;counter&quot;</span><span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-51-12" name="__codelineno-51-12"></a><span class="p">}</span>
<a id="__codelineno-51-13" name="__codelineno-51-13"></a>
<a id="__codelineno-51-14" name="__codelineno-51-14"></a>
<a id="__codelineno-51-15" name="__codelineno-51-15"></a><span class="c1"># Home URL</span>
<a id="__codelineno-51-16" name="__codelineno-51-16"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-51-17" name="__codelineno-51-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-51-18" name="__codelineno-51-18"></a>    <span class="c1"># on vise à montrer que le dictionnaire [config] est partagé entre tous les clients</span>
<a id="__codelineno-51-19" name="__codelineno-51-19"></a>    <span class="c1"># de l&#39;application web</span>
<a id="__codelineno-51-20" name="__codelineno-51-20"></a>
<a id="__codelineno-51-21" name="__codelineno-51-21"></a>    <span class="c1"># on incrémente le compteur</span>
<a id="__codelineno-51-22" name="__codelineno-51-22"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;counter&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-51-23" name="__codelineno-51-23"></a>    <span class="c1"># on envoie la réponse</span>
<a id="__codelineno-51-24" name="__codelineno-51-24"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-51-25" name="__codelineno-51-25"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span>
<a id="__codelineno-51-26" name="__codelineno-51-26"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-51-27" name="__codelineno-51-27"></a>
<a id="__codelineno-51-28" name="__codelineno-51-28"></a>
<a id="__codelineno-51-29" name="__codelineno-51-29"></a><span class="c1"># main</span>
<a id="__codelineno-51-30" name="__codelineno-51-30"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-51-31" name="__codelineno-51-31"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-51-32" name="__codelineno-51-32"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 10-12 : le dictionnaire <strong>[config]</strong> partagé par les utilisateurs. Il contient un compteur ;</li>
<li>ligne 22 : à chaque fois qu’un utilisateur demandera l’URL /, le compteur de la configuration sera incrémenté ;</li>
<li>lignes 23-26 : la chaîne jSON du dictionnaire est envoyée à chaque client ;
On lance ce script. Puis on demande l’URL [<a href="http://127.0.0.1:5000/"><u><u>http://127.0.0.1:5000/</u></u></a>] avec un premier navigateur :</li>
</ul>
<p><img src="images/1000000000000191000000B420109116.png" style="width:4.642cm;height:2.08cm;" alt="Image" /></p>
<p>On fait ensuite la même chose avec un second navigateur :</p>
<p><img src="images/10000000000001E8000000E5A55E01AE.png" style="width:5.631cm;height:2.65cm;" alt="Image" /></p>
<p>Puis une troisième fois avec Postman :</p>
<p><img src="images/100000000000023B000000DAD8605727.png" style="width:6.58cm;height:2.521cm;" alt="Image" /></p>
<p>On voit que chaque client récupère le compteur dans l’état où le client précédent l’a laissé. Ils ont donc bien accès à la même information.</p>
<h3 id="2274-script-application_scope_03">22.7.4. script [application_scope_03]</h3>
<p>Le script <strong>[application_scope_03]</strong> montre pourquoi l’information partagée entre utilisateurs doit être en lecture seule.</p>
<p><img src="images/100000000000013600000137C3593DCB.png" style="width:3.581cm;height:3.59cm;" alt="Image" /></p>
<p>Le script est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-52-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-52-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-52-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-52-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-52-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-52-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-52-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-52-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-52-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-52-10">10</a></span>
<span class="normal"><a href="#__codelineno-52-11">11</a></span>
<span class="normal"><a href="#__codelineno-52-12">12</a></span>
<span class="normal"><a href="#__codelineno-52-13">13</a></span>
<span class="normal"><a href="#__codelineno-52-14">14</a></span>
<span class="normal"><a href="#__codelineno-52-15">15</a></span>
<span class="normal"><a href="#__codelineno-52-16">16</a></span>
<span class="normal"><a href="#__codelineno-52-17">17</a></span>
<span class="normal"><a href="#__codelineno-52-18">18</a></span>
<span class="normal"><a href="#__codelineno-52-19">19</a></span>
<span class="normal"><a href="#__codelineno-52-20">20</a></span>
<span class="normal"><a href="#__codelineno-52-21">21</a></span>
<span class="normal"><a href="#__codelineno-52-22">22</a></span>
<span class="normal"><a href="#__codelineno-52-23">23</a></span>
<span class="normal"><a href="#__codelineno-52-24">24</a></span>
<span class="normal"><a href="#__codelineno-52-25">25</a></span>
<span class="normal"><a href="#__codelineno-52-26">26</a></span>
<span class="normal"><a href="#__codelineno-52-27">27</a></span>
<span class="normal"><a href="#__codelineno-52-28">28</a></span>
<span class="normal"><a href="#__codelineno-52-29">29</a></span>
<span class="normal"><a href="#__codelineno-52-30">30</a></span>
<span class="normal"><a href="#__codelineno-52-31">31</a></span>
<span class="normal"><a href="#__codelineno-52-32">32</a></span>
<span class="normal"><a href="#__codelineno-52-33">33</a></span>
<span class="normal"><a href="#__codelineno-52-34">34</a></span>
<span class="normal"><a href="#__codelineno-52-35">35</a></span>
<span class="normal"><a href="#__codelineno-52-36">36</a></span>
<span class="normal"><a href="#__codelineno-52-37">37</a></span>
<span class="normal"><a href="#__codelineno-52-38">38</a></span>
<span class="normal"><a href="#__codelineno-52-39">39</a></span>
<span class="normal"><a href="#__codelineno-52-40">40</a></span>
<span class="normal"><a href="#__codelineno-52-41">41</a></span>
<span class="normal"><a href="#__codelineno-52-42">42</a></span>
<span class="normal"><a href="#__codelineno-52-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="c1"># dépendances</span>
<a id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<a id="__codelineno-52-3" name="__codelineno-52-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">sleep</span>
<a id="__codelineno-52-4" name="__codelineno-52-4"></a>
<a id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span>
<a id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-52-7" name="__codelineno-52-7"></a>
<a id="__codelineno-52-8" name="__codelineno-52-8"></a><span class="c1"># application Flask</span>
<a id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-52-10" name="__codelineno-52-10"></a>
<a id="__codelineno-52-11" name="__codelineno-52-11"></a><span class="c1"># données de portée application</span>
<a id="__codelineno-52-12" name="__codelineno-52-12"></a><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-52-13" name="__codelineno-52-13"></a>    <span class="s2">&quot;counter&quot;</span><span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-52-14" name="__codelineno-52-14"></a><span class="p">}</span>
<a id="__codelineno-52-15" name="__codelineno-52-15"></a>
<a id="__codelineno-52-16" name="__codelineno-52-16"></a>
<a id="__codelineno-52-17" name="__codelineno-52-17"></a><span class="c1"># Home URL</span>
<a id="__codelineno-52-18" name="__codelineno-52-18"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-52-19" name="__codelineno-52-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-52-20" name="__codelineno-52-20"></a>    <span class="c1"># on vise à montrer que le dictionnaire [config] est partagé entre tous les clients</span>
<a id="__codelineno-52-21" name="__codelineno-52-21"></a>    <span class="c1"># de l&#39;application web et qu&#39;il doit être en lecture seule</span>
<a id="__codelineno-52-22" name="__codelineno-52-22"></a>
<a id="__codelineno-52-23" name="__codelineno-52-23"></a>    <span class="c1"># nom du thread</span>
<a id="__codelineno-52-24" name="__codelineno-52-24"></a>    <span class="n">thread_name</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-52-25" name="__codelineno-52-25"></a>    <span class="c1"># on lit le compteur</span>
<a id="__codelineno-52-26" name="__codelineno-52-26"></a>    <span class="n">counter</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;counter&quot;</span><span class="p">]</span>
<a id="__codelineno-52-27" name="__codelineno-52-27"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;compteur lu : </span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2">, par le thread </span><span class="si">{</span><span class="n">thread_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-52-28" name="__codelineno-52-28"></a>    <span class="c1"># on s&#39;arrête 5 secondes - du coup d&#39;autres clients vont être servis</span>
<a id="__codelineno-52-29" name="__codelineno-52-29"></a>    <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-52-30" name="__codelineno-52-30"></a>    <span class="c1"># on incrémente le compteur de la configuration</span>
<a id="__codelineno-52-31" name="__codelineno-52-31"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;counter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-52-32" name="__codelineno-52-32"></a>    <span class="c1"># log</span>
<a id="__codelineno-52-33" name="__codelineno-52-33"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;compteur écrit : </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;counter&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, par le thread </span><span class="si">{</span><span class="n">thread_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-52-34" name="__codelineno-52-34"></a>    <span class="c1"># on envoie la réponse</span>
<a id="__codelineno-52-35" name="__codelineno-52-35"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-52-36" name="__codelineno-52-36"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;application/json; charset=utf-8&#39;</span>
<a id="__codelineno-52-37" name="__codelineno-52-37"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-52-38" name="__codelineno-52-38"></a>
<a id="__codelineno-52-39" name="__codelineno-52-39"></a>
<a id="__codelineno-52-40" name="__codelineno-52-40"></a><span class="c1"># main</span>
<a id="__codelineno-52-41" name="__codelineno-52-41"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-52-42" name="__codelineno-52-42"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-52-43" name="__codelineno-52-43"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 43 : on a changé le mode d’exécution de l’application web. On a écrit <strong>[</strong><strong>threaded=</strong><strong>True</strong><strong>]</strong> pour indiquer que l’application devait servir les utilisateurs simultanément. Cela se fait au moyen de threads d’exécution :</li>
<li>il peut y avoir plusieurs threads d’exécution simultanés, chacun servant un utilisateur ;</li>
<li>le processeur de la machine est partagé par ces threads ;</li>
<li>un thread peut être interrompu avant qu’il n’ait terminé son travail. Il sera repris ultérieurement ;</li>
<li>ligne 19 : la fonction <strong>[index]</strong> peut être exécutée simultanément par plusieurs threads ;</li>
<li>ligne 24 : on récupère le nom du thread qui exécute la fonction <strong>[index]</strong> ;</li>
<li>ligne 26 : on lit la valeur du compteur. Pour les besoins de notre démonstration on décompose l’incrémentation du compteur de la façon suivante :</li>
<li>étape 1 : lecture du compteur (1 par exemple) par le thread 1 ;</li>
<li>étape 2 : pause du thread 1 pendant 5 secondes (ligne 29). Parce que le thread 1 a demandé une pause, le processeur est donné à un autre thread, le thread 2. Le but est que ce nouveau thread lise la même valeur du compteur (=1). Puis lui aussi fait une pause de 5 secondes et perd le processeur ;</li>
<li>étape 3 : incrémentation du compteur, ligne 31 à partir de la valeur lue à l’étape 1 (=1). Le thread 1 est le 1er à le faire : il passe le compteur à 2 puis termine l’exécution de la fonction <strong>[index]</strong>. Puis c’est au tour du thread 2 de se réveiller et de passer lui aussi le compteur à 2 à partir de la valeur lue à l’étape 1 (=1). Au final, après le passage des deux threads, le compteur est à 2 alors qu’il devrait être à 3 ;</li>
<li>ligne 33 : on affiche la valeur du compteur pour vérification ;
Nous lançons le script puis demandons l’url <strong>[http://loaclhost :5000/]</strong> avec deux navigateurs puis avec Postman. Les logs dans la console PyCharm sont alors les suivants :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-53-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-53-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-53-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-53-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-53-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-53-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-53-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-53-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-53-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-53-10">10</a></span>
<span class="normal"><a href="#__codelineno-53-11">11</a></span>
<span class="normal"><a href="#__codelineno-53-12">12</a></span>
<span class="normal"><a href="#__codelineno-53-13">13</a></span>
<span class="normal"><a href="#__codelineno-53-14">14</a></span>
<span class="normal"><a href="#__codelineno-53-15">15</a></span>
<span class="normal"><a href="#__codelineno-53-16">16</a></span>
<span class="normal"><a href="#__codelineno-53-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">flask</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="n">application_scope_03</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-53-2" name="__codelineno-53-2"></a> <span class="o">*</span> <span class="n">Serving</span> <span class="n">Flask</span> <span class="n">app</span> <span class="s2">&quot;application_scope_03&quot;</span> <span class="p">(</span><span class="n">lazy</span> <span class="n">loading</span><span class="p">)</span>
<a id="__codelineno-53-3" name="__codelineno-53-3"></a> <span class="o">*</span> <span class="n">Environment</span><span class="p">:</span> <span class="n">development</span>
<a id="__codelineno-53-4" name="__codelineno-53-4"></a> <span class="o">*</span> <span class="n">Debug</span> <span class="n">mode</span><span class="p">:</span> <span class="n">on</span>
<a id="__codelineno-53-5" name="__codelineno-53-5"></a> <span class="o">*</span> <span class="n">Restarting</span> <span class="k">with</span> <span class="n">stat</span>
<a id="__codelineno-53-6" name="__codelineno-53-6"></a> <span class="o">*</span> <span class="n">Debugger</span> <span class="ow">is</span> <span class="n">active</span><span class="err">!</span>
<a id="__codelineno-53-7" name="__codelineno-53-7"></a> <span class="o">*</span> <span class="n">Debugger</span> <span class="n">PIN</span><span class="p">:</span> <span class="mi">334</span><span class="o">-</span><span class="mi">263</span><span class="o">-</span><span class="mi">283</span>
<a id="__codelineno-53-8" name="__codelineno-53-8"></a> <span class="o">*</span> <span class="n">Running</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0.0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span> <span class="p">(</span><span class="n">Press</span> <span class="n">CTRL</span><span class="o">+</span><span class="n">C</span> <span class="n">to</span> <span class="n">quit</span><span class="p">)</span>
<a id="__codelineno-53-9" name="__codelineno-53-9"></a><span class="n">compteur</span> <span class="n">lu</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">par</span> <span class="n">le</span> <span class="n">thread</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span>
<a id="__codelineno-53-10" name="__codelineno-53-10"></a><span class="n">compteur</span> <span class="n">lu</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">par</span> <span class="n">le</span> <span class="n">thread</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span>
<a id="__codelineno-53-11" name="__codelineno-53-11"></a><span class="n">compteur</span> <span class="n">écrit</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">par</span> <span class="n">le</span> <span class="n">thread</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span>
<a id="__codelineno-53-12" name="__codelineno-53-12"></a><span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">16</span><span class="o">/</span><span class="n">Jul</span><span class="o">/</span><span class="mi">2020</span> <span class="mi">08</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">37</span><span class="p">]</span> <span class="s2">&quot;GET / HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="o">-</span>
<a id="__codelineno-53-13" name="__codelineno-53-13"></a><span class="n">compteur</span> <span class="n">écrit</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">par</span> <span class="n">le</span> <span class="n">thread</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span>
<a id="__codelineno-53-14" name="__codelineno-53-14"></a><span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">16</span><span class="o">/</span><span class="n">Jul</span><span class="o">/</span><span class="mi">2020</span> <span class="mi">08</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span> <span class="s2">&quot;GET / HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="o">-</span>
<a id="__codelineno-53-15" name="__codelineno-53-15"></a><span class="n">compteur</span> <span class="n">lu</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">par</span> <span class="n">le</span> <span class="n">thread</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">5</span>
<a id="__codelineno-53-16" name="__codelineno-53-16"></a><span class="n">compteur</span> <span class="n">écrit</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="n">par</span> <span class="n">le</span> <span class="n">thread</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">5</span>
<a id="__codelineno-53-17" name="__codelineno-53-17"></a><span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">16</span><span class="o">/</span><span class="n">Jul</span><span class="o">/</span><span class="mi">2020</span> <span class="mi">08</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">46</span><span class="p">]</span> <span class="s2">&quot;GET / HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="o">-</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 9-10 : les deux premiers threads 2 et 4 lisent la même valeur 0 du compteur ;</li>
<li>ligne 11 : le thread 2 passe le compteur à 1 ;</li>
<li>ligne 13 : le thread 4 passe le compteur à 1. A partir de maintenant la valeur du compteur est incorrecte ;</li>
<li>lignes 15-16 : le thread 5 n’est pas interrompu et gère correctement la valeur du compteur ;
On retiendra de cet exemple que le code d’une application web ne doit pas modifier la valeur d’informations partagées par les utilisateurs.</li>
</ul>
<h2 id="228-scripts-flask07-gestion-des-routes">22.8. scripts [flask/07] : gestion des routes</h2>
<p><img src="images/100000000000010300000130FE8A2D44.png" style="width:2.991cm;height:3.511cm;" alt="Image" /></p>
<p>Nous nous intéressons ici à la gestion des routes d’une application, ç-à-d les URL servies par l’application web.</p>
<h3 id="2281-script-main_01-routes-parametrees">22.8.1. script [main_01] : routes paramétrées</h3>
<p>Le script <strong>[main_01]</strong> introduit la possibilité de paramétrer les routes :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-54-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-54-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-54-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-54-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-54-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-54-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-54-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-54-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-54-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-54-10">10</a></span>
<span class="normal"><a href="#__codelineno-54-11">11</a></span>
<span class="normal"><a href="#__codelineno-54-12">12</a></span>
<span class="normal"><a href="#__codelineno-54-13">13</a></span>
<span class="normal"><a href="#__codelineno-54-14">14</a></span>
<span class="normal"><a href="#__codelineno-54-15">15</a></span>
<span class="normal"><a href="#__codelineno-54-16">16</a></span>
<span class="normal"><a href="#__codelineno-54-17">17</a></span>
<span class="normal"><a href="#__codelineno-54-18">18</a></span>
<span class="normal"><a href="#__codelineno-54-19">19</a></span>
<span class="normal"><a href="#__codelineno-54-20">20</a></span>
<span class="normal"><a href="#__codelineno-54-21">21</a></span>
<span class="normal"><a href="#__codelineno-54-22">22</a></span>
<span class="normal"><a href="#__codelineno-54-23">23</a></span>
<span class="normal"><a href="#__codelineno-54-24">24</a></span>
<span class="normal"><a href="#__codelineno-54-25">25</a></span>
<span class="normal"><a href="#__codelineno-54-26">26</a></span>
<span class="normal"><a href="#__codelineno-54-27">27</a></span>
<span class="normal"><a href="#__codelineno-54-28">28</a></span>
<span class="normal"><a href="#__codelineno-54-29">29</a></span>
<span class="normal"><a href="#__codelineno-54-30">30</a></span>
<span class="normal"><a href="#__codelineno-54-31">31</a></span>
<span class="normal"><a href="#__codelineno-54-32">32</a></span>
<span class="normal"><a href="#__codelineno-54-33">33</a></span>
<span class="normal"><a href="#__codelineno-54-34">34</a></span>
<span class="normal"><a href="#__codelineno-54-35">35</a></span>
<span class="normal"><a href="#__codelineno-54-36">36</a></span>
<span class="normal"><a href="#__codelineno-54-37">37</a></span>
<span class="normal"><a href="#__codelineno-54-38">38</a></span>
<span class="normal"><a href="#__codelineno-54-39">39</a></span>
<span class="normal"><a href="#__codelineno-54-40">40</a></span>
<span class="normal"><a href="#__codelineno-54-41">41</a></span>
<span class="normal"><a href="#__codelineno-54-42">42</a></span>
<span class="normal"><a href="#__codelineno-54-43">43</a></span>
<span class="normal"><a href="#__codelineno-54-44">44</a></span>
<span class="normal"><a href="#__codelineno-54-45">45</a></span>
<span class="normal"><a href="#__codelineno-54-46">46</a></span>
<span class="normal"><a href="#__codelineno-54-47">47</a></span>
<span class="normal"><a href="#__codelineno-54-48">48</a></span>
<span class="normal"><a href="#__codelineno-54-49">49</a></span>
<span class="normal"><a href="#__codelineno-54-50">50</a></span>
<span class="normal"><a href="#__codelineno-54-51">51</a></span>
<span class="normal"><a href="#__codelineno-54-52">52</a></span>
<span class="normal"><a href="#__codelineno-54-53">53</a></span>
<span class="normal"><a href="#__codelineno-54-54">54</a></span>
<span class="normal"><a href="#__codelineno-54-55">55</a></span>
<span class="normal"><a href="#__codelineno-54-56">56</a></span>
<span class="normal"><a href="#__codelineno-54-57">57</a></span>
<span class="normal"><a href="#__codelineno-54-58">58</a></span>
<span class="normal"><a href="#__codelineno-54-59">59</a></span>
<span class="normal"><a href="#__codelineno-54-60">60</a></span>
<span class="normal"><a href="#__codelineno-54-61">61</a></span>
<span class="normal"><a href="#__codelineno-54-62">62</a></span>
<span class="normal"><a href="#__codelineno-54-63">63</a></span>
<span class="normal"><a href="#__codelineno-54-64">64</a></span>
<span class="normal"><a href="#__codelineno-54-65">65</a></span>
<span class="normal"><a href="#__codelineno-54-66">66</a></span>
<span class="normal"><a href="#__codelineno-54-67">67</a></span>
<span class="normal"><a href="#__codelineno-54-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span>
<a id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-54-3" name="__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="c1"># application Flask</span>
<a id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-54-6" name="__codelineno-54-6"></a>
<a id="__codelineno-54-7" name="__codelineno-54-7"></a>
<a id="__codelineno-54-8" name="__codelineno-54-8"></a><span class="c1"># envoi de la réponse</span>
<a id="__codelineno-54-9" name="__codelineno-54-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">send_plain_response</span><span class="p">(</span><span class="n">réponse</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-54-10" name="__codelineno-54-10"></a>    <span class="c1"># on envoie la réponse</span>
<a id="__codelineno-54-11" name="__codelineno-54-11"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">réponse</span><span class="p">)</span>
<a id="__codelineno-54-12" name="__codelineno-54-12"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;text/plain; charset=utf-8&#39;</span>
<a id="__codelineno-54-13" name="__codelineno-54-13"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-54-14" name="__codelineno-54-14"></a>
<a id="__codelineno-54-15" name="__codelineno-54-15"></a>
<a id="__codelineno-54-16" name="__codelineno-54-16"></a><span class="c1"># /nom/prenom</span>
<a id="__codelineno-54-17" name="__codelineno-54-17"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;string:nom&gt;/&lt;string:prenom&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-54-18" name="__codelineno-54-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="n">nom</span><span class="p">,</span> <span class="n">prenom</span><span class="p">):</span>
<a id="__codelineno-54-19" name="__codelineno-54-19"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-54-20" name="__codelineno-54-20"></a>    <span class="k">return</span> <span class="n">send_plain_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prenom</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">nom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-54-21" name="__codelineno-54-21"></a>
<a id="__codelineno-54-22" name="__codelineno-54-22"></a>
<a id="__codelineno-54-23" name="__codelineno-54-23"></a><span class="c1"># init-session</span>
<a id="__codelineno-54-24" name="__codelineno-54-24"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/init-session/&lt;string:type&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-54-25" name="__codelineno-54-25"></a><span class="k">def</span><span class="w"> </span><span class="nf">init_session</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-54-26" name="__codelineno-54-26"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-54-27" name="__codelineno-54-27"></a>    <span class="k">return</span> <span class="n">send_plain_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/init-session/</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-54-28" name="__codelineno-54-28"></a>
<a id="__codelineno-54-29" name="__codelineno-54-29"></a>
<a id="__codelineno-54-30" name="__codelineno-54-30"></a><span class="c1"># authentifier-utilisateur</span>
<a id="__codelineno-54-31" name="__codelineno-54-31"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/authentifier-utilisateur&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<a id="__codelineno-54-32" name="__codelineno-54-32"></a><span class="k">def</span><span class="w"> </span><span class="nf">authentifier_utilisateur</span><span class="p">():</span>
<a id="__codelineno-54-33" name="__codelineno-54-33"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-54-34" name="__codelineno-54-34"></a>    <span class="k">return</span> <span class="n">send_plain_response</span><span class="p">(</span><span class="s2">&quot;/authentifier-utilisateur&quot;</span><span class="p">)</span>
<a id="__codelineno-54-35" name="__codelineno-54-35"></a>
<a id="__codelineno-54-36" name="__codelineno-54-36"></a>
<a id="__codelineno-54-37" name="__codelineno-54-37"></a><span class="c1"># calculer-impot</span>
<a id="__codelineno-54-38" name="__codelineno-54-38"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/calculer-impot&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<a id="__codelineno-54-39" name="__codelineno-54-39"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculer_impot</span><span class="p">():</span>
<a id="__codelineno-54-40" name="__codelineno-54-40"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-54-41" name="__codelineno-54-41"></a>    <span class="k">return</span> <span class="n">send_plain_response</span><span class="p">(</span><span class="s2">&quot;/calculer-impot&quot;</span><span class="p">)</span>
<a id="__codelineno-54-42" name="__codelineno-54-42"></a>
<a id="__codelineno-54-43" name="__codelineno-54-43"></a>
<a id="__codelineno-54-44" name="__codelineno-54-44"></a><span class="c1"># lister-simulations</span>
<a id="__codelineno-54-45" name="__codelineno-54-45"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/lister-simulations&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-54-46" name="__codelineno-54-46"></a><span class="k">def</span><span class="w"> </span><span class="nf">lister_simulations</span><span class="p">():</span>
<a id="__codelineno-54-47" name="__codelineno-54-47"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-54-48" name="__codelineno-54-48"></a>    <span class="k">return</span> <span class="n">send_plain_response</span><span class="p">(</span><span class="s2">&quot;/lister-simulations&quot;</span><span class="p">)</span>
<a id="__codelineno-54-49" name="__codelineno-54-49"></a>
<a id="__codelineno-54-50" name="__codelineno-54-50"></a>
<a id="__codelineno-54-51" name="__codelineno-54-51"></a><span class="c1"># supprimer-simulation</span>
<a id="__codelineno-54-52" name="__codelineno-54-52"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/supprimer-simulation/&lt;int:numero&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-54-53" name="__codelineno-54-53"></a><span class="k">def</span><span class="w"> </span><span class="nf">supprimer_simulation</span><span class="p">(</span><span class="n">numero</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-54-54" name="__codelineno-54-54"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-54-55" name="__codelineno-54-55"></a>    <span class="k">return</span> <span class="n">send_plain_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/supprimer-simulation/</span><span class="si">{</span><span class="n">numero</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-54-56" name="__codelineno-54-56"></a>
<a id="__codelineno-54-57" name="__codelineno-54-57"></a>
<a id="__codelineno-54-58" name="__codelineno-54-58"></a><span class="c1"># fin-session</span>
<a id="__codelineno-54-59" name="__codelineno-54-59"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/fin-session&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-54-60" name="__codelineno-54-60"></a><span class="k">def</span><span class="w"> </span><span class="nf">fin_session</span><span class="p">():</span>
<a id="__codelineno-54-61" name="__codelineno-54-61"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-54-62" name="__codelineno-54-62"></a>    <span class="k">return</span> <span class="n">send_plain_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/fin-session&quot;</span><span class="p">)</span>
<a id="__codelineno-54-63" name="__codelineno-54-63"></a>
<a id="__codelineno-54-64" name="__codelineno-54-64"></a>
<a id="__codelineno-54-65" name="__codelineno-54-65"></a><span class="c1"># main</span>
<a id="__codelineno-54-66" name="__codelineno-54-66"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-54-67" name="__codelineno-54-67"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-54-68" name="__codelineno-54-68"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 17 : on précise le type des paramètres de l’URL. Cela permet à Flask de faire des vérifications. Si le paramètre n’est pas du type attendu, la requête du client sera refusée (erreur 400 Bad Request). Donc Flask fait une partie du travail que nous aurions du faire ;</li>
<li>ligne 18 : pour les paramètres, on doit reprendre les noms exacts des paramètres de la ligne 17 mais pas forcément leur ordre ;</li>
<li>ligne 20 : on utilise la fonction <strong>[send_plain_response]</strong> pour envoyer la réponse au client web ;</li>
<li>ligne 9 : la fonction <strong>[send_plain_response]</strong> reçoit la chaîne de caractères à envoyer au client ;</li>
<li>ligne 11 : le corps de la réponse HTTP est construit ;</li>
<li>ligne 12 : on dit au client qu’on lui envoie du texte brut ;</li>
<li>ligne 13 : on envoie la réponse HTTP ;</li>
<li>lignes 23-62 : d’autres routes paramétrées qui seront utilisées ultérieurement dans un exercice d’application ;
On lance le script et on l’interroge avec le client Postman :</li>
</ul>
<p><img src="images/10000000000005AA000001F49B5D09CB.png" style="width:16.721cm;height:5.781cm;" alt="Image" /></p>
<h3 id="2282-script-main_02-externalisation-des-routes">22.8.2. script [main_02] : externalisation des routes</h3>
<p>Dans le script <strong>[main_01]</strong> précédent, le code peut devenir important s’il y a de nombreuses routes. Le script <strong>[main_02]</strong> montre comment externaliser les routes.</p>
<p><img src="images/100000000000010300000130B409EAE7.png" style="width:2.991cm;height:3.511cm;" alt="Image" /></p>
<p>Le script <strong>[routes_02]</strong> rassemble les fonctions associées aux routes du script précédent :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-55-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-55-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-55-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-55-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-55-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-55-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-55-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-55-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-55-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-55-10">10</a></span>
<span class="normal"><a href="#__codelineno-55-11">11</a></span>
<span class="normal"><a href="#__codelineno-55-12">12</a></span>
<span class="normal"><a href="#__codelineno-55-13">13</a></span>
<span class="normal"><a href="#__codelineno-55-14">14</a></span>
<span class="normal"><a href="#__codelineno-55-15">15</a></span>
<span class="normal"><a href="#__codelineno-55-16">16</a></span>
<span class="normal"><a href="#__codelineno-55-17">17</a></span>
<span class="normal"><a href="#__codelineno-55-18">18</a></span>
<span class="normal"><a href="#__codelineno-55-19">19</a></span>
<span class="normal"><a href="#__codelineno-55-20">20</a></span>
<span class="normal"><a href="#__codelineno-55-21">21</a></span>
<span class="normal"><a href="#__codelineno-55-22">22</a></span>
<span class="normal"><a href="#__codelineno-55-23">23</a></span>
<span class="normal"><a href="#__codelineno-55-24">24</a></span>
<span class="normal"><a href="#__codelineno-55-25">25</a></span>
<span class="normal"><a href="#__codelineno-55-26">26</a></span>
<span class="normal"><a href="#__codelineno-55-27">27</a></span>
<span class="normal"><a href="#__codelineno-55-28">28</a></span>
<span class="normal"><a href="#__codelineno-55-29">29</a></span>
<span class="normal"><a href="#__codelineno-55-30">30</a></span>
<span class="normal"><a href="#__codelineno-55-31">31</a></span>
<span class="normal"><a href="#__codelineno-55-32">32</a></span>
<span class="normal"><a href="#__codelineno-55-33">33</a></span>
<span class="normal"><a href="#__codelineno-55-34">34</a></span>
<span class="normal"><a href="#__codelineno-55-35">35</a></span>
<span class="normal"><a href="#__codelineno-55-36">36</a></span>
<span class="normal"><a href="#__codelineno-55-37">37</a></span>
<span class="normal"><a href="#__codelineno-55-38">38</a></span>
<span class="normal"><a href="#__codelineno-55-39">39</a></span>
<span class="normal"><a href="#__codelineno-55-40">40</a></span>
<span class="normal"><a href="#__codelineno-55-41">41</a></span>
<span class="normal"><a href="#__codelineno-55-42">42</a></span>
<span class="normal"><a href="#__codelineno-55-43">43</a></span>
<span class="normal"><a href="#__codelineno-55-44">44</a></span>
<span class="normal"><a href="#__codelineno-55-45">45</a></span>
<span class="normal"><a href="#__codelineno-55-46">46</a></span>
<span class="normal"><a href="#__codelineno-55-47">47</a></span>
<span class="normal"><a href="#__codelineno-55-48">48</a></span>
<span class="normal"><a href="#__codelineno-55-49">49</a></span>
<span class="normal"><a href="#__codelineno-55-50">50</a></span>
<span class="normal"><a href="#__codelineno-55-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_response</span>
<a id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-55-3" name="__codelineno-55-3"></a>
<a id="__codelineno-55-4" name="__codelineno-55-4"></a>
<a id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">send_response</span><span class="p">(</span><span class="n">réponse</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-55-6" name="__codelineno-55-6"></a>    <span class="c1"># on envoie la réponse</span>
<a id="__codelineno-55-7" name="__codelineno-55-7"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">réponse</span><span class="p">)</span>
<a id="__codelineno-55-8" name="__codelineno-55-8"></a>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;text/plain; charset=utf-8&#39;</span>
<a id="__codelineno-55-9" name="__codelineno-55-9"></a>    <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
<a id="__codelineno-55-10" name="__codelineno-55-10"></a>
<a id="__codelineno-55-11" name="__codelineno-55-11"></a>
<a id="__codelineno-55-12" name="__codelineno-55-12"></a><span class="c1"># Home URL</span>
<a id="__codelineno-55-13" name="__codelineno-55-13"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">(</span><span class="n">nom</span><span class="p">,</span> <span class="n">prenom</span><span class="p">):</span>
<a id="__codelineno-55-14" name="__codelineno-55-14"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-55-15" name="__codelineno-55-15"></a>    <span class="k">return</span> <span class="n">send_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">prenom</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">nom</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-55-16" name="__codelineno-55-16"></a>
<a id="__codelineno-55-17" name="__codelineno-55-17"></a>
<a id="__codelineno-55-18" name="__codelineno-55-18"></a><span class="c1"># init-session</span>
<a id="__codelineno-55-19" name="__codelineno-55-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">init_session</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-55-20" name="__codelineno-55-20"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-55-21" name="__codelineno-55-21"></a>    <span class="k">return</span> <span class="n">send_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/init-session/</span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-55-22" name="__codelineno-55-22"></a>
<a id="__codelineno-55-23" name="__codelineno-55-23"></a>
<a id="__codelineno-55-24" name="__codelineno-55-24"></a><span class="c1"># authentifier-utilisateur</span>
<a id="__codelineno-55-25" name="__codelineno-55-25"></a><span class="k">def</span><span class="w"> </span><span class="nf">authentifier_utilisateur</span><span class="p">():</span>
<a id="__codelineno-55-26" name="__codelineno-55-26"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-55-27" name="__codelineno-55-27"></a>    <span class="k">return</span> <span class="n">send_response</span><span class="p">(</span><span class="s2">&quot;/authentifier-utilisateur&quot;</span><span class="p">)</span>
<a id="__codelineno-55-28" name="__codelineno-55-28"></a>
<a id="__codelineno-55-29" name="__codelineno-55-29"></a>
<a id="__codelineno-55-30" name="__codelineno-55-30"></a><span class="c1"># calculer-impot</span>
<a id="__codelineno-55-31" name="__codelineno-55-31"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculer_impot</span><span class="p">():</span>
<a id="__codelineno-55-32" name="__codelineno-55-32"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-55-33" name="__codelineno-55-33"></a>    <span class="k">return</span> <span class="n">send_response</span><span class="p">(</span><span class="s2">&quot;/calculer-impot&quot;</span><span class="p">)</span>
<a id="__codelineno-55-34" name="__codelineno-55-34"></a>
<a id="__codelineno-55-35" name="__codelineno-55-35"></a>
<a id="__codelineno-55-36" name="__codelineno-55-36"></a><span class="c1"># lister-simulations</span>
<a id="__codelineno-55-37" name="__codelineno-55-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">lister_simulations</span><span class="p">():</span>
<a id="__codelineno-55-38" name="__codelineno-55-38"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-55-39" name="__codelineno-55-39"></a>    <span class="k">return</span> <span class="n">send_response</span><span class="p">(</span><span class="s2">&quot;/lister-simulations&quot;</span><span class="p">)</span>
<a id="__codelineno-55-40" name="__codelineno-55-40"></a>
<a id="__codelineno-55-41" name="__codelineno-55-41"></a>
<a id="__codelineno-55-42" name="__codelineno-55-42"></a><span class="c1"># supprimer-simulation</span>
<a id="__codelineno-55-43" name="__codelineno-55-43"></a><span class="k">def</span><span class="w"> </span><span class="nf">supprimer_simulation</span><span class="p">(</span><span class="n">numero</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-55-44" name="__codelineno-55-44"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-55-45" name="__codelineno-55-45"></a>    <span class="k">return</span> <span class="n">send_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/supprimer-simulation/</span><span class="si">{</span><span class="n">numero</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-55-46" name="__codelineno-55-46"></a>
<a id="__codelineno-55-47" name="__codelineno-55-47"></a>
<a id="__codelineno-55-48" name="__codelineno-55-48"></a><span class="c1"># fin-session</span>
<a id="__codelineno-55-49" name="__codelineno-55-49"></a><span class="k">def</span><span class="w"> </span><span class="nf">fin_session</span><span class="p">():</span>
<a id="__codelineno-55-50" name="__codelineno-55-50"></a>    <span class="c1"># réponse</span>
<a id="__codelineno-55-51" name="__codelineno-55-51"></a>    <span class="k">return</span> <span class="n">send_response</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/fin-session&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>On notera que le script <strong>[routes_02]</strong> n’est pas un script de routes. C’est une liste de fonctions. C’est le script principal <strong>[main_02]</strong> qui fait le lien entre routes et fonctions :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-56-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-56-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-56-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-56-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-56-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-56-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-56-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-56-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-56-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-56-10">10</a></span>
<span class="normal"><a href="#__codelineno-56-11">11</a></span>
<span class="normal"><a href="#__codelineno-56-12">12</a></span>
<span class="normal"><a href="#__codelineno-56-13">13</a></span>
<span class="normal"><a href="#__codelineno-56-14">14</a></span>
<span class="normal"><a href="#__codelineno-56-15">15</a></span>
<span class="normal"><a href="#__codelineno-56-16">16</a></span>
<span class="normal"><a href="#__codelineno-56-17">17</a></span>
<span class="normal"><a href="#__codelineno-56-18">18</a></span>
<span class="normal"><a href="#__codelineno-56-19">19</a></span>
<span class="normal"><a href="#__codelineno-56-20">20</a></span>
<span class="normal"><a href="#__codelineno-56-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>
<a id="__codelineno-56-2" name="__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3"></a><span class="c1"># on déporte les fonctions des routes dans leur propre script</span>
<a id="__codelineno-56-4" name="__codelineno-56-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">routes_02</span>
<a id="__codelineno-56-5" name="__codelineno-56-5"></a>
<a id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="c1"># application Flask</span>
<a id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-56-8" name="__codelineno-56-8"></a>
<a id="__codelineno-56-9" name="__codelineno-56-9"></a><span class="c1"># associations routes / fonctions</span>
<a id="__codelineno-56-10" name="__codelineno-56-10"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/&lt;string:nom&gt;/&lt;string:prenom&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span> <span class="n">view_func</span><span class="o">=</span><span class="n">routes_02</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<a id="__codelineno-56-11" name="__codelineno-56-11"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/init-session/&lt;string:type&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span> <span class="n">view_func</span><span class="o">=</span><span class="n">routes_02</span><span class="o">.</span><span class="n">init_session</span><span class="p">)</span>
<a id="__codelineno-56-12" name="__codelineno-56-12"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/authentifier-utilisateur&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">],</span> <span class="n">view_func</span><span class="o">=</span><span class="n">routes_02</span><span class="o">.</span><span class="n">authentifier_utilisateur</span><span class="p">)</span>
<a id="__codelineno-56-13" name="__codelineno-56-13"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/calculer-impot&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">],</span> <span class="n">view_func</span><span class="o">=</span><span class="n">routes_02</span><span class="o">.</span><span class="n">calculer_impot</span><span class="p">)</span>
<a id="__codelineno-56-14" name="__codelineno-56-14"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/lister-simulations&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span> <span class="n">view_func</span><span class="o">=</span><span class="n">routes_02</span><span class="o">.</span><span class="n">lister_simulations</span><span class="p">)</span>
<a id="__codelineno-56-15" name="__codelineno-56-15"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/supprimer-simulation/&lt;int:numero&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span> <span class="n">view_func</span><span class="o">=</span><span class="n">routes_02</span><span class="o">.</span><span class="n">supprimer_simulation</span><span class="p">)</span>
<a id="__codelineno-56-16" name="__codelineno-56-16"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s1">&#39;/fin-session&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">],</span> <span class="n">view_func</span><span class="o">=</span><span class="n">routes_02</span><span class="o">.</span><span class="n">fin_session</span><span class="p">)</span>
<a id="__codelineno-56-17" name="__codelineno-56-17"></a>
<a id="__codelineno-56-18" name="__codelineno-56-18"></a><span class="c1"># main</span>
<a id="__codelineno-56-19" name="__codelineno-56-19"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-56-20" name="__codelineno-56-20"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-56-21" name="__codelineno-56-21"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 4 : on importe le script des fonctions associées aux routes ;</li>
<li>lignes 9-16 : association routes / fonctions ;
Avec cette méthode, chaque fonction associée à une route peut faire l’objet d’un script séparé si nécessaire.</li>
</ul>
<p>Les résultats sont les mêmes que ceux obtenus avec le script <strong>[main_01]</strong> précédent.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>