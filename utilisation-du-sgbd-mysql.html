
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Python 3 et au framework web Flask par l'exemple">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-flask-sept-2020/utilisation-du-sgbd-mysql.html">
      
      
        <link rel="prev" href="exercice-dx27application---version-4.html">
      
      
        <link rel="next" href="utilisation-du-sgbd-postgresql.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>16. Utilisation du SGBD MySQL - Introduction au langage Python 3 et au framework web Flask par l'exemple</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#16-utilisation-du-sgbd-mysql" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-header__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Python 3 et au framework web Flask par l'exemple
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              16. Utilisation du SGBD MySQL
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-nav__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Python 3 et au framework web Flask par l'exemple
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="avant-propos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Avant-propos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dx27un-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Installation d&#x27;un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-bases-de-python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Les bases de Python
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-chaines-de-caracteres.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Les chaînes de caractères
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-exceptions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Les exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fonctions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Les fonctions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fichiers-texte.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Les fichiers texte
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Exercice d&#x27;application – version 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-imports.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Les imports
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Exercice d’application : version 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Exercice d’application : version 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-et-objets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. Les classes et objets
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-generiques-baseentity-et-myexception.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. Les classes génériques [BaseEntity] et [MyException]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture-en-couches-et-programmation-par-interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. Architecture en couches et programmation par interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. Exercice d&#x27;application - version 4
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    16. Utilisation du SGBD MySQL
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="utilisation-du-sgbd-mysql.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    16. Utilisation du SGBD MySQL
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#161-intallation-du-sgbd-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.1. Intallation du SGBD MySQL
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="16.1. Intallation du SGBD MySQL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1611-installation-de-laragon" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.1.1. Installation de Laragon
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1612-creation-dune-base-de-donnees" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.1.2. Création d’une base de données
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#162-intallation-du-package-mysql-connector-python" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.2. Intallation du package [mysql-connector-python]
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#163-script-mysql_01-connexion-a-une-base-mysql-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.3. script [mysql_01] : connexion à une base MySQL - 1
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#164-script-mysql_02-connexion-a-une-base-mysql-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.4. script [mysql_02] : connexion à une base MySQL - 2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#165-script-mysql_03-creation-dune-table-mysql" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.5. script [mysql_03] : création d&#x27;une table MySQL
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#166-script-mysql_04-execution-dun-fichier-dordres-sql" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.6. script [mysql_04] : exécution d&#x27;un fichier d&#x27;ordres SQL
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#167-script-mysql_05-utilisation-de-requetes-parametrees" class="md-nav__link">
    <span class="md-ellipsis">
      
        16.7. script [mysql_05] : utilisation de requêtes paramétrées
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-postgresql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. Utilisation du SGBD PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="ecrire-du-code-independant-du-sgbd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. Ecrire du code indépendant du SGBD
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-de-lorm-sqlalchemy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. Utilisation de l’ORM SQLALCHEMY
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application-version-5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Exercice d&#x27;application : version 5
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="fonctions-internet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Fonctions internet
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="services-web-avec-le-framework-flask.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Services web avec le framework Flask
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23. Exercice d’application : version 6
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24. Exercice d’application : version 7
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25. Exercice d’application : version 8
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="du-dictionnaire-a-xml-et-vice-versa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26. Du dictionnaire à XML et vice-versa
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-9.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27. Exercice d’application : version 9
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-10.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28. Exercice d’application : version 10
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-11.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    29. Exercice d’application : version 11
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30. Exercice d’application : version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="clients-web-pour-les-services-json-et-xml-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    31. Clients web pour les services jSON et XML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="le-mode-html-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    32. Le mode HTML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-13.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    33. Exercice d’application : version 13
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-14.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    34. Exercice d’application : version 14
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-15.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    35. Exercice d’application : version 15
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-16.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    36. Exercice d’application : version 16
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-17.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    37. Exercice d’application : version 17
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-18.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    38. Exercice d’application : version 18
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    39. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="16-utilisation-du-sgbd-mysql">16. Utilisation du SGBD MySQL</h1>
<p><img src="images/1000000000000168000001EB3E9DBFEB.png" style="width:3.731cm;height:5.091cm;" alt="Image" /></p>
<h2 id="161-intallation-du-sgbd-mysql">16.1. Intallation du SGBD MySQL</h2>
<p>Pour disposer du SGBD MySQL, nous allons installer le logiciel Laragon.</p>
<h3 id="1611-installation-de-laragon">16.1.1. Installation de Laragon</h3>
<p>Laragon est un package réunissant plusieurs logiciels :</p>
<ul>
<li>un serveur web Apache. Nous l&#x27;utiliserons pour l&#x27;écriture de scripts web en Python ;</li>
<li>le SGBD MySQL ;</li>
<li>le langage de script PHP que nous n&#x27;utiliserons pas ;</li>
<li>un serveur Redis implémentant un cache pour des applications web. Nous n&#x27;utiliserons ;
Laragon peut être téléchargé (février 2020) à l&#x27;adresse suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="p">[</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">laragon</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">laragon</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><img src="images/1000000100000433000001A177BF5DDA.png" style="width:16.301cm;height:6.321cm;" alt="Image" /></p>
<p><img src="images/1000000100000433000001A1CEE81769.png" style="width:16.44cm;height:6.37cm;" alt="Image" /></p>
<ul>
<li>l&#x27;installation <strong>[1-5]</strong> donne naissance à l&#x27;arborescence suivante :</li>
</ul>
<p><img src="images/100000000000083D000003996FDD348B.png" style="width:13.951cm;height:6.091cm;" alt="Image" /></p>
<ul>
<li>en <strong>[6]</strong> le dossier d&#x27;installation de PHP (pas utilisé dans ce document) ;
Le lancement de <strong>[Laragon]</strong> affiche la fenêtre suivante :</li>
</ul>
<p><img src="images/10000001000002C3000001D6D3D28280.png" style="width:11.951cm;height:7.94cm;" alt="Image" /></p>
<ul>
<li><strong>[1]</strong> : le menu principal de Laragon ;</li>
<li><strong>[2]</strong> : le bouton <strong>[Start All]</strong> lance le serveur web Apache et le SGBD MySQL ;</li>
<li><strong>[3]</strong> : le bouton <strong>[WEB]</strong> affiche la page web <strong>[http://localhost]</strong> ;</li>
<li><strong>[4]</strong> : le bouton <strong>[Database]</strong> permet de gérer le SGBD MySQL avec l’outil <strong>[phpMyAdmin]</strong>. Il faut auparavant installer celui-ci ;</li>
<li><strong>[5]</strong> : le bouton <strong>[Terminal]</strong> ouvre un terminal de commandes ;</li>
<li><strong>[6]</strong> : le bouton <strong>[Root]</strong> ouvre un explorateur Windows positionné sur le dossier <strong>[&lt;laragon&gt;/www]</strong> qui est la racine du site web <strong>[http://localhost]</strong>. C’est là qu’il faut placer les applications web statiques gérées par le serveur Apache de Laragon ;</li>
</ul>
<h3 id="1612-creation-dune-base-de-donnees">16.1.2. Création d’une base de données</h3>
<p>Nous montrons maintenant comment créer une base de données ainsi qu&#x27;un utilisateur MySQL avec l’outil Laragon.</p>
<p><img src="images/10000001000002F50000027C80AAEFD6.png" style="width:11.281cm;height:9.471cm;" alt="Image" /></p>
<ul>
<li>une fois lancé, Laragon <strong>[1]</strong> peut être administré à partir d&#x27;un menu <strong>[2]</strong> ;</li>
<li>en <strong>[3-5]</strong>, on installe l&#x27;outil <strong>[phpMyAdmin]</strong> d&#x27;administration de MySQL s’il n’a pas déjà été installé ;</li>
</ul>
<p><img src="images/100000010000039B000000B36AFAD98A.png" style="width:13.93cm;height:2.701cm;" alt="Image" /></p>
<ul>
<li>en <strong>[6]</strong>, on démarre le serveur web Apache ainsi que le SGBD MySQL ;</li>
<li>en <strong>[7]</strong>, le serveur Apache est lancé ;</li>
<li>en <strong>[8]</strong>, le SGBD MySQL est lancé ;</li>
</ul>
<p><img src="images/100000010000043300000199932A8AB9.png" style="width:16.911cm;height:6.43cm;" alt="Image" /></p>
<ul>
<li>en <strong>[8-10]</strong>, on crée une base de données qu’on nomme <strong>[dbpersonnes]</strong> <strong>[11]</strong>. On va construire une base de données de personnes ;</li>
</ul>
<p><img src="images/10000001000001EF00000068714EC692.png" style="width:7.621cm;height:1.601cm;" alt="Image" /></p>
<ul>
<li>en <strong>[11]</strong>, on va gérer la base de données qu’on vient de créer ;</li>
</ul>
<p><img src="images/10000001000002D5000001F1B00EAF8C.png" style="width:11.281cm;height:7.73cm;" alt="Image" /></p>
<ul>
<li>l’opération <strong>[Bases de données]</strong> émet une requête web vers l’URL <strong>[http://localhost/phpmyadmin]</strong> <strong>[12]</strong>. C’est le serveur web Apache de Laragon qui répond. L’URL <strong>[http://localhost/phpmyadmin]</strong> est l’URL de l’utilitaire <strong>[phpMyAdmin]</strong> que nous avons installé précédemment <strong>[5]</strong>. Cet utilitaire permet de gérer les bases de données MySQL ;</li>
<li>par défaut, les identifiants de connexion de l’administrateur de la base sont : <strong>root</strong> <strong>[13]</strong> sans mot de passe <strong>[14]</strong> ;</li>
</ul>
<p><img src="images/100000010000025100000145FCB28F32.png" style="width:9.111cm;height:4.991cm;" alt="Image" /></p>
<ul>
<li>en <strong>[16]</strong>, la base de données que nous avons créée précédemment ;</li>
</ul>
<p><img src="images/10000001000002C7000000F1D65E40FB.png" style="width:10.75cm;height:3.641cm;" alt="Image" /></p>
<ul>
<li>on a pour l’instant une base <strong>[dbpersonnes]</strong> <strong>[17]</strong> qui est vide <strong>[18]</strong> ;
On crée un utilisateur <strong>[admpersonnes]</strong> avec le mot de passe <strong>[nobody]</strong> qui va avoir tous les droits sur la base de données <strong>[dbpersonnes]</strong> :</li>
</ul>
<p><img src="images/100000010000035900000152D1575E1B.png" style="width:13.161cm;height:5.19cm;" alt="Image" /></p>
<ul>
<li>en <strong>[19]</strong>, on est positionnés sur la base <strong>[dbpersonnes]</strong> ;</li>
<li>en <strong>[20]</strong>, on sélectionne l’onglet <strong>[Privileges]</strong> ;</li>
<li>en <strong>[21-22]</strong>, on voit que l’utilisateur <strong>[root]</strong> a tous les droits sur la base <strong>[dbpersonnes]</strong> ;</li>
<li>en <strong>[23]</strong>, on crée un nouvel utilisateur ;</li>
</ul>
<p><img src="images/1000000100000433000002BD8294FA0E.png" style="width:16.901cm;height:11.022cm;" alt="Image" /></p>
<ul>
<li>en <strong>[25-26]</strong>, l’utilisateur aura l’identifiant <strong>[admdbpersonnes]</strong> ;</li>
<li>en <strong>[27-29]</strong>, son mot de passe sera <strong>[nobody]</strong> ;</li>
<li>en <strong>[30]</strong>, phpMyAdmin signale que le mot de passe est très faible (facile à craquer). En production, il est préférable de générer un mot de passe fort avec <strong>[31]</strong> ;</li>
<li>en <strong>[32]</strong>, on indique que l’utilisateur <strong>[admdbpersonnes]</strong> doit avoir tous les droits sur la base <strong>[dbpersonnes]</strong> ;</li>
<li>en <strong>[33]</strong>, on valide les renseignements donnés ;</li>
</ul>
<p><img src="images/1000000100000421000000AC423471AB.png" style="width:15.77cm;height:2.56cm;" alt="Image" /></p>
<ul>
<li>en <strong>[35]</strong>, phpMyAdmin indique que l’utilisateur a été créé ;</li>
<li>en <strong>[36]</strong>, l’ordre SQL qui a été émis sur la base ;</li>
<li>
<p>en <strong>[37]</strong>, l’utilisateur <strong>[admpersonnes]</strong> a tous les droits sur la base de données <strong>[dbpersonnes]</strong> ;
Désormais nous avons :</p>
</li>
<li>
<p>une base de données MySQL <strong>[dbpersonnes]</strong> ;</p>
</li>
<li>un utilisateur <strong>[admpersonnes/nobody]</strong> qui a tous les droits sur cette base de données ;</li>
</ul>
<h2 id="162-intallation-du-package-mysql-connector-python">16.2. Intallation du package [mysql-connector-python]</h2>
<p>Nous allons écrire des scripts Python pour exploiter la base de données créée précédemment avec l&#x27;architecture suivante :</p>
<p><img src="images/100000010000030B0000008320840B22.png" style="width:11.84cm;height:1.99cm;" alt="Image" /></p>
<p>Un connecteur sert à isoler le code Python du SGBD exploité. Il existe des connecteurs pour différents SGBD et ceux-ci respectent la même interface. Aussi lorsque ci-dessus, on remplace le SGBD MySQL par le SGBD PostgreSQL, l&#x27;architecture devient la suivante :</p>
<p><img src="images/10000001000003050000007CE8B4EDA2.png" style="width:11.851cm;height:1.9cm;" alt="Image" /></p>
<p>Parce que tous les connecteurs de SGBD respectent tous la même interface, le script Python <strong>n&#x27;a normalement pas à être modifié</strong>. Dans la réalité, la plupart des SGBD ont un SQL propriétaire :</p>
<ul>
<li>ils respectent la norme SQL (Structured Query Language) ;</li>
<li>mais l&#x27;étendent, car elle n&#x27;est pas suffisante, avec des extensions du langage propriétaires ;
Aussi, est-il fréquent que lors d&#x27;un changement de SGBD il y ait des modifications de SQL à faire dans les scripts.</li>
</ul>
<p>Nativement, Python n&#x27;offre pas la possibilité de gérer une base MySQL. Il faut pour cela télécharger un package. Il en existe plusieurs. Nous allons utiliser ici le package <strong>[mysql-connector-python]</strong> qui est le connecteur Officiel d&#x27;Oracle, l&#x27;entreprise qui possède MySQL.</p>
<p>L&#x27;installation du package se fera dans une fenêtre <strong>[Terminal]</strong> de Pycharm :</p>
<p><img src="images/100000010000032C000000C6BC625476.png" style="width:12.45cm;height:3.031cm;" alt="Image" /></p>
<ul>
<li>
<p>le dossier en <strong>[2]</strong> n&#x27;a pas d&#x27;importance pour ce qui va suivre ;
Dans le terminal, on tape la commande <strong>[</strong><strong>pip search MySQL</strong><strong>]</strong> :</p>
</li>
<li>
<p><strong>[</strong><strong>pip</strong><strong>]</strong> (Package Installer for Python) est l&#x27;outil d&#x27;installation des packages Python. L&#x27;outil <strong>[pip]</strong> se connecte au dépôt contenant les packages Python ;</p>
</li>
<li><strong>[</strong><strong>search MySQL</strong><strong>]</strong> : demande la liste des packages contenant le terme <strong>[MySQL]</strong> (la casse n&#x27;a pas d&#x27;importance) dans leur nom ;
Les résultats de la commande sont les suivants :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">mysql</span> <span class="p">(</span><span class="mf">0.0.2</span><span class="p">)</span>                                                   <span class="o">-</span> <span class="n">Virtual</span> <span class="n">package</span> <span class="k">for</span> <span class="n">MySQL</span><span class="o">-</span><span class="n">python</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="n">jx</span><span class="o">-</span><span class="n">mysql</span> <span class="p">(</span><span class="mf">3.49.20042</span><span class="p">)</span>                                           <span class="o">-</span> <span class="n">jx</span><span class="o">-</span><span class="n">mysql</span> <span class="o">-</span> <span class="n">JSON</span> <span class="n">Expressions</span> <span class="k">for</span> <span class="n">MySQL</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="n">weibo</span><span class="o">-</span><span class="n">mysql</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>                                               <span class="o">-</span> <span class="n">insert</span> <span class="n">mysql</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="n">bits</span><span class="o">-</span><span class="n">mysql</span> <span class="p">(</span><span class="mf">1.0.3</span><span class="p">)</span>                                              <span class="o">-</span> <span class="n">BITS</span> <span class="n">MySQL</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="n">MySQL</span><span class="o">-</span><span class="n">python</span> <span class="p">(</span><span class="mf">1.2.5</span><span class="p">)</span>                                            <span class="o">-</span> <span class="n">Python</span> <span class="n">interface</span> <span class="n">to</span> <span class="n">MySQL</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="n">deployfish</span><span class="o">-</span><span class="n">mysql</span> <span class="p">(</span><span class="mf">0.2.13</span><span class="p">)</span>                                       <span class="o">-</span> <span class="n">Deployfish</span> <span class="n">MySQL</span> <span class="n">plugin</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="n">mtstat</span><span class="o">-</span><span class="n">mysql</span> <span class="p">(</span><span class="mf">0.7.3.3</span><span class="p">)</span>                                          <span class="o">-</span> <span class="n">MySQL</span> <span class="n">Plugins</span> <span class="k">for</span> <span class="n">mtstat</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="n">bottle</span><span class="o">-</span><span class="n">mysql</span> <span class="p">(</span><span class="mf">0.3.1</span><span class="p">)</span>                                            <span class="o">-</span> <span class="n">MySQL</span> <span class="n">integration</span> <span class="k">for</span> <span class="n">Bottle</span><span class="o">.</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="n">WintxDriver</span><span class="o">-</span><span class="n">MySQL</span> <span class="p">(</span><span class="mf">2.0.0</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>                                     <span class="o">-</span> <span class="n">MySQL</span> <span class="n">support</span> <span class="k">for</span> <span class="n">Wintx</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="n">py</span><span class="o">-</span><span class="n">mysql</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>                                                  <span class="o">-</span> <span class="n">Operating</span> <span class="n">Mysql</span> <span class="k">for</span> <span class="n">Python</span><span class="o">.</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="n">mysql</span><span class="o">-</span><span class="n">utilities</span> <span class="p">(</span><span class="mf">1.4.3</span><span class="p">)</span>                                         <span class="o">-</span> <span class="n">MySQL</span> <span class="n">Utilities</span> <span class="mf">1.4.3</span> <span class="p">(</span><span class="n">part</span> <span class="n">of</span> <span class="n">MySQL</span> <span class="n">Workbench</span> <span class="n">Distribution</span> <span class="mf">6.0.0</span><span class="p">)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="err">…</span><span class="o">.</span>                                        <span class="o">-</span> <span class="n">Tool</span> <span class="n">to</span> <span class="n">move</span> <span class="n">slices</span> <span class="n">of</span> <span class="n">data</span> <span class="kn">from</span><span class="w"> </span><span class="nn">one</span> <span class="n">MySQL</span> <span class="n">store</span> <span class="n">to</span> <span class="n">another</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="n">mysql</span><span class="o">-</span><span class="n">tracer</span> <span class="p">(</span><span class="mf">2.0.2</span><span class="p">)</span>                                            <span class="o">-</span> <span class="n">A</span> <span class="n">MySQL</span> <span class="n">client</span> <span class="n">to</span> <span class="n">run</span> <span class="n">queries</span><span class="p">,</span> <span class="n">write</span> <span class="n">execution</span> <span class="n">reports</span> <span class="ow">and</span> <span class="n">export</span> <span class="n">results</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="n">mysql</span><span class="o">-</span><span class="n">utils</span> <span class="p">(</span><span class="mf">0.0.2</span><span class="p">)</span>                                             <span class="o">-</span> <span class="n">A</span> <span class="n">simple</span> <span class="n">MySQL</span> <span class="n">library</span> <span class="n">including</span> <span class="n">a</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">utility</span> <span class="n">APIs</span> <span class="k">for</span> <span class="n">Python</span> <span class="n">database</span> <span class="n">programming</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">repackaged</span> <span class="p">(</span><span class="mf">0.3.1</span><span class="p">)</span>                              <span class="o">-</span> <span class="n">MySQL</span> <span class="n">driver</span> <span class="n">written</span> <span class="ow">in</span> <span class="n">Python</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="n">dffml</span><span class="o">-</span><span class="n">source</span><span class="o">-</span><span class="n">mysql</span> <span class="p">(</span><span class="mf">0.0.5</span><span class="p">)</span>                                      <span class="o">-</span> <span class="n">DFFML</span> <span class="n">Source</span> <span class="k">for</span> <span class="n">MySQL</span> <span class="n">Protocol</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span> <span class="p">(</span><span class="mf">8.0.19</span><span class="p">)</span>                                 <span class="o">-</span> <span class="n">MySQL</span> <span class="n">driver</span> <span class="n">written</span> <span class="ow">in</span> <span class="n">Python</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>  <span class="n">INSTALLED</span><span class="p">:</span> <span class="mf">8.0.19</span> <span class="p">(</span><span class="n">latest</span><span class="p">)</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="n">prometheus</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">exporter</span> <span class="p">(</span><span class="mf">0.2.0</span><span class="p">)</span>                               <span class="o">-</span> <span class="n">MySQL</span> <span class="n">query</span> <span class="n">Prometheus</span> <span class="n">exporter</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="n">backwork</span><span class="o">-</span><span class="n">backup</span><span class="o">-</span><span class="n">mysql</span> <span class="p">(</span><span class="mf">0.3.0</span><span class="p">)</span>                                   <span class="o">-</span> <span class="n">Backwork</span> <span class="n">plug</span><span class="o">-</span><span class="ow">in</span> <span class="k">for</span> <span class="n">MySQL</span> <span class="n">backups</span><span class="o">.</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="n">django</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">manager</span> <span class="p">(</span><span class="mf">0.1.4</span><span class="p">)</span>                                    <span class="o">-</span> <span class="n">django</span><span class="o">-</span><span class="n">mysql</span><span class="o">-</span><span class="n">manager</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">Django</span> <span class="n">based</span> <span class="n">management</span> <span class="n">interface</span> <span class="k">for</span> <span class="n">MySQL</span> <span class="n">users</span> <span class="ow">and</span> <span class="n">databases</span><span class="o">.</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="err">…</span><span class="o">.</span>                                              <span class="o">-</span> <span class="n">mysql</span> <span class="n">operate</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">v</span><span class="o">-</span><span class="mi">01</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Ont été listés tous les modules dont le nom ou la description ont le mot clé MySQL. Celui que nous utiliserons (fév 2020) est <strong>[mysql-connector-python]</strong>, ligne 17. Pour l&#x27;installer, on tape dans le terminal la commande <strong>[</strong><strong>pip install -U mysql-connector-python</strong><strong>]</strong> :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span>
<span class="normal"><a href="#__codelineno-2-8">8</a></span>
<span class="normal"><a href="#__codelineno-2-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">v</span><span class="o">-</span><span class="mi">01</span><span class="o">&gt;</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">Collecting</span> <span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>  <span class="n">Using</span> <span class="n">cached</span> <span class="n">mysql_connector_python</span><span class="o">-</span><span class="mf">8.0.19</span><span class="o">-</span><span class="n">py2</span><span class="o">.</span><span class="n">py3</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="nb">any</span><span class="o">.</span><span class="n">whl</span> <span class="p">(</span><span class="mi">355</span> <span class="n">kB</span><span class="p">)</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">,</span> <span class="n">skipping</span> <span class="n">upgrade</span><span class="p">:</span> <span class="n">protobuf</span><span class="o">==</span><span class="mf">3.6.1</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>\<span class="n">myprograms</span>\<span class="n">python38</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span><span class="p">)</span> <span class="p">(</span><span class="mf">3.6.1</span><span class="p">)</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">,</span> <span class="n">skipping</span> <span class="n">upgrade</span><span class="p">:</span> <span class="n">dnspython</span><span class="o">==</span><span class="mf">1.16.0</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>\<span class="n">myprograms</span>\<span class="n">python38</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.16.0</span><span class="p">)</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">,</span> <span class="n">skipping</span> <span class="n">upgrade</span><span class="p">:</span> <span class="n">six</span><span class="o">&gt;=</span><span class="mf">1.9</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>\<span class="n">users</span>\<span class="n">serge</span>\<span class="n">appdata</span>\<span class="n">roaming</span>\<span class="n">python</span>\<span class="n">python38</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">protobuf</span><span class="o">==</span><span class="mf">3.6.1</span><span class="o">-&gt;</span><span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span><span class="p">)</span> <span class="p">(</span><span class="mf">1.14.0</span><span class="p">)</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="n">Requirement</span> <span class="n">already</span> <span class="n">satisfied</span><span class="p">,</span> <span class="n">skipping</span> <span class="n">upgrade</span><span class="p">:</span> <span class="n">setuptools</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>\<span class="n">myprograms</span>\<span class="n">python38</span>\<span class="n">lib</span>\<span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="p">(</span><span class="kn">from</span><span class="w"> </span><span class="nn">protobuf</span><span class="o">==</span><span class="mf">3.6.1</span><span class="o">-&gt;</span><span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span><span class="p">)</span> <span class="p">(</span><span class="mf">41.2.0</span><span class="p">)</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="n">Installing</span> <span class="n">collected</span> <span class="n">packages</span><span class="p">:</span> <span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="n">Successfully</span> <span class="n">installed</span> <span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span><span class="o">-</span><span class="mf">8.0.19</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 1 : l&#x27;option <strong>[install -U]</strong> (U=upgrade) demande la version la plus récente des différents packages associés au package <strong>[mysql-connector-python]</strong> ;
Pour connaître les packages installés dans l&#x27;environnement Python de notre macine, on tape la commande <strong>[</strong><strong>pip list</strong><strong>]</strong> :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">v</span><span class="o">-</span><span class="mi">01</span><span class="o">&gt;</span><span class="n">pip</span> <span class="nb">list</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">Package</span>                <span class="n">Version</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="o">----------------------</span> <span class="o">----------</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="n">asgiref</span>                <span class="mf">3.2.3</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="n">astroid</span>                <span class="mf">2.3.3</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="n">atomicwrites</span>           <span class="mf">1.3.0</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="n">attrs</span>                  <span class="mf">19.3.0</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="n">certifi</span>                <span class="mf">2019.11.28</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="err">…</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="n">MarkupSafe</span>             <span class="mf">1.1.1</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="n">mccabe</span>                 <span class="mf">0.6.1</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="n">more</span><span class="o">-</span><span class="n">itertools</span>         <span class="mf">8.1.0</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span> <span class="mf">8.0.19</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="n">mysqlclient</span>            <span class="mf">1.4.6</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="n">packaging</span>              <span class="mf">20.0</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="n">pip</span>                    <span class="mf">20.0.1</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="n">pipenv</span>                 <span class="mf">2018.11.26</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="err">…</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 13 : on a bien le package <strong>[mysql-connector-python]</strong> ;
Pour savoir comment utiliser le package <strong>[mysql-connector-python]</strong> afin de gérer une base de données MySQL, on ira sur le site du package |<a href="https://dev.mysql.com/doc/connector-python/en/">https://dev.mysql.com/doc/connector-python/en/</a>|. La suite présente une série d&#x27;exemples.</li>
</ul>
<h2 id="163-script-mysql_01-connexion-a-une-base-mysql-1">16.3. script [mysql_01] : connexion à une base MySQL - 1</h2>
<p>Le script <strong>[mysql_01]</strong> présente la première étape de l&#x27;utilisation d&#x27;une base de données. Il va nous permettre de vérifier qu&#x27;on est capables de se connecter à la base <strong>[dbpersonnes]</strong> créée précédemment.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># import du module mysql.connector</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mysql.connector</span><span class="w"> </span><span class="kn">import</span> <span class="n">connect</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">,</span> <span class="n">InterfaceError</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="c1"># connexion à une base MySql [dbpersonnes]</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="c1"># l&#39;identité de l&#39;utilisateur est (admpersonnes,nobody)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="n">USER</span> <span class="o">=</span> <span class="s2">&quot;admpersonnes&quot;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="n">PWD</span> <span class="o">=</span> <span class="s2">&quot;nobody&quot;</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="n">HOST</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="n">DATABASE</span> <span class="o">=</span> <span class="s2">&quot;dbpersonnes&quot;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="c1"># c&#39;est parti</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="n">connexion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connexion au SGBD MySQL en cours...&quot;</span><span class="p">)</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span class="c1"># connexion</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span class="n">connexion</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">HOST</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">USER</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PWD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">DATABASE</span><span class="p">)</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>    <span class="c1"># suivi</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>    <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>        <span class="sa">f</span><span class="s2">&quot;Connexion MySQL réussie à la base database=</span><span class="si">{</span><span class="n">DATABASE</span><span class="si">}</span><span class="s2">, host=</span><span class="si">{</span><span class="n">HOST</span><span class="si">}</span><span class="s2"> sous l&#39;identité user=</span><span class="si">{</span><span class="n">USER</span><span class="si">}</span><span class="s2">, passwd=</span><span class="si">{</span><span class="n">PWD</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="k">except</span> <span class="p">(</span><span class="n">InterfaceError</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>    <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>    <span class="c1"># on ferme la connexion si elle a été ouverte</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>    <span class="k">if</span> <span class="n">connexion</span><span class="p">:</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>        <span class="n">connexion</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong></p>
<ul>
<li>ligne 2 : on importe certaines fonctions et classes du module <strong>[</strong><strong>mysql</strong><strong>.</strong><strong>connector</strong><strong>]</strong> ;</li>
<li>lignes 6-7 : les identifiants de l&#x27;utilisateur qui va se connecter ;</li>
<li>ligne 8 : la machine qui héberge la base de données. En effet, le connecteur MySQL permet de travailler avec une base distante ;</li>
<li>ligne 9 : le nom de la base de données à laquelle on veut se connecter ;</li>
<li>lignes 11-26 : le script va connecter (ligne 16) l&#x27;utilisateur <strong>[admpersonnes / nobody]</strong> à la base de données <strong>[dbpersonnes]</strong> ;</li>
<li>lignes 20-26 : la connexion peut échouer. Aussi la fait-on dans un try / except / finally ;</li>
<li>ligne 16 : la méthode connect du module <strong>[mysq.connector]</strong> admet différents paramètres nommés :</li>
<li>user : utilisateur propriétaire de la connexion <strong>[admpersonnes]</strong> ;</li>
<li>password : mot de passe de l&#x27;utilisateur <strong>[nobody]</strong> ;</li>
<li>host : machine du SGBD MySQL <strong>[localhost]</strong> ;</li>
<li>database : la base de données à laquelle on se connecte. Optionnel.</li>
<li>ligne 20 : si une exception est lancée, elle est de type <strong>[DatabaseError]</strong> ou <strong>[InterfaceError]</strong> ;</li>
<li>lignes 23-26 : dans la clause <strong>[finally]</strong>, on ferme la connexion ;
<strong>Résultats</strong></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">databases</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql_01</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="n">Connexion</span> <span class="n">au</span> <span class="n">SGBD</span> <span class="n">MySQL</span> <span class="n">en</span> <span class="n">cours</span><span class="o">...</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="n">Connexion</span> <span class="n">MySQL</span> <span class="n">réussie</span> <span class="n">à</span> <span class="n">la</span> <span class="n">base</span> <span class="n">database</span><span class="o">=</span><span class="n">dbpersonnes</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">localhost</span> <span class="n">sous</span> <span class="n">l</span><span class="s1">&#39;identité user=admpersonnes, passwd=nobody</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<h2 id="164-script-mysql_02-connexion-a-une-base-mysql-2">16.4. script [mysql_02] : connexion à une base MySQL - 2</h2>
<p>Dans ce nouveau script, la connexion à la base est isolée dans une fonction :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span>
<span class="normal"><a href="#__codelineno-6-39">39</a></span>
<span class="normal"><a href="#__codelineno-6-40">40</a></span>
<span class="normal"><a href="#__codelineno-6-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># import du module mysql.connector</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mysql.connector</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabaseError</span><span class="p">,</span> <span class="n">InterfaceError</span><span class="p">,</span> <span class="n">connect</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="c1"># ---------------------------------------------------------------------------------</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">connexion</span><span class="p">(</span><span class="n">host</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">database</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">login</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pwd</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>    <span class="c1"># connecte puis déconnecte (login,pwd) de la base [database] du serveur [host]</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>    <span class="c1"># lance l&#39;exception DatabaseError si problème</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>    <span class="n">connexion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>        <span class="c1"># connexion</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>        <span class="n">connexion</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">pwd</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>        <span class="nb">print</span><span class="p">(</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>            <span class="sa">f</span><span class="s2">&quot;Connexion réussie à la base database=</span><span class="si">{</span><span class="n">database</span><span class="si">}</span><span class="s2">, host=</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2"> sous l&#39;identité user=</span><span class="si">{</span><span class="n">login</span><span class="si">}</span><span class="s2">, passwd=</span><span class="si">{</span><span class="n">pwd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a>        <span class="c1"># on ferme la connexion si elle a été ouverte</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a>        <span class="k">if</span> <span class="n">connexion</span><span class="p">:</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a>            <span class="n">connexion</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Déconnexion réussie</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="c1"># ---------------------------------------------- main</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="c1"># identifiants de la connexion</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="n">USER</span> <span class="o">=</span> <span class="s2">&quot;admpersonnes&quot;</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="n">PASSWD</span> <span class="o">=</span> <span class="s2">&quot;nobody&quot;</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="n">HOST</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="n">DATABASE</span> <span class="o">=</span> <span class="s2">&quot;dbpersonnes&quot;</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="c1"># connexion d&#39;un utilisateur existant</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a>    <span class="n">connexion</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">HOST</span><span class="p">,</span> <span class="n">login</span><span class="o">=</span><span class="n">USER</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="n">PASSWD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">DATABASE</span><span class="p">)</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="k">except</span> <span class="p">(</span><span class="n">InterfaceError</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-6-33" name="__codelineno-6-33"></a>    <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-6-34" name="__codelineno-6-34"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">erreur</span><span class="p">)</span>
<a id="__codelineno-6-35" name="__codelineno-6-35"></a>
<a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="c1"># connexion d&#39;un utilisateur inexistant</span>
<a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-6-38" name="__codelineno-6-38"></a>    <span class="n">connexion</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">HOST</span><span class="p">,</span> <span class="n">login</span><span class="o">=</span><span class="s2">&quot;xx&quot;</span><span class="p">,</span> <span class="n">pwd</span><span class="o">=</span><span class="s2">&quot;xx&quot;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">DATABASE</span><span class="p">)</span>
<a id="__codelineno-6-39" name="__codelineno-6-39"></a><span class="k">except</span> <span class="p">(</span><span class="n">InterfaceError</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-6-40" name="__codelineno-6-40"></a>    <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">erreur</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong> :</p>
<ul>
<li>lignes 6-19 : une fonction <strong>[connexion]</strong> qui tente de connecter puis de déconnecter un utilisateur à la base de données <strong>[dbpersonnes]</strong>. Affiche le résultat ;</li>
<li>lignes 29-41 : programme principal – appelle deux fois la méthode connexion et affiche les éventuelles exceptions ;
<strong>Résultats</strong></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span>
<span class="normal"><a href="#__codelineno-7-4">4</a></span>
<span class="normal"><a href="#__codelineno-7-5">5</a></span>
<span class="normal"><a href="#__codelineno-7-6">6</a></span>
<span class="normal"><a href="#__codelineno-7-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">databases</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql_02</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="n">Connexion</span> <span class="n">MySQL</span> <span class="n">réussie</span> <span class="n">à</span> <span class="n">la</span> <span class="n">base</span> <span class="n">database</span><span class="o">=</span><span class="n">dbpersonnes</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">localhost</span> <span class="n">sous</span> <span class="n">l</span><span class="s1">&#39;identité user=admpersonnes, passwd=nobody</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">Déconnexion</span> <span class="n">MySQL</span> <span class="n">réussie</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="mi">1045</span> <span class="p">(</span><span class="mi">28000</span><span class="p">):</span> <span class="n">Access</span> <span class="n">denied</span> <span class="k">for</span> <span class="n">user</span> <span class="s1">&#39;xx&#39;</span><span class="o">@</span><span class="s1">&#39;localhost&#39;</span> <span class="p">(</span><span class="n">using</span> <span class="n">password</span><span class="p">:</span> <span class="n">YES</span><span class="p">)</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<h2 id="165-script-mysql_03-creation-dune-table-mysql">16.5. script [mysql_03] : création d&#x27;une table MySQL</h2>
<p>Maintenant qu&#x27;on sait créer une connexion avec un SGBD MySQL, on commence à émettre des ordres SQL sur cette connexion. Pour cela, nous allons nous connecter à la base créée <strong>[dbpersonnes]</strong> et utiliser la connexion pour créer une table dans la base.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span>
<span class="normal"><a href="#__codelineno-8-33">33</a></span>
<span class="normal"><a href="#__codelineno-8-34">34</a></span>
<span class="normal"><a href="#__codelineno-8-35">35</a></span>
<span class="normal"><a href="#__codelineno-8-36">36</a></span>
<span class="normal"><a href="#__codelineno-8-37">37</a></span>
<span class="normal"><a href="#__codelineno-8-38">38</a></span>
<span class="normal"><a href="#__codelineno-8-39">39</a></span>
<span class="normal"><a href="#__codelineno-8-40">40</a></span>
<span class="normal"><a href="#__codelineno-8-41">41</a></span>
<span class="normal"><a href="#__codelineno-8-42">42</a></span>
<span class="normal"><a href="#__codelineno-8-43">43</a></span>
<span class="normal"><a href="#__codelineno-8-44">44</a></span>
<span class="normal"><a href="#__codelineno-8-45">45</a></span>
<span class="normal"><a href="#__codelineno-8-46">46</a></span>
<span class="normal"><a href="#__codelineno-8-47">47</a></span>
<span class="normal"><a href="#__codelineno-8-48">48</a></span>
<span class="normal"><a href="#__codelineno-8-49">49</a></span>
<span class="normal"><a href="#__codelineno-8-50">50</a></span>
<span class="normal"><a href="#__codelineno-8-51">51</a></span>
<span class="normal"><a href="#__codelineno-8-52">52</a></span>
<span class="normal"><a href="#__codelineno-8-53">53</a></span>
<span class="normal"><a href="#__codelineno-8-54">54</a></span>
<span class="normal"><a href="#__codelineno-8-55">55</a></span>
<span class="normal"><a href="#__codelineno-8-56">56</a></span>
<span class="normal"><a href="#__codelineno-8-57">57</a></span>
<span class="normal"><a href="#__codelineno-8-58">58</a></span>
<span class="normal"><a href="#__codelineno-8-59">59</a></span>
<span class="normal"><a href="#__codelineno-8-60">60</a></span>
<span class="normal"><a href="#__codelineno-8-61">61</a></span>
<span class="normal"><a href="#__codelineno-8-62">62</a></span>
<span class="normal"><a href="#__codelineno-8-63">63</a></span>
<span class="normal"><a href="#__codelineno-8-64">64</a></span>
<span class="normal"><a href="#__codelineno-8-65">65</a></span>
<span class="normal"><a href="#__codelineno-8-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># imports</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mysql.connector</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabaseError</span><span class="p">,</span> <span class="n">InterfaceError</span><span class="p">,</span> <span class="n">connect</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mysql.connector.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">MySQLConnection</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="c1"># ---------------------------------------------------------------------------------</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute_sql</span><span class="p">(</span><span class="n">connexion</span><span class="p">:</span> <span class="n">MySQLConnection</span><span class="p">,</span> <span class="n">update</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>    <span class="c1"># exécute une requête de mise à jour sur la connexion</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>    <span class="n">curseur</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>        <span class="c1"># on demande un curseur</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>        <span class="n">curseur</span> <span class="o">=</span> <span class="n">connexion</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>        <span class="c1"># exécute la requête update sur la connexion</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>        <span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a>        <span class="c1"># fermeture du curseur s&#39;il a été obtenu</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>        <span class="k">if</span> <span class="n">curseur</span><span class="p">:</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>            <span class="n">curseur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="c1"># ---------------------------------------------- main</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="c1"># identifiants de la connexion</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="c1"># l&#39;identité de l&#39;utilisateur</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="n">ID</span> <span class="o">=</span> <span class="s2">&quot;admpersonnes&quot;</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="n">PWD</span> <span class="o">=</span> <span class="s2">&quot;nobody&quot;</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="c1"># la machine hôte du sgbd</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a><span class="n">HOST</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a><span class="c1"># identité de la base</span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a><span class="n">DATABASE</span> <span class="o">=</span> <span class="s2">&quot;dbpersonnes&quot;</span>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a><span class="c1"># on y va étape par étape</span>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a>    <span class="c1"># connexion</span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a>    <span class="n">connexion</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">HOST</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">ID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PWD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">DATABASE</span><span class="p">)</span>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a>    <span class="c1"># mode AUTOCOMMIT</span>
<a id="__codelineno-8-38" name="__codelineno-8-38"></a>    <span class="n">connexion</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-8-39" name="__codelineno-8-39"></a><span class="k">except</span> <span class="p">(</span><span class="n">InterfaceError</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-8-40" name="__codelineno-8-40"></a>    <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-8-42" name="__codelineno-8-42"></a>    <span class="c1"># on quitte</span>
<a id="__codelineno-8-43" name="__codelineno-8-43"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-8-44" name="__codelineno-8-44"></a>
<a id="__codelineno-8-45" name="__codelineno-8-45"></a><span class="c1"># suppression de la table personnes si elle existe</span>
<a id="__codelineno-8-46" name="__codelineno-8-46"></a><span class="c1"># si elle n&#39;existe pas une erreur se produira - on l&#39;ignore</span>
<a id="__codelineno-8-47" name="__codelineno-8-47"></a><span class="n">requête</span> <span class="o">=</span> <span class="s2">&quot;drop table personnes&quot;</span>
<a id="__codelineno-8-48" name="__codelineno-8-48"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-8-49" name="__codelineno-8-49"></a>    <span class="n">execute_sql</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="n">requête</span><span class="p">)</span>
<a id="__codelineno-8-50" name="__codelineno-8-50"></a><span class="k">except</span> <span class="p">(</span><span class="n">InterfaceError</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">):</span>
<a id="__codelineno-8-51" name="__codelineno-8-51"></a>    <span class="k">pass</span>
<a id="__codelineno-8-52" name="__codelineno-8-52"></a>
<a id="__codelineno-8-53" name="__codelineno-8-53"></a><span class="c1"># création de la table personnes</span>
<a id="__codelineno-8-54" name="__codelineno-8-54"></a><span class="n">requête</span> <span class="o">=</span> <span class="s2">&quot;create table personnes (id int PRIMARY KEY, prenom varchar(30) NOT NULL, nom varchar(30) NOT NULL, age integer NOT NULL, &quot;</span> \
<a id="__codelineno-8-55" name="__codelineno-8-55"></a>          <span class="s2">&quot;unique(nom,prenom)) &quot;</span>
<a id="__codelineno-8-56" name="__codelineno-8-56"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-8-57" name="__codelineno-8-57"></a>    <span class="c1"># exécution requête</span>
<a id="__codelineno-8-58" name="__codelineno-8-58"></a>    <span class="n">execute_sql</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="n">requête</span><span class="p">)</span>
<a id="__codelineno-8-59" name="__codelineno-8-59"></a>    <span class="c1"># affichage</span>
<a id="__codelineno-8-60" name="__codelineno-8-60"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">requête</span><span class="si">}</span><span class="s2"> : requête réussie&quot;</span><span class="p">)</span>
<a id="__codelineno-8-61" name="__codelineno-8-61"></a><span class="k">except</span> <span class="p">(</span><span class="n">InterfaceError</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-8-62" name="__codelineno-8-62"></a>    <span class="c1"># on affiche l&#39;erreur</span>
<a id="__codelineno-8-63" name="__codelineno-8-63"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-8-64" name="__codelineno-8-64"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-8-65" name="__codelineno-8-65"></a>    <span class="c1"># on se déconnecte</span>
<a id="__codelineno-8-66" name="__codelineno-8-66"></a>    <span class="n">connexion</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong> :</p>
<ul>
<li>ligne 9 : la fonction execute_sql exécute une requête SQL sur une connexion ouverte ;</li>
<li>ligne 14 : les opérations SQL sur la connexion se font au travers d&#x27;un objet particulier appelé curseur ;</li>
<li>ligne 14 : obtention d&#x27;un curseur ;</li>
<li>ligne 16 : exécution de la requête SQL ;</li>
<li>lignes 17-20 : qu&#x27;il y ait erreur ou non, le curseur est fermé. Cela libère les ressources qui lui sont associées. Si exception il y a, alors elle n&#x27;est pas gérée ici. Elle va remonter au code appelant ;</li>
<li>lignes 33-43 : création d&#x27;une connexion avec la base de données ;</li>
<li>ligne 38 : le mode AUTOCOMMIT=True pour une connexion signifie que chaque exécution d&#x27;une requête s&#x27;exécute dans une transaction automatique. Le mode par défaut est AUTOCOMMIT=False où c&#x27;est le développeur qui a la responsabilité de gérer les transactions. Une transaction est un mécanisme qui englobe l&#x27;exécution de plusieurs requêtes 1 à n. Soit celles-ci réussissent toutes, soit aucune ne réussit. Ainsi si les requêtes 1 à i réussissent mais que la requête i+1 échoue, alors les requêtes 1 à i vont être &#x27;défaites&#x27; pour que la base retrouve l&#x27;état qu&#x27;elle avait avant l&#x27;exécution de la requête 1 ;</li>
<li>ici, il y a deux requêtes SQL (lignes 49, 58). Elles seront chacune exécutées dans une transaction. Que la seconde échoue n&#x27;a aucun impact sur la première ;</li>
<li>lignes 45-51 : l&#x27;ordre SQL <strong>[</strong><strong>drop table personnes</strong><strong>]</strong> est exécuté. Elle supprime la table appelée <strong>[personnes]</strong>. Si celle-ci n&#x27;existe pas, une erreur peut être signalée. Celle-ci est ignorée (ligne 51) ;</li>
<li>lignes 53-55 : l&#x27;ordre de création de la table <strong>[personnes]</strong>. Une table peut être vue comme un ensemble de lignes et de colonnes. L&#x27;ordre de création précise le nom des colonnes :</li>
<li><strong>[id]</strong> : un identifiant entier. Il sera unique pour chaque personne. Ce sera la clé primaire (PRIMARY KEY). Cela signifie que dans la table, cette colonne n’a pas deux fois la même valeur et qu’elle peut être utilisée pour identifier une personne ;</li>
<li><strong>[nom]</strong> : une chaîne d&#x27;au plus 30 caractères ;</li>
<li><strong>[prenom]</strong> : une chaîne d&#x27;au plus 30 caractères ;</li>
<li><strong>[age]</strong> : un nombre entier ;</li>
<li>l&#x27;attribut <strong>[NOT NULL]</strong> pour chacune de ces colonnes signifie que dans une ligne de la table, aucune des trois colonnes ne peut être vide ;</li>
<li>le paramètre <strong>[</strong><strong>unique(nom,prenom)</strong><strong>]</strong> s&#x27;appelle une <strong>contrainte</strong>. Ici la contrainte sur les lignes est que le tuple (nom, prenom) de la ligne doit être unique dans la table. Cela signifie qu&#x27;on peut repérer de façon unique dans la table, un individu dont on connaît les nom et prénom ;</li>
<li>lignes 56-60 : exécution de l’ordre SQL ;</li>
<li>lignes 61-63 : gestion de l’éventuelle exception ;</li>
<li>lignes 64-66 : on se déconnecte de la base de données ;
<strong>Résultats</strong></li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">databases</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql_03</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">create</span> <span class="n">table</span> <span class="n">personnes</span> <span class="p">(</span><span class="nb">id</span> <span class="nb">int</span> <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">nom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">age</span> <span class="n">integer</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">unique</span><span class="p">(</span><span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">))</span>  <span class="p">:</span> <span class="n">requête</span> <span class="n">réussie</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<p>Vérification avec <strong>[phpMyAdmin]</strong> :</p>
<p><img src="images/100000000000057200000365E1BC6EAD.png" style="width:16.102cm;height:10.03cm;" alt="Image" /></p>
<ul>
<li>la base de données <strong>[dbpersonnes]</strong> <strong>[1]</strong> a une table <strong>[personnes]</strong> <strong>[2]</strong> qui a la structure <strong>[3-4]</strong>, la clé primaire <strong>[5]</strong> et la contrainte d’unicité <strong>[6]</strong> ;</li>
</ul>
<h2 id="166-script-mysql_04-execution-dun-fichier-dordres-sql">16.6. script [mysql_04] : exécution d&#x27;un fichier d&#x27;ordres SQL</h2>
<p>Après avoir créé précédemment la table <strong>[personnes]</strong>, maintenant nous la remplissons puis l&#x27;exploitons à l&#x27;aide d&#x27;ordres SQL.</p>
<p>Nous souhaitons exécuter les ordres SQL d&#x27;un fichier texte :</p>
<p><img src="images/1000000000000174000001EA2C3FF061.png" style="width:4.291cm;height:5.661cm;" alt="Image" /></p>
<p>Le contenu du fichier <strong>[commandes.sql]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span>
<span class="normal"><a href="#__codelineno-10-30">30</a></span>
<span class="normal"><a href="#__codelineno-10-31">31</a></span>
<span class="normal"><a href="#__codelineno-10-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># suppression de la table [personnes]</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="n">drop</span> <span class="n">table</span> <span class="n">personnes</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="c1"># création de la table personnes</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="n">create</span> <span class="n">table</span> <span class="n">personnes</span> <span class="p">(</span><span class="n">prenom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">nom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">age</span> <span class="n">integer</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">primary</span> <span class="n">key</span> <span class="p">(</span><span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">))</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="c1"># insertion de deux personnes</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span><span class="p">(</span><span class="s1">&#39;Paul&#39;</span><span class="p">,</span><span class="s1">&#39;Langevin&#39;</span><span class="p">,</span><span class="mi">48</span><span class="p">)</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;Sylvie&#39;</span><span class="p">,</span><span class="s1">&#39;Lefur&#39;</span><span class="p">,</span><span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="c1"># affichage de la table</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="n">select</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="c1"># erreur volontaire</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="n">xx</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="c1"># insertion de trois personnes</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;Pierre&#39;</span><span class="p">,</span><span class="s1">&#39;Nicazou&#39;</span><span class="p">,</span><span class="mi">35</span><span class="p">)</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;Geraldine&#39;</span><span class="p">,</span><span class="s1">&#39;Colou&#39;</span><span class="p">,</span><span class="mi">26</span><span class="p">)</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="s1">&#39;Paulette&#39;</span><span class="p">,</span><span class="s1">&#39;Girond&#39;</span><span class="p">,</span><span class="mi">56</span><span class="p">)</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="c1"># affichage de la table</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="n">select</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="c1"># liste des personnes par ordre alphabétique des noms et à nom égal par ordre alphabétique des prénoms</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">order</span> <span class="n">by</span> <span class="n">nom</span> <span class="n">asc</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">desc</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="c1"># liste des personnes ayant un âge dans l&#39;intervalle [20,40] par ordre décroissant de l&#39;âge</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a><span class="c1"># puis à âge égal par ordre alphabétique des noms et à nom égal par ordre alphabétique des prénoms</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">age</span> <span class="n">between</span> <span class="mi">20</span> <span class="ow">and</span> <span class="mi">40</span> <span class="n">order</span> <span class="n">by</span> <span class="n">age</span> <span class="n">desc</span><span class="p">,</span> <span class="n">nom</span> <span class="n">asc</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">asc</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="c1"># insertion de mme Bruneau</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span><span class="p">(</span><span class="s1">&#39;Josette&#39;</span><span class="p">,</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">,</span><span class="mi">46</span><span class="p">)</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="c1"># mise à jour de son âge</span>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="n">update</span> <span class="n">personnes</span> <span class="nb">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">47</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="c1"># liste des personnes ayant Bruneau pour nom</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="c1"># suppression de Mme Bruneau</span>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="n">delete</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="c1"># liste des personnes ayant Bruneau pour nom</span>
<a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span>
</code></pre></div></td></tr></table></div>
<p>Nous définissons tout d&#x27;abord des fonctions que nous installons dans un module afin de pouvoir les réutiliser :</p>
<p><img src="images/1000000000000174000001EAB3648863.png" style="width:4.291cm;height:5.661cm;" alt="Image" /></p>
<p>Le script <strong>[mysql_module]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span>
<span class="normal"><a href="#__codelineno-11-41">41</a></span>
<span class="normal"><a href="#__codelineno-11-42">42</a></span>
<span class="normal"><a href="#__codelineno-11-43">43</a></span>
<span class="normal"><a href="#__codelineno-11-44">44</a></span>
<span class="normal"><a href="#__codelineno-11-45">45</a></span>
<span class="normal"><a href="#__codelineno-11-46">46</a></span>
<span class="normal"><a href="#__codelineno-11-47">47</a></span>
<span class="normal"><a href="#__codelineno-11-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># imports</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mysql.connector</span><span class="w"> </span><span class="kn">import</span> <span class="n">DatabaseError</span><span class="p">,</span> <span class="n">InterfaceError</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mysql.connector.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">MySQLConnection</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mysql.connector.cursor</span><span class="w"> </span><span class="kn">import</span> <span class="n">MySQLCursor</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="c1"># ---------------------------------------------------------------------------------</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">afficher_infos</span><span class="p">(</span><span class="n">curseur</span><span class="p">:</span> <span class="n">MySQLCursor</span><span class="p">):</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>    <span class="c1"># affiche le résultat d&#39;une command sql</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a>    <span class="err">…</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="c1"># ---------------------------------------------------------------------------------</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute_list_of_commands</span><span class="p">(</span><span class="n">connexion</span><span class="p">:</span> <span class="n">MySQLConnection</span><span class="p">,</span> <span class="n">sql_commands</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a>                             <span class="n">suivi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">arrêt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">with_transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a>    <span class="c1"># utilise la connexion ouverte [connexion]</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a>    <span class="c1"># exécute sur cette connexion les commandes SQL contenues dans la liste [sql_commands]</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a>    <span class="c1"># ce fichier est un fichier de commandes SQL à exécuter à raison d&#39;une par ligne</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a>    <span class="c1"># si suivi=True alors chaque exécution d&#39;un ordre SQL fait l&#39;objet d&#39;un affichage indiquant sa réussite ou son échec</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a>    <span class="c1"># si arrêt=True, la fonction s&#39;arrête sur la 1ère erreur rencontrée sinon elle exécute ttes les commandes sql</span>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a>    <span class="c1"># si with_transaction=True alors toute erreur annule l&#39;ensemble des ordres SQL exécutés auparavant</span>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a>    <span class="c1"># si with_transaction=False alors une erreur n&#39;a aucun impact sur les ordres SQL exécutés auparavant</span>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a>    <span class="c1"># la fonction rend une liste [erreur1, erreur2, ...]</span>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a>    <span class="err">…</span><span class="o">.</span>
<a id="__codelineno-11-26" name="__codelineno-11-26"></a>
<a id="__codelineno-11-27" name="__codelineno-11-27"></a>
<a id="__codelineno-11-28" name="__codelineno-11-28"></a><span class="c1"># ---------------------------------------------------------------------------------</span>
<a id="__codelineno-11-29" name="__codelineno-11-29"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute_file_of_commands</span><span class="p">(</span><span class="n">connexion</span><span class="p">:</span> <span class="n">MySQLConnection</span><span class="p">,</span> <span class="n">sql_filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-11-30" name="__codelineno-11-30"></a>                             <span class="n">suivi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">arrêt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">with_transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-11-31" name="__codelineno-11-31"></a>    <span class="c1"># utilise la connexion ouverte [connexion]</span>
<a id="__codelineno-11-32" name="__codelineno-11-32"></a>    <span class="c1"># exécute sur cette connexion les commandes SQL contenues dans le fichier texte sql_filename</span>
<a id="__codelineno-11-33" name="__codelineno-11-33"></a>    <span class="c1"># ce fichier est un fichier de commandes SQL à exécuter à raison d&#39;une par ligne</span>
<a id="__codelineno-11-34" name="__codelineno-11-34"></a>    <span class="c1"># si suivi=True alors chaque exécution d&#39;un ordre SQL fait l&#39;objet d&#39;un affichage indiquant sa réussite ou son échec</span>
<a id="__codelineno-11-35" name="__codelineno-11-35"></a>    <span class="c1"># si arrêt=True, la fonction s&#39;arrête sur la 1ère erreur rencontrée sinon elle exécute ttes les commandes sql</span>
<a id="__codelineno-11-36" name="__codelineno-11-36"></a>    <span class="c1"># si with_transaction=True alors toute erreur annule l&#39;ensemble des ordres SQL exécutés auparavant</span>
<a id="__codelineno-11-37" name="__codelineno-11-37"></a>    <span class="c1"># si with_transaction=False alors une erreur n&#39;a aucun impact sur les ordres SQL exécutés auparavant</span>
<a id="__codelineno-11-38" name="__codelineno-11-38"></a>    <span class="c1"># la fonction rend une liste [erreur1, erreur2, ...]</span>
<a id="__codelineno-11-39" name="__codelineno-11-39"></a>
<a id="__codelineno-11-40" name="__codelineno-11-40"></a>    <span class="c1"># exploitation du fichier SQL</span>
<a id="__codelineno-11-41" name="__codelineno-11-41"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-11-42" name="__codelineno-11-42"></a>        <span class="c1"># ouverture du fichier en lecture</span>
<a id="__codelineno-11-43" name="__codelineno-11-43"></a>        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">sql_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<a id="__codelineno-11-44" name="__codelineno-11-44"></a>        <span class="c1"># exploitation</span>
<a id="__codelineno-11-45" name="__codelineno-11-45"></a>        <span class="k">return</span> <span class="n">execute_list_of_commands</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">(),</span> <span class="n">suivi</span><span class="p">,</span> <span class="n">arrêt</span><span class="p">,</span> <span class="n">with_transaction</span><span class="p">)</span>
<a id="__codelineno-11-46" name="__codelineno-11-46"></a>    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-11-47" name="__codelineno-11-47"></a>        <span class="c1"># on rend un tableau d&#39;erreurs</span>
<a id="__codelineno-11-48" name="__codelineno-11-48"></a>        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Le fichier </span><span class="si">{</span><span class="n">sql_filename</span><span class="si">}</span><span class="s2"> n&#39;a pu être être exploité : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong> :</p>
<ul>
<li>ligne 29 : la fonction <strong>[</strong><strong>execute_file_of_commands</strong><strong>]</strong> exécute les ordres SQL contenu dans le fichier texte nommé <strong>[</strong><strong>sql_filename</strong><strong>]</strong> :</li>
<li>on lira les commentaires des lignes 31-38 pour connaître la signification des paramètres ;</li>
<li>lignes 40-48 : on exploite le fichier texte <strong>[</strong><strong>sql_filename</strong><strong>]</strong> ;</li>
<li>ligne 43 : ouverture du fichier ;</li>
<li>ligne 34 : exécution de la fonction <strong>[</strong><strong>execute_list_of_commands</strong><strong>]</strong> qui exécute les commandes SQL qu&#x27;on lui passe dans une liste. Cette liste est ici constituée par la liste de toutes les lignes du fichier texte <strong>[</strong><strong>file.readlines()</strong><strong>]</strong> (ligne 45) ;
La fonction <strong>[</strong><strong>execute_list_of_commands</strong><strong>]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span>
<span class="normal"><a href="#__codelineno-12-27">27</a></span>
<span class="normal"><a href="#__codelineno-12-28">28</a></span>
<span class="normal"><a href="#__codelineno-12-29">29</a></span>
<span class="normal"><a href="#__codelineno-12-30">30</a></span>
<span class="normal"><a href="#__codelineno-12-31">31</a></span>
<span class="normal"><a href="#__codelineno-12-32">32</a></span>
<span class="normal"><a href="#__codelineno-12-33">33</a></span>
<span class="normal"><a href="#__codelineno-12-34">34</a></span>
<span class="normal"><a href="#__codelineno-12-35">35</a></span>
<span class="normal"><a href="#__codelineno-12-36">36</a></span>
<span class="normal"><a href="#__codelineno-12-37">37</a></span>
<span class="normal"><a href="#__codelineno-12-38">38</a></span>
<span class="normal"><a href="#__codelineno-12-39">39</a></span>
<span class="normal"><a href="#__codelineno-12-40">40</a></span>
<span class="normal"><a href="#__codelineno-12-41">41</a></span>
<span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span>
<span class="normal"><a href="#__codelineno-12-44">44</a></span>
<span class="normal"><a href="#__codelineno-12-45">45</a></span>
<span class="normal"><a href="#__codelineno-12-46">46</a></span>
<span class="normal"><a href="#__codelineno-12-47">47</a></span>
<span class="normal"><a href="#__codelineno-12-48">48</a></span>
<span class="normal"><a href="#__codelineno-12-49">49</a></span>
<span class="normal"><a href="#__codelineno-12-50">50</a></span>
<span class="normal"><a href="#__codelineno-12-51">51</a></span>
<span class="normal"><a href="#__codelineno-12-52">52</a></span>
<span class="normal"><a href="#__codelineno-12-53">53</a></span>
<span class="normal"><a href="#__codelineno-12-54">54</a></span>
<span class="normal"><a href="#__codelineno-12-55">55</a></span>
<span class="normal"><a href="#__codelineno-12-56">56</a></span>
<span class="normal"><a href="#__codelineno-12-57">57</a></span>
<span class="normal"><a href="#__codelineno-12-58">58</a></span>
<span class="normal"><a href="#__codelineno-12-59">59</a></span>
<span class="normal"><a href="#__codelineno-12-60">60</a></span>
<span class="normal"><a href="#__codelineno-12-61">61</a></span>
<span class="normal"><a href="#__codelineno-12-62">62</a></span>
<span class="normal"><a href="#__codelineno-12-63">63</a></span>
<span class="normal"><a href="#__codelineno-12-64">64</a></span>
<span class="normal"><a href="#__codelineno-12-65">65</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># ---------------------------------------------------------------------------------</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute_list_of_commands</span><span class="p">(</span><span class="n">connexion</span><span class="p">:</span> <span class="n">MySQLConnection</span><span class="p">,</span> <span class="n">sql_commands</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>                             <span class="n">suivi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">arrêt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">with_transaction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>    <span class="c1"># utilise la connexion ouverte [connexion]</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>    <span class="c1"># exécute sur cette connexion les commandes SQL contenues dans la liste [sql_commands]</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>    <span class="c1"># ce fichier est un fichier de commandes SQL à exécuter à raison d&#39;une par ligne</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>    <span class="c1"># si suivi=True alors chaque exécution d&#39;un ordre SQL fait l&#39;objet d&#39;un affichage indiquant sa réussite ou son échec</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>    <span class="c1"># si arrêt=True, la fonction s&#39;arrête sur la 1ère erreur rencontrée sinon elle exécute ttes les commandes sql</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a>    <span class="c1"># si with_transaction=True alors toute erreur annule l&#39;ensemble des ordres SQL exécutés auparavant</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>    <span class="c1"># si with_transaction=False alors une erreur n&#39;a aucun impact sur les ordres SQL exécutés auparavant</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>    <span class="c1"># la fonction rend une liste [erreur1, erreur2, ...]</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a>    <span class="c1"># initialisations</span>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a>    <span class="n">curseur</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a>    <span class="n">connexion</span><span class="o">.</span><span class="n">autocommit</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">with_transaction</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a>    <span class="n">erreurs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a>        <span class="c1"># on demande un curseur</span>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a>        <span class="n">curseur</span> <span class="o">=</span> <span class="n">connexion</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a>        <span class="c1"># exécution des sql_commands SQL contenues dans sql_commands</span>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a>        <span class="c1"># on les exécute une à une</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a>        <span class="k">for</span> <span class="n">command</span> <span class="ow">in</span> <span class="n">sql_commands</span><span class="p">:</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a>            <span class="c1"># on élimine les blancs de début et de fin de la commande courante</span>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a>            <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a>            <span class="c1"># a-t-on une commande vide ou un commentaire ? Si oui, on passe à la commande suivante</span>
<a id="__codelineno-12-26" name="__codelineno-12-26"></a>            <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
<a id="__codelineno-12-27" name="__codelineno-12-27"></a>                <span class="k">continue</span>
<a id="__codelineno-12-28" name="__codelineno-12-28"></a>            <span class="c1"># exécution de la commande courante</span>
<a id="__codelineno-12-29" name="__codelineno-12-29"></a>            <span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-12-30" name="__codelineno-12-30"></a>            <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-12-31" name="__codelineno-12-31"></a>                <span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
<a id="__codelineno-12-32" name="__codelineno-12-32"></a>            <span class="k">except</span> <span class="p">(</span><span class="n">InterfaceError</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-12-33" name="__codelineno-12-33"></a>                <span class="n">error</span> <span class="o">=</span> <span class="n">erreur</span>
<a id="__codelineno-12-34" name="__codelineno-12-34"></a>            <span class="c1"># y-a-t-il eu une erreur ?</span>
<a id="__codelineno-12-35" name="__codelineno-12-35"></a>            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
<a id="__codelineno-12-36" name="__codelineno-12-36"></a>                <span class="c1"># une erreur de plus</span>
<a id="__codelineno-12-37" name="__codelineno-12-37"></a>                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2"> : Erreur (</span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">)&quot;</span>
<a id="__codelineno-12-38" name="__codelineno-12-38"></a>                <span class="n">erreurs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-12-39" name="__codelineno-12-39"></a>                <span class="c1"># suivi écran ou non ?</span>
<a id="__codelineno-12-40" name="__codelineno-12-40"></a>                <span class="k">if</span> <span class="n">suivi</span><span class="p">:</span>
<a id="__codelineno-12-41" name="__codelineno-12-41"></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<a id="__codelineno-12-42" name="__codelineno-12-42"></a>                <span class="c1"># on s&#39;arrête ?</span>
<a id="__codelineno-12-43" name="__codelineno-12-43"></a>                <span class="k">if</span> <span class="n">with_transaction</span> <span class="ow">or</span> <span class="n">arrêt</span><span class="p">:</span>
<a id="__codelineno-12-44" name="__codelineno-12-44"></a>                    <span class="c1"># on rend la liste d&#39;erreurs</span>
<a id="__codelineno-12-45" name="__codelineno-12-45"></a>                    <span class="k">return</span> <span class="n">erreurs</span>
<a id="__codelineno-12-46" name="__codelineno-12-46"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-47" name="__codelineno-12-47"></a>                <span class="c1"># pas d&#39;erreur</span>
<a id="__codelineno-12-48" name="__codelineno-12-48"></a>                <span class="k">if</span> <span class="n">suivi</span><span class="p">:</span>
<a id="__codelineno-12-49" name="__codelineno-12-49"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">command</span><span class="si">}</span><span class="s2">] : Exécution réussie&quot;</span><span class="p">)</span>
<a id="__codelineno-12-50" name="__codelineno-12-50"></a>                <span class="c1"># on affiche le résultat de la command</span>
<a id="__codelineno-12-51" name="__codelineno-12-51"></a>                <span class="n">afficher_infos</span><span class="p">(</span><span class="n">curseur</span><span class="p">)</span>
<a id="__codelineno-12-52" name="__codelineno-12-52"></a>        <span class="c1"># on rend le tableau des erreurs</span>
<a id="__codelineno-12-53" name="__codelineno-12-53"></a>        <span class="k">return</span> <span class="n">erreurs</span>
<a id="__codelineno-12-54" name="__codelineno-12-54"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-12-55" name="__codelineno-12-55"></a>        <span class="c1"># fermeture du curseur</span>
<a id="__codelineno-12-56" name="__codelineno-12-56"></a>        <span class="k">if</span> <span class="n">curseur</span><span class="p">:</span>
<a id="__codelineno-12-57" name="__codelineno-12-57"></a>            <span class="n">curseur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-12-58" name="__codelineno-12-58"></a>        <span class="c1"># on valide / annule la transaction si elle existe</span>
<a id="__codelineno-12-59" name="__codelineno-12-59"></a>        <span class="k">if</span> <span class="n">with_transaction</span><span class="p">:</span>
<a id="__codelineno-12-60" name="__codelineno-12-60"></a>            <span class="k">if</span> <span class="n">erreurs</span><span class="p">:</span>
<a id="__codelineno-12-61" name="__codelineno-12-61"></a>                <span class="c1"># annulation</span>
<a id="__codelineno-12-62" name="__codelineno-12-62"></a>                <span class="n">connexion</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<a id="__codelineno-12-63" name="__codelineno-12-63"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-64" name="__codelineno-12-64"></a>                <span class="c1"># validation</span>
<a id="__codelineno-12-65" name="__codelineno-12-65"></a>                <span class="n">connexion</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong></p>
<ul>
<li>ligne 2 : la fonction <strong>[</strong><strong>execute_list_of_commands</strong><strong>]</strong> exécute les ordres SQL contenu dans la liste <strong>[</strong><strong>sql_commands</strong><strong>]</strong> :</li>
<li>on lira les commentaires des lignes 4-11 pour connaître la signification des paramètres ;</li>
<li>ligne 2 : la connexion reçue est une connexion ouverte vers une base de données ;</li>
<li>ligne 15 : si on veut que l&#x27;ensemble des commandes de la liste <strong>[</strong><strong>sql_commands</strong><strong>]</strong> s&#x27;exécute au sein d&#x27;une transaction alors il faut travailler en mode AUTOCOMMIT=False. Sinon, on travaillera en  mode AUTOCOMMIT=True et alors chacune des commandes de la liste <strong>[sqlCommands]</strong> s&#x27;exécutera au sein d&#x27;une transaction automatique et il n&#x27;y aura pas de transaction globale ;</li>
<li>ligne 19 : on demande un curseur pour exécuter les différentes commandes SQL ;</li>
<li>lignes 22-51 : on exécute les commandes une par une ;</li>
<li>lignes 26-27 : on accepte les lignes blanches ainsi que les commentaires dans la liste des commandes SQL. Dans ce cas, on ignore simplement la commande ;</li>
<li>lignes 30-33 : exécution de la requête courante ;</li>
<li>lignes 35-45 : on traite le cas d&#x27;une éventuelle erreur d&#x27;exécution de la requête courante ;</li>
<li>lignes 37-38 : l&#x27;erreur est ajoutée au tableau des erreurs ;</li>
<li>lignes 40-41 : si un suivi a été demandé, alors le message d&#x27;erreur est affiché ;</li>
<li>lignes 43-45 : si le code appelant a demandé un arrêt après la première erreur ou s&#x27;il a demandé l&#x27;utilisation d&#x27;une transaction, alors il faut s&#x27;arrêter. On rend le tableau des erreurs ;</li>
<li>lignes 46-51 : cas où il n&#x27;y a pas eu d&#x27;erreur d&#x27;exécution de la requête courante ;</li>
<li>lignes 48-49 : si un suivi a été demandé, on affiche la requête exécutée avec la mention &#x27;réussie&#x27; ;</li>
<li>lignes 50-51 : on affiche le résultat de la requête exécutée. On va revenir sur la fonction <strong>[afficher_infos]</strong> un peu plus loin ;</li>
<li>lignes 54-65 : la clause <strong>[finally]</strong> est exécutée dans tous les cas, qu&#x27;il y ait eu une exception ou pas ;</li>
<li>lignes 56-57 : fermeture du curseur. Cela libère les ressources allouées à celui-ci ;</li>
<li>lignes 59-65 : on traite le cas où le code appelant a demandé à ce que les commandes SQL soient exécutées dans une transaction ;</li>
<li>ligne 60 : on regarde si la liste <strong>[erreurs]</strong> est vide, ce qui signifie qu&#x27;aucune exception n&#x27;a eu lieu. Dans ce cas, la transaction est validée (ligne 65), sinon elle est annulée (ligne 62) ;
La fonction <strong>[</strong><strong>afficher_infos</strong><strong>]</strong> affiche le résultat d&#x27;une requête :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># ---------------------------------------------------------------------------------</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">afficher_infos</span><span class="p">(</span><span class="n">curseur</span><span class="p">:</span> <span class="n">MySQLCursor</span><span class="p">):</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">curseur</span><span class="p">))</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>    <span class="c1"># affiche le résultat d&#39;une command sql</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>    <span class="c1"># s&#39;agissait-il d&#39;un select ?</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>    <span class="k">if</span> <span class="n">curseur</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>        <span class="c1"># le curseur a une description - donc il a exécuté un select</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>        <span class="c1"># description[i] est la description de la colonne n° i du select</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>        <span class="c1"># description[i][0] est le nom de la colonne n° i du select</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>        <span class="c1"># on affiche les noms des champs</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>        <span class="n">titre</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">curseur</span><span class="o">.</span><span class="n">description</span><span class="p">)):</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>            <span class="n">titre</span> <span class="o">+=</span> <span class="n">curseur</span><span class="o">.</span><span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a>        <span class="c1"># on affiche la liste des champs sans la virgule de fin</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">titre</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">titre</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a>        <span class="c1"># ligne séparatrice</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">titre</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>        <span class="c1"># ligne courante du select</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a>        <span class="n">ligne</span> <span class="o">=</span> <span class="n">curseur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a>        <span class="k">while</span> <span class="n">ligne</span><span class="p">:</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a>            <span class="c1"># on l&#39;affiche</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">ligne</span><span class="p">)</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a>            <span class="c1"># ligne suivante du select</span>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a>            <span class="n">ligne</span> <span class="o">=</span> <span class="n">curseur</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a>        <span class="c1"># ligne séparatrice</span>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*&quot;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">titre</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a>        <span class="c1"># le curseur n&#39;a pas de champ [description] - il a donc exécuté un ordre SQL</span>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a>        <span class="c1"># de mise à jour (insert, delete, update)</span>
<a id="__codelineno-13-30" name="__codelineno-13-30"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;nombre de lignes modifiées : </span><span class="si">{</span><span class="n">curseur</span><span class="o">.</span><span class="n">rowcount</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong></p>
<ul>
<li>ligne 1 : le paramètre de la fonction est le curseur qui vient d&#x27;exécuter un ordre SQL. Selon que cet ordre est un SELECT ou un ordre de mise à jour INSERT, UPDATE, DELETE, le contenu du curseur n&#x27;est pas le même ;</li>
<li>ligne 6 : si le curseur a le champ <strong>[description]</strong> alors il a exécuté un SELECT et <strong>[description]</strong> décrit les champs demandés dans le SELECT :</li>
<li><strong>description</strong><strong>[i]</strong> décrit le champ n° i demandé par le SELECT. C&#x27;est une liste ;</li>
<li><strong>description</strong><strong>[i][0]</strong> est le nom du champ n° i ;</li>
<li>lignes 11-17 : on affiche le nom des champs demandés par le SELECT ;</li>
<li>lignes 18-24 : on exploite le résultat du SELECT ;</li>
<li>lignes 20, 24 : le résultat d&#x27;un SELECT s&#x27;exploite séquentiellement. Ce résultat est un ensemble de lignes. La ligne courante est obtenue par <strong>[</strong><strong>curseur</strong><strong>.fetchone()</strong><strong>]</strong> (ligne 19). On obtient alors un tuple ;</li>
<li>lignes 27-30 :  si le curseur n&#x27;a pas le champ <strong>[description]</strong> alors il a exécuté un ordre de mise à jour  INSERT, UPDATE, DELETE. On peut alors savoir combien de lignes de la table ont été modifiées par l&#x27;exécution de cet ordre ;</li>
<li>ligne 30 : <strong>[</strong><strong>curseur.rowcount</strong><strong>]</strong> est ce nombre ;
Le script principal <strong>[mysql-04]</strong> utilise le module <strong>[</strong><strong>mysql_module</strong><strong>]</strong> que nous venons de décrire :</li>
</ul>
<p><img src="images/10000000000001400000019646564AE6.png" style="width:3.701cm;height:4.68cm;" alt="Image" /></p>
<p>Le fichier <strong>[config_04]</strong> configure le contexte d’exécution du script <strong>[mysql_04]</strong> :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">():</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>    <span class="c1"># chemin absolu du dossier du fichier de configuration</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>    <span class="c1"># configuration des dossiers du syspath</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>        <span class="c1"># dossiers locaux</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/shared&quot;</span><span class="p">,</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>    <span class="p">]</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a>    <span class="c1"># fixation du syspath</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a>    <span class="c1"># on rend la config</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a>        <span class="c1"># fichier des commandes SQL</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a>        <span class="s2">&quot;commands_filename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/data/commandes.sql&quot;</span><span class="p">,</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a>        <span class="c1"># identifiants de la connexion à la base de données</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>        <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;localhost&quot;</span><span class="p">,</span>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a>        <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="s2">&quot;dbpersonnes&quot;</span><span class="p">,</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a>        <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;admpersonnes&quot;</span><span class="p">,</span>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a>        <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;nobody&quot;</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Le script <strong>[mysql_04]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span>
<span class="normal"><a href="#__codelineno-15-30">30</a></span>
<span class="normal"><a href="#__codelineno-15-31">31</a></span>
<span class="normal"><a href="#__codelineno-15-32">32</a></span>
<span class="normal"><a href="#__codelineno-15-33">33</a></span>
<span class="normal"><a href="#__codelineno-15-34">34</a></span>
<span class="normal"><a href="#__codelineno-15-35">35</a></span>
<span class="normal"><a href="#__codelineno-15-36">36</a></span>
<span class="normal"><a href="#__codelineno-15-37">37</a></span>
<span class="normal"><a href="#__codelineno-15-38">38</a></span>
<span class="normal"><a href="#__codelineno-15-39">39</a></span>
<span class="normal"><a href="#__codelineno-15-40">40</a></span>
<span class="normal"><a href="#__codelineno-15-41">41</a></span>
<span class="normal"><a href="#__codelineno-15-42">42</a></span>
<span class="normal"><a href="#__codelineno-15-43">43</a></span>
<span class="normal"><a href="#__codelineno-15-44">44</a></span>
<span class="normal"><a href="#__codelineno-15-45">45</a></span>
<span class="normal"><a href="#__codelineno-15-46">46</a></span>
<span class="normal"><a href="#__codelineno-15-47">47</a></span>
<span class="normal"><a href="#__codelineno-15-48">48</a></span>
<span class="normal"><a href="#__codelineno-15-49">49</a></span>
<span class="normal"><a href="#__codelineno-15-50">50</a></span>
<span class="normal"><a href="#__codelineno-15-51">51</a></span>
<span class="normal"><a href="#__codelineno-15-52">52</a></span>
<span class="normal"><a href="#__codelineno-15-53">53</a></span>
<span class="normal"><a href="#__codelineno-15-54">54</a></span>
<span class="normal"><a href="#__codelineno-15-55">55</a></span>
<span class="normal"><a href="#__codelineno-15-56">56</a></span>
<span class="normal"><a href="#__codelineno-15-57">57</a></span>
<span class="normal"><a href="#__codelineno-15-58">58</a></span>
<span class="normal"><a href="#__codelineno-15-59">59</a></span>
<span class="normal"><a href="#__codelineno-15-60">60</a></span>
<span class="normal"><a href="#__codelineno-15-61">61</a></span>
<span class="normal"><a href="#__codelineno-15-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># on récupère la configuration de l&#39;application</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config_04</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config_04</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="c1"># le syspath est configuré - on peut faire les imports</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mysql_module</span><span class="w"> </span><span class="kn">import</span> <span class="n">execute_file_of_commands</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mysql.connector</span><span class="w"> </span><span class="kn">import</span> <span class="n">connect</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">,</span> <span class="n">InterfaceError</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="c1"># ---------------------------------------------- main</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="c1"># vérification de la syntaxe de l&#39;appel</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="c1"># argv[0] true / false</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="n">erreur</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>    <span class="n">with_transaction</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a>    <span class="n">erreur</span> <span class="o">=</span> <span class="n">with_transaction</span> <span class="o">!=</span> <span class="s2">&quot;true&quot;</span> <span class="ow">and</span> <span class="n">with_transaction</span> <span class="o">!=</span> <span class="s2">&quot;false&quot;</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="c1"># erreur ?</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="k">if</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;syntaxe : </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> true / false&quot;</span><span class="p">)</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="c1"># calcul d&#39;un texte</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="n">with_transaction</span> <span class="o">=</span> <span class="n">with_transaction</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="k">if</span> <span class="n">with_transaction</span><span class="p">:</span>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a>    <span class="n">texte</span> <span class="o">=</span> <span class="s2">&quot;avec transaction&quot;</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a><span class="k">else</span><span class="p">:</span>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a>    <span class="n">texte</span> <span class="o">=</span> <span class="s2">&quot;sans transaction&quot;</span>
<a id="__codelineno-15-30" name="__codelineno-15-30"></a>
<a id="__codelineno-15-31" name="__codelineno-15-31"></a><span class="c1"># logs écran</span>
<a id="__codelineno-15-32" name="__codelineno-15-32"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-15-33" name="__codelineno-15-33"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exécution du fichier SQL </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;commands_filename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">texte</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-34" name="__codelineno-15-34"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-15-35" name="__codelineno-15-35"></a>
<a id="__codelineno-15-36" name="__codelineno-15-36"></a><span class="c1"># exécution des ordres SQL du fichier</span>
<a id="__codelineno-15-37" name="__codelineno-15-37"></a><span class="n">connexion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-15-38" name="__codelineno-15-38"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-15-39" name="__codelineno-15-39"></a>    <span class="c1"># connexion à la bd</span>
<a id="__codelineno-15-40" name="__codelineno-15-40"></a>    <span class="n">connexion</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">],</span> <span class="n">user</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">],</span> <span class="n">password</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span>
<a id="__codelineno-15-41" name="__codelineno-15-41"></a>                        <span class="n">database</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">])</span>
<a id="__codelineno-15-42" name="__codelineno-15-42"></a>    <span class="c1"># exécution du fichier des commandes SQL</span>
<a id="__codelineno-15-43" name="__codelineno-15-43"></a>    <span class="n">erreurs</span> <span class="o">=</span> <span class="n">execute_file_of_commands</span><span class="p">(</span><span class="n">connexion</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;commands_filename&quot;</span><span class="p">],</span> <span class="n">suivi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">arrêt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-15-44" name="__codelineno-15-44"></a>                                       <span class="n">with_transaction</span><span class="o">=</span><span class="n">with_transaction</span><span class="p">)</span>
<a id="__codelineno-15-45" name="__codelineno-15-45"></a><span class="k">except</span> <span class="p">(</span><span class="n">InterfaceError</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-15-46" name="__codelineno-15-46"></a>    <span class="c1"># affichage de l&#39;erreur</span>
<a id="__codelineno-15-47" name="__codelineno-15-47"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur fatale suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-15-48" name="__codelineno-15-48"></a>    <span class="c1"># on s&#39;arrête</span>
<a id="__codelineno-15-49" name="__codelineno-15-49"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-15-50" name="__codelineno-15-50"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-15-51" name="__codelineno-15-51"></a>    <span class="c1"># fermeture de la connexion si elle a été ouverte</span>
<a id="__codelineno-15-52" name="__codelineno-15-52"></a>    <span class="k">if</span> <span class="n">connexion</span><span class="p">:</span>
<a id="__codelineno-15-53" name="__codelineno-15-53"></a>        <span class="n">connexion</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-15-54" name="__codelineno-15-54"></a>
<a id="__codelineno-15-55" name="__codelineno-15-55"></a><span class="c1"># affichage nombre d&#39;erreurs</span>
<a id="__codelineno-15-56" name="__codelineno-15-56"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-15-57" name="__codelineno-15-57"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exécution terminée&quot;</span><span class="p">)</span>
<a id="__codelineno-15-58" name="__codelineno-15-58"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------------------------&quot;</span><span class="p">)</span>
<a id="__codelineno-15-59" name="__codelineno-15-59"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Il y a eu </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">erreurs</span><span class="p">)</span><span class="si">}</span><span class="s2"> erreur(s)&quot;</span><span class="p">)</span>
<a id="__codelineno-15-60" name="__codelineno-15-60"></a><span class="c1"># affichage des erreurs</span>
<a id="__codelineno-15-61" name="__codelineno-15-61"></a><span class="k">for</span> <span class="n">erreur</span> <span class="ow">in</span> <span class="n">erreurs</span><span class="p">:</span>
<a id="__codelineno-15-62" name="__codelineno-15-62"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">erreur</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong></p>
<ul>
<li>lignes 1-4 : configuration du script ;</li>
<li>ligne 8 : import du module <strong>[</strong><strong>mysql_module</strong><strong>]</strong> décrit précédemment :</li>
<li>lignes 12-22 : le script <strong>[mysql-04]</strong> attend un paramètre qui doit avoir l&#x27;une des valeurs <strong>[true / false]</strong>. Ce paramètre indique si le fichier d&#x27;ordres SQL doit être exécuté au sein d&#x27;une transaction (true) ou pas (false) ;</li>
<li>ligne 14 : les paramètres passés par l&#x27;utilisateur au script sont trouvés dans la liste <strong>[sys.argv]</strong> ;</li>
<li>ligne 15 : il faut deux paramètres, par exemple <strong>[mysql-04 true]</strong>. Le nom du script compte comme un paramètre ;</li>
<li>lignes 17-18 : s&#x27;il y a bien deux paramètres, il faut que le 2e soit une chaîne de caractères de valeur &#x27;true&#x27; ou &#x27;false&#x27; ;</li>
<li>lignes 24-29 : calcul d&#x27;un texte affiché ligne 33 ;</li>
<li>lignes 39-44 : on exécute les commandes du fichier <strong>[</strong><strong>./data/commandes.sql</strong><strong>]</strong> ;</li>
<li>lignes 45-49 : s’il se produit une erreur à la connexion (ligne 40) ou non gérée par le script <strong>[</strong><strong>execute_file_of_commands</strong><strong>]</strong> on affiche l’erreur et on arrête tout ;</li>
<li>lignes 55-62 : en cas d’exécution réussie, on affiche le nombre d’erreurs rencontrées dans l’exécution des commandes SQL ;
<u><strong>Exécution n° 1</strong></u></li>
</ul>
<p>On fait d&#x27;abord une exécution sans transaction. Pour cela, on va créer une configuration d&#x27;exécution comme il a été fait dans le paragraphe |<a href="#_Le_script_principal_2"><u><u>configuration d’un contexte d’exécution</u></u></a>|:</p>
<p><img src="images/10000000000005780000022925712BDD.png" style="width:16.181cm;height:6.391cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1-4]</strong>, on crée une configuration d&#x27;exécution Python ;</li>
</ul>
<p><img src="images/10000000000006370000028EDA2645CB.png" style="width:16.571cm;height:6.801cm;" alt="Image" /></p>
<ul>
<li><strong>[5]</strong> : nom de la configuration d&#x27;xécution ;</li>
<li><strong>[6]</strong> : chemin du script à exécuter ;</li>
<li><strong>[7]</strong>  : paramètres du script ;</li>
<li><strong>[8]</strong> : dossier d’exécution ;
Cette configuration correspond donc à une exécution du fichier SQL avec une transaction. Utiliser le bouton <strong>[Apply]</strong> pour valider la configuration.</li>
</ul>
<p>Nous créons de la même façon la configuration d&#x27;exécution <strong>[mysql mysql-04 without_transaction]</strong> :</p>
<p><img src="images/1000000000000558000001E178FC5470.png" style="width:15.791cm;height:5.541cm;" alt="Image" /></p>
<p>Cette configuration correspond donc à une exécution du fichier SQL sans transaction. Utiliser le bouton <strong>[Apply]</strong> pour valider la configuration.</p>
<p>Nous exécutons d&#x27;abord la version sans transaction :</p>
<p><img src="images/1000000000000413000000A167B8ACCE.png" style="width:12.06cm;height:1.86cm;" alt="Image" /></p>
<p>Les résultats sont alors les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span>
<span class="normal"><a href="#__codelineno-16-27">27</a></span>
<span class="normal"><a href="#__codelineno-16-28">28</a></span>
<span class="normal"><a href="#__codelineno-16-29">29</a></span>
<span class="normal"><a href="#__codelineno-16-30">30</a></span>
<span class="normal"><a href="#__codelineno-16-31">31</a></span>
<span class="normal"><a href="#__codelineno-16-32">32</a></span>
<span class="normal"><a href="#__codelineno-16-33">33</a></span>
<span class="normal"><a href="#__codelineno-16-34">34</a></span>
<span class="normal"><a href="#__codelineno-16-35">35</a></span>
<span class="normal"><a href="#__codelineno-16-36">36</a></span>
<span class="normal"><a href="#__codelineno-16-37">37</a></span>
<span class="normal"><a href="#__codelineno-16-38">38</a></span>
<span class="normal"><a href="#__codelineno-16-39">39</a></span>
<span class="normal"><a href="#__codelineno-16-40">40</a></span>
<span class="normal"><a href="#__codelineno-16-41">41</a></span>
<span class="normal"><a href="#__codelineno-16-42">42</a></span>
<span class="normal"><a href="#__codelineno-16-43">43</a></span>
<span class="normal"><a href="#__codelineno-16-44">44</a></span>
<span class="normal"><a href="#__codelineno-16-45">45</a></span>
<span class="normal"><a href="#__codelineno-16-46">46</a></span>
<span class="normal"><a href="#__codelineno-16-47">47</a></span>
<span class="normal"><a href="#__codelineno-16-48">48</a></span>
<span class="normal"><a href="#__codelineno-16-49">49</a></span>
<span class="normal"><a href="#__codelineno-16-50">50</a></span>
<span class="normal"><a href="#__codelineno-16-51">51</a></span>
<span class="normal"><a href="#__codelineno-16-52">52</a></span>
<span class="normal"><a href="#__codelineno-16-53">53</a></span>
<span class="normal"><a href="#__codelineno-16-54">54</a></span>
<span class="normal"><a href="#__codelineno-16-55">55</a></span>
<span class="normal"><a href="#__codelineno-16-56">56</a></span>
<span class="normal"><a href="#__codelineno-16-57">57</a></span>
<span class="normal"><a href="#__codelineno-16-58">58</a></span>
<span class="normal"><a href="#__codelineno-16-59">59</a></span>
<span class="normal"><a href="#__codelineno-16-60">60</a></span>
<span class="normal"><a href="#__codelineno-16-61">61</a></span>
<span class="normal"><a href="#__codelineno-16-62">62</a></span>
<span class="normal"><a href="#__codelineno-16-63">63</a></span>
<span class="normal"><a href="#__codelineno-16-64">64</a></span>
<span class="normal"><a href="#__codelineno-16-65">65</a></span>
<span class="normal"><a href="#__codelineno-16-66">66</a></span>
<span class="normal"><a href="#__codelineno-16-67">67</a></span>
<span class="normal"><a href="#__codelineno-16-68">68</a></span>
<span class="normal"><a href="#__codelineno-16-69">69</a></span>
<span class="normal"><a href="#__codelineno-16-70">70</a></span>
<span class="normal"><a href="#__codelineno-16-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">databases</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql_04</span><span class="o">.</span><span class="n">py</span> <span class="n">false</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="n">Exécution</span> <span class="n">du</span> <span class="n">fichier</span> <span class="n">SQL</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">databases</span>\<span class="n">mysql</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">commandes</span><span class="o">.</span><span class="n">sql</span> <span class="n">sans</span> <span class="n">transaction</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="p">[</span><span class="n">drop</span> <span class="n">table</span> <span class="n">personnes</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="p">[</span><span class="n">create</span> <span class="n">table</span> <span class="n">personnes</span> <span class="p">(</span><span class="nb">id</span> <span class="nb">int</span> <span class="n">primary</span> <span class="n">key</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">nom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">age</span> <span class="n">integer</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">unique</span> <span class="p">(</span><span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">))]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Paul&#39;</span><span class="p">,</span><span class="s1">&#39;Langevin&#39;</span><span class="p">,</span><span class="mi">48</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Sylvie&#39;</span><span class="p">,</span><span class="s1">&#39;Lefur&#39;</span><span class="p">,</span><span class="mi">70</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="p">[</span><span class="n">select</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="o">*****************</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="p">(</span><span class="s1">&#39;Paul&#39;</span><span class="p">,</span> <span class="s1">&#39;Langevin&#39;</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="p">(</span><span class="s1">&#39;Sylvie&#39;</span><span class="p">,</span> <span class="s1">&#39;Lefur&#39;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="o">*****************</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="n">xx</span> <span class="p">:</span> <span class="n">Erreur</span> <span class="p">(</span><span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="n">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">your</span> <span class="n">MySQL</span> <span class="n">server</span> <span class="n">version</span> <span class="k">for</span> <span class="n">the</span> <span class="n">right</span> <span class="n">syntax</span> <span class="n">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">&#39;xx&#39;</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Pierre&#39;</span><span class="p">,</span><span class="s1">&#39;Nicazou&#39;</span><span class="p">,</span><span class="mi">35</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Geraldine&#39;</span><span class="p">,</span><span class="s1">&#39;Colou&#39;</span><span class="p">,</span><span class="mi">26</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Paulette&#39;</span><span class="p">,</span><span class="s1">&#39;Girond&#39;</span><span class="p">,</span><span class="mi">56</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a><span class="p">[</span><span class="n">select</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-16-28" name="__codelineno-16-28"></a><span class="o">*****************</span>
<a id="__codelineno-16-29" name="__codelineno-16-29"></a><span class="p">(</span><span class="s1">&#39;Paul&#39;</span><span class="p">,</span> <span class="s1">&#39;Langevin&#39;</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<a id="__codelineno-16-30" name="__codelineno-16-30"></a><span class="p">(</span><span class="s1">&#39;Sylvie&#39;</span><span class="p">,</span> <span class="s1">&#39;Lefur&#39;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-16-31" name="__codelineno-16-31"></a><span class="p">(</span><span class="s1">&#39;Pierre&#39;</span><span class="p">,</span> <span class="s1">&#39;Nicazou&#39;</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
<a id="__codelineno-16-32" name="__codelineno-16-32"></a><span class="p">(</span><span class="s1">&#39;Geraldine&#39;</span><span class="p">,</span> <span class="s1">&#39;Colou&#39;</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<a id="__codelineno-16-33" name="__codelineno-16-33"></a><span class="p">(</span><span class="s1">&#39;Paulette&#39;</span><span class="p">,</span> <span class="s1">&#39;Girond&#39;</span><span class="p">,</span> <span class="mi">56</span><span class="p">)</span>
<a id="__codelineno-16-34" name="__codelineno-16-34"></a><span class="o">*****************</span>
<a id="__codelineno-16-35" name="__codelineno-16-35"></a><span class="p">[</span><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">order</span> <span class="n">by</span> <span class="n">nom</span> <span class="n">asc</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">desc</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-36" name="__codelineno-16-36"></a><span class="n">nom</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span>
<a id="__codelineno-16-37" name="__codelineno-16-37"></a><span class="o">************</span>
<a id="__codelineno-16-38" name="__codelineno-16-38"></a><span class="p">(</span><span class="s1">&#39;Colou&#39;</span><span class="p">,</span> <span class="s1">&#39;Geraldine&#39;</span><span class="p">)</span>
<a id="__codelineno-16-39" name="__codelineno-16-39"></a><span class="p">(</span><span class="s1">&#39;Girond&#39;</span><span class="p">,</span> <span class="s1">&#39;Paulette&#39;</span><span class="p">)</span>
<a id="__codelineno-16-40" name="__codelineno-16-40"></a><span class="p">(</span><span class="s1">&#39;Langevin&#39;</span><span class="p">,</span> <span class="s1">&#39;Paul&#39;</span><span class="p">)</span>
<a id="__codelineno-16-41" name="__codelineno-16-41"></a><span class="p">(</span><span class="s1">&#39;Lefur&#39;</span><span class="p">,</span> <span class="s1">&#39;Sylvie&#39;</span><span class="p">)</span>
<a id="__codelineno-16-42" name="__codelineno-16-42"></a><span class="p">(</span><span class="s1">&#39;Nicazou&#39;</span><span class="p">,</span> <span class="s1">&#39;Pierre&#39;</span><span class="p">)</span>
<a id="__codelineno-16-43" name="__codelineno-16-43"></a><span class="o">************</span>
<a id="__codelineno-16-44" name="__codelineno-16-44"></a><span class="p">[</span><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">age</span> <span class="n">between</span> <span class="mi">20</span> <span class="ow">and</span> <span class="mi">40</span> <span class="n">order</span> <span class="n">by</span> <span class="n">age</span> <span class="n">desc</span><span class="p">,</span> <span class="n">nom</span> <span class="n">asc</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">asc</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-45" name="__codelineno-16-45"></a><span class="n">nom</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-16-46" name="__codelineno-16-46"></a><span class="o">*****************</span>
<a id="__codelineno-16-47" name="__codelineno-16-47"></a><span class="p">(</span><span class="s1">&#39;Nicazou&#39;</span><span class="p">,</span> <span class="s1">&#39;Pierre&#39;</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
<a id="__codelineno-16-48" name="__codelineno-16-48"></a><span class="p">(</span><span class="s1">&#39;Colou&#39;</span><span class="p">,</span> <span class="s1">&#39;Geraldine&#39;</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>
<a id="__codelineno-16-49" name="__codelineno-16-49"></a><span class="o">*****************</span>
<a id="__codelineno-16-50" name="__codelineno-16-50"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;Josette&#39;</span><span class="p">,</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">,</span><span class="mi">46</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-51" name="__codelineno-16-51"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-16-52" name="__codelineno-16-52"></a><span class="p">[</span><span class="n">update</span> <span class="n">personnes</span> <span class="nb">set</span> <span class="n">age</span><span class="o">=</span><span class="mi">47</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-53" name="__codelineno-16-53"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-16-54" name="__codelineno-16-54"></a><span class="p">[</span><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-55" name="__codelineno-16-55"></a><span class="n">nom</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-16-56" name="__codelineno-16-56"></a><span class="o">*****************</span>
<a id="__codelineno-16-57" name="__codelineno-16-57"></a><span class="p">(</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">,</span> <span class="s1">&#39;Josette&#39;</span><span class="p">,</span> <span class="mi">47</span><span class="p">)</span>
<a id="__codelineno-16-58" name="__codelineno-16-58"></a><span class="o">*****************</span>
<a id="__codelineno-16-59" name="__codelineno-16-59"></a><span class="p">[</span><span class="n">delete</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-60" name="__codelineno-16-60"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-16-61" name="__codelineno-16-61"></a><span class="p">[</span><span class="n">select</span> <span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">,</span><span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span> <span class="n">where</span> <span class="n">nom</span><span class="o">=</span><span class="s1">&#39;Bruneau&#39;</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-16-62" name="__codelineno-16-62"></a><span class="n">nom</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-16-63" name="__codelineno-16-63"></a><span class="o">*****************</span>
<a id="__codelineno-16-64" name="__codelineno-16-64"></a><span class="o">*****************</span>
<a id="__codelineno-16-65" name="__codelineno-16-65"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-16-66" name="__codelineno-16-66"></a><span class="n">Exécution</span> <span class="n">terminée</span>
<a id="__codelineno-16-67" name="__codelineno-16-67"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-16-68" name="__codelineno-16-68"></a><span class="n">Il</span> <span class="n">y</span> <span class="n">a</span> <span class="n">eu</span> <span class="mi">1</span> <span class="n">erreur</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-16-69" name="__codelineno-16-69"></a><span class="n">xx</span> <span class="p">:</span> <span class="n">Erreur</span> <span class="p">(</span><span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="n">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">your</span> <span class="n">MySQL</span> <span class="n">server</span> <span class="n">version</span> <span class="k">for</span> <span class="n">the</span> <span class="n">right</span> <span class="n">syntax</span> <span class="n">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">&#39;xx&#39;</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-16-70" name="__codelineno-16-70"></a>
<a id="__codelineno-16-71" name="__codelineno-16-71"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong> :</p>
<ul>
<li>ligne 19 : on voit qu&#x27;après l&#x27;erreur l&#x27;exécution des ordres SQL a continué, ceci parce que l&#x27;exécution s&#x27;est faite sans transaction et avec le paramètre <strong>[arrêt=False]</strong>. Tous les ordres SQL ont donc été exécutés. On devrait donc avoir une table <strong>[personnes]</strong> reflétant cette exécution ;
Vérification avec phpMyAdmin :</li>
</ul>
<p><img src="images/10000000000002BE00000254275E18A9.png" style="width:8.09cm;height:6.891cm;" alt="Image" /></p>
<p><u><strong>Exécution n° 2</strong></u></p>
<p>Nous exécutons maintenant la configuration <strong>[mysql mysql-04 with_transaction]</strong>. Les résultats sont les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span>
<span class="normal"><a href="#__codelineno-17-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">databases</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">mysql_04</span><span class="o">.</span><span class="n">py</span> <span class="n">true</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="n">Exécution</span> <span class="n">du</span> <span class="n">fichier</span> <span class="n">SQL</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">databases</span>\<span class="n">mysql</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">commandes</span><span class="o">.</span><span class="n">sql</span> <span class="n">avec</span> <span class="n">transaction</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="p">[</span><span class="n">drop</span> <span class="n">table</span> <span class="n">personnes</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="p">[</span><span class="n">create</span> <span class="n">table</span> <span class="n">personnes</span> <span class="p">(</span><span class="nb">id</span> <span class="nb">int</span> <span class="n">primary</span> <span class="n">key</span><span class="p">,</span> <span class="n">prenom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">nom</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">age</span> <span class="n">integer</span> <span class="ow">not</span> <span class="n">null</span><span class="p">,</span> <span class="n">unique</span> <span class="p">(</span><span class="n">nom</span><span class="p">,</span><span class="n">prenom</span><span class="p">))]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Paul&#39;</span><span class="p">,</span><span class="s1">&#39;Langevin&#39;</span><span class="p">,</span><span class="mi">48</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="p">[</span><span class="n">insert</span> <span class="n">into</span> <span class="n">personnes</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">values</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Sylvie&#39;</span><span class="p">,</span><span class="s1">&#39;Lefur&#39;</span><span class="p">,</span><span class="mi">70</span><span class="p">)]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="n">nombre</span> <span class="n">de</span> <span class="n">lignes</span> <span class="n">modifiées</span> <span class="p">:</span> <span class="mi">1</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="p">[</span><span class="n">select</span> <span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span> <span class="kn">from</span><span class="w"> </span><span class="nn">personnes</span><span class="p">]</span> <span class="p">:</span> <span class="n">Exécution</span> <span class="n">réussie</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="n">prenom</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="o">*****************</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a><span class="p">(</span><span class="s1">&#39;Paul&#39;</span><span class="p">,</span> <span class="s1">&#39;Langevin&#39;</span><span class="p">,</span> <span class="mi">48</span><span class="p">)</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="p">(</span><span class="s1">&#39;Sylvie&#39;</span><span class="p">,</span> <span class="s1">&#39;Lefur&#39;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="o">*****************</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="n">xx</span> <span class="p">:</span> <span class="n">Erreur</span> <span class="p">(</span><span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="n">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">your</span> <span class="n">MySQL</span> <span class="n">server</span> <span class="n">version</span> <span class="k">for</span> <span class="n">the</span> <span class="n">right</span> <span class="n">syntax</span> <span class="n">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">&#39;xx&#39;</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="n">Exécution</span> <span class="n">terminée</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="o">--------------------------------------------------------------------</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a><span class="n">Il</span> <span class="n">y</span> <span class="n">a</span> <span class="n">eu</span> <span class="mi">1</span> <span class="n">erreur</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="n">xx</span> <span class="p">:</span> <span class="n">Erreur</span> <span class="p">(</span><span class="mi">1064</span> <span class="p">(</span><span class="mi">42000</span><span class="p">):</span> <span class="n">You</span> <span class="n">have</span> <span class="n">an</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">your</span> <span class="n">SQL</span> <span class="n">syntax</span><span class="p">;</span> <span class="n">check</span> <span class="n">the</span> <span class="n">manual</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">your</span> <span class="n">MySQL</span> <span class="n">server</span> <span class="n">version</span> <span class="k">for</span> <span class="n">the</span> <span class="n">right</span> <span class="n">syntax</span> <span class="n">to</span> <span class="n">use</span> <span class="n">near</span> <span class="s1">&#39;xx&#39;</span> <span class="n">at</span> <span class="n">line</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong> :</p>
<ul>
<li>ligne 19 : on voit qu&#x27;après l&#x27;erreur il n&#x27;y a plus d&#x27;exécution d&#x27;ordres SQL, ceci parce que l&#x27;exécution s&#x27;est faite dans une transaction et qu&#x27;à la 1re erreur rencontrée nous avons défait la transaction et arrêté l&#x27;exécution des ordres SQL. Ceci signifie que le résultat des ordres des lignes 9, 11, 13 a été défait. On devrait donc avoir une table <strong>[personnes]</strong> vide ;
Vérifications avec phpMyAdmin :</li>
</ul>
<p><img src="images/10000000000003F4000001B87E159F8E.png" style="width:11.69cm;height:5.081cm;" alt="Image" /></p>
<ul>
<li>en <strong>[5]</strong>, on voit que la table <strong>[personnes]</strong> <strong>[2]</strong> est vide ;</li>
</ul>
<h2 id="167-script-mysql_05-utilisation-de-requetes-parametrees">16.7. script [mysql_05] : utilisation de requêtes paramétrées</h2>
<p>Le script  <strong>[mysql_05]</strong> introduit la notion de requêtes paramétrées :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span>
<span class="normal"><a href="#__codelineno-18-29">29</a></span>
<span class="normal"><a href="#__codelineno-18-30">30</a></span>
<span class="normal"><a href="#__codelineno-18-31">31</a></span>
<span class="normal"><a href="#__codelineno-18-32">32</a></span>
<span class="normal"><a href="#__codelineno-18-33">33</a></span>
<span class="normal"><a href="#__codelineno-18-34">34</a></span>
<span class="normal"><a href="#__codelineno-18-35">35</a></span>
<span class="normal"><a href="#__codelineno-18-36">36</a></span>
<span class="normal"><a href="#__codelineno-18-37">37</a></span>
<span class="normal"><a href="#__codelineno-18-38">38</a></span>
<span class="normal"><a href="#__codelineno-18-39">39</a></span>
<span class="normal"><a href="#__codelineno-18-40">40</a></span>
<span class="normal"><a href="#__codelineno-18-41">41</a></span>
<span class="normal"><a href="#__codelineno-18-42">42</a></span>
<span class="normal"><a href="#__codelineno-18-43">43</a></span>
<span class="normal"><a href="#__codelineno-18-44">44</a></span>
<span class="normal"><a href="#__codelineno-18-45">45</a></span>
<span class="normal"><a href="#__codelineno-18-46">46</a></span>
<span class="normal"><a href="#__codelineno-18-47">47</a></span>
<span class="normal"><a href="#__codelineno-18-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># imports</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mysql.connector</span><span class="w"> </span><span class="kn">import</span> <span class="n">connect</span><span class="p">,</span> <span class="n">DatabaseError</span><span class="p">,</span> <span class="n">InterfaceError</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="c1"># l&#39;identité de l&#39;utilisateur</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="n">ID</span> <span class="o">=</span> <span class="s2">&quot;admpersonnes&quot;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="n">PWD</span> <span class="o">=</span> <span class="s2">&quot;nobody&quot;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="c1"># la machine hôte du sgbd</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="n">HOST</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="c1"># identité de la base</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="n">BASE</span> <span class="o">=</span> <span class="s2">&quot;dbpersonnes&quot;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="c1"># liste de personnes (nom,prenom,age)</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="n">personnes</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>    <span class="n">personnes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;n0</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;p0</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="n">personnes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">40</span><span class="p">,</span> <span class="s2">&quot;d&#39;Aboot&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&#39;éna&quot;</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="c1"># autre liste de personnes</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="n">autresPersonnes</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a>    <span class="n">autresPersonnes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span> <span class="o">+</span> <span class="mi">100</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;n1</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;p1</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">20</span><span class="p">))</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="n">autresPersonnes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;d&#39;Aboot&quot;</span><span class="p">,</span> <span class="s2">&quot;F&#39;ilhem&quot;</span><span class="p">,</span> <span class="mi">34</span><span class="p">))</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a><span class="c1"># accès au SGBD</span>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="n">connexion</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-18-25" name="__codelineno-18-25"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-18-26" name="__codelineno-18-26"></a>    <span class="c1"># connexion</span>
<a id="__codelineno-18-27" name="__codelineno-18-27"></a>    <span class="n">connexion</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">HOST</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">ID</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PWD</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">BASE</span><span class="p">)</span>
<a id="__codelineno-18-28" name="__codelineno-18-28"></a>    <span class="c1"># curseur</span>
<a id="__codelineno-18-29" name="__codelineno-18-29"></a>    <span class="n">curseur</span> <span class="o">=</span> <span class="n">connexion</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<a id="__codelineno-18-30" name="__codelineno-18-30"></a>    <span class="c1"># suppression des enregistrement existants</span>
<a id="__codelineno-18-31" name="__codelineno-18-31"></a>    <span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;delete from personnes&quot;</span><span class="p">)</span>
<a id="__codelineno-18-32" name="__codelineno-18-32"></a>    <span class="c1"># insertions personne par personne avec une requête préparée</span>
<a id="__codelineno-18-33" name="__codelineno-18-33"></a>    <span class="k">for</span> <span class="n">personne</span> <span class="ow">in</span> <span class="n">personnes</span><span class="p">:</span>
<a id="__codelineno-18-34" name="__codelineno-18-34"></a>        <span class="n">curseur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;insert into personnes(id,nom,prenom,age) values(</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">personne</span><span class="p">)</span>
<a id="__codelineno-18-35" name="__codelineno-18-35"></a>    <span class="c1"># insertion en bloc d&#39;une liste de personnes</span>
<a id="__codelineno-18-36" name="__codelineno-18-36"></a>    <span class="n">curseur</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;insert into personnes(id,nom,prenom,age) values(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">autresPersonnes</span><span class="p">)</span>
<a id="__codelineno-18-37" name="__codelineno-18-37"></a>    <span class="c1"># validation de la transaction</span>
<a id="__codelineno-18-38" name="__codelineno-18-38"></a>    <span class="n">connexion</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<a id="__codelineno-18-39" name="__codelineno-18-39"></a><span class="k">except</span> <span class="p">(</span><span class="n">DatabaseError</span><span class="p">,</span> <span class="n">InterfaceError</span><span class="p">)</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-18-40" name="__codelineno-18-40"></a>    <span class="c1"># affichage erreur</span>
<a id="__codelineno-18-41" name="__codelineno-18-41"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-42" name="__codelineno-18-42"></a>    <span class="c1"># annulation transaction</span>
<a id="__codelineno-18-43" name="__codelineno-18-43"></a>    <span class="k">if</span> <span class="n">connexion</span><span class="p">:</span>
<a id="__codelineno-18-44" name="__codelineno-18-44"></a>        <span class="n">connexion</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<a id="__codelineno-18-45" name="__codelineno-18-45"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-18-46" name="__codelineno-18-46"></a>    <span class="c1"># fermeture connexion</span>
<a id="__codelineno-18-47" name="__codelineno-18-47"></a>    <span class="k">if</span> <span class="n">connexion</span><span class="p">:</span>
<a id="__codelineno-18-48" name="__codelineno-18-48"></a>        <span class="n">connexion</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong></p>
<ul>
<li>lignes 12-21 : on crée deux listes de personnes à inclure dans la base de données <strong>[dbpersonnes]</strong> ;</li>
<li>ligne 27 : connexion à la base de données ;</li>
<li>ligne 31 : suppression du contenu de la table <strong>[personnes]</strong> ;</li>
<li>lignes 33-34 : insertion de personnes avec une requête paramétrée. Ligne 34, le 1er paramètre est l&#x27;ordre SQL à exécuter. Celui-ci est incomplet. Il contient des paramètres <strong>[%s]</strong> qui vont être remplacés un par un et dans l&#x27;ordre par les valeurs de la liste du second paramètre ;</li>
<li>
<p>ligne 36 : insertion de personnes avec cette fois une seule instruction <strong>[</strong><strong>curseur.executemany</strong><strong>]</strong>. Le second paramètre de <strong>[executemany]</strong> est alors une liste de listes ;
L&#x27;intérêt des requêtes paramétrées réside en deux points :</p>
</li>
<li>
<p>elles sont exécutées plus rapidement que des requêtes en &#x27;dur&#x27; qu&#x27;il faut analyser à chaque exécution. La requête paramétrée <strong>[executemany]</strong> n&#x27;est analysée qu&#x27;une fois. Ensuite elle est exécutée n fois sans être analysée de nouveau ;</p>
</li>
<li>les paramètres injectés dans la requête paramétrée sont vérifiés. S&#x27;ils contiennent des caractères réservés, comme l&#x27;apostrophe par exemple, ceux-ci sont &#x27;protégés&#x27; afin qu&#x27;ils n&#x27;interfèrent pas dans l&#x27;exécution de l&#x27;ordre SQL. C’est pour vérifier ce point qu’on a inclus des noms et prénoms avec apostrophes dans la liste (lignes 16 et 21) ;
Les résultats obtenus dans phpMyAdmin sont les suivants :</li>
</ul>
<p><img src="images/1000000000000357000003570770DB41.png" style="width:9.861cm;height:9.88cm;" alt="Image" /></p>
<ul>
<li>on notera que les chaînes ayant une apostrophe, caractère réservé en SQL, ont été correctement insérées. La requête  paramétrée les a &#x27;protégées&#x27;. Sans requête paramétrée, il aurait fallu faire ce travail nous-mêmes ;</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>