
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Python 3 et au framework web Flask par l'exemple">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-flask-sept-2020/exercice-dx27application---version-4.html">
      
      
        <link rel="prev" href="architecture-en-couches-et-programmation-par-interfaces.html">
      
      
        <link rel="next" href="utilisation-du-sgbd-mysql.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>15. Exercice d'application - version 4 - Introduction au langage Python 3 et au framework web Flask par l'exemple</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#15-exercice-dapplication-version-4" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-header__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Python 3 et au framework web Flask par l'exemple
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              15. Exercice d&#x27;application - version 4
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-nav__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Python 3 et au framework web Flask par l'exemple
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="avant-propos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Avant-propos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dx27un-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Installation d&#x27;un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-bases-de-python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Les bases de Python
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-chaines-de-caracteres.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Les chaînes de caractères
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-exceptions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Les exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fonctions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Les fonctions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fichiers-texte.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Les fichiers texte
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Exercice d&#x27;application – version 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-imports.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Les imports
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Exercice d’application : version 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Exercice d’application : version 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-et-objets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. Les classes et objets
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-generiques-baseentity-et-myexception.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. Les classes génériques [BaseEntity] et [MyException]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture-en-couches-et-programmation-par-interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. Architecture en couches et programmation par interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    15. Exercice d&#x27;application - version 4
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="exercice-dx27application---version-4.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    15. Exercice d&#x27;application - version 4
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#151-version-4-application-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1. Version 4 – application 1
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.1. Version 4 – application 1">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1511-les-entites" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.1. Les entités
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.1.1. Les entités">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#15111-la-classe-impotserror" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.1.1. La classe [ImpôtsError]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15112-la-classe-admindata" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.1.2. La classe [AdminData]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15113-la-classe-taxpayer" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.1.3. La classe [TaxPayer]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1512-la-couche-dao" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.2. La couche [dao]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.1.2. La couche [dao]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#15121-linterface-interfaceimpotsdao" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.2.1. L&#x27;interface [InterfaceImpôtsDao]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15122-la-classe-abstractimpotsdao" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.2.2. La classe [AbstractImpôtsDao]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15123-classe-impotsdaowithadmindatainjsonfile" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.2.3. Classe [ImpôtsDaoWithAdminDataInJsonFile]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1513-la-couche-metier" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.3. La couche [métier]
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.1.3. La couche [métier]">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#15131-linterface-interfaceimpotsmetier" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.3.1. L&#x27;interface [InterfaceImpôtsMétier]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15132-la-classe-impotsmetier" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.3.2. La classe [ImpôtsMétier]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1514-tests-des-couches-dao-et-metier" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.4. Tests des couches [dao] et [métier]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1515-script-principal" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.1.5. Script principal
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#152-version-4-application-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.2. Version 4 – application 2
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="15.2. Version 4 – application 2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1521-linterface-interfaceimpotsui" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.2.1. L&#x27;interface [InterfaceImpôtsUi]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1522-la-classe-impotsconsole" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.2.2. La classe [ImpôtsConsole]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1523-le-script-principal" class="md-nav__link">
    <span class="md-ellipsis">
      
        15.2.3. Le script principal
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-mysql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. Utilisation du SGBD MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-postgresql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. Utilisation du SGBD PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="ecrire-du-code-independant-du-sgbd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. Ecrire du code indépendant du SGBD
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-de-lorm-sqlalchemy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. Utilisation de l’ORM SQLALCHEMY
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application-version-5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Exercice d&#x27;application : version 5
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="fonctions-internet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Fonctions internet
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="services-web-avec-le-framework-flask.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Services web avec le framework Flask
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23. Exercice d’application : version 6
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24. Exercice d’application : version 7
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25. Exercice d’application : version 8
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="du-dictionnaire-a-xml-et-vice-versa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26. Du dictionnaire à XML et vice-versa
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-9.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27. Exercice d’application : version 9
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-10.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28. Exercice d’application : version 10
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-11.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    29. Exercice d’application : version 11
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30. Exercice d’application : version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="clients-web-pour-les-services-json-et-xml-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    31. Clients web pour les services jSON et XML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="le-mode-html-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    32. Le mode HTML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-13.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    33. Exercice d’application : version 13
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-14.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    34. Exercice d’application : version 14
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-15.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    35. Exercice d’application : version 15
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-16.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    36. Exercice d’application : version 16
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-17.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    37. Exercice d’application : version 17
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-18.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    38. Exercice d’application : version 18
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    39. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="15-exercice-dapplication-version-4">15. Exercice d&#x27;application - version 4</h1>
<p>Nous reprenons ici l&#x27;exercice décrit au paragraphe |<a href="#_Exercice_d’application_:"><u><u>Version 3</u></u></a>| et nous le traitons maintenant avec des classes et interfaces. Nous écrirons deux applications :</p>
<p>L’application 1 sera la suivante :</p>
<p><img src="images/100000010000025A000000D06120CF11.png" style="width:10.141cm;height:3.5cm;" alt="Image" /></p>
<p>Un script principal <strong>[main]</strong> instanciera une couche <strong>[dao]</strong> et une couche <strong>[métier]</strong> :</p>
<ul>
<li>la couche <strong>[dao]</strong> aura pour rôle de gérer des données stockées dans des fichiers texte et ultérieurement dans une base de données ;</li>
<li>la couche <strong>[métier]</strong> aura pour rôle de faire le calcul de l&#x27;impôt ;
Dans cette application, il n&#x27;y aura pas d&#x27;actions de la part d&#x27;un utilisateur : les données des contribuables seront trouvées dans un fichier texte dont on donnera le nom au module <strong>[main]</strong><strong>.</strong></li>
</ul>
<p>Dans l’application 2, c&#x27;est l&#x27;utilisateur qui tapera au clavier les données des contribuables. L&#x27;architecture évoluera alors de la façon suivante  :</p>
<p><img src="images/1000000100000276000000B3ACA856C0.png" style="width:10.54cm;height:2.991cm;" alt="Image" /></p>
<ul>
<li>la couche <strong>[dao]</strong> (<strong>D</strong>ata <strong>A</strong>ccess <strong>O</strong>bject) s&#x27;occupe de l&#x27;accès aux données externes</li>
<li>la couche <strong>[métier]</strong> s&#x27;occupe des problèmes métier, ici le calcul de l&#x27;impôt. Elle ne s&#x27;occupe pas des données. Celles-ci peuvent avoir deux provenances :</li>
<li>la couche <strong>[dao]</strong> pour les données persistantes ;</li>
<li>la couche <strong>[ui]</strong> pour les données fournies par l&#x27;utilisateur.</li>
<li>la couche <strong>[ui]</strong> (<strong>U</strong>ser <strong>I</strong>nterface) s&#x27;occupe des interactions avec l&#x27;utilisateur ;</li>
<li><strong>[main]</strong> est le chef d&#x27;orchestre ;
Dans la suite, les couches <strong>[dao]</strong>, <strong>[métier]</strong> et <strong>[ui]</strong> seront chacune implémentée à l&#x27;aide d&#x27;une classe. Les couches <strong>[métier]</strong> et <strong>[dao]</strong> seront les mêmes pour les deux applications. C’est la raison pour laquelle on les a réunies dans une même version de l’exercice d’application.</li>
</ul>
<h2 id="151-version-4-application-1">15.1. Version 4 – application 1</h2>
<p>La version 4 calcule l&#x27;impôt d&#x27;une liste de contribuables placée dans un fichier texte. Elle a l&#x27;architecture suivante :</p>
<p><img src="images/1000000100000257000000DA58BEF0ED.png" style="width:10.12cm;height:3.68cm;" alt="Image" /></p>
<h3 id="1511-les-entites">15.1.1. Les entités</h3>
<p>Les entités sont des classes de données. Leur rôle est d’encapsuler des données et d’offrir des getters / setters qui permettent de vérifier la validité de celles-ci. Les entités sont échangées par les couches. Une même entité peut partir de la couche <strong>[ui]</strong> pour aller jusqu’à la couche <strong>[dao]</strong> et vice-versa.</p>
<p><img src="images/1000000000000152000002069D0947DC.png" style="width:3.901cm;height:5.98cm;" alt="Image" /></p>
<h4 id="15111-la-classe-impotserror">15.1.1.1. La classe [ImpôtsError]</h4>
<p>Nous utiliserons une classe d&#x27;exception propriétaire :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># -------------------------------</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="c1"># classe d&#39;exception</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">MyException</span><span class="w"> </span><span class="kn">import</span> <span class="n">MyException</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">ImpôtsError</span><span class="p">(</span><span class="n">MyException</span><span class="p">):</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p>Dès que les couches <strong>[métier]</strong> et <strong>[dao]</strong> rencontreront un problème, elles lanceront cette exception. Elle dérive de la classe <strong>[MyException]</strong>. Elle s’utilise donc de la façon suivante : <strong>[raise ImpôtsError(code_erreur, msg_erreur)]</strong>.</p>
<h4 id="15112-la-classe-admindata">15.1.1.2. La classe [AdminData]</h4>
<p>La classe <strong>[AdminData]</strong> encapsule les constantes intervenant dans le calcul de l’impôt :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">BaseEntity</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseEntity</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="c1"># données de l&#39;administration fiscale</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">AdminData</span><span class="p">(</span><span class="n">BaseEntity</span><span class="p">):</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>    <span class="c1"># clés exclues de l&#39;état de la classe</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>    <span class="n">excluded_keys</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>    <span class="c1"># clés aurorisées</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_allowed_keys</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>        <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a>            <span class="s2">&quot;limites&quot;</span><span class="p">,</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>            <span class="s2">&quot;coeffr&quot;</span><span class="p">,</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>            <span class="s2">&quot;coeffn&quot;</span><span class="p">,</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>            <span class="s2">&quot;plafond_qf_demi_part&quot;</span><span class="p">,</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>            <span class="s2">&quot;plafond_revenus_celibataire_pour_reduction&quot;</span><span class="p">,</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>            <span class="s2">&quot;plafond_revenus_couple_pour_reduction&quot;</span><span class="p">,</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>            <span class="s2">&quot;valeur_reduc_demi_part&quot;</span><span class="p">,</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>            <span class="s2">&quot;plafond_decote_celibataire&quot;</span><span class="p">,</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a>            <span class="s2">&quot;plafond_decote_couple&quot;</span><span class="p">,</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>            <span class="s2">&quot;plafond_impot_couple_pour_decote&quot;</span><span class="p">,</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>            <span class="s2">&quot;plafond_impot_celibataire_pour_decote&quot;</span><span class="p">,</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a>            <span class="s2">&quot;abattement_dixpourcent_max&quot;</span><span class="p">,</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a>            <span class="s2">&quot;abattement_dixpourcent_min&quot;</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>        <span class="p">]</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 5 : la classe <strong>[AdminData]</strong> étend la classe <strong>[BaseEntity]</strong> décrite au paragraphe |<a href="#_La_classe_[BaseEntity]"><u><u>BaseEntity</u></u></a>|. On se rappelle que les classes  étendant la classe <strong>[BaseEntity]</strong> doivent définir :</li>
<li>un attribut de classe <strong>[excluded_keys]</strong> (ligne 7) qui liste les propriétés de l’objet exclues lorsque l’objet est transformé en dictionnaire ;</li>
<li>une méthode statique <strong>[get_allowed_keys]</strong> (lignes 10-26) qui rend la liste des propriétés acceptées lorsque l’objet est initialisé avec un dictionnaire ;
On n’a pas utilisé de setters pour vérifier la validité des données utilisées pour initialiser un objet <strong>[AdminData]</strong>. En effet, cet objet est unique et défini par configuration et donc pas susceptible d’être erroné.</li>
</ul>
<h4 id="15113-la-classe-taxpayer">15.1.1.3. La classe [TaxPayer]</h4>
<p>La classe <strong>[TaxPayer]</strong> modèlisera un contribuable :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">  1</a></span>
<span class="normal"><a href="#__codelineno-2-2">  2</a></span>
<span class="normal"><a href="#__codelineno-2-3">  3</a></span>
<span class="normal"><a href="#__codelineno-2-4">  4</a></span>
<span class="normal"><a href="#__codelineno-2-5">  5</a></span>
<span class="normal"><a href="#__codelineno-2-6">  6</a></span>
<span class="normal"><a href="#__codelineno-2-7">  7</a></span>
<span class="normal"><a href="#__codelineno-2-8">  8</a></span>
<span class="normal"><a href="#__codelineno-2-9">  9</a></span>
<span class="normal"><a href="#__codelineno-2-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-2-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-2-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-2-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-2-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-2-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-2-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-2-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-2-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-2-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-2-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-2-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-2-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-2-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-2-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-2-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-2-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-2-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-2-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-2-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-2-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-2-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-2-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-2-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-2-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-2-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-2-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-2-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-2-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-2-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-2-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-2-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-2-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-2-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-2-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-2-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-2-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-2-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-2-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-2-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-2-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-2-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-2-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-2-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-2-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-2-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-2-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-2-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-2-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-2-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-2-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-2-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-2-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-2-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-2-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-2-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-2-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-2-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-2-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-2-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-2-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-2-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-2-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-2-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-2-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-2-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-2-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-2-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-2-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-2-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-2-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-2-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-2-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-2-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-2-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-2-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-2-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-2-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-2-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-2-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-2-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-2-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-2-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-2-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-2-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-2-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-2-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-2-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-2-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-2-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-2-100">100</a></span>
<span class="normal"><a href="#__codelineno-2-101">101</a></span>
<span class="normal"><a href="#__codelineno-2-102">102</a></span>
<span class="normal"><a href="#__codelineno-2-103">103</a></span>
<span class="normal"><a href="#__codelineno-2-104">104</a></span>
<span class="normal"><a href="#__codelineno-2-105">105</a></span>
<span class="normal"><a href="#__codelineno-2-106">106</a></span>
<span class="normal"><a href="#__codelineno-2-107">107</a></span>
<span class="normal"><a href="#__codelineno-2-108">108</a></span>
<span class="normal"><a href="#__codelineno-2-109">109</a></span>
<span class="normal"><a href="#__codelineno-2-110">110</a></span>
<span class="normal"><a href="#__codelineno-2-111">111</a></span>
<span class="normal"><a href="#__codelineno-2-112">112</a></span>
<span class="normal"><a href="#__codelineno-2-113">113</a></span>
<span class="normal"><a href="#__codelineno-2-114">114</a></span>
<span class="normal"><a href="#__codelineno-2-115">115</a></span>
<span class="normal"><a href="#__codelineno-2-116">116</a></span>
<span class="normal"><a href="#__codelineno-2-117">117</a></span>
<span class="normal"><a href="#__codelineno-2-118">118</a></span>
<span class="normal"><a href="#__codelineno-2-119">119</a></span>
<span class="normal"><a href="#__codelineno-2-120">120</a></span>
<span class="normal"><a href="#__codelineno-2-121">121</a></span>
<span class="normal"><a href="#__codelineno-2-122">122</a></span>
<span class="normal"><a href="#__codelineno-2-123">123</a></span>
<span class="normal"><a href="#__codelineno-2-124">124</a></span>
<span class="normal"><a href="#__codelineno-2-125">125</a></span>
<span class="normal"><a href="#__codelineno-2-126">126</a></span>
<span class="normal"><a href="#__codelineno-2-127">127</a></span>
<span class="normal"><a href="#__codelineno-2-128">128</a></span>
<span class="normal"><a href="#__codelineno-2-129">129</a></span>
<span class="normal"><a href="#__codelineno-2-130">130</a></span>
<span class="normal"><a href="#__codelineno-2-131">131</a></span>
<span class="normal"><a href="#__codelineno-2-132">132</a></span>
<span class="normal"><a href="#__codelineno-2-133">133</a></span>
<span class="normal"><a href="#__codelineno-2-134">134</a></span>
<span class="normal"><a href="#__codelineno-2-135">135</a></span>
<span class="normal"><a href="#__codelineno-2-136">136</a></span>
<span class="normal"><a href="#__codelineno-2-137">137</a></span>
<span class="normal"><a href="#__codelineno-2-138">138</a></span>
<span class="normal"><a href="#__codelineno-2-139">139</a></span>
<span class="normal"><a href="#__codelineno-2-140">140</a></span>
<span class="normal"><a href="#__codelineno-2-141">141</a></span>
<span class="normal"><a href="#__codelineno-2-142">142</a></span>
<span class="normal"><a href="#__codelineno-2-143">143</a></span>
<span class="normal"><a href="#__codelineno-2-144">144</a></span>
<span class="normal"><a href="#__codelineno-2-145">145</a></span>
<span class="normal"><a href="#__codelineno-2-146">146</a></span>
<span class="normal"><a href="#__codelineno-2-147">147</a></span>
<span class="normal"><a href="#__codelineno-2-148">148</a></span>
<span class="normal"><a href="#__codelineno-2-149">149</a></span>
<span class="normal"><a href="#__codelineno-2-150">150</a></span>
<span class="normal"><a href="#__codelineno-2-151">151</a></span>
<span class="normal"><a href="#__codelineno-2-152">152</a></span>
<span class="normal"><a href="#__codelineno-2-153">153</a></span>
<span class="normal"><a href="#__codelineno-2-154">154</a></span>
<span class="normal"><a href="#__codelineno-2-155">155</a></span>
<span class="normal"><a href="#__codelineno-2-156">156</a></span>
<span class="normal"><a href="#__codelineno-2-157">157</a></span>
<span class="normal"><a href="#__codelineno-2-158">158</a></span>
<span class="normal"><a href="#__codelineno-2-159">159</a></span>
<span class="normal"><a href="#__codelineno-2-160">160</a></span>
<span class="normal"><a href="#__codelineno-2-161">161</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="c1"># imports</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">BaseEntity</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseEntity</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="c1"># un contribuable</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">TaxPayer</span><span class="p">(</span><span class="n">BaseEntity</span><span class="p">):</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>    <span class="c1"># modélise un contribuable</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>    <span class="c1"># id : identifiant</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>    <span class="c1"># marié : oui / non</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a>    <span class="c1"># enfants : son nombre d&#39;enfants</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a>    <span class="c1"># salaire : son salaire annuel</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a>    <span class="c1"># impôt : montant de l&#39;impôt à payer</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a>    <span class="c1"># surcôte : surcôte d&#39;impôt à payer</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a>    <span class="c1"># décôte : décôte de l&#39;impôt à payer</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a>    <span class="c1"># réduction : réduction sur l&#39;impôt à payer</span>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a>    <span class="c1"># taux : taux d&#39;imposition du contribuable</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a>    <span class="c1"># clés exclues de l&#39;état de la classe</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a>    <span class="n">excluded_keys</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a>    <span class="c1"># clés aurorisées</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_allowed_keys</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a>        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;marié&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">]</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a>    <span class="c1"># properties</span>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a>    <span class="nd">@property</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">marié</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__marié</span>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a>    <span class="nd">@property</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">enfants</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__enfants</span>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a>    <span class="nd">@property</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">salaire</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__salaire</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a>    <span class="nd">@property</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">impôt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__impôt</span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a>    <span class="nd">@property</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">surcôte</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__surcôte</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a>    <span class="nd">@property</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">décôte</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__décôte</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a>    <span class="nd">@property</span>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">réduction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__réduction</span>
<a id="__codelineno-2-55" name="__codelineno-2-55"></a>
<a id="__codelineno-2-56" name="__codelineno-2-56"></a>    <span class="nd">@property</span>
<a id="__codelineno-2-57" name="__codelineno-2-57"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">taux</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-2-58" name="__codelineno-2-58"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__taux</span>
<a id="__codelineno-2-59" name="__codelineno-2-59"></a>
<a id="__codelineno-2-60" name="__codelineno-2-60"></a>    <span class="c1"># setters</span>
<a id="__codelineno-2-61" name="__codelineno-2-61"></a>    <span class="nd">@marié</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-2-62" name="__codelineno-2-62"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">marié</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marié</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-2-63" name="__codelineno-2-63"></a>        <span class="n">ok</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">marié</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
<a id="__codelineno-2-64" name="__codelineno-2-64"></a>        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
<a id="__codelineno-2-65" name="__codelineno-2-65"></a>            <span class="n">marié</span> <span class="o">=</span> <span class="n">marié</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-2-66" name="__codelineno-2-66"></a>            <span class="n">ok</span> <span class="o">=</span> <span class="n">marié</span> <span class="o">==</span> <span class="s2">&quot;oui&quot;</span> <span class="ow">or</span> <span class="n">marié</span> <span class="o">==</span> <span class="s2">&quot;non&quot;</span>
<a id="__codelineno-2-67" name="__codelineno-2-67"></a>        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
<a id="__codelineno-2-68" name="__codelineno-2-68"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__marié</span> <span class="o">=</span> <span class="n">marié</span>
<a id="__codelineno-2-69" name="__codelineno-2-69"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-70" name="__codelineno-2-70"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;l&#39;attribut marié [</span><span class="si">{</span><span class="n">marié</span><span class="si">}</span><span class="s2">] doit avoir l&#39;une des valeurs oui / non&quot;</span><span class="p">)</span>
<a id="__codelineno-2-71" name="__codelineno-2-71"></a>
<a id="__codelineno-2-72" name="__codelineno-2-72"></a>    <span class="nd">@enfants</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-2-73" name="__codelineno-2-73"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">enfants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enfants</span><span class="p">):</span>
<a id="__codelineno-2-74" name="__codelineno-2-74"></a>        <span class="c1"># enfants doit être un entier &gt;=0</span>
<a id="__codelineno-2-75" name="__codelineno-2-75"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-76" name="__codelineno-2-76"></a>            <span class="n">enfants</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">enfants</span><span class="p">)</span>
<a id="__codelineno-2-77" name="__codelineno-2-77"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="n">enfants</span> <span class="o">&lt;</span> <span class="mi">0</span>
<a id="__codelineno-2-78" name="__codelineno-2-78"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-2-79" name="__codelineno-2-79"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-2-80" name="__codelineno-2-80"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-2-81" name="__codelineno-2-81"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__enfants</span> <span class="o">=</span> <span class="n">enfants</span>
<a id="__codelineno-2-82" name="__codelineno-2-82"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-83" name="__codelineno-2-83"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;L&#39;attribut enfants [</span><span class="si">{</span><span class="n">enfants</span><span class="si">}</span><span class="s2">] doit être un entier &gt;=0&quot;</span><span class="p">)</span>
<a id="__codelineno-2-84" name="__codelineno-2-84"></a>
<a id="__codelineno-2-85" name="__codelineno-2-85"></a>    <span class="nd">@salaire</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-2-86" name="__codelineno-2-86"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">salaire</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">salaire</span><span class="p">):</span>
<a id="__codelineno-2-87" name="__codelineno-2-87"></a>        <span class="c1"># salaire doit être un entier &gt;=0</span>
<a id="__codelineno-2-88" name="__codelineno-2-88"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-89" name="__codelineno-2-89"></a>            <span class="n">salaire</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">salaire</span><span class="p">)</span>
<a id="__codelineno-2-90" name="__codelineno-2-90"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="n">salaire</span> <span class="o">&lt;</span> <span class="mi">0</span>
<a id="__codelineno-2-91" name="__codelineno-2-91"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-2-92" name="__codelineno-2-92"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-2-93" name="__codelineno-2-93"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-2-94" name="__codelineno-2-94"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__salaire</span> <span class="o">=</span> <span class="n">salaire</span>
<a id="__codelineno-2-95" name="__codelineno-2-95"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-96" name="__codelineno-2-96"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;L&#39;attribut salaire [</span><span class="si">{</span><span class="n">salaire</span><span class="si">}</span><span class="s2">] doit être un entier &gt;=0&quot;</span><span class="p">)</span>
<a id="__codelineno-2-97" name="__codelineno-2-97"></a>
<a id="__codelineno-2-98" name="__codelineno-2-98"></a>    <span class="nd">@impôt</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-2-99" name="__codelineno-2-99"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">impôt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">impôt</span><span class="p">):</span>
<a id="__codelineno-2-100" name="__codelineno-2-100"></a>        <span class="c1"># impôt doit être un entier &gt;=0</span>
<a id="__codelineno-2-101" name="__codelineno-2-101"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-102" name="__codelineno-2-102"></a>            <span class="n">impôt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">impôt</span><span class="p">)</span>
<a id="__codelineno-2-103" name="__codelineno-2-103"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="n">impôt</span> <span class="o">&lt;</span> <span class="mi">0</span>
<a id="__codelineno-2-104" name="__codelineno-2-104"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-2-105" name="__codelineno-2-105"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-2-106" name="__codelineno-2-106"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-2-107" name="__codelineno-2-107"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__impôt</span> <span class="o">=</span> <span class="n">impôt</span>
<a id="__codelineno-2-108" name="__codelineno-2-108"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-109" name="__codelineno-2-109"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;L&#39;attribut impôt [</span><span class="si">{</span><span class="n">impôt</span><span class="si">}</span><span class="s2">] doit être un nombre &gt;=0&quot;</span><span class="p">)</span>
<a id="__codelineno-2-110" name="__codelineno-2-110"></a>
<a id="__codelineno-2-111" name="__codelineno-2-111"></a>    <span class="nd">@décôte</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-2-112" name="__codelineno-2-112"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">décôte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">décôte</span><span class="p">):</span>
<a id="__codelineno-2-113" name="__codelineno-2-113"></a>        <span class="c1"># décôte doit être un entier &gt;=0</span>
<a id="__codelineno-2-114" name="__codelineno-2-114"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-115" name="__codelineno-2-115"></a>            <span class="n">décôte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">décôte</span><span class="p">)</span>
<a id="__codelineno-2-116" name="__codelineno-2-116"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="n">décôte</span> <span class="o">&lt;</span> <span class="mi">0</span>
<a id="__codelineno-2-117" name="__codelineno-2-117"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-2-118" name="__codelineno-2-118"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-2-119" name="__codelineno-2-119"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-2-120" name="__codelineno-2-120"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__décôte</span> <span class="o">=</span> <span class="n">décôte</span>
<a id="__codelineno-2-121" name="__codelineno-2-121"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-122" name="__codelineno-2-122"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;L&#39;attribut décôte [</span><span class="si">{</span><span class="n">décôte</span><span class="si">}</span><span class="s2">] doit être un nombre &gt;=0&quot;</span><span class="p">)</span>
<a id="__codelineno-2-123" name="__codelineno-2-123"></a>
<a id="__codelineno-2-124" name="__codelineno-2-124"></a>    <span class="nd">@surcôte</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-2-125" name="__codelineno-2-125"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">surcôte</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surcôte</span><span class="p">):</span>
<a id="__codelineno-2-126" name="__codelineno-2-126"></a>        <span class="c1"># surcôte doit être un entier &gt;=0</span>
<a id="__codelineno-2-127" name="__codelineno-2-127"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-128" name="__codelineno-2-128"></a>            <span class="n">surcôte</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">surcôte</span><span class="p">)</span>
<a id="__codelineno-2-129" name="__codelineno-2-129"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="n">surcôte</span> <span class="o">&lt;</span> <span class="mi">0</span>
<a id="__codelineno-2-130" name="__codelineno-2-130"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-2-131" name="__codelineno-2-131"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-2-132" name="__codelineno-2-132"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-2-133" name="__codelineno-2-133"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__surcôte</span> <span class="o">=</span> <span class="n">surcôte</span>
<a id="__codelineno-2-134" name="__codelineno-2-134"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-135" name="__codelineno-2-135"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;L&#39;attribut surcôte [</span><span class="si">{</span><span class="n">surcôte</span><span class="si">}</span><span class="s2">] doit être un nombre &gt;=0&quot;</span><span class="p">)</span>
<a id="__codelineno-2-136" name="__codelineno-2-136"></a>
<a id="__codelineno-2-137" name="__codelineno-2-137"></a>    <span class="nd">@réduction</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-2-138" name="__codelineno-2-138"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">réduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">réduction</span><span class="p">):</span>
<a id="__codelineno-2-139" name="__codelineno-2-139"></a>        <span class="c1"># surcôte doit être un entier &gt;=0</span>
<a id="__codelineno-2-140" name="__codelineno-2-140"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-141" name="__codelineno-2-141"></a>            <span class="n">réduction</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">réduction</span><span class="p">)</span>
<a id="__codelineno-2-142" name="__codelineno-2-142"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="n">réduction</span> <span class="o">&lt;</span> <span class="mi">0</span>
<a id="__codelineno-2-143" name="__codelineno-2-143"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-2-144" name="__codelineno-2-144"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-2-145" name="__codelineno-2-145"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-2-146" name="__codelineno-2-146"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__réduction</span> <span class="o">=</span> <span class="n">réduction</span>
<a id="__codelineno-2-147" name="__codelineno-2-147"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-148" name="__codelineno-2-148"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;L&#39;attribut réduction [</span><span class="si">{</span><span class="n">réduction</span><span class="si">}</span><span class="s2">] doit être un nombre &gt;=0&quot;</span><span class="p">)</span>
<a id="__codelineno-2-149" name="__codelineno-2-149"></a>
<a id="__codelineno-2-150" name="__codelineno-2-150"></a>    <span class="nd">@taux</span><span class="o">.</span><span class="n">setter</span>
<a id="__codelineno-2-151" name="__codelineno-2-151"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">taux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taux</span><span class="p">):</span>
<a id="__codelineno-2-152" name="__codelineno-2-152"></a>        <span class="c1"># taux doit être un réel &gt;=0</span>
<a id="__codelineno-2-153" name="__codelineno-2-153"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-2-154" name="__codelineno-2-154"></a>            <span class="n">taux</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">taux</span><span class="p">)</span>
<a id="__codelineno-2-155" name="__codelineno-2-155"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="n">taux</span> <span class="o">&lt;</span> <span class="mi">0</span>
<a id="__codelineno-2-156" name="__codelineno-2-156"></a>        <span class="k">except</span><span class="p">:</span>
<a id="__codelineno-2-157" name="__codelineno-2-157"></a>            <span class="n">erreur</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-2-158" name="__codelineno-2-158"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-2-159" name="__codelineno-2-159"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__taux</span> <span class="o">=</span> <span class="n">taux</span>
<a id="__codelineno-2-160" name="__codelineno-2-160"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-2-161" name="__codelineno-2-161"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;L&#39;attribut taux [</span><span class="si">{</span><span class="n">taux</span><span class="si">}</span><span class="s2">] doit être un nombre &gt;=0&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong> :</p>
<ul>
<li>la classe <strong>[TaxPayer]</strong> encapsule un contribuable ;</li>
<li>ligne 7 : la classe <strong>[TaxPayer]</strong> dérive de la classe <strong>[BaseEntity]</strong>. Elle a donc un identifiant <strong>[id]</strong> ;</li>
<li>ligne 20 : aucune propriété n’est exclue de l’état d’un objet <strong>[AdminData]</strong> ;</li>
<li>lignes 22-25 : les propriétés de la classe. Celles-ci sont explicitées aux lignes 9-17 ;</li>
<li>lignes 27-58 : getters des attributs de la classe ;</li>
<li>lignes 60-161 : les setters des attributs de la classe. On rappelle que l’intérêt d’une classe encapsulant des données vis-à-vis d’un simple dictionnaire est que la classe peut vérifier la validité de ses propriétés grâce à ses setters ;</li>
</ul>
<h3 id="1512-la-couche-dao">15.1.2. La couche [dao]</h3>
<p><img src="images/1000000100000257000000DA58BEF0ED.png" style="width:10.12cm;height:3.68cm;" alt="Image" /></p>
<p>Nous allons réunir les implémentations des couches dans un dossier <strong>[</strong><strong>services</strong><strong>]</strong>. Ces classes implémenteront des interfaces définies dans le dossier <strong>[</strong><strong>interfaces</strong><strong>]</strong>.</p>
<p><img src="images/100000000000023B00000216ED994750.png" style="width:6.58cm;height:6.181cm;" alt="Image" /></p>
<h4 id="15121-linterface-interfaceimpotsdao">15.1.2.1. L&#x27;interface [InterfaceImpôtsDao]</h4>
<p>La couche <strong>[dao]</strong> implémentera l&#x27;interface <strong>[InterfaceImpôtsDao]</strong> suivante (fichier InterfaceImpôtsDao.py) :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># imports</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="c1"># interface IImpôtsDao</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AdminData</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdminData</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">InterfaceImpôtsDao</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a>    <span class="c1"># liste des tranches de l&#39;impôt</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_admindata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdminData</span><span class="p">:</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a>        <span class="k">pass</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a>    <span class="c1"># liste des données contribuables</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_taxpayers_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a>        <span class="k">pass</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a>    <span class="c1"># écriture des résultats du calcul de l&#39;impôt</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write_taxpayers_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayers_results</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p>L&#x27;interface définit trois méthodes :</p>
<ul>
<li><strong>[</strong><strong>get_admindata</strong><strong>]</strong> : est la méthode qui obtient le tableau des tranches d&#x27;impôt. On notera qu&#x27;on ne donne aucun renseignement sur la façon d&#x27;obtenir ces données. Dans la suite, elles seront trouvées d&#x27;abord dans un fichier texte puis dans une base de données. Ce seront aux classes qui implémentent l&#x27;interface de s&#x27;adapter au mode de stockage des données. On aura donc une classe pour récupérer les tranches d&#x27;impôt dans un fichier texte et une autre pour les récupérer dans une base de données. Elles implémenteront toutes deux la méthode <strong>[</strong><strong>get_admindata</strong><strong>]</strong> ;</li>
<li><strong>[</strong><strong>get_taxpayers_data</strong><strong>]</strong> : est la méthode qui obtient les données des contribuables. Là encore nous ne disons pas où elles seront trouvées. Nous ne traiterons que le cas où elles sont dans un fichier texte ;</li>
<li><strong>[</strong><strong>write_taxpayers_results</strong><strong>]</strong> : est la méthode qui va persister les résultats du calcul de l&#x27;impôt. Nous ne disons pas où. Nous ne traiterons que le cas où les résultats sont persistés dans un fichier texte. Le paramètre <strong>[</strong><strong>taxpayers_results</strong><strong>]</strong> sera la liste des résultats à persister ;</li>
</ul>
<h4 id="15122-la-classe-abstractimpotsdao">15.1.2.2. La classe [AbstractImpôtsDao]</h4>
<p>La couche <strong>[dao]</strong> va être implémentée par deux classes :</p>
<ul>
<li>l&#x27;une ira chercher les données (contribuables, résultats, tranches d&#x27;impôt) dans des fichiers texte ;</li>
<li>
<p>l&#x27;autre ira chercher les données (contribuables, résultats) dans des fichiers texte et les tranches de l&#x27;impôt dans une base de données ;
Les deux classes ne vont différer que par la gestion des tranches de l&#x27;impôt. Les données contribuables et les résultats des calculs de l&#x27;impôt seront, elles, gérées de la même façon. Pour cette raison, nous allons les gérer dans une classe parent <strong>[</strong><strong>AbstractImpôtsDao</strong><strong>]</strong>. La particularité de la gestion des tranches d&#x27;impôt sera, elle, gérée dans deux classes filles :</p>
</li>
<li>
<p>la classe <strong>[</strong><strong>Imp</strong><strong>ôtsDaoWithAdminDataInJsonFile</strong><strong>]</strong> ira chercher les tranches de l&#x27;impôt dans un fichier texte au format jSON ;</p>
</li>
<li>la classe <strong>[</strong><strong>ImpôtsDaoWithAdminDataInDatabase</strong><strong>]</strong>  ira chercher les tranches de l&#x27;impôt dans une base de données ;
La classe parent <strong>[</strong><strong>AbstractImpôtsDao</strong><strong>]</strong> sera la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span>
<span class="normal"><a href="#__codelineno-4-35">35</a></span>
<span class="normal"><a href="#__codelineno-4-36">36</a></span>
<span class="normal"><a href="#__codelineno-4-37">37</a></span>
<span class="normal"><a href="#__codelineno-4-38">38</a></span>
<span class="normal"><a href="#__codelineno-4-39">39</a></span>
<span class="normal"><a href="#__codelineno-4-40">40</a></span>
<span class="normal"><a href="#__codelineno-4-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># imports</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">codecs</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstractmethod</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AdminData</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdminData</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceImpôtsDao</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceImpôtsDao</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="c1"># classe de base pour la couche [dao]</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">AbstractImpôtsDao</span><span class="p">(</span><span class="n">InterfaceImpôtsDao</span><span class="p">):</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>    <span class="c1"># les contribuables et leur impôt seront dans des fichiers texte</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>    <span class="c1"># constructeur</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>        <span class="c1"># config[taxpayersFilename] : le nom du fichier texte des contribuables</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>        <span class="c1"># config[resultsFilename] : le nom du fichier jSON des résultats</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>        <span class="c1"># config[errorsFilename] : le nom du fichier des erreurs</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>        <span class="c1"># on mémorise les paramètres</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">taxpayers_filename</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taxpayersFilename&quot;</span><span class="p">)</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">taxpayers_results_filename</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resultsFilename&quot;</span><span class="p">)</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">errors_filename</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;errorsFilename&quot;</span><span class="p">)</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>    <span class="c1"># ------------------</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a>    <span class="c1"># interface IImpôtsDao</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a>    <span class="c1"># ------------------</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a>    <span class="c1"># liste des données contribuables</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_taxpayers_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a>        <span class="err">…</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a>    <span class="c1"># écriture de l&#39;impôt des contribuables</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write_taxpayers_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayers</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a>        <span class="err">…</span>
<a id="__codelineno-4-37" name="__codelineno-4-37"></a>
<a id="__codelineno-4-38" name="__codelineno-4-38"></a>    <span class="c1"># lecture des tranches de l&#39;impôt</span>
<a id="__codelineno-4-39" name="__codelineno-4-39"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-4-40" name="__codelineno-4-40"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_admindata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdminData</span><span class="p">:</span>
<a id="__codelineno-4-41" name="__codelineno-4-41"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 13 : la classe <strong>[</strong><strong>AbstractImpôtsDao</strong><strong>]</strong> implémente l&#x27;interface <strong>[</strong><strong>InterfaceImpôtsDao</strong><strong>]</strong>. Aussi trouve-t-on les trois méthodes de cette interface :</li>
<li><strong>[</strong><strong>get_taxpayers_data</strong><strong>]</strong> : ligne 31 ;</li>
<li><strong>[</strong><strong>write_taxpayers_results</strong><strong>]</strong> : ligne 35 ;</li>
<li><strong>[</strong><strong>get_admindata</strong><strong>]</strong> : ligne 40. Cette méthode ne sera pas implémentée par la classe <strong>[</strong><strong>AbstractImpôtsDao</strong><strong>]</strong> aussi est-elle déclarée abstraite (ligne 39) ;</li>
<li>ligne 16 : le constructeur reçoit un dictionnaire <strong>[config]</strong> contenant les informations suivantes :</li>
<li><strong>[</strong><strong>taxpayersFilename</strong><strong>]</strong> : le nom du fichier texte qui contient les données des contribuables ;</li>
<li><strong>[</strong><strong>resultsFilename</strong><strong>]</strong> : le nom du fichier texte dans lequel seront mis les résultats ;</li>
<li><strong>[</strong><strong>errorsFilename</strong><strong>]</strong> : le nom du fichier texte listant les erreurs rencontrées lors de l’exploitation du fichier <strong>[</strong><strong>taxpayersFilename</strong><strong>]</strong> ;
La méthode <strong>[</strong><strong>get_taxpayers_data</strong><strong>]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span>
<span class="normal"><a href="#__codelineno-5-31">31</a></span>
<span class="normal"><a href="#__codelineno-5-32">32</a></span>
<span class="normal"><a href="#__codelineno-5-33">33</a></span>
<span class="normal"><a href="#__codelineno-5-34">34</a></span>
<span class="normal"><a href="#__codelineno-5-35">35</a></span>
<span class="normal"><a href="#__codelineno-5-36">36</a></span>
<span class="normal"><a href="#__codelineno-5-37">37</a></span>
<span class="normal"><a href="#__codelineno-5-38">38</a></span>
<span class="normal"><a href="#__codelineno-5-39">39</a></span>
<span class="normal"><a href="#__codelineno-5-40">40</a></span>
<span class="normal"><a href="#__codelineno-5-41">41</a></span>
<span class="normal"><a href="#__codelineno-5-42">42</a></span>
<span class="normal"><a href="#__codelineno-5-43">43</a></span>
<span class="normal"><a href="#__codelineno-5-44">44</a></span>
<span class="normal"><a href="#__codelineno-5-45">45</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>    <span class="c1"># liste des données contribuables</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_taxpayers_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>        <span class="c1"># initialisations</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>        <span class="n">taxpayers_data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>        <span class="n">datafile</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>        <span class="n">erreurs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>            <span class="c1"># ouverture du fichier des données</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>            <span class="n">datafile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taxpayers_filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>            <span class="c1"># on exploite la ligne courante du fichier</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>            <span class="n">ligne</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>            <span class="c1"># n° de ligne</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>            <span class="n">numligne</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>            <span class="k">while</span> <span class="n">ligne</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a>                <span class="c1"># une ligne de +</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>                <span class="n">numligne</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>                <span class="c1"># on enlève les blancs</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>                <span class="n">ligne</span> <span class="o">=</span> <span class="n">ligne</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>                <span class="c1"># on ignore les lignes vides et les commentaires</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a>                <span class="k">if</span> <span class="n">ligne</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">ligne</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;#&quot;</span><span class="p">:</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a>                        <span class="c1"># on récupère les 4 champs id,marié,enfants,salaire qui forment la ligne contribuable</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a>                        <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">marié</span><span class="p">,</span> <span class="n">enfants</span><span class="p">,</span> <span class="n">salaire</span><span class="p">)</span> <span class="o">=</span> <span class="n">ligne</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a>                        <span class="c1"># on crée un nouveau TaxPayer</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a>                        <span class="n">taxpayers_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a>                            <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">id</span><span class="p">,</span> <span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="n">marié</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="n">enfants</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="n">salaire</span><span class="p">}))</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a>                    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a>                        <span class="c1"># on note l&#39;erreur</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a>                        <span class="n">erreurs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ligne </span><span class="si">{</span><span class="n">numligne</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a>                <span class="c1"># on lit une nouvelle ligne contribuable</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a>                <span class="n">ligne</span> <span class="o">=</span> <span class="n">datafile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a>            <span class="c1"># on enregistre les erreurs s&#39;il y en a</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a>            <span class="k">if</span> <span class="n">erreurs</span><span class="p">:</span>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a>                <span class="n">text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Analyse du fichier </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">taxpayers_filename</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">erreurs</span><span class="p">)</span>
<a id="__codelineno-5-35" name="__codelineno-5-35"></a>                <span class="k">with</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">errors_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
<a id="__codelineno-5-36" name="__codelineno-5-36"></a>                    <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-5-37" name="__codelineno-5-37"></a>            <span class="c1"># on rend le résultat</span>
<a id="__codelineno-5-38" name="__codelineno-5-38"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;taxpayers&quot;</span><span class="p">:</span> <span class="n">taxpayers_data</span><span class="p">,</span> <span class="s2">&quot;erreurs&quot;</span><span class="p">:</span> <span class="n">erreurs</span><span class="p">}</span>
<a id="__codelineno-5-39" name="__codelineno-5-39"></a>        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-5-40" name="__codelineno-5-40"></a>            <span class="c1"># on lance une exception ImpôtsError</span>
<a id="__codelineno-5-41" name="__codelineno-5-41"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-5-42" name="__codelineno-5-42"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-5-43" name="__codelineno-5-43"></a>            <span class="c1"># on ferme le fichier</span>
<a id="__codelineno-5-44" name="__codelineno-5-44"></a>            <span class="k">if</span> <span class="n">datafile</span><span class="p">:</span>
<a id="__codelineno-5-45" name="__codelineno-5-45"></a>                <span class="n">datafile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 4 : les données des contribuables (marié, enfants, salaire) seront placées dans une liste d&#x27;objets de type <strong>[TaxPayer]</strong> ;</li>
<li>lignes 8-9 : on ouvre le fichier texte des contribuables en lecture. Son contenu a la forme suivante :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># données valides : id, marié, enfants, salaire</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="mi">1</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">55555</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="mi">2</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">50000</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="mi">3</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">50000</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="mi">4</span><span class="p">,</span><span class="n">non</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100000</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="mi">5</span><span class="p">,</span><span class="n">non</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100000</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="mi">6</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100000</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="mi">7</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">100000</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="mi">8</span><span class="p">,</span><span class="n">non</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100000</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="mi">9</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">30000</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="mi">10</span><span class="p">,</span><span class="n">non</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">200000</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="mi">11</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">200000</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="c1"># on peut avoir des lignes vides</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="c1"># on crée des lignes erronées</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="c1"># pas assez de valeurs</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="mi">11</span><span class="p">,</span><span class="mi">12</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="c1"># trop de valeurs</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="mi">12</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">200000</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="c1"># des valeurs erronées</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Par rapport aux versions précédentes :</p>
<ul>
<li>chaque ligne du fichier <strong>[</strong><strong>taxpayersFilename</strong><strong>]</strong> commence par l&#x27;identifiant du contribuable, un simple numéro ;</li>
<li>les commentaires et les lignes vides sont autorisés ;</li>
<li>
<p>on va gérer les erreurs. Ainsi les lignes 17, 19 et 21 doivent être déclarées erronées. Les erreurs sont consignées dans un fichier à part ;
Continuons l’examen du code :</p>
</li>
<li>
<p>ligne 4 : les données du fichier texte sont transférées dans la liste <strong>[</strong><strong>taxPayersData</strong><strong>]</strong> ;</p>
</li>
<li>lignes 14-31 : le fichier des contribuables est lu ligne par ligne ;</li>
<li>ligne 14 : la fin du fichier est atteinte lorsqu’on lit une ligne vide (rien – pas même la marque de fin de ligne \r\n) ;</li>
<li>ligne 20 : on ignore les lignes vides et les commentaires. Une ligne est un commentaire si, une fois la ligne débarrassée de ses blancs devant et derrière le texte, le 1er caractère est le caractère # ;</li>
<li>ligne 24 : une ligne correcte est composée de quatre champs séparés par une virgule. On récupère ceux-ci. L’affectation de données à un tuple de quatre éléments échoue s’il n’y a pas exactement quatre données affectées ;</li>
<li>ligne 25 : si l’un des quatre champs récupérés <strong>[</strong><strong>id, marié, enfants, salaire</strong><strong>]</strong> est invalide alors la méthode <strong>[BaseEntity.fromdict]</strong> lancera une exception de type <strong>[MyException]</strong> ;</li>
<li>lignes 25-26 : un objet <strong>[TaxPayer]</strong> est ajouté à la liste <strong>[</strong><strong>taxpayers_data</strong><strong>]</strong> des contribuables ;</li>
<li>lignes 27-29 : les éventuelles erreurs sont cumulées dans une liste <strong>[erreurs]</strong>. Cette liste a été créée ligne 6 ;</li>
<li>lignes 33-36 : la liste des erreurs rencontrées est enregistrée dans le fichier texte <strong>[</strong><strong>errorsFilename</strong><strong>]</strong>. Elles sont de deux types :</li>
<li>une ligne n’avait pas le nombre correct de champs attendus ;</li>
<li>les informations de la ligne étaient erronées et ont échoué à construire un objet <strong>[TaxPayer]</strong> ;</li>
<li>lignes 39-41 : on intercepte toute erreur (BaseException) et on la remonte en l&#x27;encapsulant dans un type <strong>[ImpôtsError]</strong> ;</li>
<li>lignes 42-45 : dans tous les cas, réussite ou échec, le fichier texte des contrbuables est fermé s&#x27;il a été ouvert ;
La méthode <strong>[</strong><strong>write_taxpayers_results</strong><strong>]</strong> doit produire un fichier jSON de la forme :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="p">[</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>  <span class="p">{</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>    <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>    <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>    <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">55555</span><span class="p">,</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>    <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">2814</span><span class="p">,</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>    <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>    <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>    <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>    <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>  <span class="p">},</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>  <span class="p">{</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>    <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>    <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>    <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a>    <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a>    <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a>    <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a>    <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a>    <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a>  <span class="p">},</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a>  <span class="p">{</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a>    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a>    <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a>    <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a>    <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a>    <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a>    <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a>    <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a>    <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">720</span><span class="p">,</span>
<a id="__codelineno-7-33" name="__codelineno-7-33"></a>    <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span>
<a id="__codelineno-7-34" name="__codelineno-7-34"></a>  <span class="p">},</span>
<a id="__codelineno-7-35" name="__codelineno-7-35"></a>  <span class="err">…</span>
<a id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="p">]</span>
</code></pre></div></td></tr></table></div>
<p>La méthode <strong>[</strong><strong>write_taxpayers_results</strong><strong>]</strong> est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>    <span class="c1"># écriture de l&#39;impôt des contribuables</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write_taxpayers_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayers</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>        <span class="c1"># écriture des résultats dans un fichier jSON</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>        <span class="c1"># taxpayers : liste d&#39;objets de type TaxPayer</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>        <span class="c1"># (id, marié, enfants, salaire, impôt, surcôte, décôte, réduction, taux)</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>        <span class="c1"># la liste [taxpayers] est enregistrée dans le fichier texte [self.taxpayers_results_filename]</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>        <span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>            <span class="c1"># ouverture du fichier des résultats</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>            <span class="n">file</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taxpayers_results_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>            <span class="c1"># création de la liste à sérialiser en jSON</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>            <span class="n">mapping</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">taxpayer</span><span class="p">:</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span> <span class="n">taxpayers</span><span class="p">)</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>            <span class="c1"># sérialisation jSON</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">mapping</span><span class="p">),</span> <span class="n">file</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>            <span class="c1"># on relance l&#39;erreur sous un autre type</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>            <span class="c1"># on ferme le fichier s&#39;il a été ouvert</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>            <span class="k">if</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a>                <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 2 : la méthode reçoit une liste de contribuables <strong>[taxpayers]</strong> qu&#x27;elle doit enregistrer dans le fichier texte <strong>[</strong><strong>self</strong><strong>.</strong><strong>taxpayers_results_filename</strong><strong>]</strong> au format jSON ;</li>
<li>ligne 10 : création du fichier UTF-8 des résultats ;</li>
<li>ligne 12 : nous introduisons ici la fonction <strong>[map]</strong> dont la syntaxe ici est <strong>[map (fonction, liste1)]</strong>. La fonction <strong>[fonction]</strong> est appliquée à chaque élément de <strong>[liste1]</strong> et produit un nouvel élément qui alimente une liste <strong>[liste2]</strong>. Finalement, pour chaque i :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">liste2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">fonction</span><span class="p">(</span><span class="n">liste1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Ici, <strong>[liste1]</strong> est la liste <strong>[taxPayers]</strong>, une liste d&#x27;objets de type <strong>[TaxPayer]</strong>. La fonction <strong>[fonction]</strong> est exprimée ici sous la forme d&#x27;une fonction dite <strong>[lambda]</strong> qui exprime la transformation faite sur un élément <strong>[taxpayer]</strong> de la liste <strong>[taxpayers]</strong> : chaque élément <strong>[taxpayer]</strong> est remplacé par son dictionnaire <strong>[taxpayer.asdict()]</strong>. Finalement, la liste <strong>[liste2]</strong> obtenue est la liste des dictionnaires des éléments de la liste <strong>[taxpayers]</strong> ;</p>
<ul>
<li>ligne 12 : le résultat rendu par la fonction <strong>[map]</strong> n&#x27;est pas la liste <strong>[liste2]</strong> mais un objet de type <strong>[map]</strong>. Pour avoir <strong>[liste2]</strong>, il faut utiliser l&#x27;expression <strong>[list(mapping)]</strong> (ligne 14) ;</li>
<li>ligne 14 : la liste <strong>[liste2]</strong> est enregistrée au format jSON dans le fichier <strong>[</strong><strong>self</strong><strong>.</strong><strong>taxpayers_results_filename</strong><strong>]</strong> ;</li>
<li>lignes 15-17 : tout type d&#x27;exception est intercepté et encapsulé dans une erreur de type <strong>[</strong><strong>ImpôtsError</strong><strong>]</strong> avant d&#x27;être relancé (ligne 17) ;</li>
<li>lignes 19-21 : dans tous les cas, réussite ou échec, le fichier des résultats est fermé s&#x27;il a été ouvert ;</li>
</ul>
<h4 id="15123-classe-impotsdaowithadmindatainjsonfile">15.1.2.3. Classe [ImpôtsDaoWithAdminDataInJsonFile]</h4>
<p>La classe <strong>[</strong><strong>ImpôtsDaoWithAdminDataInJsonFile</strong><strong>]</strong> va dériver de la classe <strong>[AbstractImpôtsDao]</strong> et implémenter la méthode <strong>[getAdminData]</strong> que sa classe parent n&#x27;a pas implémentée. Elle ira chercher les données de l&#x27;administration fiscale dans un fichier jSON :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>    <span class="s2">&quot;limites&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9964</span><span class="p">,</span> <span class="mi">27519</span><span class="p">,</span> <span class="mi">73779</span><span class="p">,</span> <span class="mi">156244</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>    <span class="s2">&quot;coeffr&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">],</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>    <span class="s2">&quot;coeffn&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1394.96</span><span class="p">,</span> <span class="mi">5798</span><span class="p">,</span> <span class="mf">13913.69</span><span class="p">,</span> <span class="mf">20163.45</span><span class="p">],</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>    <span class="s2">&quot;plafond_qf_demi_part&quot;</span><span class="p">:</span> <span class="mi">1551</span><span class="p">,</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>    <span class="s2">&quot;plafond_revenus_celibataire_pour_reduction&quot;</span><span class="p">:</span> <span class="mi">21037</span><span class="p">,</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>    <span class="s2">&quot;plafond_revenus_couple_pour_reduction&quot;</span><span class="p">:</span> <span class="mi">42074</span><span class="p">,</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>    <span class="s2">&quot;valeur_reduc_demi_part&quot;</span><span class="p">:</span> <span class="mi">3797</span><span class="p">,</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>    <span class="s2">&quot;plafond_decote_celibataire&quot;</span><span class="p">:</span> <span class="mi">1196</span><span class="p">,</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>    <span class="s2">&quot;plafond_decote_couple&quot;</span><span class="p">:</span> <span class="mi">1970</span><span class="p">,</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>    <span class="s2">&quot;plafond_impot_couple_pour_decote&quot;</span><span class="p">:</span> <span class="mi">2627</span><span class="p">,</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a>    <span class="s2">&quot;plafond_impot_celibataire_pour_decote&quot;</span><span class="p">:</span> <span class="mi">1595</span><span class="p">,</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>    <span class="s2">&quot;abattement_dixpourcent_max&quot;</span><span class="p">:</span> <span class="mi">12502</span><span class="p">,</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a>    <span class="s2">&quot;abattement_dixpourcent_min&quot;</span><span class="p">:</span> <span class="mi">437</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>La classe <strong>[</strong><strong>ImpôtsDaoWithAdminDataInJsonFile</strong><strong>]</strong> est la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span>
<span class="normal"><a href="#__codelineno-11-41">41</a></span>
<span class="normal"><a href="#__codelineno-11-42">42</a></span>
<span class="normal"><a href="#__codelineno-11-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># imports</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">codecs</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AbstractImpôtsDao</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbstractImpôtsDao</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AdminData</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdminData</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="c1"># une implémentation de la couche [dao] où les données de l&#39;administration fiscale sont dans un fichier jSON</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">ImpôtsDaoWithAdminDataInJsonFile</span><span class="p">(</span><span class="n">AbstractImpôtsDao</span><span class="p">):</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>    <span class="c1"># constructeur</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a>        <span class="c1"># config[admindataFilename] : le nom du fichier jSON contenant les données de l&#39;administration fiscale</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a>        <span class="c1"># config[taxpayersFilename] : le nom du fichier texte des contribuables</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a>        <span class="c1"># config[resultsFilename] : le nom du fichier jSON des résultats</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a>        <span class="c1"># config[errorsFilename] : le nom du fichier des erreurs</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a>        <span class="c1"># initialisation de la classe Parent</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a>        <span class="n">AbstractImpôtsDao</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a>        <span class="c1"># lecture des données de l&#39;administration fiscale</span>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a>        <span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a>            <span class="c1"># ouverture du fichier jSON des données fiscales en lecture</span>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a>            <span class="n">file</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;admindataFilename&quot;</span><span class="p">],</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
<a id="__codelineno-11-26" name="__codelineno-11-26"></a>            <span class="c1"># transfert du contenu du fichier jSON dans un objet [AdminData]</span>
<a id="__codelineno-11-27" name="__codelineno-11-27"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span> <span class="o">=</span> <span class="n">AdminData</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
<a id="__codelineno-11-28" name="__codelineno-11-28"></a>        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-11-29" name="__codelineno-11-29"></a>            <span class="c1"># on relance l&#39;erreur sous la forme d&#39;un type [ImpôtsError]</span>
<a id="__codelineno-11-30" name="__codelineno-11-30"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-11-31" name="__codelineno-11-31"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-11-32" name="__codelineno-11-32"></a>            <span class="c1"># fermeture du fichier s&#39;il a été ouvert</span>
<a id="__codelineno-11-33" name="__codelineno-11-33"></a>            <span class="k">if</span> <span class="n">file</span><span class="p">:</span>
<a id="__codelineno-11-34" name="__codelineno-11-34"></a>                <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-11-35" name="__codelineno-11-35"></a>
<a id="__codelineno-11-36" name="__codelineno-11-36"></a>    <span class="c1"># -------------</span>
<a id="__codelineno-11-37" name="__codelineno-11-37"></a>    <span class="c1"># interface</span>
<a id="__codelineno-11-38" name="__codelineno-11-38"></a>    <span class="c1"># -------------</span>
<a id="__codelineno-11-39" name="__codelineno-11-39"></a>
<a id="__codelineno-11-40" name="__codelineno-11-40"></a>    <span class="c1"># récupération des données de l&#39;administration fiscale</span>
<a id="__codelineno-11-41" name="__codelineno-11-41"></a>    <span class="c1"># la méthode rend un objet [AdminData]</span>
<a id="__codelineno-11-42" name="__codelineno-11-42"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_admindata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdminData</span><span class="p">:</span>
<a id="__codelineno-11-43" name="__codelineno-11-43"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 11 : la classe <strong>[</strong><strong>ImpôtsDaoWithAdminDataInJsonFile</strong><strong>]</strong> hérite de la classe <strong>[</strong><strong>AbstractImpôtsDao</strong><strong>]</strong>. A ce titre elle implémente l&#x27;interface <strong>[</strong><strong>InterfaceImpôtsDao</strong><strong>]</strong> ;</li>
<li>ligne 13 : le constructeur reçoit en paramètre un dictionnaire contenant les informations des lignes 14-17 ;</li>
<li>ligne 20 : la classe parent est initialisée ;</li>
<li>ligne 24 : ouverture du fichier jSON des données de l&#x27;administration fiscale ;</li>
<li>ligne 25 : le fichier UTF-8 des données de l’administration fiscale est ouvert ;</li>
<li>ligne 27 : le contenu du fichier est lu et placé dans l’objet <strong>[</strong><strong>self</strong><strong>.admindata</strong><strong>]</strong> de type <strong>[AdminData]</strong>. Il faut que les clés du fichier jSON correspondent aux propriétés acceptées pour un objet <strong>[AdminData]</strong> sinon la méthode <strong>[fromdict]</strong> lancera une exception ;</li>
<li>lignes 28-30 : gestion des exceptions. Les exceptions qui peuvent se produire sont encapsulées dans un type <strong>[</strong><strong>ImpôtsError</strong><strong>]</strong> avant d&#x27;être relancées ;</li>
<li>lignes 32-34 : le fichier est fermé s&#x27;il a été ouvert ;</li>
<li>lignes 42-43 : implémentation de la méthode <strong>[</strong><strong>get_admindata</strong><strong>]</strong> de l&#x27;interface <strong>[InterfaceImpôtsDao]</strong> ;</li>
</ul>
<h3 id="1513-la-couche-metier">15.1.3. La couche [métier]</h3>
<h4 id="15131-linterface-interfaceimpotsmetier">15.1.3.1. L&#x27;interface [InterfaceImpôtsMétier]</h4>
<p>L&#x27;interface de la couche <strong>[métier]</strong> sera la suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># imports</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AdminData</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdminData</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="c1"># interface IImpôtsMétier</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">InterfaceImpôtsMétier</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>    <span class="c1"># calcul de l&#39;impôt pour 1 contribuable</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_tax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayer</span><span class="p">:</span> <span class="n">TaxPayer</span><span class="p">,</span> <span class="n">admindata</span><span class="p">:</span> <span class="n">AdminData</span><span class="p">):</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>l&#x27;interface <strong>[InterfaceImpôtsMétier]</strong> définit une unique méthode :</li>
<li>ligne 12 : la méthode <strong>[</strong><strong>calculate_tax</strong><strong>]</strong> permet de calculer l&#x27;impôt d&#x27;un unique contribuable <strong>[</strong><strong>taxpayer</strong><strong>]</strong>. <strong>[</strong><strong>admindata</strong><strong>]</strong> est l’objet <strong>[AdminData]</strong> encapsulant les données de l&#x27;administration fiscale ;</li>
<li>ligne 12 : la méthode <strong>[</strong><strong>calculate_tax</strong><strong>]</strong> ne rend pas de résultat. Les données obtenues (impôt, surcôte, décôte, réduction, taux) sont incluses dans le paramètre <strong>[taxpayer]</strong> : avant l&#x27;appel ces attributs sont vides, après l&#x27;appel ils ont été initialisés ;</li>
</ul>
<h4 id="15132-la-classe-impotsmetier">15.1.3.2. La classe [ImpôtsMétier]</h4>
<p>La classe <strong>[ImpôtsMétier]</strong> implémente l&#x27;interface <strong>[InterfaceImpôtsMétier]</strong> de la façon suivante :</p>
<p><img src="images/10000000000003DF0000039527DE6C80.png" style="width:11.45cm;height:10.6cm;" alt="Image" /></p>
<p>Les méthodes de la classe sont issues du module <strong>[impôts_module_02]</strong> du paragraphe |<a href="#_Le_module_[impots.v02.modules.impôt"><u><u>Le module </u><u><strong>[impots.v02.modules.impôts_module_02]</strong></u></u></a>|. On a seulement limité les paramètres des méthodes à deux :</p>
<ul>
<li>taxpayer(id, marié, enfants, salaire, impôt, décôte, surcôte, réduction, taux) : l&#x27;objet représentant un contribuable et son impôt ;</li>
<li>admindata : l’objet encapsulant les données de l&#x27;administration fiscale ;
Nous montrons sur une méthode les changements ainsi apportés ;</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span>
<span class="normal"><a href="#__codelineno-13-31">31</a></span>
<span class="normal"><a href="#__codelineno-13-32">32</a></span>
<span class="normal"><a href="#__codelineno-13-33">33</a></span>
<span class="normal"><a href="#__codelineno-13-34">34</a></span>
<span class="normal"><a href="#__codelineno-13-35">35</a></span>
<span class="normal"><a href="#__codelineno-13-36">36</a></span>
<span class="normal"><a href="#__codelineno-13-37">37</a></span>
<span class="normal"><a href="#__codelineno-13-38">38</a></span>
<span class="normal"><a href="#__codelineno-13-39">39</a></span>
<span class="normal"><a href="#__codelineno-13-40">40</a></span>
<span class="normal"><a href="#__codelineno-13-41">41</a></span>
<span class="normal"><a href="#__codelineno-13-42">42</a></span>
<span class="normal"><a href="#__codelineno-13-43">43</a></span>
<span class="normal"><a href="#__codelineno-13-44">44</a></span>
<span class="normal"><a href="#__codelineno-13-45">45</a></span>
<span class="normal"><a href="#__codelineno-13-46">46</a></span>
<span class="normal"><a href="#__codelineno-13-47">47</a></span>
<span class="normal"><a href="#__codelineno-13-48">48</a></span>
<span class="normal"><a href="#__codelineno-13-49">49</a></span>
<span class="normal"><a href="#__codelineno-13-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a>    <span class="c1"># calcul de l&#39;impôt - phase 1</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>    <span class="c1"># ----------------------------------------</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_tax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayer</span><span class="p">:</span> <span class="n">TaxPayer</span><span class="p">,</span> <span class="n">admindata</span><span class="p">:</span> <span class="n">AdminData</span><span class="p">):</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>        <span class="c1"># taxpayer(id, marié, enfants, salaire, impôt, décôte, surcôte, réduction, taux)</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>        <span class="c1"># admindata : données de l&#39;administration fiscale</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>        <span class="c1"># calcul de l&#39;impôt avec enfants</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_tax_2</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>        <span class="c1"># les résultats sont dans taxpayer</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>        <span class="n">taux1</span> <span class="o">=</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a>        <span class="n">surcôte1</span> <span class="o">=</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>        <span class="n">impot1</span> <span class="o">=</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a>        <span class="c1"># calcul de l&#39;impôt sans les enfants</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a>        <span class="k">if</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">enfants</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a>            <span class="c1"># calcul de l&#39;impôt pour le même contribuable sans enfants</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a>            <span class="n">taxpayer2</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>                <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">marié</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">salaire</span><span class="p">})</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">calculate_tax_2</span><span class="p">(</span><span class="n">taxpayer2</span><span class="p">,</span> <span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a>            <span class="c1"># les résultats sont dans taxpayer2</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a>            <span class="n">taux2</span> <span class="o">=</span> <span class="n">taxpayer2</span><span class="o">.</span><span class="n">taux</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a>            <span class="n">surcôte2</span> <span class="o">=</span> <span class="n">taxpayer2</span><span class="o">.</span><span class="n">surcôte</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a>            <span class="n">impot2</span> <span class="o">=</span> <span class="n">taxpayer2</span><span class="o">.</span><span class="n">impôt</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a>            <span class="c1"># application du plafonnement du quotient familial</span>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a>            <span class="k">if</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">enfants</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a>                <span class="c1"># PLAFOND_QF_DEMI_PART euros pour les 2 premiers enfants</span>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a>                <span class="n">impot2</span> <span class="o">=</span> <span class="n">impot2</span> <span class="o">-</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">enfants</span> <span class="o">*</span> <span class="n">admindata</span><span class="o">.</span><span class="n">plafond_qf_demi_part</span>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a>                <span class="c1"># PLAFOND_QF_DEMI_PART euros pour les 2 premiers enfants, le double pour les suivants</span>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a>                <span class="n">impot2</span> <span class="o">=</span> <span class="n">impot2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">admindata</span><span class="o">.</span><span class="n">plafond_qf_demi_part</span> <span class="o">-</span> <span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">enfants</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> \
<a id="__codelineno-13-30" name="__codelineno-13-30"></a>                         <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">admindata</span><span class="o">.</span><span class="n">plafond_qf_demi_part</span>
<a id="__codelineno-13-31" name="__codelineno-13-31"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-13-32" name="__codelineno-13-32"></a>            <span class="c1"># si le contribuable n&#39;a pas d&#39;enfants alors impot2=impot1</span>
<a id="__codelineno-13-33" name="__codelineno-13-33"></a>            <span class="n">impot2</span> <span class="o">=</span> <span class="n">impot1</span>
<a id="__codelineno-13-34" name="__codelineno-13-34"></a>
<a id="__codelineno-13-35" name="__codelineno-13-35"></a>        <span class="c1"># on prend l&#39;impôt le plus fort avec le taux et la surcôte qui vont avec</span>
<a id="__codelineno-13-36" name="__codelineno-13-36"></a>        <span class="p">(</span><span class="n">impot</span><span class="p">,</span> <span class="n">surcôte</span><span class="p">,</span> <span class="n">taux</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">impot1</span><span class="p">,</span> <span class="n">surcôte1</span><span class="p">,</span> <span class="n">taux1</span><span class="p">)</span> <span class="k">if</span> <span class="n">impot1</span> <span class="o">&gt;=</span> <span class="n">impot2</span> <span class="k">else</span> <span class="p">(</span>
<a id="__codelineno-13-37" name="__codelineno-13-37"></a>            <span class="n">impot2</span><span class="p">,</span> <span class="n">impot2</span> <span class="o">-</span> <span class="n">impot1</span> <span class="o">+</span> <span class="n">surcôte2</span><span class="p">,</span> <span class="n">taux2</span><span class="p">)</span>
<a id="__codelineno-13-38" name="__codelineno-13-38"></a>
<a id="__codelineno-13-39" name="__codelineno-13-39"></a>        <span class="c1"># résultats partiels</span>
<a id="__codelineno-13-40" name="__codelineno-13-40"></a>        <span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span> <span class="o">=</span> <span class="n">impot</span>
<a id="__codelineno-13-41" name="__codelineno-13-41"></a>        <span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span> <span class="o">=</span> <span class="n">surcôte</span>
<a id="__codelineno-13-42" name="__codelineno-13-42"></a>        <span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span> <span class="o">=</span> <span class="n">taux</span>
<a id="__codelineno-13-43" name="__codelineno-13-43"></a>        <span class="c1"># calcul d&#39;une éventuelle décôte</span>
<a id="__codelineno-13-44" name="__codelineno-13-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_décôte</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-13-45" name="__codelineno-13-45"></a>        <span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span> <span class="o">-=</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span>
<a id="__codelineno-13-46" name="__codelineno-13-46"></a>        <span class="c1"># calcul d&#39;une éventuelle réduction d&#39;impôts</span>
<a id="__codelineno-13-47" name="__codelineno-13-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">get_réduction</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-13-48" name="__codelineno-13-48"></a>        <span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span> <span class="o">-=</span> <span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span>
<a id="__codelineno-13-49" name="__codelineno-13-49"></a>        <span class="c1"># résultat</span>
<a id="__codelineno-13-50" name="__codelineno-13-50"></a>        <span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 3: la méthode <strong>[calculate_tax]</strong> est l&#x27;unique méthode de l&#x27;interface <strong>[InterfaceImpôtsMétier]</strong>. Elle admet deux paramètres :</li>
<li><strong>[tapPayer]</strong> : le contribuable dont on calcule l&#x27;impôt ;</li>
<li><strong>[admindata]</strong> : l’objet encapsulant les données de l&#x27;administration fiscale ;</li>
<li>les résultats du calcul sont encapsulés dans le paramètre <strong>[taxpayer]</strong> (lignes 40-50). Le contenu de cet objet n&#x27;est donc pas le même avant et après l&#x27;appel à la méthode ;</li>
</ul>
<h3 id="1514-tests-des-couches-dao-et-metier">15.1.4. Tests des couches [dao] et [métier]</h3>
<p><img src="images/1000000000000170000002065376CC8F.png" style="width:4.25cm;height:5.991cm;" alt="Image" /></p>
<ul>
<li><strong>[TestDaoMétier]</strong> est la classe UnitTest de test des couches <strong>[dao]</strong> et <strong>[métier]</strong> ;</li>
<li><strong>[config]</strong> est le fichier de configuration des tests ; 
La configuration <strong>[config]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span>
<span class="normal"><a href="#__codelineno-14-32">32</a></span>
<span class="normal"><a href="#__codelineno-14-33">33</a></span>
<span class="normal"><a href="#__codelineno-14-34">34</a></span>
<span class="normal"><a href="#__codelineno-14-35">35</a></span>
<span class="normal"><a href="#__codelineno-14-36">36</a></span>
<span class="normal"><a href="#__codelineno-14-37">37</a></span>
<span class="normal"><a href="#__codelineno-14-38">38</a></span>
<span class="normal"><a href="#__codelineno-14-39">39</a></span>
<span class="normal"><a href="#__codelineno-14-40">40</a></span>
<span class="normal"><a href="#__codelineno-14-41">41</a></span>
<span class="normal"><a href="#__codelineno-14-42">42</a></span>
<span class="normal"><a href="#__codelineno-14-43">43</a></span>
<span class="normal"><a href="#__codelineno-14-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">():</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>    <span class="c1"># étape 1 ------</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>    <span class="c1"># configuration du python Path</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>    <span class="c1"># dossier de ce fichier</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>    <span class="c1"># root_dir</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>    <span class="n">root_dir</span> <span class="o">=</span> <span class="s2">&quot;C:/Data/st-2020/dev/python/cours-2020/python3-flask-2020/classes&quot;</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>    <span class="c1"># dépendances absolues de l&#39;application</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../entities&quot;</span><span class="p">,</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../interfaces&quot;</span><span class="p">,</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../services&quot;</span><span class="p">,</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/02/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a>    <span class="p">]</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>    <span class="c1"># on fixe le syspath</span>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a>    <span class="c1"># étape 2 ------</span>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a>    <span class="c1"># configuration de l&#39;application</span>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a>        <span class="c1"># chemins absolus des fichiers de l&#39;application</span>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a>        <span class="s2">&quot;admindataFilename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../data/input/admindata.json&quot;</span>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a>    <span class="p">}</span>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a>    <span class="c1"># instanciation des couches de l&#39;application</span>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsDaoWithAdminDataInJsonFile</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsDaoWithAdminDataInJsonFile</span>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsMétier</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsMétier</span>
<a id="__codelineno-14-35" name="__codelineno-14-35"></a>
<a id="__codelineno-14-36" name="__codelineno-14-36"></a>    <span class="n">dao</span> <span class="o">=</span> <span class="n">ImpôtsDaoWithAdminDataInJsonFile</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-14-37" name="__codelineno-14-37"></a>    <span class="n">métier</span> <span class="o">=</span> <span class="n">ImpôtsMétier</span><span class="p">()</span>
<a id="__codelineno-14-38" name="__codelineno-14-38"></a>
<a id="__codelineno-14-39" name="__codelineno-14-39"></a>    <span class="c1"># on met les instances de couches dans la config</span>
<a id="__codelineno-14-40" name="__codelineno-14-40"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;dao&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dao</span>
<a id="__codelineno-14-41" name="__codelineno-14-41"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;métier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">métier</span>
<a id="__codelineno-14-42" name="__codelineno-14-42"></a>
<a id="__codelineno-14-43" name="__codelineno-14-43"></a>    <span class="c1"># on rend la config</span>
<a id="__codelineno-14-44" name="__codelineno-14-44"></a>    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 4-23 : on configure le Python Path des tests ;</li>
<li>lignes 32-41 : on instancie les couches <strong>[dao]</strong> et <strong>[métier]</strong>. On met leurs références dans le dictionnaire <strong>[config]</strong> ;</li>
<li>ligne 44 : on rend ce dictionnaire ;
La classe de test <strong>[</strong><strong>TestDaoMétier</strong><strong>]</strong> est la suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">  1</a></span>
<span class="normal"><a href="#__codelineno-15-2">  2</a></span>
<span class="normal"><a href="#__codelineno-15-3">  3</a></span>
<span class="normal"><a href="#__codelineno-15-4">  4</a></span>
<span class="normal"><a href="#__codelineno-15-5">  5</a></span>
<span class="normal"><a href="#__codelineno-15-6">  6</a></span>
<span class="normal"><a href="#__codelineno-15-7">  7</a></span>
<span class="normal"><a href="#__codelineno-15-8">  8</a></span>
<span class="normal"><a href="#__codelineno-15-9">  9</a></span>
<span class="normal"><a href="#__codelineno-15-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-15-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-15-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-15-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-15-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-15-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-15-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-15-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-15-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-15-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-15-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-15-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-15-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-15-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-15-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-15-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-15-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-15-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-15-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-15-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-15-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-15-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-15-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-15-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-15-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-15-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-15-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-15-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-15-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-15-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-15-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-15-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-15-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-15-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-15-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-15-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-15-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-15-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-15-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-15-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-15-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-15-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-15-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-15-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-15-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-15-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-15-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-15-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-15-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-15-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-15-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-15-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-15-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-15-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-15-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-15-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-15-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-15-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-15-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-15-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-15-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-15-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-15-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-15-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-15-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-15-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-15-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-15-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-15-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-15-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-15-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-15-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-15-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-15-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-15-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-15-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-15-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-15-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-15-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-15-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-15-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-15-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-15-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-15-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-15-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-15-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-15-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-15-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-15-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-15-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-15-100">100</a></span>
<span class="normal"><a href="#__codelineno-15-101">101</a></span>
<span class="normal"><a href="#__codelineno-15-102">102</a></span>
<span class="normal"><a href="#__codelineno-15-103">103</a></span>
<span class="normal"><a href="#__codelineno-15-104">104</a></span>
<span class="normal"><a href="#__codelineno-15-105">105</a></span>
<span class="normal"><a href="#__codelineno-15-106">106</a></span>
<span class="normal"><a href="#__codelineno-15-107">107</a></span>
<span class="normal"><a href="#__codelineno-15-108">108</a></span>
<span class="normal"><a href="#__codelineno-15-109">109</a></span>
<span class="normal"><a href="#__codelineno-15-110">110</a></span>
<span class="normal"><a href="#__codelineno-15-111">111</a></span>
<span class="normal"><a href="#__codelineno-15-112">112</a></span>
<span class="normal"><a href="#__codelineno-15-113">113</a></span>
<span class="normal"><a href="#__codelineno-15-114">114</a></span>
<span class="normal"><a href="#__codelineno-15-115">115</a></span>
<span class="normal"><a href="#__codelineno-15-116">116</a></span>
<span class="normal"><a href="#__codelineno-15-117">117</a></span>
<span class="normal"><a href="#__codelineno-15-118">118</a></span>
<span class="normal"><a href="#__codelineno-15-119">119</a></span>
<span class="normal"><a href="#__codelineno-15-120">120</a></span>
<span class="normal"><a href="#__codelineno-15-121">121</a></span>
<span class="normal"><a href="#__codelineno-15-122">122</a></span>
<span class="normal"><a href="#__codelineno-15-123">123</a></span>
<span class="normal"><a href="#__codelineno-15-124">124</a></span>
<span class="normal"><a href="#__codelineno-15-125">125</a></span>
<span class="normal"><a href="#__codelineno-15-126">126</a></span>
<span class="normal"><a href="#__codelineno-15-127">127</a></span>
<span class="normal"><a href="#__codelineno-15-128">128</a></span>
<span class="normal"><a href="#__codelineno-15-129">129</a></span>
<span class="normal"><a href="#__codelineno-15-130">130</a></span>
<span class="normal"><a href="#__codelineno-15-131">131</a></span>
<span class="normal"><a href="#__codelineno-15-132">132</a></span>
<span class="normal"><a href="#__codelineno-15-133">133</a></span>
<span class="normal"><a href="#__codelineno-15-134">134</a></span>
<span class="normal"><a href="#__codelineno-15-135">135</a></span>
<span class="normal"><a href="#__codelineno-15-136">136</a></span>
<span class="normal"><a href="#__codelineno-15-137">137</a></span>
<span class="normal"><a href="#__codelineno-15-138">138</a></span>
<span class="normal"><a href="#__codelineno-15-139">139</a></span>
<span class="normal"><a href="#__codelineno-15-140">140</a></span>
<span class="normal"><a href="#__codelineno-15-141">141</a></span>
<span class="normal"><a href="#__codelineno-15-142">142</a></span>
<span class="normal"><a href="#__codelineno-15-143">143</a></span>
<span class="normal"><a href="#__codelineno-15-144">144</a></span>
<span class="normal"><a href="#__codelineno-15-145">145</a></span>
<span class="normal"><a href="#__codelineno-15-146">146</a></span>
<span class="normal"><a href="#__codelineno-15-147">147</a></span>
<span class="normal"><a href="#__codelineno-15-148">148</a></span>
<span class="normal"><a href="#__codelineno-15-149">149</a></span>
<span class="normal"><a href="#__codelineno-15-150">150</a></span>
<span class="normal"><a href="#__codelineno-15-151">151</a></span>
<span class="normal"><a href="#__codelineno-15-152">152</a></span>
<span class="normal"><a href="#__codelineno-15-153">153</a></span>
<span class="normal"><a href="#__codelineno-15-154">154</a></span>
<span class="normal"><a href="#__codelineno-15-155">155</a></span>
<span class="normal"><a href="#__codelineno-15-156">156</a></span>
<span class="normal"><a href="#__codelineno-15-157">157</a></span>
<span class="normal"><a href="#__codelineno-15-158">158</a></span>
<span class="normal"><a href="#__codelineno-15-159">159</a></span>
<span class="normal"><a href="#__codelineno-15-160">160</a></span>
<span class="normal"><a href="#__codelineno-15-161">161</a></span>
<span class="normal"><a href="#__codelineno-15-162">162</a></span>
<span class="normal"><a href="#__codelineno-15-163">163</a></span>
<span class="normal"><a href="#__codelineno-15-164">164</a></span>
<span class="normal"><a href="#__codelineno-15-165">165</a></span>
<span class="normal"><a href="#__codelineno-15-166">166</a></span>
<span class="normal"><a href="#__codelineno-15-167">167</a></span>
<span class="normal"><a href="#__codelineno-15-168">168</a></span>
<span class="normal"><a href="#__codelineno-15-169">169</a></span>
<span class="normal"><a href="#__codelineno-15-170">170</a></span>
<span class="normal"><a href="#__codelineno-15-171">171</a></span>
<span class="normal"><a href="#__codelineno-15-172">172</a></span>
<span class="normal"><a href="#__codelineno-15-173">173</a></span>
<span class="normal"><a href="#__codelineno-15-174">174</a></span>
<span class="normal"><a href="#__codelineno-15-175">175</a></span>
<span class="normal"><a href="#__codelineno-15-176">176</a></span>
<span class="normal"><a href="#__codelineno-15-177">177</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">unittest</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_config</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>    <span class="c1"># configuration de l&#39;application</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>    <span class="c1"># on rend la configuration</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>    <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">TestDaoMétier</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a>    <span class="c1"># exécutée avant chaque méthode test_</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a>        <span class="c1"># on récupère la configuration des tests</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a>        <span class="n">config</span> <span class="o">=</span> <span class="n">get_config</span><span class="p">()</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>        <span class="c1"># on mémorise quelques informations</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;métier&#39;</span><span class="p">]</span>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;dao&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_admindata</span><span class="p">()</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_1</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a>        <span class="c1"># {&#39;marié&#39;: &#39;oui&#39;, &#39;enfants&#39;: 2, &#39;salaire&#39;: 55555,</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a>        <span class="c1"># &#39;impôt&#39;: 2814, &#39;surcôte&#39;: 0, &#39;décôte&#39;: 0, &#39;réduction&#39;: 0, &#39;taux&#39;: 0.14}</span>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">55555</span><span class="p">})</span>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a>        <span class="c1"># vérification</span>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">2815</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-30" name="__codelineno-15-30"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-31" name="__codelineno-15-31"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-32" name="__codelineno-15-32"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-33" name="__codelineno-15-33"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-34" name="__codelineno-15-34"></a>
<a id="__codelineno-15-35" name="__codelineno-15-35"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_2</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-36" name="__codelineno-15-36"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-37" name="__codelineno-15-37"></a>
<a id="__codelineno-15-38" name="__codelineno-15-38"></a>        <span class="c1"># {&#39;marié&#39;: &#39;oui&#39;, &#39;enfants&#39;: 2, &#39;salaire&#39;: 50000,</span>
<a id="__codelineno-15-39" name="__codelineno-15-39"></a>        <span class="c1"># &#39;impôt&#39;: 1384, &#39;surcôte&#39;: 0, &#39;décôte&#39;: 384, &#39;réduction&#39;: 347, &#39;taux&#39;: 0.14}</span>
<a id="__codelineno-15-40" name="__codelineno-15-40"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">})</span>
<a id="__codelineno-15-41" name="__codelineno-15-41"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-42" name="__codelineno-15-42"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-15-43" name="__codelineno-15-43"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">1384</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-44" name="__codelineno-15-44"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-45" name="__codelineno-15-45"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-46" name="__codelineno-15-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-47" name="__codelineno-15-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-48" name="__codelineno-15-48"></a>
<a id="__codelineno-15-49" name="__codelineno-15-49"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_3</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-50" name="__codelineno-15-50"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-51" name="__codelineno-15-51"></a>
<a id="__codelineno-15-52" name="__codelineno-15-52"></a>        <span class="c1"># {&#39;marié&#39;: &#39;oui&#39;, &#39;enfants&#39;: 3, &#39;salaire&#39;: 50000,</span>
<a id="__codelineno-15-53" name="__codelineno-15-53"></a>        <span class="c1"># &#39;impôt&#39;: 0, &#39;surcôte&#39;: 0, &#39;décôte&#39;: 720, &#39;réduction&#39;: 0, &#39;taux&#39;: 0.14}</span>
<a id="__codelineno-15-54" name="__codelineno-15-54"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">})</span>
<a id="__codelineno-15-55" name="__codelineno-15-55"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-56" name="__codelineno-15-56"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-15-57" name="__codelineno-15-57"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-58" name="__codelineno-15-58"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-59" name="__codelineno-15-59"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-60" name="__codelineno-15-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-61" name="__codelineno-15-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-62" name="__codelineno-15-62"></a>
<a id="__codelineno-15-63" name="__codelineno-15-63"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_4</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-64" name="__codelineno-15-64"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-65" name="__codelineno-15-65"></a>
<a id="__codelineno-15-66" name="__codelineno-15-66"></a>        <span class="c1"># {&#39;marié&#39;: &#39;non&#39;, &#39;enfants&#39;: 2, &#39;salaire&#39;: 100000,</span>
<a id="__codelineno-15-67" name="__codelineno-15-67"></a>        <span class="c1"># &#39;impôt&#39;: 19884, &#39;surcôte&#39;: 4480, &#39;décôte&#39;: 0, &#39;réduction&#39;: 0, &#39;taux&#39;: 0.41}</span>
<a id="__codelineno-15-68" name="__codelineno-15-68"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">})</span>
<a id="__codelineno-15-69" name="__codelineno-15-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-70" name="__codelineno-15-70"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-15-71" name="__codelineno-15-71"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">19884</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-72" name="__codelineno-15-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-73" name="__codelineno-15-73"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-74" name="__codelineno-15-74"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-75" name="__codelineno-15-75"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">4480</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-76" name="__codelineno-15-76"></a>
<a id="__codelineno-15-77" name="__codelineno-15-77"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_5</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-78" name="__codelineno-15-78"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-79" name="__codelineno-15-79"></a>
<a id="__codelineno-15-80" name="__codelineno-15-80"></a>        <span class="c1"># {&#39;marié&#39;: &#39;non&#39;, &#39;enfants&#39;: 3, &#39;salaire&#39;: 100000,</span>
<a id="__codelineno-15-81" name="__codelineno-15-81"></a>        <span class="c1"># &#39;impôt&#39;: 16782, &#39;surcôte&#39;: 7176, &#39;décôte&#39;: 0, &#39;réduction&#39;: 0, &#39;taux&#39;: 0.41}</span>
<a id="__codelineno-15-82" name="__codelineno-15-82"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">})</span>
<a id="__codelineno-15-83" name="__codelineno-15-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-84" name="__codelineno-15-84"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-15-85" name="__codelineno-15-85"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">16782</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-86" name="__codelineno-15-86"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-87" name="__codelineno-15-87"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-88" name="__codelineno-15-88"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-89" name="__codelineno-15-89"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">7176</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-90" name="__codelineno-15-90"></a>
<a id="__codelineno-15-91" name="__codelineno-15-91"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_6</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-92" name="__codelineno-15-92"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-93" name="__codelineno-15-93"></a>
<a id="__codelineno-15-94" name="__codelineno-15-94"></a>        <span class="c1"># {&#39;marié&#39;: &#39;oui&#39;, &#39;enfants&#39;: 3, &#39;salaire&#39;: 100000,</span>
<a id="__codelineno-15-95" name="__codelineno-15-95"></a>        <span class="c1"># &#39;impôt&#39;: 9200, &#39;surcôte&#39;: 2180, &#39;décôte&#39;: 0, &#39;réduction&#39;: 0, &#39;taux&#39;: 0.3}</span>
<a id="__codelineno-15-96" name="__codelineno-15-96"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">})</span>
<a id="__codelineno-15-97" name="__codelineno-15-97"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-98" name="__codelineno-15-98"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-15-99" name="__codelineno-15-99"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">9200</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-100" name="__codelineno-15-100"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-101" name="__codelineno-15-101"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-102" name="__codelineno-15-102"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-103" name="__codelineno-15-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">2180</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-104" name="__codelineno-15-104"></a>
<a id="__codelineno-15-105" name="__codelineno-15-105"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_7</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-106" name="__codelineno-15-106"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-107" name="__codelineno-15-107"></a>
<a id="__codelineno-15-108" name="__codelineno-15-108"></a>        <span class="c1"># {&#39;marié&#39;: &#39;oui&#39;, &#39;enfants&#39;: 5, &#39;salaire&#39;: 100000,</span>
<a id="__codelineno-15-109" name="__codelineno-15-109"></a>        <span class="c1"># &#39;impôt&#39;: 4230, &#39;surcôte&#39;: 0, &#39;décôte&#39;: 0, &#39;réduction&#39;: 0, &#39;taux&#39;: 0.14}</span>
<a id="__codelineno-15-110" name="__codelineno-15-110"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">})</span>
<a id="__codelineno-15-111" name="__codelineno-15-111"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-112" name="__codelineno-15-112"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-15-113" name="__codelineno-15-113"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">4230</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-114" name="__codelineno-15-114"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-115" name="__codelineno-15-115"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-116" name="__codelineno-15-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-117" name="__codelineno-15-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-118" name="__codelineno-15-118"></a>
<a id="__codelineno-15-119" name="__codelineno-15-119"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_8</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-120" name="__codelineno-15-120"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-121" name="__codelineno-15-121"></a>
<a id="__codelineno-15-122" name="__codelineno-15-122"></a>        <span class="c1"># {&#39;marié&#39;: &#39;non&#39;, &#39;enfants&#39;: 0, &#39;salaire&#39;: 100000,</span>
<a id="__codelineno-15-123" name="__codelineno-15-123"></a>        <span class="c1"># &#39;impôt&#39;: 22986, &#39;surcôte&#39;: 0, &#39;décôte&#39;: 0, &#39;réduction&#39;: 0, &#39;taux&#39;: 0.41}</span>
<a id="__codelineno-15-124" name="__codelineno-15-124"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">})</span>
<a id="__codelineno-15-125" name="__codelineno-15-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-126" name="__codelineno-15-126"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-15-127" name="__codelineno-15-127"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">22986</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-128" name="__codelineno-15-128"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-129" name="__codelineno-15-129"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-130" name="__codelineno-15-130"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-131" name="__codelineno-15-131"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-132" name="__codelineno-15-132"></a>
<a id="__codelineno-15-133" name="__codelineno-15-133"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_9</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-134" name="__codelineno-15-134"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-135" name="__codelineno-15-135"></a>
<a id="__codelineno-15-136" name="__codelineno-15-136"></a>        <span class="c1"># {&#39;marié&#39;: &#39;oui&#39;, &#39;enfants&#39;: 2, &#39;salaire&#39;: 30000,</span>
<a id="__codelineno-15-137" name="__codelineno-15-137"></a>        <span class="c1"># &#39;impôt&#39;: 0, &#39;surcôte&#39;: 0, &#39;décôte&#39;: 0, &#39;réduction&#39;: 0, &#39;taux&#39;: 0}</span>
<a id="__codelineno-15-138" name="__codelineno-15-138"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">})</span>
<a id="__codelineno-15-139" name="__codelineno-15-139"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-140" name="__codelineno-15-140"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-15-141" name="__codelineno-15-141"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-142" name="__codelineno-15-142"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-143" name="__codelineno-15-143"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-144" name="__codelineno-15-144"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-145" name="__codelineno-15-145"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-146" name="__codelineno-15-146"></a>
<a id="__codelineno-15-147" name="__codelineno-15-147"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_10</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-148" name="__codelineno-15-148"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-149" name="__codelineno-15-149"></a>
<a id="__codelineno-15-150" name="__codelineno-15-150"></a>        <span class="c1"># {&#39;marié&#39;: &#39;non&#39;, &#39;enfants&#39;: 0, &#39;salaire&#39;: 200000,</span>
<a id="__codelineno-15-151" name="__codelineno-15-151"></a>        <span class="c1"># &#39;impôt&#39;: 64210, &#39;surcôte&#39;: 7498, &#39;décôte&#39;: 0, &#39;réduction&#39;: 0, &#39;taux&#39;: 0.45}</span>
<a id="__codelineno-15-152" name="__codelineno-15-152"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">})</span>
<a id="__codelineno-15-153" name="__codelineno-15-153"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-154" name="__codelineno-15-154"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-15-155" name="__codelineno-15-155"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">64210</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-156" name="__codelineno-15-156"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-157" name="__codelineno-15-157"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-158" name="__codelineno-15-158"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-159" name="__codelineno-15-159"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">7498</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-160" name="__codelineno-15-160"></a>
<a id="__codelineno-15-161" name="__codelineno-15-161"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">test_11</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-15-162" name="__codelineno-15-162"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-15-163" name="__codelineno-15-163"></a>
<a id="__codelineno-15-164" name="__codelineno-15-164"></a>        <span class="c1"># {&#39;marié&#39;: &#39;oui&#39;, &#39;enfants&#39;: 3, &#39;salaire&#39;: 200000,</span>
<a id="__codelineno-15-165" name="__codelineno-15-165"></a>        <span class="c1"># &#39;impôt&#39;: 42842, &#39;surcôte&#39;: 17283, &#39;décôte&#39;: 0, &#39;réduction&#39;: 0, &#39;taux&#39;: 0.41}</span>
<a id="__codelineno-15-166" name="__codelineno-15-166"></a>        <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">})</span>
<a id="__codelineno-15-167" name="__codelineno-15-167"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-15-168" name="__codelineno-15-168"></a>        <span class="c1"># vérifications</span>
<a id="__codelineno-15-169" name="__codelineno-15-169"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">impôt</span><span class="p">,</span> <span class="mi">42842</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-170" name="__codelineno-15-170"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">décôte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-171" name="__codelineno-15-171"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">réduction</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-15-172" name="__codelineno-15-172"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">taux</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<a id="__codelineno-15-173" name="__codelineno-15-173"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">taxpayer</span><span class="o">.</span><span class="n">surcôte</span><span class="p">,</span> <span class="mi">17283</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-15-174" name="__codelineno-15-174"></a>
<a id="__codelineno-15-175" name="__codelineno-15-175"></a>
<a id="__codelineno-15-176" name="__codelineno-15-176"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-15-177" name="__codelineno-15-177"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 11 : la classe de test étend la classe <strong>[unittest</strong><strong>.</strong><strong>TestCase</strong><strong>]</strong> ;</li>
<li>lignes 13-19 : dans un test UnitTest, la méthode <strong>[setUp]</strong> est exécutée avant chacune des méthodes <strong>[test_]</strong> ;</li>
<li>ligne 16 : on récupère la configuration issue du script <strong>[config]</strong> étudié précédemment ;</li>
<li>ligne 18 : on mémorise une référence sur la couche <strong>[métier]</strong> ;</li>
<li>ligne 19 : on demande à la couche <strong>[dao]</strong> l’objet <strong>[AdminData]</strong> encapsulant les données de l’administration fiscale et on le mémorise ;</li>
<li>lignes 21-173 : 11 tests dont les résultats ont été vérifiés sur le site officiel des impôts 2019 |<a href="https://www3.impots.gouv.fr/simulateur/calcul_impot/2019/simplifie/index.htm"><u><u>https://www3.impots.gouv.fr/simulateur/calcul_impot/2019/simplifie/index.htm</u></u></a>| ;</li>
<li>lignes 21-33 : tous les tests ont été construits sur le même modèle ;</li>
<li>ligne 22 : on importe la classe <strong>[TaxPayer]</strong> ;</li>
<li>ligne 24 : contribuable testé ;</li>
<li>ligne 25 : résultats attendus ;</li>
<li>ligne 26 : construction de l’objet <strong>[TaxPayer]</strong> du contribuable ;</li>
<li>ligne 27 : calcul de son impôt. Le résultat est dans <strong>[taxpayer]</strong> ;</li>
<li>lignes 29-33 : vérification des résultats obtenus ;</li>
<li>ligne 29 : on vérifie le montant de l’impôt à l’euro près. Les tests ont en effet montré que les résultats obtenus par l’algorithme de ce document pouvaient différer des chiffres officiels au plus d’un montant de 1 euro ;
L’exécution des tests donne les résultats suivants :</li>
</ul>
<p><img src="images/1000000000000260000002BB45DA0CBB.png" style="width:7.021cm;height:8.071cm;" alt="Image" /></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="n">Testing</span> <span class="n">started</span> <span class="n">at</span> <span class="mi">16</span><span class="p">:</span><span class="mi">08</span> <span class="o">...</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="s2">&quot;C:\Program Files\JetBrains\PyCharm Community Edition 2020.1.2\plugins\python-ce\helpers\pycharm\_jb_unittest_runner.py&quot;</span> <span class="o">--</span><span class="n">path</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">impots</span><span class="o">/</span><span class="n">v04</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">TestDaoMétier</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="n">Launching</span> <span class="n">unittests</span> <span class="k">with</span> <span class="n">arguments</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">unittest</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">impots</span><span class="o">/</span><span class="n">v04</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">TestDaoMétier</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">impots</span>\<span class="n">v04</span>\<span class="n">tests</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="n">Ran</span> <span class="mi">11</span> <span class="n">tests</span> <span class="ow">in</span> <span class="mf">0.055</span><span class="n">s</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="n">OK</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
<h3 id="1515-script-principal">15.1.5. Script principal</h3>
<p><img src="images/10000000000001B20000027E72AAE6FF.png" style="width:5.01cm;height:7.37cm;" alt="Image" /></p>
<p>Le script principal est configuré par le script <strong>[config]</strong> suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span>
<span class="normal"><a href="#__codelineno-17-26">26</a></span>
<span class="normal"><a href="#__codelineno-17-27">27</a></span>
<span class="normal"><a href="#__codelineno-17-28">28</a></span>
<span class="normal"><a href="#__codelineno-17-29">29</a></span>
<span class="normal"><a href="#__codelineno-17-30">30</a></span>
<span class="normal"><a href="#__codelineno-17-31">31</a></span>
<span class="normal"><a href="#__codelineno-17-32">32</a></span>
<span class="normal"><a href="#__codelineno-17-33">33</a></span>
<span class="normal"><a href="#__codelineno-17-34">34</a></span>
<span class="normal"><a href="#__codelineno-17-35">35</a></span>
<span class="normal"><a href="#__codelineno-17-36">36</a></span>
<span class="normal"><a href="#__codelineno-17-37">37</a></span>
<span class="normal"><a href="#__codelineno-17-38">38</a></span>
<span class="normal"><a href="#__codelineno-17-39">39</a></span>
<span class="normal"><a href="#__codelineno-17-40">40</a></span>
<span class="normal"><a href="#__codelineno-17-41">41</a></span>
<span class="normal"><a href="#__codelineno-17-42">42</a></span>
<span class="normal"><a href="#__codelineno-17-43">43</a></span>
<span class="normal"><a href="#__codelineno-17-44">44</a></span>
<span class="normal"><a href="#__codelineno-17-45">45</a></span>
<span class="normal"><a href="#__codelineno-17-46">46</a></span>
<span class="normal"><a href="#__codelineno-17-47">47</a></span>
<span class="normal"><a href="#__codelineno-17-48">48</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">():</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>    <span class="c1"># étape 1 ------</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>    <span class="c1"># configuration du python Path</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>    <span class="c1"># dossier de ce fichier</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>    <span class="c1"># root_dir</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>    <span class="n">root_dir</span> <span class="o">=</span> <span class="s2">&quot;C:/Data/st-2020/dev/python/cours-2020/python3-flask-2020/classes&quot;</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a>    <span class="c1"># dépendances de l&#39;application</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a>        <span class="c1"># dépendances locales</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../entities&quot;</span><span class="p">,</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../interfaces&quot;</span><span class="p">,</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../services&quot;</span><span class="p">,</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/02/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a>    <span class="p">]</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a>    <span class="c1"># on fixe le syspath</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a>    <span class="c1"># étape 2 ------</span>
<a id="__codelineno-17-27" name="__codelineno-17-27"></a>    <span class="c1"># configuration de l&#39;application</span>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-17-29" name="__codelineno-17-29"></a>        <span class="c1"># chemins absolus des fichiers de l&#39;application</span>
<a id="__codelineno-17-30" name="__codelineno-17-30"></a>        <span class="s2">&quot;taxpayersFilename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../data/input/taxpayersdata.txt&quot;</span><span class="p">,</span>
<a id="__codelineno-17-31" name="__codelineno-17-31"></a>        <span class="s2">&quot;resultsFilename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../data/output/résultats.json&quot;</span><span class="p">,</span>
<a id="__codelineno-17-32" name="__codelineno-17-32"></a>        <span class="s2">&quot;admindataFilename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../data/input/admindata.json&quot;</span><span class="p">,</span>
<a id="__codelineno-17-33" name="__codelineno-17-33"></a>        <span class="s2">&quot;errorsFilename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../data/output/errors.txt&quot;</span>
<a id="__codelineno-17-34" name="__codelineno-17-34"></a>    <span class="p">}</span>
<a id="__codelineno-17-35" name="__codelineno-17-35"></a>
<a id="__codelineno-17-36" name="__codelineno-17-36"></a>    <span class="c1"># instanciation des couches de l&#39;application</span>
<a id="__codelineno-17-37" name="__codelineno-17-37"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsDaoWithAdminDataInJsonFile</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsDaoWithAdminDataInJsonFile</span>
<a id="__codelineno-17-38" name="__codelineno-17-38"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsMétier</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsMétier</span>
<a id="__codelineno-17-39" name="__codelineno-17-39"></a>
<a id="__codelineno-17-40" name="__codelineno-17-40"></a>    <span class="n">dao</span> <span class="o">=</span> <span class="n">ImpôtsDaoWithAdminDataInJsonFile</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-17-41" name="__codelineno-17-41"></a>    <span class="n">métier</span> <span class="o">=</span> <span class="n">ImpôtsMétier</span><span class="p">()</span>
<a id="__codelineno-17-42" name="__codelineno-17-42"></a>
<a id="__codelineno-17-43" name="__codelineno-17-43"></a>    <span class="c1"># on met les instances de couches dans la config</span>
<a id="__codelineno-17-44" name="__codelineno-17-44"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;dao&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dao</span>
<a id="__codelineno-17-45" name="__codelineno-17-45"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;métier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">métier</span>
<a id="__codelineno-17-46" name="__codelineno-17-46"></a>
<a id="__codelineno-17-47" name="__codelineno-17-47"></a>    <span class="c1"># on rend la config</span>
<a id="__codelineno-17-48" name="__codelineno-17-48"></a>    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<p>Il est analogue à celui utilisé pour le test des couches <strong>[métier]</strong> et <strong>[dao]</strong>.</p>
<p>Le script principal <strong>[main.py]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span>
<span class="normal"><a href="#__codelineno-18-29">29</a></span>
<span class="normal"><a href="#__codelineno-18-30">30</a></span>
<span class="normal"><a href="#__codelineno-18-31">31</a></span>
<span class="normal"><a href="#__codelineno-18-32">32</a></span>
<span class="normal"><a href="#__codelineno-18-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="c1"># imports</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="c1"># on récupère les couches de l&#39;application (elles sont déjà instanciées)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="n">dao</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;dao&quot;</span><span class="p">]</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="n">métier</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;métier&quot;</span><span class="p">]</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>    <span class="c1"># récupération des tranches de l&#39;impôt</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>    <span class="n">admindata</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_admindata</span><span class="p">()</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>    <span class="c1"># lecture des données des contribuables</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a>    <span class="n">taxpayers</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_taxpayers_data</span><span class="p">()[</span><span class="s2">&quot;taxpayers&quot;</span><span class="p">]</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>    <span class="c1"># des contribuables ?</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">taxpayers</span><span class="p">:</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a>        <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Pas de contribuables valides dans le fichier </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;taxpayersFilename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a>    <span class="c1"># calcul de l&#39;impôt des contribuables</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a>    <span class="k">for</span> <span class="n">taxpayer</span> <span class="ow">in</span> <span class="n">taxpayers</span><span class="p">:</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a>        <span class="c1"># taxpayer est à la fois un paramètre d&#39;entrée et de sortie</span>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a>        <span class="c1"># taxpayer va être modifié</span>
<a id="__codelineno-18-25" name="__codelineno-18-25"></a>        <span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-18-26" name="__codelineno-18-26"></a>    <span class="c1"># écriture des résultats dans un fichier texte</span>
<a id="__codelineno-18-27" name="__codelineno-18-27"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">write_taxpayers_results</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">)</span>
<a id="__codelineno-18-28" name="__codelineno-18-28"></a><span class="k">except</span> <span class="n">ImpôtsError</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-18-29" name="__codelineno-18-29"></a>    <span class="c1"># affichage de l&#39;erreur</span>
<a id="__codelineno-18-30" name="__codelineno-18-30"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-18-31" name="__codelineno-18-31"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-18-32" name="__codelineno-18-32"></a>    <span class="c1"># terminé</span>
<a id="__codelineno-18-33" name="__codelineno-18-33"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Travail terminé...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p><strong>Notes</strong></p>
<ul>
<li>lignes 2-4 : on récupère la configuration de l’application. On sait également que le Python Path de l’application a été construit ;</li>
<li>lignes 9-11 : on récupère des références sur les couches <strong>[métier]</strong> et <strong>[dao]</strong> ;</li>
<li>ligne 15 : on obtient les données de l&#x27;administration fiscale ;</li>
<li>ligne 17 : on obtient la liste des contribuables dont il faut calculer l&#x27;impôt ;</li>
<li>lignes 19-20 : si cette liste est vide, on lève une exception ;</li>
<li>lignes 22-25 : calcul de l&#x27;impôt des différents objets <strong>[taxpayer]</strong> grâce à la couche <strong>[métier]</strong> ;</li>
<li>ligne 27 : <strong>[taxpayers]</strong> est désormais une liste d&#x27;objets <strong>[TaxPayer]</strong> où les attributs (impôt, décôte, surcôte, réduction, taux) ont reçu une valeur. Cette liste est écrite dans un fichier jSON ;</li>
<li>lignes 28-30 : interception d&#x27;une éventuelle erreur ;</li>
<li>lignes 31-33 : exécutées dans tous les cas ;
L’exécution du script donne les mêmes résultats que dans les versions précédentes. Le fichier des erreurs de contribuables était une nouveauté dans cette version. Après exécution du script <strong>[main]</strong> son contenu est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="n">Analyse</span> <span class="n">du</span> <span class="n">fichier</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">impots</span>\<span class="n">v04</span>\<span class="n">main</span>\<span class="mi">01</span><span class="o">/../../</span><span class="n">data</span><span class="o">/</span><span class="nb">input</span><span class="o">/</span><span class="n">taxpayersdata</span><span class="o">.</span><span class="n">txt</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="n">Ligne</span> <span class="mi">17</span><span class="p">,</span> <span class="ow">not</span> <span class="n">enough</span> <span class="n">values</span> <span class="n">to</span> <span class="n">unpack</span> <span class="p">(</span><span class="n">expected</span> <span class="mi">4</span><span class="p">,</span> <span class="n">got</span> <span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="n">Ligne</span> <span class="mi">19</span><span class="p">,</span> <span class="n">too</span> <span class="n">many</span> <span class="n">values</span> <span class="n">to</span> <span class="n">unpack</span> <span class="p">(</span><span class="n">expected</span> <span class="mi">4</span><span class="p">)</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="n">Ligne</span> <span class="mi">21</span><span class="p">,</span> <span class="n">MyException</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">L</span><span class="s1">&#39;identifiant d&#39;</span><span class="n">une</span> <span class="n">entité</span> <span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="err">&#39;</span><span class="nc">TaxPayer</span><span class="o">.</span><span class="n">TaxPayer</span><span class="s1">&#39;&gt; doit être un entier &gt;=0]</span>
</code></pre></div></td></tr></table></div>
<p>Les lignes erronées étaient les suivantes :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># données valides : id, marié, enfants, salaire</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="mi">1</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">55555</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="mi">2</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">50000</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="mi">3</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">50000</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="mi">4</span><span class="p">,</span><span class="n">non</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">100000</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="mi">5</span><span class="p">,</span><span class="n">non</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100000</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="mi">6</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">100000</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="mi">7</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">100000</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="mi">8</span><span class="p">,</span><span class="n">non</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100000</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="mi">9</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">30000</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="mi">10</span><span class="p">,</span><span class="n">non</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">200000</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="mi">11</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">200000</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="c1"># on peut avoir des lignes vides</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="c1"># on crée des lignes erronées</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="c1"># pas assez de valeurs</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="mi">11</span><span class="p">,</span><span class="mi">12</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="c1"># trop de valeurs</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="mi">12</span><span class="p">,</span><span class="n">oui</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">200000</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="c1"># des valeurs erronées</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span>
</code></pre></div></td></tr></table></div>
<h2 id="152-version-4-application-2">15.2. Version 4 – application 2</h2>
<p>Dans cette version, c&#x27;est l&#x27;utilisateur au clavier qui donne la liste des contribuables. L&#x27;architecture de l&#x27;application sera la suivante :</p>
<p><img src="images/1000000100000301000000E74B894567.png" style="width:10.381cm;height:3.111cm;" alt="Image" /></p>
<p>Un nouveau module apparaît : la couche <strong>[ui]</strong> (User Interface) qui va dialoguer avec l&#x27;utilisateur. Cette couche aura une interface et sera implémentée par une classe.</p>
<p><img src="images/10000000000002350000034FDD3FB621.png" style="width:5.871cm;height:8.801cm;" alt="Image" /></p>
<h3 id="1521-linterface-interfaceimpotsui">15.2.1. L&#x27;interface [InterfaceImpôtsUi]</h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="c1"># imports</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="c1"># interface InterfaceImpôtsUI</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">InterfaceImpôtsUi</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>    <span class="c1"># exécution de la classe implémentant l&#39;interface</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<p>L&#x27;interface <strong>[</strong><strong>InterfaceImpôtsUi</strong><strong>]</strong> n&#x27;aura qu&#x27;une méthode, celle des lignes 8-10. L&#x27;interface sera ici implémentée avec une application console mais on pourrait aussi l&#x27;implémenter avec une interface graphique. Les paramètres passés à la méthode <strong>[run]</strong> ne seraient pas les mêmes dans les deux implémentations. Pour contourner ce problème, la méthode habituelle est de :</p>
<ul>
<li>ne pas mettre de paramètres à la méthode <strong>[run]</strong> (ou le minimum de paramètres) ;</li>
<li>passer des paramètres au constructeur de la classe implémentant l&#x27;interface. Ils peuvent être différents d&#x27;une implémentation à l&#x27;autre. Ces paramètres sont enregistrés comme attributs de la classe ;</li>
<li>faire en sorte que la méthode <strong>[run]</strong> utilise ces attributs de classe (self.x) ;
Cette méthode permet d&#x27;avoir une interface très générale qui est précisée par les paramètres des constructeurs de chaque classe d&#x27;implémentation. Cette méthode a déjà été utilisée pour la version modulaire n° 1.</li>
</ul>
<h3 id="1522-la-classe-impotsconsole">15.2.2. La classe [ImpôtsConsole]</h3>
<p>La classe <strong>[</strong><strong>ImpôtsConsole</strong><strong>]</strong> implémente l&#x27;interface <strong>[</strong><strong>InterfaceImpôtsUi</strong><strong>]</strong> de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span>
<span class="normal"><a href="#__codelineno-22-27">27</a></span>
<span class="normal"><a href="#__codelineno-22-28">28</a></span>
<span class="normal"><a href="#__codelineno-22-29">29</a></span>
<span class="normal"><a href="#__codelineno-22-30">30</a></span>
<span class="normal"><a href="#__codelineno-22-31">31</a></span>
<span class="normal"><a href="#__codelineno-22-32">32</a></span>
<span class="normal"><a href="#__codelineno-22-33">33</a></span>
<span class="normal"><a href="#__codelineno-22-34">34</a></span>
<span class="normal"><a href="#__codelineno-22-35">35</a></span>
<span class="normal"><a href="#__codelineno-22-36">36</a></span>
<span class="normal"><a href="#__codelineno-22-37">37</a></span>
<span class="normal"><a href="#__codelineno-22-38">38</a></span>
<span class="normal"><a href="#__codelineno-22-39">39</a></span>
<span class="normal"><a href="#__codelineno-22-40">40</a></span>
<span class="normal"><a href="#__codelineno-22-41">41</a></span>
<span class="normal"><a href="#__codelineno-22-42">42</a></span>
<span class="normal"><a href="#__codelineno-22-43">43</a></span>
<span class="normal"><a href="#__codelineno-22-44">44</a></span>
<span class="normal"><a href="#__codelineno-22-45">45</a></span>
<span class="normal"><a href="#__codelineno-22-46">46</a></span>
<span class="normal"><a href="#__codelineno-22-47">47</a></span>
<span class="normal"><a href="#__codelineno-22-48">48</a></span>
<span class="normal"><a href="#__codelineno-22-49">49</a></span>
<span class="normal"><a href="#__codelineno-22-50">50</a></span>
<span class="normal"><a href="#__codelineno-22-51">51</a></span>
<span class="normal"><a href="#__codelineno-22-52">52</a></span>
<span class="normal"><a href="#__codelineno-22-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="c1"># imports</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceImpôtsUi</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceImpôtsUi</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">TaxPayer</span><span class="w"> </span><span class="kn">import</span> <span class="n">TaxPayer</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="c1"># couche [UI]</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">ImpôtsConsole</span><span class="p">(</span><span class="n">InterfaceImpôtsUi</span><span class="p">):</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a>    <span class="c1"># constructeur</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a>        <span class="c1"># on mémorise les paramètres</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;dao&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_admindata</span><span class="p">()</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">métier</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;métier&#39;</span><span class="p">]</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a>        <span class="c1"># dialogue interactif avec l&#39;utilisateur</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a>        <span class="n">fini</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">fini</span><span class="p">:</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a>            <span class="c1"># le contribuable est-il marié ?</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a>            <span class="n">marié</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Le contribuable est-il marié / pacsé (oui/non) (* pour arrêter) : &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a>            <span class="c1"># vérification de la validité de la saisie</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a>            <span class="k">while</span> <span class="n">marié</span> <span class="o">!=</span> <span class="s2">&quot;oui&quot;</span> <span class="ow">and</span> <span class="n">marié</span> <span class="o">!=</span> <span class="s2">&quot;non&quot;</span> <span class="ow">and</span> <span class="n">marié</span> <span class="o">!=</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a>                <span class="c1"># msg d&#39;erreur</span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tapez oui ou non ou *&quot;</span><span class="p">)</span>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a>                <span class="c1"># question de nouveau</span>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a>                <span class="n">marié</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Le contribuable est-il marié / pacsé (oui/non) (* pour arrêter) : &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-22-28" name="__codelineno-22-28"></a>            <span class="c1"># fini ?</span>
<a id="__codelineno-22-29" name="__codelineno-22-29"></a>            <span class="k">if</span> <span class="n">marié</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
<a id="__codelineno-22-30" name="__codelineno-22-30"></a>                <span class="c1"># dialogue terminé</span>
<a id="__codelineno-22-31" name="__codelineno-22-31"></a>                <span class="k">return</span>
<a id="__codelineno-22-32" name="__codelineno-22-32"></a>            <span class="c1"># nombre d&#39;enfants</span>
<a id="__codelineno-22-33" name="__codelineno-22-33"></a>            <span class="n">enfants</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Nombre d&#39;enfants : &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-22-34" name="__codelineno-22-34"></a>            <span class="c1"># vérification de la validité de la saisie</span>
<a id="__codelineno-22-35" name="__codelineno-22-35"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d+$&quot;</span><span class="p">,</span> <span class="n">enfants</span><span class="p">):</span>
<a id="__codelineno-22-36" name="__codelineno-22-36"></a>                <span class="c1"># msg d&#39;erreur</span>
<a id="__codelineno-22-37" name="__codelineno-22-37"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tapez un nombre entier positif ou nul&quot;</span><span class="p">)</span>
<a id="__codelineno-22-38" name="__codelineno-22-38"></a>                <span class="c1"># on recommence</span>
<a id="__codelineno-22-39" name="__codelineno-22-39"></a>                <span class="n">enfants</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Nombre d&#39;enfants : &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-22-40" name="__codelineno-22-40"></a>            <span class="c1"># salaire annuel</span>
<a id="__codelineno-22-41" name="__codelineno-22-41"></a>            <span class="n">salaire</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Salaire annuel : &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-22-42" name="__codelineno-22-42"></a>            <span class="c1"># vérification de la validité de la saisie</span>
<a id="__codelineno-22-43" name="__codelineno-22-43"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\d+$&quot;</span><span class="p">,</span> <span class="n">salaire</span><span class="p">):</span>
<a id="__codelineno-22-44" name="__codelineno-22-44"></a>                <span class="c1"># msg d&#39;erreur</span>
<a id="__codelineno-22-45" name="__codelineno-22-45"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tapez un nombre entier positif ou nul&quot;</span><span class="p">)</span>
<a id="__codelineno-22-46" name="__codelineno-22-46"></a>                <span class="c1"># on recommence</span>
<a id="__codelineno-22-47" name="__codelineno-22-47"></a>                <span class="n">salaire</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Salaire annuel : &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<a id="__codelineno-22-48" name="__codelineno-22-48"></a>            <span class="c1"># calcul de l&#39;impôt</span>
<a id="__codelineno-22-49" name="__codelineno-22-49"></a>            <span class="n">taxpayer</span> <span class="o">=</span> <span class="n">TaxPayer</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">({</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="n">marié</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">enfants</span><span class="p">),</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">salaire</span><span class="p">)})</span>
<a id="__codelineno-22-50" name="__codelineno-22-50"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-22-51" name="__codelineno-22-51"></a>            <span class="c1"># affichage</span>
<a id="__codelineno-22-52" name="__codelineno-22-52"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Impôt du contribuable = </span><span class="si">{</span><span class="n">taxpayer</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-22-53" name="__codelineno-22-53"></a>            <span class="c1"># contribuable suivant</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 9 : la classe <strong>[</strong><strong>ImpôtsConsole</strong><strong>]</strong> implémente l&#x27;interface <strong>[</strong><strong>InterfaceImpôtsUi</strong><strong>]</strong> ;</li>
<li>ligne 11 : le constructeur de la classe reçoit un paramètre, le dictionnaire <strong>[config]</strong>  de la configuration de l’application ;</li>
<li>ligne 13 : on récupère les données de l’administration fiscale permettant le calcul de l’impôt ;</li>
<li>ligne 14 : on mémorise une référence sur la couche <strong>[métier]</strong> ;</li>
<li>ligne 16 : implémentation de la méthode <strong>[run]</strong> de l&#x27;interface ;</li>
<li>lignes 19-53 : dialogue avec l&#x27;utilisateur. Il consiste</li>
<li>à demander les trois informations (marié, enfants, salaire) du contribuable ;</li>
<li>à calculer son impôt ;</li>
<li>à afficher celui-ci ;</li>
<li>le dialogue se termine lorsque l&#x27;utilisateur répond * à la première question ;</li>
<li>lignes 20-27 : on demande si le contribuable est marié et on vérifie la validité de la réponse ;</li>
<li>lignes 29-31 : si l’utilisateur a répondu ‘*’ à la question le dialogue est arrêté ;</li>
<li>lignes 32-39 : on demande le nombre d&#x27;enfants du contribuable et on vérifie la validité de la réponse ;</li>
<li>lignes 40-47 : on demande le salaire annuel du contribuable et on vérifie la validité de la réponse ;</li>
<li>lignes 48-50 : avec ces informations on fait calculer, par la couche <strong>[métier]</strong>, l&#x27;impôt du contribuable ;</li>
<li>ligne 52 : le montant de l&#x27;impôt est affiché ;</li>
</ul>
<h3 id="1523-le-script-principal">15.2.3. Le script principal</h3>
<p>Le script principal <strong>[main]</strong> est configuré par le fichier <strong>[config]</strong> suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span>
<span class="normal"><a href="#__codelineno-23-44">44</a></span>
<span class="normal"><a href="#__codelineno-23-45">45</a></span>
<span class="normal"><a href="#__codelineno-23-46">46</a></span>
<span class="normal"><a href="#__codelineno-23-47">47</a></span>
<span class="normal"><a href="#__codelineno-23-48">48</a></span>
<span class="normal"><a href="#__codelineno-23-49">49</a></span>
<span class="normal"><a href="#__codelineno-23-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">():</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>    <span class="c1"># étape 1 ------</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>    <span class="c1"># configuration du python Path</span>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>    <span class="c1"># dossier de ce fichier</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>    <span class="c1"># root_dir</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>    <span class="n">root_dir</span> <span class="o">=</span> <span class="s2">&quot;C:/Data/st-2020/dev/python/cours-2020/python3-flask-2020/classes&quot;</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a>    <span class="c1"># dépendances de l&#39;application</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>    <span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a>        <span class="c1"># dépendances locales</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../entities&quot;</span><span class="p">,</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../interfaces&quot;</span><span class="p">,</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../services&quot;</span><span class="p">,</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/02/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a>    <span class="p">]</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a>    <span class="c1"># on fixe le syspath</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">myutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">set_syspath</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a>    <span class="n">set_syspath</span><span class="p">(</span><span class="n">absolute_dependencies</span><span class="p">)</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a>    <span class="c1"># étape 2 ------</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a>    <span class="c1"># configuration de l&#39;application</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a>    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a>        <span class="c1"># chemins absolus des fichiers de l&#39;application</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a>        <span class="s2">&quot;admindataFilename&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../../data/input/admindata.json&quot;</span><span class="p">,</span>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a>    <span class="p">}</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>    <span class="c1"># instanciation des couches de l&#39;application</span>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsDaoWithAdminDataInJsonFile</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsDaoWithAdminDataInJsonFile</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsMétier</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsMétier</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsConsole</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsConsole</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a>    <span class="c1"># couche dao</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a>    <span class="n">dao</span> <span class="o">=</span> <span class="n">ImpôtsDaoWithAdminDataInJsonFile</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a>    <span class="c1"># couche métier</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a>    <span class="n">métier</span> <span class="o">=</span> <span class="n">ImpôtsMétier</span><span class="p">()</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a>    <span class="c1"># on met les instances de couches dans la config</span>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;dao&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dao</span>
<a id="__codelineno-23-44" name="__codelineno-23-44"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;métier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">métier</span>
<a id="__codelineno-23-45" name="__codelineno-23-45"></a>    <span class="c1"># couche ui</span>
<a id="__codelineno-23-46" name="__codelineno-23-46"></a>    <span class="n">ui</span> <span class="o">=</span> <span class="n">ImpôtsConsole</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-23-47" name="__codelineno-23-47"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;ui&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ui</span>
<a id="__codelineno-23-48" name="__codelineno-23-48"></a>
<a id="__codelineno-23-49" name="__codelineno-23-49"></a>    <span class="c1"># on rend la config</span>
<a id="__codelineno-23-50" name="__codelineno-23-50"></a>    <span class="k">return</span> <span class="n">config</span>
</code></pre></div></td></tr></table></div>
<p>Le script chef d&#x27;orchestre est le suivant (main.py) :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">()</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="c1"># imports</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="c1"># on récupère les couches de l&#39;application (elles sont déjà instanciées)</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="n">ui</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;ui&quot;</span><span class="p">]</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="c1"># code</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a>    <span class="c1"># exécution de la couche [ui]</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a>    <span class="n">ui</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="k">except</span> <span class="n">ImpôtsError</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a>    <span class="c1"># on affiche le message d&#39;erreur</span>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L&#39;erreur suivante s&#39;est produite : </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a>    <span class="c1"># exécuté dans tous les cas</span>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Travail terminé...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 1-4 : on récupère la configuration de l’application ;</li>
<li>ligne 10 : on récupère une référence sur la couche <strong>[ui]</strong> ;</li>
<li>lignes 12-21 : la structure du code est la même que dans l’application précédente : du code entouré d&#x27;un try / catch pour arrêter toute éventuelle exception ;</li>
<li>ligne 15 : on demande à la couche <strong>[ui]</strong> de s&#x27;exécuter : le dialogue avec l&#x27;utilisateur commence alors ;</li>
<li>lignes 16-18 : interception d&#x27;une éventuelle exception ;
Voici un exemple d&#x27;exécution :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Data</span>\<span class="n">st</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">dev</span>\<span class="n">python</span>\<span class="n">cours</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="n">C</span><span class="p">:</span><span class="o">/</span><span class="n">Data</span><span class="o">/</span><span class="n">st</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">cours</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">python3</span><span class="o">-</span><span class="n">flask</span><span class="o">-</span><span class="mi">2020</span><span class="o">/</span><span class="n">impots</span><span class="o">/</span><span class="n">v04</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="n">py</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="n">Le</span> <span class="n">contribuable</span> <span class="n">est</span><span class="o">-</span><span class="n">il</span> <span class="n">marié</span> <span class="o">/</span> <span class="n">pacsé</span> <span class="p">(</span><span class="n">oui</span><span class="o">/</span><span class="n">non</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span> <span class="n">oui</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="n">Nombre</span> <span class="n">d</span><span class="s1">&#39;enfants : 3</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="n">Salaire</span> <span class="n">annuel</span> <span class="p">:</span> <span class="mi">200000</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="n">Impôt</span> <span class="n">du</span> <span class="n">contribuable</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="n">Le</span> <span class="n">contribuable</span> <span class="n">est</span><span class="o">-</span><span class="n">il</span> <span class="n">marié</span> <span class="o">/</span> <span class="n">pacsé</span> <span class="p">(</span><span class="n">oui</span><span class="o">/</span><span class="n">non</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span> <span class="n">pour</span> <span class="n">arrêter</span><span class="p">)</span> <span class="p">:</span> <span class="o">*</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="n">Travail</span> <span class="n">terminé</span><span class="o">...</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="n">Process</span> <span class="n">finished</span> <span class="k">with</span> <span class="n">exit</span> <span class="n">code</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>