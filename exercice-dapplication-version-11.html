
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Python 3 et au framework web Flask par l'exemple">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-flask-sept-2020/exercice-dapplication-version-11.html">
      
      
        <link rel="prev" href="exercice-dapplication-version-10.html">
      
      
        <link rel="next" href="exercice-dapplication-version-12.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>29. Exercice d’application : version 11 - Introduction au langage Python 3 et au framework web Flask par l'exemple</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#29-exercice-dapplication-version-11" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-header__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Python 3 et au framework web Flask par l'exemple
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              29. Exercice d’application : version 11
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-nav__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Python 3 et au framework web Flask par l'exemple
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="avant-propos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Avant-propos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dx27un-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Installation d&#x27;un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-bases-de-python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Les bases de Python
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-chaines-de-caracteres.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Les chaînes de caractères
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-exceptions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Les exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fonctions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Les fonctions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fichiers-texte.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Les fichiers texte
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Exercice d&#x27;application – version 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-imports.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Les imports
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Exercice d’application : version 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Exercice d’application : version 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-et-objets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. Les classes et objets
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-generiques-baseentity-et-myexception.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. Les classes génériques [BaseEntity] et [MyException]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture-en-couches-et-programmation-par-interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. Architecture en couches et programmation par interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. Exercice d&#x27;application - version 4
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-mysql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. Utilisation du SGBD MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-postgresql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. Utilisation du SGBD PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="ecrire-du-code-independant-du-sgbd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. Ecrire du code indépendant du SGBD
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-de-lorm-sqlalchemy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. Utilisation de l’ORM SQLALCHEMY
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application-version-5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Exercice d&#x27;application : version 5
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="fonctions-internet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Fonctions internet
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="services-web-avec-le-framework-flask.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Services web avec le framework Flask
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23. Exercice d’application : version 6
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24. Exercice d’application : version 7
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25. Exercice d’application : version 8
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="du-dictionnaire-a-xml-et-vice-versa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26. Du dictionnaire à XML et vice-versa
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-9.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27. Exercice d’application : version 9
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-10.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28. Exercice d’application : version 10
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    29. Exercice d’application : version 11
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="exercice-dapplication-version-11.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    29. Exercice d’application : version 11
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#291-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.1. Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#292-le-serveur-web" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.2. Le serveur web
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#293-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.3. Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#294-le-script-principal-main" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.4. Le script principal [main]
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#295-les-controleurs" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.5. Les contrôleurs
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#296-tests-postman" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.6. Tests Postman
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#297-le-client-web" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.7. Le client web
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="29.7. Le client web">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2971-configuration-des-couches-du-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.7.1. Configuration des couches du client
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2972-implementation-de-la-couche-dao" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.7.2. Implémentation de la couche [dao]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#298-les-scripts-main-main2" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.8. Les scripts [main, main2]
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#299-tests-du-client" class="md-nav__link">
    <span class="md-ellipsis">
      
        29.9. Tests du client
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30. Exercice d’application : version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="clients-web-pour-les-services-json-et-xml-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    31. Clients web pour les services jSON et XML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="le-mode-html-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    32. Le mode HTML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-13.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    33. Exercice d’application : version 13
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-14.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    34. Exercice d’application : version 14
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-15.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    35. Exercice d’application : version 15
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-16.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    36. Exercice d’application : version 16
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-17.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    37. Exercice d’application : version 17
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-18.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    38. Exercice d’application : version 18
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    39. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="29-exercice-dapplication-version-11">29. Exercice d’application : version 11</h1>
<h2 id="291-introduction">29.1. Introduction</h2>
<p>Dans les versions précédentes de l’application client / serveur de calcul de l’impôt, la couche <strong>[métier]</strong> qui implémente les règles métier de ce calcul était côté serveur. On se propose maintenant de la déplacer côté client. Quel est l’intérêt ? Du travail que faisait le serveur va être déplacé côté client. Si on pense à la situation d’un serveur interrogé par N clients, N calculs métier de l’impôt seront faits par les clients. Dans les versions précédentes, le serveur faisait ces N calculs métier. Parce qu’il ne fait plus le calcul métier, le serveur va répondre plus rapidement à ses clients et va alors pouvoir en servir davantage simultanément.</p>
<p>L’architecture client / serveur devient la suivante :</p>
<p><img src="images/10000000000003CF000004EDD095C42F.png" style="width:11.261cm;height:14.57cm;" alt="Image" /></p>
<ul>
<li>la couche <strong>[métier]</strong> <strong>[10]</strong> a été dupliquée <strong>[12]</strong> sur le client ;</li>
<li>
<p>un nouveau script <strong>[main2]</strong> <strong>[11]</strong> a été ajouté au client ;
Le client web aura deux façon de calculer l’imppôt de la liste de contribuables trouvée en <strong>[3]</strong> :</p>
</li>
<li>
<p>utiliser la méthode de la version précédente. Il utilise la couche <strong>[métier]</strong> <strong>[10]</strong> du serveur. Le script <strong>[main]</strong> utilisera cette méthode ;</p>
</li>
<li>se contenter de demander au serveur les données de l’administration fiscale <strong>[2-4]</strong> puis utiliser la couche <strong>[métier]</strong> <strong>[12]</strong> locale au client ;
Nous comparerons les performances des deux méthodes.</li>
</ul>
<h2 id="292-le-serveur-web">29.2. Le serveur web</h2>
<p>L’arborescence du serveur web sera la suivante :</p>
<p><img src="images/1000000000000213000002CD6E21E5B2.png" style="width:5.52cm;height:7.451cm;" alt="Image" /></p>
<ul>
<li>le dossier <strong>[http-servers/06]</strong> est initialement obtenu par recopie du dossier <strong>[http-servers/05]</strong>. On va en effet conserver l’acquis de la version 10 précédente. On va simplement lui ajouter une nouvelle fonctionnalité. Celle-ci est matérialisée par la présence d’un nouveau contrôleur <strong>[get_admindata_controller]</strong> <strong>[1]</strong>. L’autre contrôleur <strong>[calculate_tax_controller]</strong> n’est autre que l’ancien contrôleur <strong>[index_controller]</strong> qui a été renommé ;</li>
</ul>
<h2 id="293-configuration">29.3. Configuration</h2>
<p>Le serveur offrira deux URL de service :</p>
<ul>
<li><strong>[/calculate-tax]</strong> pour calculer l’impôt d’une liste de contribuables passée dans le corps d’un POST. Elle correspond donc à l’URL <strong>[/]</strong> de la version 10 précédente ;</li>
<li><strong>[/get-admindata]</strong> délivre la chaîne jSON des données de l’administration fiscale ;
La configuration <strong>[config]</strong> associe chacune de ces URL au contrôleur qui la traite :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>    <span class="c1"># dictionnaire des contrôleurs de l&#39;application web</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">calculate_tax_controller</span><span class="o">,</span><span class="w"> </span><span class="nn">get_admindata_controller</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>    <span class="n">controllers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;calculate-tax&quot;</span><span class="p">:</span> <span class="n">calculate_tax_controller</span><span class="p">,</span> <span class="s2">&quot;get-admindata&quot;</span><span class="p">:</span> <span class="n">get_admindata_controller</span><span class="p">}</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="n">config</span><span class="p">[</span><span class="s1">&#39;controllers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">controllers</span>
</code></pre></div></td></tr></table></div>
<h2 id="294-le-script-principal-main">29.4. Le script principal [main]</h2>
<p>Le script principal <strong>[main]</strong> restructure le script <strong>[main]</strong> de la version précédente :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">  1</a></span>
<span class="normal"><a href="#__codelineno-1-2">  2</a></span>
<span class="normal"><a href="#__codelineno-1-3">  3</a></span>
<span class="normal"><a href="#__codelineno-1-4">  4</a></span>
<span class="normal"><a href="#__codelineno-1-5">  5</a></span>
<span class="normal"><a href="#__codelineno-1-6">  6</a></span>
<span class="normal"><a href="#__codelineno-1-7">  7</a></span>
<span class="normal"><a href="#__codelineno-1-8">  8</a></span>
<span class="normal"><a href="#__codelineno-1-9">  9</a></span>
<span class="normal"><a href="#__codelineno-1-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-1-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-1-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-1-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-1-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-1-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-1-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-1-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-1-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-1-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-1-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-1-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-1-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-1-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-1-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-1-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-1-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-1-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-1-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-1-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-1-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-1-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-1-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-1-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-1-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-1-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-1-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-1-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-1-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-1-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-1-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-1-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-1-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-1-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-1-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-1-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-1-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-1-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-1-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-1-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-1-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-1-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-1-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-1-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-1-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-1-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-1-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-1-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-1-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-1-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-1-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-1-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-1-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-1-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-1-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-1-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-1-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-1-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-1-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-1-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-1-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-1-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-1-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-1-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-1-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-1-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-1-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-1-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-1-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-1-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-1-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-1-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-1-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-1-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-1-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-1-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-1-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-1-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-1-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-1-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-1-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-1-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-1-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-1-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-1-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-1-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-1-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-1-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-1-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-1-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-1-100">100</a></span>
<span class="normal"><a href="#__codelineno-1-101">101</a></span>
<span class="normal"><a href="#__codelineno-1-102">102</a></span>
<span class="normal"><a href="#__codelineno-1-103">103</a></span>
<span class="normal"><a href="#__codelineno-1-104">104</a></span>
<span class="normal"><a href="#__codelineno-1-105">105</a></span>
<span class="normal"><a href="#__codelineno-1-106">106</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># on attend un paramètre mysql ou pgres</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="n">syntaxe</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> mysql / pgres&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="n">erreur</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="k">if</span> <span class="ow">not</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>    <span class="n">sgbd</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>    <span class="n">erreur</span> <span class="o">=</span> <span class="n">sgbd</span> <span class="o">!=</span> <span class="s2">&quot;mysql&quot;</span> <span class="ow">and</span> <span class="n">sgbd</span> <span class="o">!=</span> <span class="s2">&quot;pgres&quot;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="k">if</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;syntaxe : </span><span class="si">{</span><span class="n">syntaxe</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">({</span><span class="s1">&#39;sgbd&#39;</span><span class="p">:</span> <span class="n">sgbd</span><span class="p">})</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="c1"># dépendances</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="err">…</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="c1"># récupération des données de l&#39;administration fiscale</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="n">erreur</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>    <span class="c1"># admindata sera une donnée de portée application en lecture seule</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;admindata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;layers&quot;</span><span class="p">][</span><span class="s2">&quot;dao&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get_admindata</span><span class="p">()</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a>    <span class="c1"># log de réussite</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;[serveur] connexion à la base de données réussie</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="k">except</span> <span class="n">ImpôtsError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a>    <span class="c1"># on note l&#39;erreur</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a>    <span class="err">…</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a><span class="err">…</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="c1"># s&#39;il y a eu erreur on s&#39;arrête</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="k">if</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="c1"># l&#39;application Flask peut démarrer</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="c1"># contrôleur principal</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="k">def</span><span class="w"> </span><span class="nf">main_controller</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>    <span class="c1"># on récupère l&#39;action demandée</span>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a>    <span class="n">dummy</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a>        <span class="c1"># logger</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a>        <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;logsFilename&quot;</span><span class="p">])</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a>        <span class="c1"># on le mémorise dans une config associée au thread</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a>        <span class="n">thread_config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;logger&quot;</span><span class="p">:</span> <span class="n">logger</span><span class="p">}</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a>        <span class="n">thread_name</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">current_thread</span><span class="p">()</span><span class="o">.</span><span class="n">name</span>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a>        <span class="n">config</span><span class="p">[</span><span class="n">thread_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;config&quot;</span><span class="p">:</span> <span class="n">thread_config</span><span class="p">}</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a>        <span class="c1"># on logue la requête</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[index] requête : </span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a>        <span class="c1"># on interrompt le thread si cela a été demandé</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a>        <span class="n">sleep_time</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;sleep_time&quot;</span><span class="p">]</span>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a>        <span class="k">if</span> <span class="n">sleep_time</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-1-54" name="__codelineno-1-54"></a>            <span class="c1"># la pause est aléatoire pour que certains threads soient interrompus et d&#39;autres pas</span>
<a id="__codelineno-1-55" name="__codelineno-1-55"></a>            <span class="n">aléa</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-56" name="__codelineno-1-56"></a>            <span class="k">if</span> <span class="n">aléa</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-1-57" name="__codelineno-1-57"></a>                <span class="c1"># log avant pause</span>
<a id="__codelineno-1-58" name="__codelineno-1-58"></a>                <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[index] mis en pause du thread pendant </span><span class="si">{</span><span class="n">sleep_time</span><span class="si">}</span><span class="s2"> seconde(s)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-59" name="__codelineno-1-59"></a>                <span class="c1"># pause</span>
<a id="__codelineno-1-60" name="__codelineno-1-60"></a>                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>
<a id="__codelineno-1-61" name="__codelineno-1-61"></a>        <span class="c1"># on fait exécuter la requête par le contrôleur de la requête</span>
<a id="__codelineno-1-62" name="__codelineno-1-62"></a>        <span class="n">controller</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;controllers&#39;</span><span class="p">][</span><span class="n">action</span><span class="p">]</span>
<a id="__codelineno-1-63" name="__codelineno-1-63"></a>        <span class="n">résultat</span><span class="p">,</span> <span class="n">status_code</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<a id="__codelineno-1-64" name="__codelineno-1-64"></a>        <span class="c1"># y-a-t-il eu une erreur fatale ?</span>
<a id="__codelineno-1-65" name="__codelineno-1-65"></a>        <span class="k">if</span> <span class="n">status_code</span> <span class="o">==</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">:</span>
<a id="__codelineno-1-66" name="__codelineno-1-66"></a>            <span class="c1"># on envoie un mail à l&#39;administrateur de l&#39;application</span>
<a id="__codelineno-1-67" name="__codelineno-1-67"></a>            <span class="n">config_mail</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;adminMail&quot;</span><span class="p">]</span>
<a id="__codelineno-1-68" name="__codelineno-1-68"></a>            <span class="n">config_mail</span><span class="p">[</span><span class="s2">&quot;logger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-1-69" name="__codelineno-1-69"></a>            <span class="n">SendAdminMail</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">config_mail</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">résultat</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<a id="__codelineno-1-70" name="__codelineno-1-70"></a>        <span class="c1"># on logue la réponse</span>
<a id="__codelineno-1-71" name="__codelineno-1-71"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[index] </span><span class="si">{</span><span class="n">résultat</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-72" name="__codelineno-1-72"></a>        <span class="c1"># on envoie la réponse</span>
<a id="__codelineno-1-73" name="__codelineno-1-73"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">résultat</span><span class="p">)</span>
<a id="__codelineno-1-74" name="__codelineno-1-74"></a>        <span class="k">return</span> <span class="n">json_response</span><span class="p">(</span><span class="n">résultat</span><span class="p">,</span> <span class="n">status_code</span><span class="p">)</span>
<a id="__codelineno-1-75" name="__codelineno-1-75"></a>    <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">erreur</span><span class="p">:</span>
<a id="__codelineno-1-76" name="__codelineno-1-76"></a>        <span class="c1"># on logue l&#39;erreur si c&#39;est possible</span>
<a id="__codelineno-1-77" name="__codelineno-1-77"></a>        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
<a id="__codelineno-1-78" name="__codelineno-1-78"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[index] </span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-79" name="__codelineno-1-79"></a>        <span class="c1"># on prépare la réponse au client</span>
<a id="__codelineno-1-80" name="__codelineno-1-80"></a>        <span class="n">résultat</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;erreurs&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]}}</span>
<a id="__codelineno-1-81" name="__codelineno-1-81"></a>        <span class="c1"># on envoie la réponse</span>
<a id="__codelineno-1-82" name="__codelineno-1-82"></a>        <span class="k">return</span> <span class="n">json_response</span><span class="p">(</span><span class="n">résultat</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">)</span>
<a id="__codelineno-1-83" name="__codelineno-1-83"></a>    <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-1-84" name="__codelineno-1-84"></a>        <span class="c1"># on ferme le fichier de logs s&#39;il a été ouvert</span>
<a id="__codelineno-1-85" name="__codelineno-1-85"></a>        <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
<a id="__codelineno-1-86" name="__codelineno-1-86"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-1-87" name="__codelineno-1-87"></a>
<a id="__codelineno-1-88" name="__codelineno-1-88"></a><span class="c1"># calcul de l&#39;impôt</span>
<a id="__codelineno-1-89" name="__codelineno-1-89"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/calculate-tax&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<a id="__codelineno-1-90" name="__codelineno-1-90"></a><span class="nd">@auth</span><span class="o">.</span><span class="n">login_required</span>
<a id="__codelineno-1-91" name="__codelineno-1-91"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate_tax</span><span class="p">():</span>
<a id="__codelineno-1-92" name="__codelineno-1-92"></a>    <span class="c1"># on passe la main au contrôleur principal</span>
<a id="__codelineno-1-93" name="__codelineno-1-93"></a>    <span class="k">return</span> <span class="n">main_controller</span><span class="p">()</span>
<a id="__codelineno-1-94" name="__codelineno-1-94"></a>
<a id="__codelineno-1-95" name="__codelineno-1-95"></a><span class="c1"># obtenir les données de l&#39;administration fiscale</span>
<a id="__codelineno-1-96" name="__codelineno-1-96"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get-admindata&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-1-97" name="__codelineno-1-97"></a><span class="nd">@auth</span><span class="o">.</span><span class="n">login_required</span>
<a id="__codelineno-1-98" name="__codelineno-1-98"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_admindata</span><span class="p">():</span>
<a id="__codelineno-1-99" name="__codelineno-1-99"></a>    <span class="c1"># on passe la main au contrôleur principal</span>
<a id="__codelineno-1-100" name="__codelineno-1-100"></a>    <span class="k">return</span> <span class="n">main_controller</span><span class="p">()</span>
<a id="__codelineno-1-101" name="__codelineno-1-101"></a>
<a id="__codelineno-1-102" name="__codelineno-1-102"></a><span class="c1"># main uniquement</span>
<a id="__codelineno-1-103" name="__codelineno-1-103"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-1-104" name="__codelineno-1-104"></a>    <span class="c1"># on lance le serveur</span>
<a id="__codelineno-1-105" name="__codelineno-1-105"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-1-106" name="__codelineno-1-106"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 88-93 : la fonction <strong>[calculate_tax]</strong> traite l’URL <strong>[/calculate-tax]</strong> ;</li>
<li>lignes 95-100 : la fonction <strong>[get_admindata]</strong> traite l’URL <strong>[/get-admindata]</strong> ;</li>
<li>ces deux fonctions ne font rien par elles-mêmes. Elles passent immédiatement la main au contrôleur principal <strong>[main_controller]</strong> des lignes 37-86 ;</li>
<li>lignes 37-86 : le contrôleur principal <strong>[main_controller]</strong> n’est rien d’autre que la fonction <strong>[index]</strong> de la version précédente à un détail près : là où la fonction <strong>[index]</strong> ne traitait qu’une unique URL, ici <strong>[main_controller]</strong> traite deux URL. Il lui faut donc faire traiter celles-ci par l’un des deux contrôleurs <strong>[calculate_tax_controller, get_admin,data_controller]</strong> ;</li>
<li>lignes 39-40 : on récupère l’action demandée <strong>[calculate_tax]</strong> ou <strong>[get_admindata]</strong>. Cette information est dans le chemin de l’URL <strong>[request.path]</strong>. Selon les cas, <strong>[request.path]</strong> vaut <strong>[/get-admindata]</strong> ou <strong>[/calculate_tax]</strong>. Le split de la ligne 40 va donner deux éléments :</li>
<li>la chaîne vide pour la partie qui précède le / ;</li>
<li>le nom de l’action demandée pour la partie qui suit le / ;</li>
<li>lignes 62-63 : une fois l’action de l’URL récupérée, on sait quel contrôleur utiliser pour traiter l’URL. Cette informations sont dans la configuration <strong>[config]</strong> ;</li>
</ul>
<h2 id="295-les-controleurs">29.5. Les contrôleurs</h2>
<p>Le contrôleur <strong>[calculate_tax_controller]</strong> n’est autre que le contrôleur <strong>[index_controller]</strong> de la version précédente.</p>
<p>Le contrôleur <strong>[get_admindata_controller]</strong> est lui le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.local</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalProxy</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>    <span class="c1"># on rend la réponse</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;admindata&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">asdict</span><span class="p">()}},</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>l’URL <strong>[/get-admindata]</strong> doit rendre la chaîne jSON des données de l’administration fiscale ;</li>
<li>ligne 6 : celles-ci ont été récupérées par le script principal <strong>[main]</strong> et mises dans le dictionnaire <strong>[config]</strong> sous la forme d’un objet <strong>[AdminData]</strong>. On rend le dictionnaire de cet objet ;</li>
</ul>
<h2 id="296-tests-postman">29.6. Tests Postman</h2>
<p>On lance le serveur web, le SGBD et le serveur de mails <strong>[hMailServer]</strong>. Puis avec un client Postman, on fait le calcul de l’impôt de plusieurs contribuables :</p>
<p><img src="images/10000000000003F7000002A033324B17.png" style="width:11.72cm;height:7.76cm;" alt="Image" /></p>
<p>Dans la console Postman, le dialogue client / serveur est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span>
<span class="normal"><a href="#__codelineno-3-31">31</a></span>
<span class="normal"><a href="#__codelineno-3-32">32</a></span>
<span class="normal"><a href="#__codelineno-3-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">POST</span> <span class="o">/</span><span class="n">calculate</span><span class="o">-</span><span class="n">tax</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">Authorization</span><span class="p">:</span> <span class="n">Basic</span> <span class="n">YWRtaW46YWRtaW4</span><span class="o">=</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.2</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="mf">5e71461</span><span class="n">a</span><span class="o">-</span><span class="n">fec8</span><span class="o">-</span><span class="mi">4315</span><span class="o">-</span><span class="mf">85e8</span><span class="o">-</span><span class="mi">41721</span><span class="n">de939e5</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">824</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="p">[</span> 
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="p">{</span> 
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> 
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> 
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">55555</span> 
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="p">},</span> 
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="err">…</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="p">{</span> 
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> 
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> 
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span> 
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="p">}</span> 
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="p">]</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">1461</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">29</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">07</span><span class="p">:</span><span class="mi">02</span><span class="p">:</span><span class="mi">07</span> <span class="n">GMT</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="p">{</span><span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">55555</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">2814</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="err">…</span><span class="p">]}}</span>
</code></pre></div></td></tr></table></div>
<p>Maintenant demandons l’URL <strong>[/get-admindata]</strong> avec un GET :</p>
<p><img src="images/10000000000002F9000000C1F96A179D.png" style="width:8.771cm;height:2.23cm;" alt="Image" /></p>
<p>Le dialogue client / serveur dans la console Postman est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">GET</span> <span class="o">/</span><span class="n">get</span><span class="o">-</span><span class="n">admindata</span> <span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="n">Authorization</span><span class="p">:</span> <span class="n">Basic</span> <span class="n">YWRtaW46YWRtaW4</span><span class="o">=</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="n">User</span><span class="o">-</span><span class="n">Agent</span><span class="p">:</span> <span class="n">PostmanRuntime</span><span class="o">/</span><span class="mf">7.26.2</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="n">Accept</span><span class="p">:</span> <span class="o">*/*</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="n">Postman</span><span class="o">-</span><span class="n">Token</span><span class="p">:</span> <span class="mi">4</span><span class="n">af342c4</span><span class="o">-</span><span class="mi">7</span><span class="n">ecb</span><span class="o">-</span><span class="mi">4</span><span class="n">ab2</span><span class="o">-</span><span class="mf">9e12</span><span class="o">-</span><span class="n">d653f81da424</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="n">Host</span><span class="p">:</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="n">Accept</span><span class="o">-</span><span class="n">Encoding</span><span class="p">:</span> <span class="n">gzip</span><span class="p">,</span> <span class="n">deflate</span><span class="p">,</span> <span class="n">br</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="n">Connection</span><span class="p">:</span> <span class="n">keep</span><span class="o">-</span><span class="n">alive</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.0</span> <span class="mi">200</span> <span class="n">OK</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">utf</span><span class="o">-</span><span class="mi">8</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">596</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="n">Server</span><span class="p">:</span> <span class="n">Werkzeug</span><span class="o">/</span><span class="mf">1.0.1</span> <span class="n">Python</span><span class="o">/</span><span class="mf">3.8.1</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="n">Date</span><span class="p">:</span> <span class="n">Wed</span><span class="p">,</span> <span class="mi">29</span> <span class="n">Jul</span> <span class="mi">2020</span> <span class="mi">07</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="mi">24</span> <span class="n">GMT</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="p">{</span><span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;limites&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">9964.0</span><span class="p">,</span> <span class="mf">27519.0</span><span class="p">,</span> <span class="mf">73779.0</span><span class="p">,</span> <span class="mf">156244.0</span><span class="p">,</span> <span class="mf">93749.0</span><span class="p">],</span> <span class="s2">&quot;coeffr&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">],</span> <span class="s2">&quot;coeffn&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1394.96</span><span class="p">,</span> <span class="mf">5798.0</span><span class="p">,</span> <span class="mf">13913.7</span><span class="p">,</span> <span class="mf">20163.4</span><span class="p">],</span> <span class="s2">&quot;plafond_decote_couple&quot;</span><span class="p">:</span> <span class="mf">1970.0</span><span class="p">,</span> <span class="s2">&quot;valeur_reduc_demi_part&quot;</span><span class="p">:</span> <span class="mf">3797.0</span><span class="p">,</span> <span class="s2">&quot;plafond_revenus_celibataire_pour_reduction&quot;</span><span class="p">:</span> <span class="mf">21037.0</span><span class="p">,</span> <span class="s2">&quot;plafond_qf_demi_part&quot;</span><span class="p">:</span> <span class="mf">1551.0</span><span class="p">,</span> <span class="s2">&quot;abattement_dixpourcent_max&quot;</span><span class="p">:</span> <span class="mf">12502.0</span><span class="p">,</span> <span class="s2">&quot;plafond_impot_celibataire_pour_decote&quot;</span><span class="p">:</span> <span class="mf">1595.0</span><span class="p">,</span> <span class="s2">&quot;plafond_decote_celibataire&quot;</span><span class="p">:</span> <span class="mf">1196.0</span><span class="p">,</span> <span class="s2">&quot;plafond_revenus_couple_pour_reduction&quot;</span><span class="p">:</span> <span class="mf">42074.0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;abattement_dixpourcent_min&quot;</span><span class="p">:</span> <span class="mf">437.0</span><span class="p">,</span> <span class="s2">&quot;plafond_impot_couple_pour_decote&quot;</span><span class="p">:</span> <span class="mf">2627.0</span><span class="p">}}}</span>
</code></pre></div></td></tr></table></div>
<h2 id="297-le-client-web">29.7. Le client web</h2>
<p><img src="images/10000000000004540000030D7699C9C1.png" style="width:12.81cm;height:9.021cm;" alt="Image" /></p>
<p><img src="images/10000000000002450000026EC7BFAAF1.png" style="width:6.04cm;height:6.451cm;" alt="Image" /></p>
<p>Le dossier <strong>[http-clients/06]</strong> est initialement obtenu par recopie du dossier <strong>[http-clients/05]</strong>. Le travail de modification consiste essentiellement à :</p>
<ul>
<li>modifier la configuration <strong>[config_layers]</strong> pour qu’elle intégre désormais une couche <strong>[métier]</strong>. Auparavant elle n’avait qu’une couche <strong>[dao]</strong> ;</li>
<li>ajouter une nouvelle méthode à la couche <strong>[dao]</strong> ;</li>
<li>écrire un script <strong>[main2]</strong> qui s’appuiera sur la couche <strong>[métier]</strong> du client pour calculer l’impôt des contribuables ;</li>
</ul>
<h3 id="2971-configuration-des-couches-du-client">29.7.1. Configuration des couches du client</h3>
<p>La configuration des couches intervient en deux points :</p>
<ul>
<li>dans la configuration <strong>[config]</strong> qui doit inclure dans les dépendances du client le dossier contenant l’implémentation de la couche <strong>[métier]</strong>. Ce dossier était déjà inclus dans les dépendances :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="n">absolute_dependencies</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>        <span class="c1"># dossiers du projet</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>        <span class="c1"># BaseEntity, MyException</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/classes/02/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>        <span class="c1"># InterfaceImpôtsDao, InterfaceImpôtsMétier, InterfaceImpôtsUi</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/v04/interfaces&quot;</span><span class="p">,</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>        <span class="c1"># AbstractImpôtsdao, ImpôtsConsole, ImpôtsMétier</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/v04/services&quot;</span><span class="p">,</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>        <span class="c1"># ImpotsDaoWithAdminDataInDatabase</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/v05/services&quot;</span><span class="p">,</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>        <span class="c1"># AdminData, ImpôtsError, TaxPayer</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/v04/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>        <span class="c1"># Constantes, tranches</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/v05/entities&quot;</span><span class="p">,</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a>        <span class="c1"># ImpôtsDaoWithHttpClient</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">script_dir</span><span class="si">}</span><span class="s2">/../services&quot;</span><span class="p">,</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>        <span class="c1"># scripts de configuration</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>        <span class="n">script_dir</span><span class="p">,</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>        <span class="c1"># Logger</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">/impots/http-servers/02/utilities&quot;</span><span class="p">,</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a>    <span class="p">]</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>Puis le fichier <strong>[config_layers]</strong> doit être modifié :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>    <span class="c1"># instanciation des couches de l&#39;applicatuon</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span class="c1"># couche [métier]</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsMétier</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsMétier</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>    <span class="n">métier</span> <span class="o">=</span> <span class="n">ImpôtsMétier</span><span class="p">()</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>    <span class="c1"># couche dao</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsDaoWithHttpClient</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsDaoWithHttpClient</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>    <span class="n">dao</span> <span class="o">=</span> <span class="n">ImpôtsDaoWithHttpClient</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a>    <span class="c1"># on rend la configuration des couches</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>    <span class="k">return</span> <span class="p">{</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>        <span class="s2">&quot;dao&quot;</span><span class="p">:</span> <span class="n">dao</span><span class="p">,</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>        <span class="s2">&quot;métier&quot;</span><span class="p">:</span> <span class="n">métier</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 4-6 : instanciation de la couche <strong>[métier]</strong> ;</li>
<li>lignes 13-16 : la couche <strong>[métier]</strong> est rendue dans le dictionnaire des couches ;</li>
</ul>
<h3 id="2972-implementation-de-la-couche-dao">29.7.2. Implémentation de la couche [dao]</h3>
<p><img src="images/100000000000023B0000010ECF4FA858.png" style="width:5.931cm;height:2.811cm;" alt="Image" /></p>
<p>La couche <strong>[dao]</strong> présentera l’interface <strong>[</strong><strong>InterfaceImpôtsDaoWithHttpClient</strong><strong>]</strong> suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstractmethod</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AbstractImpôtsDao</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbstractImpôtsDao</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">InterfaceImpôtsDaoWithHttpClient</span><span class="p">(</span><span class="n">AbstractImpôtsDao</span><span class="p">):</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>    <span class="c1"># calcul de l&#39;impôt</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_tax_in_bulk_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayers</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 5 : l’interface <strong>[</strong><strong>InterfaceImpôtsDaoWithHttpClient</strong><strong>]</strong> hérite de la classe abstraite <strong>[AbstractImpôtsDao]</strong> qui gère l’accès au système de fichiers du client. On rappelle qu’elle a une méthode abstraite <strong>[get_admindata]</strong> ;</li>
<li>lignes 7-10 : la méthode <strong>[</strong><strong>calculate_tax_in_bulk_mode</strong><strong>]</strong> que nous avons définie dans la version précédente permet le calcul de l’impôt d’une liste de contribuables ;
Cette interface est implémentée par la classe <strong>[</strong><strong>ImpôtsDaoWithHttpClient</strong><strong>]</strong> suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span>
<span class="normal"><a href="#__codelineno-8-33">33</a></span>
<span class="normal"><a href="#__codelineno-8-34">34</a></span>
<span class="normal"><a href="#__codelineno-8-35">35</a></span>
<span class="normal"><a href="#__codelineno-8-36">36</a></span>
<span class="normal"><a href="#__codelineno-8-37">37</a></span>
<span class="normal"><a href="#__codelineno-8-38">38</a></span>
<span class="normal"><a href="#__codelineno-8-39">39</a></span>
<span class="normal"><a href="#__codelineno-8-40">40</a></span>
<span class="normal"><a href="#__codelineno-8-41">41</a></span>
<span class="normal"><a href="#__codelineno-8-42">42</a></span>
<span class="normal"><a href="#__codelineno-8-43">43</a></span>
<span class="normal"><a href="#__codelineno-8-44">44</a></span>
<span class="normal"><a href="#__codelineno-8-45">45</a></span>
<span class="normal"><a href="#__codelineno-8-46">46</a></span>
<span class="normal"><a href="#__codelineno-8-47">47</a></span>
<span class="normal"><a href="#__codelineno-8-48">48</a></span>
<span class="normal"><a href="#__codelineno-8-49">49</a></span>
<span class="normal"><a href="#__codelineno-8-50">50</a></span>
<span class="normal"><a href="#__codelineno-8-51">51</a></span>
<span class="normal"><a href="#__codelineno-8-52">52</a></span>
<span class="normal"><a href="#__codelineno-8-53">53</a></span>
<span class="normal"><a href="#__codelineno-8-54">54</a></span>
<span class="normal"><a href="#__codelineno-8-55">55</a></span>
<span class="normal"><a href="#__codelineno-8-56">56</a></span>
<span class="normal"><a href="#__codelineno-8-57">57</a></span>
<span class="normal"><a href="#__codelineno-8-58">58</a></span>
<span class="normal"><a href="#__codelineno-8-59">59</a></span>
<span class="normal"><a href="#__codelineno-8-60">60</a></span>
<span class="normal"><a href="#__codelineno-8-61">61</a></span>
<span class="normal"><a href="#__codelineno-8-62">62</a></span>
<span class="normal"><a href="#__codelineno-8-63">63</a></span>
<span class="normal"><a href="#__codelineno-8-64">64</a></span>
<span class="normal"><a href="#__codelineno-8-65">65</a></span>
<span class="normal"><a href="#__codelineno-8-66">66</a></span>
<span class="normal"><a href="#__codelineno-8-67">67</a></span>
<span class="normal"><a href="#__codelineno-8-68">68</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># imports</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AbstractImpôtsDao</span><span class="w"> </span><span class="kn">import</span> <span class="n">AbstractImpôtsDao</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">AdminData</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdminData</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceImpôtsDaoWithHttpClient</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceImpôtsDaoWithHttpClient</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">ImpôtsDaoWithHttpClient</span><span class="p">(</span><span class="n">InterfaceImpôtsDaoWithHttpClient</span><span class="p">):</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>    <span class="c1"># constructeur</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a>        <span class="c1"># initialisation parent</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a>        <span class="n">AbstractImpôtsDao</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>        <span class="c1"># mémorisation éléments de la configuration</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>        <span class="c1"># config générale</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__config</span> <span class="o">=</span> <span class="n">config</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>        <span class="c1"># serveur</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__config_server</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;server&quot;</span><span class="p">]</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a>        <span class="c1"># mode debug</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__debug</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;debug&quot;</span><span class="p">]</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a>        <span class="c1"># logger</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_admindata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdminData</span><span class="p">:</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a>        <span class="c1"># on laisse remonter les exceptions</span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a>        <span class="c1"># url de service</span>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a>        <span class="n">config_server</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config_server</span>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a>        <span class="n">config_services</span> <span class="o">=</span> <span class="n">config_server</span><span class="p">[</span><span class="s1">&#39;url_services&#39;</span><span class="p">]</span>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a>        <span class="n">url_service</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_server</span><span class="p">[</span><span class="s1">&#39;urlServer&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">config_services</span><span class="p">[</span><span class="s1">&#39;get-admindata&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a>        <span class="c1"># connexion</span>
<a id="__codelineno-8-38" name="__codelineno-8-38"></a>        <span class="k">if</span> <span class="n">config_server</span><span class="p">[</span><span class="s1">&#39;authBasic&#39;</span><span class="p">]:</span>
<a id="__codelineno-8-39" name="__codelineno-8-39"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_service</span><span class="p">,</span>
<a id="__codelineno-8-40" name="__codelineno-8-40"></a>                                    <span class="n">auth</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a>                                        <span class="n">config_server</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="s2">&quot;login&quot;</span><span class="p">],</span>
<a id="__codelineno-8-42" name="__codelineno-8-42"></a>                                        <span class="n">config_server</span><span class="p">[</span><span class="s2">&quot;user&quot;</span><span class="p">][</span><span class="s2">&quot;password&quot;</span><span class="p">]))</span>
<a id="__codelineno-8-43" name="__codelineno-8-43"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-8-44" name="__codelineno-8-44"></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_service</span><span class="p">)</span>
<a id="__codelineno-8-45" name="__codelineno-8-45"></a>
<a id="__codelineno-8-46" name="__codelineno-8-46"></a>        <span class="c1"># mode debug ?</span>
<a id="__codelineno-8-47" name="__codelineno-8-47"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__debug</span><span class="p">:</span>
<a id="__codelineno-8-48" name="__codelineno-8-48"></a>            <span class="c1"># logueur</span>
<a id="__codelineno-8-49" name="__codelineno-8-49"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="p">:</span>
<a id="__codelineno-8-50" name="__codelineno-8-50"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__config</span><span class="p">[</span><span class="s1">&#39;logger&#39;</span><span class="p">]</span>
<a id="__codelineno-8-51" name="__codelineno-8-51"></a>            <span class="c1"># on logue</span>
<a id="__codelineno-8-52" name="__codelineno-8-52"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-8-53" name="__codelineno-8-53"></a>
<a id="__codelineno-8-54" name="__codelineno-8-54"></a>        <span class="c1"># code de statut</span>
<a id="__codelineno-8-55" name="__codelineno-8-55"></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
<a id="__codelineno-8-56" name="__codelineno-8-56"></a>        <span class="c1"># résultat sous forme d&#39;un dictionnaire</span>
<a id="__codelineno-8-57" name="__codelineno-8-57"></a>        <span class="n">résultat</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<a id="__codelineno-8-58" name="__codelineno-8-58"></a>        <span class="c1"># si code de statut différent de 200 OK</span>
<a id="__codelineno-8-59" name="__codelineno-8-59"></a>        <span class="k">if</span> <span class="n">status_code</span> <span class="o">!=</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span><span class="p">:</span>
<a id="__codelineno-8-60" name="__codelineno-8-60"></a>            <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="n">résultat</span><span class="p">[</span><span class="s1">&#39;réponse&#39;</span><span class="p">][</span><span class="s1">&#39;erreurs&#39;</span><span class="p">])</span>
<a id="__codelineno-8-61" name="__codelineno-8-61"></a>        <span class="c1"># on rend le résultat (un dictionnaire)</span>
<a id="__codelineno-8-62" name="__codelineno-8-62"></a>        <span class="k">return</span> <span class="n">AdminData</span><span class="p">()</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span><span class="n">résultat</span><span class="p">[</span><span class="s2">&quot;réponse&quot;</span><span class="p">][</span><span class="s2">&quot;result&quot;</span><span class="p">])</span>
<a id="__codelineno-8-63" name="__codelineno-8-63"></a>
<a id="__codelineno-8-64" name="__codelineno-8-64"></a>    <span class="c1"># calcul de l&#39;impôt en mode bulk</span>
<a id="__codelineno-8-65" name="__codelineno-8-65"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_tax_in_bulk_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taxpayers</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-8-66" name="__codelineno-8-66"></a>        <span class="c1"># on laisse remonter les exceptions</span>
<a id="__codelineno-8-67" name="__codelineno-8-67"></a>
<a id="__codelineno-8-68" name="__codelineno-8-68"></a>        <span class="err">…</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 13 : la classe <strong>[</strong><strong>ImpôtsDaoWithHttpClient</strong><strong>]</strong> implémente l’interface <strong>[</strong><strong>InterfaceImpôtsDaoWithHttpClient</strong><strong>]</strong>. Elle dérive donc de la classe <strong>[AbstractImpôtsDao]</strong> ;</li>
<li>lignes 65-66 : la méthode <strong>[</strong><strong>calculate_tax_in_bulk_mode</strong><strong>]</strong> étudiée dans la version précédente ;</li>
<li>lignes 29-62 : la méthode <strong>[get_admindata]</strong> que la classe parent <strong>[AbstractImpôtsDao]</strong> a déclarée abstraite. Elle est donc implémentée dans la classe fille ;</li>
<li>
<p>lignes 33-35 : on détermine l’URL du service web que la méthode <strong>[get-admindata]</strong> doit interroger. Ces URL de service sont définies dans la configuration <strong>[config]</strong> du client :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>       <span class="c1"># le serveur de calcul de l&#39;impôt</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>        <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>            <span class="s2">&quot;urlServer&quot;</span><span class="p">:</span> <span class="s2">&quot;http://127.0.0.1:5000&quot;</span><span class="p">,</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>            <span class="s2">&quot;authBasic&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>                <span class="s2">&quot;login&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>                <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;admin&quot;</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>            <span class="p">},</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>            <span class="s2">&quot;url_services&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>                <span class="s2">&quot;calculate-tax&quot;</span><span class="p">:</span> <span class="s2">&quot;/calculate-tax&quot;</span><span class="p">,</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>                <span class="s2">&quot;get-admindata&quot;</span><span class="p">:</span> <span class="s2">&quot;/get-admindata&quot;</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>            <span class="p">}</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a>        <span class="p">},</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>lignes 9-12 : les deux URL du serveur web ;</p>
</li>
<li>lignes 37-44 : l’URL de service est interrogée de façon synchrone ;</li>
<li>lignes 46-42 : si la configuration le demande, la réponse du serevur est loguée ;</li>
<li>ligne 57 : on sait que le serveur a envoyé une chaîne jSON d’un dictionnaire ;</li>
<li>lignes 58-60 : si le statut HTTP de la réponse n’est pas 200, alors on lance une exception ;</li>
<li>lignes 61-62 : on rend l’objet <strong>[AdminData]</strong> encapsulant les données de l’administration fiscale envoyées par le serveur ;</li>
</ul>
<h2 id="298-les-scripts-main-main2">29.8. Les scripts [main, main2]</h2>
<p>Le script <strong>[main]</strong> est celui de la version précédente. Il utilise la méthode <strong>[</strong><strong>calculate_tax_in_bulk_mode</strong><strong>]</strong> de la couche <strong>[dao]</strong> et utilise donc la couche <strong>[métier]</strong> du serveur ;</p>
<p>Le script <strong>[main2]</strong> fait la même chose que le script <strong>[main]</strong> mais en utilisant la couche <strong>[métier]</strong> du client :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span>
<span class="normal"><a href="#__codelineno-10-30">30</a></span>
<span class="normal"><a href="#__codelineno-10-31">31</a></span>
<span class="normal"><a href="#__codelineno-10-32">32</a></span>
<span class="normal"><a href="#__codelineno-10-33">33</a></span>
<span class="normal"><a href="#__codelineno-10-34">34</a></span>
<span class="normal"><a href="#__codelineno-10-35">35</a></span>
<span class="normal"><a href="#__codelineno-10-36">36</a></span>
<span class="normal"><a href="#__codelineno-10-37">37</a></span>
<span class="normal"><a href="#__codelineno-10-38">38</a></span>
<span class="normal"><a href="#__codelineno-10-39">39</a></span>
<span class="normal"><a href="#__codelineno-10-40">40</a></span>
<span class="normal"><a href="#__codelineno-10-41">41</a></span>
<span class="normal"><a href="#__codelineno-10-42">42</a></span>
<span class="normal"><a href="#__codelineno-10-43">43</a></span>
<span class="normal"><a href="#__codelineno-10-44">44</a></span>
<span class="normal"><a href="#__codelineno-10-45">45</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># on configure l&#39;application</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">config</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">configure</span><span class="p">({})</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="c1"># dépendances</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">ImpôtsError</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImpôtsError</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">Logger</span><span class="w"> </span><span class="kn">import</span> <span class="n">Logger</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="c1"># code</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="k">try</span><span class="p">:</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>    <span class="c1"># logger</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">Logger</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;logsFilename&quot;</span><span class="p">])</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a>    <span class="c1"># on le mémorise dans la config</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a>    <span class="n">config</span><span class="p">[</span><span class="s2">&quot;logger&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">logger</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a>    <span class="c1"># log de début</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;début du calcul de l&#39;impôt des contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a>    <span class="c1"># on récupère la couche [dao]</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a>    <span class="n">dao</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;layers&quot;</span><span class="p">][</span><span class="s2">&quot;dao&quot;</span><span class="p">]</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a>    <span class="c1"># on récupère les contribuables</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a>    <span class="n">taxpayers</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_taxpayers_data</span><span class="p">()[</span><span class="s2">&quot;taxpayers&quot;</span><span class="p">]</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a>    <span class="c1"># des contribuables ?</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">taxpayers</span><span class="p">:</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a>        <span class="k">raise</span> <span class="n">ImpôtsError</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Pas de contribuables valides dans le fichier </span><span class="si">{</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;taxpayersFilename&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a>    <span class="c1"># on récupère les données de l&#39;administration fiscale</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a>    <span class="n">admindata</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="n">get_admindata</span><span class="p">()</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a>    <span class="c1"># calcul de l&#39;impôt des contribuables par la couche [métier]</span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a>    <span class="n">métier</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">][</span><span class="s1">&#39;métier&#39;</span><span class="p">]</span>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a>    <span class="k">for</span> <span class="n">taxpayer</span> <span class="ow">in</span> <span class="n">taxpayers</span><span class="p">:</span>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a>        <span class="n">métier</span><span class="o">.</span><span class="n">calculate_tax</span><span class="p">(</span><span class="n">taxpayer</span><span class="p">,</span> <span class="n">admindata</span><span class="p">)</span>
<a id="__codelineno-10-32" name="__codelineno-10-32"></a>    <span class="c1"># on enregistre les résultats dans le fichier jSON</span>
<a id="__codelineno-10-33" name="__codelineno-10-33"></a>    <span class="n">dao</span><span class="o">.</span><span class="n">write_taxpayers_results</span><span class="p">(</span><span class="n">taxpayers</span><span class="p">)</span>
<a id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="c1"># except BaseException as erreur:</span>
<a id="__codelineno-10-35" name="__codelineno-10-35"></a><span class="c1">#     # affichage de l&#39;erreur</span>
<a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="c1">#     print(f&quot;L&#39;erreur suivante s&#39;est produite : {erreur}&quot;)</span>
<a id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-10-38" name="__codelineno-10-38"></a>    <span class="c1"># on ferme le logueur</span>
<a id="__codelineno-10-39" name="__codelineno-10-39"></a>    <span class="k">if</span> <span class="n">logger</span><span class="p">:</span>
<a id="__codelineno-10-40" name="__codelineno-10-40"></a>        <span class="c1"># log de fin</span>
<a id="__codelineno-10-41" name="__codelineno-10-41"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;fin du calcul de l&#39;impôt des contribuables</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-10-42" name="__codelineno-10-42"></a>        <span class="c1"># fermeture du logueur</span>
<a id="__codelineno-10-43" name="__codelineno-10-43"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-10-44" name="__codelineno-10-44"></a>    <span class="c1"># on a fini</span>
<a id="__codelineno-10-45" name="__codelineno-10-45"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Travail terminé...&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 26-27 : on récupère les données de l’administration fiscale auprès du serveur ;</li>
<li>lignes 28-31 : ensuite le calcul de l’impôt des contribuables est fait localement ;</li>
</ul>
<h2 id="299-tests-du-client">29.9. Tests du client</h2>
<p>Dans chacun des scripts <strong>[main, main2]</strong> on logue le début et la fin du script. On pourra ainsi calculer la durée d’exécution du script. Faisons quelques pronostics :</p>
<ul>
<li>le script <strong>[main]</strong> de la version précédente :</li>
<li>crée N threads qui s’exécutent simultanément ;</li>
<li>chaque thread traite un lot de contribuables dont il fait calculer l’impôt via une unique requête au serveur ;</li>
<li>parce que les N threads s’exécutent simultanément, la requête N+1 est lancée avant que la requête N ait reçu sa réponse. Ainsi les N requêtes coûtent plus cher qu’une unique requête mais probablement pas beaucoup plus. Il y a par ailleurs 11 (le nombre de contribuables) calculs métier sur le serveur ;</li>
<li>le script <strong>[main2]</strong> de cette version :</li>
<li>fait une unique requête au serveur ;</li>
<li>fait 11 calculs métier localement sur le client ;
Les calculs métier auront la même durée que ce soit sur le serveur ou le client. La différence va alors se faire sur les requêtes. On peut s’attendre alors que la durée d’exécution de <strong>[main]</strong> soit légèrement supérieure à celle de <strong>[main2]</strong>.</li>
</ul>
<p>On lance le serveur de la version 11, le SGBD et le serveur de mails <strong>[hMailServer]</strong>. Côté serveur, on met le paramètre <strong>[sleep_time]</strong> à zéro pour que les deux tests soient exécutés dans les mêmes conditions.</p>
<p><u><strong>Exécution 1 </strong></u><u><strong>[main]</strong></u></p>
<p>L’exécution de <strong>[main]</strong> donne les logs suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.016079</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.016079</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 1 contribuables</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.016079</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 4 contribuables</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.016079</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 2 contribuables</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.016079</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 2 contribuables</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.024426</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">5</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 2 contribuables</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.050473</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">55555</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">2814</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}}</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.050473</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 1 contribuables</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.050473</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">4230</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}}</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.051214</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 2 contribuables</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.051214</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">5</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}}</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.051214</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">5</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 2 contribuables</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.051214</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">347</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">720</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">16782</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">7176</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}}</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.051214</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 4 contribuables</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.051214</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span> <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span> <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}}</span>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.051214</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des 2 contribuables</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.051214</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
</code></pre></div></td></tr></table></div>
<p>La durée de l’exécution a été de <strong>[051214-016079]</strong> nanosecondes (ligne 17 – ligne 1), ç-à-d 35 millisecondes et 135 nanosecondes.</p>
<p>On voit qu’entre la 1ère demande faite au serveur et la dernière réponse reçue par le client, il y a la même durée <strong>[051214-016079]</strong> (ligne 15 – ligne 1), 35 millisecondes et 135 nanosecondes.</p>
<p><u><strong>Exécution 2 </strong></u><u><strong>[main2]</strong></u></p>
<p>L’exécution de <strong>[main2]</strong> donne les logs suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">03.303520</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">début</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">03.345084</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;limites&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">9964.0</span><span class="p">,</span> <span class="mf">27519.0</span><span class="p">,</span> <span class="mf">73779.0</span><span class="p">,</span> <span class="mf">156244.0</span><span class="p">,</span> <span class="mf">13500.0</span><span class="p">],</span> <span class="s2">&quot;coeffr&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">],</span> <span class="s2">&quot;coeffn&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1394.96</span><span class="p">,</span> <span class="mf">5798.0</span><span class="p">,</span> <span class="mf">13913.7</span><span class="p">,</span> <span class="mf">20163.4</span><span class="p">],</span> <span class="s2">&quot;plafond_decote_couple&quot;</span><span class="p">:</span> <span class="mf">1970.0</span><span class="p">,</span> <span class="s2">&quot;valeur_reduc_demi_part&quot;</span><span class="p">:</span> <span class="mf">3797.0</span><span class="p">,</span> <span class="s2">&quot;plafond_revenus_celibataire_pour_reduction&quot;</span><span class="p">:</span> <span class="mf">21037.0</span><span class="p">,</span> <span class="s2">&quot;plafond_qf_demi_part&quot;</span><span class="p">:</span> <span class="mf">1551.0</span><span class="p">,</span> <span class="s2">&quot;abattement_dixpourcent_max&quot;</span><span class="p">:</span> <span class="mf">12502.0</span><span class="p">,</span> <span class="s2">&quot;plafond_impot_celibataire_pour_decote&quot;</span><span class="p">:</span> <span class="mf">1595.0</span><span class="p">,</span> <span class="s2">&quot;plafond_decote_celibataire&quot;</span><span class="p">:</span> <span class="mf">1196.0</span><span class="p">,</span> <span class="s2">&quot;plafond_revenus_couple_pour_reduction&quot;</span><span class="p">:</span> <span class="mf">42074.0</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;abattement_dixpourcent_min&quot;</span><span class="p">:</span> <span class="mf">437.0</span><span class="p">,</span> <span class="s2">&quot;plafond_impot_couple_pour_decote&quot;</span><span class="p">:</span> <span class="mf">2627.0</span><span class="p">}}}</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">03.349975</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="n">fin</span> <span class="n">du</span> <span class="n">calcul</span> <span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt des contribuables</span>
</code></pre></div></td></tr></table></div>
<p>La durée de l’exécution a été de <strong>[349975-303520]</strong> nanosecondes (ligne 3 - ligne 1), ç-à-d 46 millisecondes et 455 nanosecondes. De façon tout à fait inattendue <strong>[main]</strong> est plus rapide que <strong>[main2]</strong>.</p>
<p>On voit que l’unique requête de <strong>[main2]</strong> a duré <strong>[345084-303520]</strong> (ligne 2 – ligne 1), ç-à-d 41 millisecondes et 564 nanosecondes. Le calcul de l’impôt a ensuite duré <strong>[349975-345084]</strong> (ligne 3 – ligne 2) ç-à-d 4 millisecondes et 91 nanosecondes. C’est la requête HTTP qui fait la durée d’exécution. De façon surprenante, on voit ici que l’unique requête de <strong>[main2]</strong> a duré plus longtemps <strong>[41 millisecondes]</strong> que les quatre requêtes simultanées de <strong>[main]</strong> <strong>[35 millisecondes]</strong>. </p>
<p>Côté serveur, les logs sont les suivants :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">27.047721</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">[</span><span class="n">serveur</span><span class="p">]</span> <span class="n">démarrage</span> <span class="n">du</span> <span class="n">serveur</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">27.140927</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">[</span><span class="n">serveur</span><span class="p">]</span> <span class="n">connexion</span> <span class="n">à</span> <span class="n">la</span> <span class="n">base</span> <span class="n">de</span> <span class="n">données</span> <span class="n">réussie</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">28.790716</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">[</span><span class="n">serveur</span><span class="p">]</span> <span class="n">démarrage</span> <span class="n">du</span> <span class="n">serveur</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">28.847518</span><span class="p">,</span> <span class="n">MainThread</span> <span class="p">:</span> <span class="p">[</span><span class="n">serveur</span><span class="p">]</span> <span class="n">connexion</span> <span class="n">à</span> <span class="n">la</span> <span class="n">base</span> <span class="n">de</span> <span class="n">données</span> <span class="n">réussie</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.039178</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="n">requête</span> <span class="p">:</span> <span class="o">&lt;</span><span class="n">Request</span> <span class="s1">&#39;http://127.0.0.1:5000/calculate-tax&#39;</span> <span class="p">[</span><span class="n">POST</span><span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.039178</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="n">requête</span> <span class="p">:</span> <span class="o">&lt;</span><span class="n">Request</span> <span class="s1">&#39;http://127.0.0.1:5000/calculate-tax&#39;</span> <span class="p">[</span><span class="n">POST</span><span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.043220</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="n">requête</span> <span class="p">:</span> <span class="o">&lt;</span><span class="n">Request</span> <span class="s1">&#39;http://127.0.0.1:5000/calculate-tax&#39;</span> <span class="p">[</span><span class="n">POST</span><span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.044307</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">5</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="n">requête</span> <span class="p">:</span> <span class="o">&lt;</span><span class="n">Request</span> <span class="s1">&#39;http://127.0.0.1:5000/calculate-tax&#39;</span> <span class="p">[</span><span class="n">POST</span><span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.045796</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">2</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">{</span><span class="s1">&#39;réponse&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">9200</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">2180</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">4230</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}}</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.045796</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">3</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">{</span><span class="s1">&#39;réponse&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">55555</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">2814</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}}</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.046825</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">6</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="n">requête</span> <span class="p">:</span> <span class="o">&lt;</span><span class="n">Request</span> <span class="s1">&#39;http://127.0.0.1:5000/calculate-tax&#39;</span> <span class="p">[</span><span class="n">POST</span><span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.046825</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">6</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">{</span><span class="s1">&#39;réponse&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">1384</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">384</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">347</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">50000</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.14</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">720</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">19884</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">4480</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">16782</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">7176</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}}</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.046825</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">4</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">{</span><span class="s1">&#39;réponse&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">64210</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">7498</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.45</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">42842</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">17283</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}}</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mf">50.046825</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">5</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">{</span><span class="s1">&#39;réponse&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;non&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">22986</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.41</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;marié&#39;</span><span class="p">:</span> <span class="s1">&#39;oui&#39;</span><span class="p">,</span> <span class="s1">&#39;enfants&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;salaire&#39;</span><span class="p">:</span> <span class="mi">30000</span><span class="p">,</span> <span class="s1">&#39;impôt&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;surcôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;taux&#39;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;décôte&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;réduction&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}]}}</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">03.341582</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">7</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="n">requête</span> <span class="p">:</span> <span class="o">&lt;</span><span class="n">Request</span> <span class="s1">&#39;http://127.0.0.1:5000/get-admindata&#39;</span> <span class="p">[</span><span class="n">GET</span><span class="p">]</span><span class="o">&gt;</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">29</span> <span class="mi">14</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mf">03.341582</span><span class="p">,</span> <span class="n">Thread</span><span class="o">-</span><span class="mi">7</span> <span class="p">:</span> <span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">{</span><span class="s1">&#39;réponse&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;limites&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">9964.0</span><span class="p">,</span> <span class="mf">27519.0</span><span class="p">,</span> <span class="mf">73779.0</span><span class="p">,</span> <span class="mf">156244.0</span><span class="p">,</span> <span class="mf">13500.0</span><span class="p">],</span> <span class="s1">&#39;coeffr&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">],</span> <span class="s1">&#39;coeffn&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1394.96</span><span class="p">,</span> <span class="mf">5798.0</span><span class="p">,</span> <span class="mf">13913.7</span><span class="p">,</span> <span class="mf">20163.4</span><span class="p">],</span> <span class="s1">&#39;plafond_decote_couple&#39;</span><span class="p">:</span> <span class="mf">1970.0</span><span class="p">,</span> <span class="s1">&#39;valeur_reduc_demi_part&#39;</span><span class="p">:</span> <span class="mf">3797.0</span><span class="p">,</span> <span class="s1">&#39;plafond_revenus_celibataire_pour_reduction&#39;</span><span class="p">:</span> <span class="mf">21037.0</span><span class="p">,</span> <span class="s1">&#39;plafond_qf_demi_part&#39;</span><span class="p">:</span> <span class="mf">1551.0</span><span class="p">,</span> <span class="s1">&#39;abattement_dixpourcent_max&#39;</span><span class="p">:</span> <span class="mf">12502.0</span><span class="p">,</span> <span class="s1">&#39;plafond_impot_celibataire_pour_decote&#39;</span><span class="p">:</span> <span class="mf">1595.0</span><span class="p">,</span> <span class="s1">&#39;plafond_decote_celibataire&#39;</span><span class="p">:</span> <span class="mf">1196.0</span><span class="p">,</span> <span class="s1">&#39;plafond_revenus_couple_pour_reduction&#39;</span><span class="p">:</span> <span class="mf">42074.0</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;abattement_dixpourcent_min&#39;</span><span class="p">:</span> <span class="mf">437.0</span><span class="p">,</span> <span class="s1">&#39;plafond_impot_couple_pour_decote&#39;</span><span class="p">:</span> <span class="mf">2627.0</span><span class="p">}}}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 5 : la 1ère requête du client <strong>[main]</strong> ;</li>
<li>ligne 14 : la dernière réponse au client <strong>[main]</strong>. Il y a 6 millisecondes et 647 nanosecondes entre les deux ;</li>
<li>lignes 15-16 : l’unique requête du client <strong>[main2]</strong>. La réponse est instantanée ;</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>