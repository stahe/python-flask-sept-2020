
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Introduction au langage Python 3 et au framework web Flask par l'exemple">
      
      
        <meta name="author" content="Serge Tahé">
      
      
        <link rel="canonical" href="https://stahe.github.io/python-flask-sept-2020/le-mode-html-de-la-version-12.html">
      
      
        <link rel="prev" href="clients-web-pour-les-services-json-et-xml-de-la-version-12.html">
      
      
        <link rel="next" href="exercice-dapplication-version-13.html">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>32. Le mode HTML de la version 12 - Introduction au langage Python 3 et au framework web Flask par l'exemple</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/focus.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#32-le-mode-html-de-la-version-12" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-header__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Introduction au langage Python 3 et au framework web Flask par l'exemple
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              32. Le mode HTML de la version 12
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode sombre"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Passer au mode sombre" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Passer au mode clair"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Passer au mode clair" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Introduction au langage Python 3 et au framework web Flask par l&#39;exemple" class="md-nav__button md-logo" aria-label="Introduction au langage Python 3 et au framework web Flask par l'exemple" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Introduction au langage Python 3 et au framework web Flask par l'exemple
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stahe/python-flask-sept-2020" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accueil
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="avant-propos.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1. Avant-propos
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="installation-dx27un-environnement-de-travail.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    2. Installation d&#x27;un environnement de travail
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-bases-de-python.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    3. Les bases de Python
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-chaines-de-caracteres.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    4. Les chaînes de caractères
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-exceptions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    5. Les exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fonctions.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    6. Les fonctions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-fichiers-texte.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    7. Les fichiers texte
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-1.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    8. Exercice d&#x27;application – version 1
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-imports.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    9. Les imports
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-2.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    10. Exercice d’application : version 2
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-3.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    11. Exercice d’application : version 3
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-et-objets.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    12. Les classes et objets
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="les-classes-generiques-baseentity-et-myexception.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    13. Les classes génériques [BaseEntity] et [MyException]
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="architecture-en-couches-et-programmation-par-interfaces.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    14. Architecture en couches et programmation par interfaces
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application---version-4.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    15. Exercice d&#x27;application - version 4
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-mysql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    16. Utilisation du SGBD MySQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-du-sgbd-postgresql.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    17. Utilisation du SGBD PostgreSQL
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="ecrire-du-code-independant-du-sgbd.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    18. Ecrire du code indépendant du SGBD
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="utilisation-de-lorm-sqlalchemy.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    19. Utilisation de l’ORM SQLALCHEMY
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dx27application-version-5.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    20. Exercice d&#x27;application : version 5
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="fonctions-internet.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    21. Fonctions internet
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="services-web-avec-le-framework-flask.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    22. Services web avec le framework Flask
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-6.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    23. Exercice d’application : version 6
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-7.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    24. Exercice d’application : version 7
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-8.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    25. Exercice d’application : version 8
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="du-dictionnaire-a-xml-et-vice-versa.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    26. Du dictionnaire à XML et vice-versa
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-9.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    27. Exercice d’application : version 9
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-10.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    28. Exercice d’application : version 10
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-11.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    29. Exercice d’application : version 11
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    30. Exercice d’application : version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="clients-web-pour-les-services-json-et-xml-de-la-version-12.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    31. Clients web pour les services jSON et XML de la version 12
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    32. Le mode HTML de la version 12
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="le-mode-html-de-la-version-12.html" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    32. Le mode HTML de la version 12
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#321-architecture-mvc" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.1. Architecture MVC
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#322-larborescence-des-scripts-du-serveur-html" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.2. L’arborescence des scripts du serveur HTML
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#323-presentation-des-vues" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.3. Présentation des vues
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#324-configuration-des-vues" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.4. Configuration des vues
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#325-la-vue-dauthentification" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.5. La vue d’authentification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="32.5. La vue d’authentification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3251-presentation-de-la-vue" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.5.1. Présentation de la vue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3252-le-fragment-v-bandeauhtml" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.5.2. Le fragment [v-bandeau.html]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3253-le-fragment-v-authentificationhtml" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.5.3. Le fragment [v-authentification.html]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3254-tests-visuels" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.5.4. Tests visuels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3255-calcul-du-modele-de-la-vue" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.5.5. Calcul du modèle de la vue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3256-generation-des-reponses-html" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.5.6. Génération des réponses HTML
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3257-tests-postman" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.5.7. Tests [Postman]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3258-conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.5.8. Conclusion
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#326-la-vue-de-calcul-de-limpot" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.6. La vue de calcul de l’impôt
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="32.6. La vue de calcul de l’impôt">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3261-presentation-de-la-vue" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.6.1. Présentation de la vue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3262-le-fragment-v-calcul-impothtml" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.6.2. Le fragment [v-calcul-impot.html]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3263-le-fragment-v-menuhtml" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.6.3. Le fragment [v-menu.html]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3264-test-visuel" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.6.4. Test visuel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3265-calcul-du-modele-de-la-vue" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.6.5. Calcul du modèle de la vue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3266-tests-postman" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.6.6. Tests [Postman]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#327-la-vue-de-la-liste-des-simulations" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.7. La vue de la liste des simulations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="32.7. La vue de la liste des simulations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3271-presentation-de-la-vue" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.7.1. Présentation de la vue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3272-test-visuel" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.7.2. Test visuel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3273-calcul-du-modele-de-la-vue" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.7.3. Calcul du modèle de la vue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3274-tests-postman" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.7.4. Tests [Postman]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#328-la-vue-des-erreurs-inattendues" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.8. La vue des erreurs inattendues
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="32.8. La vue des erreurs inattendues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3281-presentation-de-la-vue" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.8.1. Présentation de la vue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3282-test-visuel" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.8.2. Test visuel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3283-calcul-du-modele-de-la-vue" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.8.3. Calcul du modèle de la vue
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3284-tests-postman" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.8.4. Tests [Postman]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#329-implementation-des-actions-du-menu-de-lapplication" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.9. Implémentation des actions du menu de l’application
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="32.9. Implémentation des actions du menu de l’application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3291-laction-afficher-calcul-impot" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.9.1. L’action [/afficher-calcul-impot]
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3292-laction-fin-session" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.9.2. L’action [/fin-session]
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3210-tests-de-lapplication-html-en-conditions-reelles" class="md-nav__link">
    <span class="md-ellipsis">
      
        32.10. Tests de l’application HTML en conditions réelles
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-13.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    33. Exercice d’application : version 13
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-14.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    34. Exercice d’application : version 14
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-15.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    35. Exercice d’application : version 15
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-16.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    36. Exercice d’application : version 16
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-17.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    37. Exercice d’application : version 17
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="exercice-dapplication-version-18.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    38. Exercice d’application : version 18
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="conclusion.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    39. Conclusion
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="32-le-mode-html-de-la-version-12">32. Le mode HTML de la version 12</h1>
<p>Nous avions indiqué au début de la version 12 que nous allions développer l’application en plusieurs temps. Nous avions écrit :</p>
<ul>
<li>à partir des vues de l’application HTML, nous allons définir les actions que doit implémenter l’application web. Nous allons ici utiliser les vues réelles mais ce pourrait être simplement des vues sur papier ;</li>
<li>à partir de ces actions, nous allons définir les URL de service de l’application HTML ;</li>
<li>nous allons implémenter ces URL de service avec un serveur délivrant du jSON. Cela permet de définir l’ossature du serveur web sans se préoccuper des pages HTML à délivrer. Nous testerons ces URL de service avec Postman ;</li>
<li>nous testerons ensuite notre serveur jSON avec un client console ;</li>
<li>une fois que le serveur jSON aura été validé, nous passerons à l’ériture de l’application HTML ;
Nous avons un serveur jSON et XML opérationnel. On peut maintenant passer au serveur HTML. Nous allons voir que celui-ci reprend toute l’architecture développée pour le serveur jSON / XML et leur ajoute une gestion de vues HTML.</li>
</ul>
<h2 id="321-architecture-mvc">32.1. Architecture MVC</h2>
<p>Nous allons implémenter le modèle d&#x27;architecture dit MVC (Modèle – Vue – Contrôleur) de la façon suivante :</p>
<p><img src="images/10000001000003320000010243F9EAD1.png" style="width:13.831cm;height:4.351cm;" alt="Image" /></p>
<p>Le traitement d&#x27;une demande d&#x27;un client se déroulera de la façon suivante :</p>
<ul>
<li>
<p>1 - demande
Les URL demandées seront de la forme http://machine:port/action/param1/param2/… Le <strong>[Contrôleur principal]</strong> utilisera un fichier de configuration pour &quot; router &quot; la demande vers le bon contrôleur. Pour cela, il utilisera le champ <strong>[action]</strong> de l&#x27;URL. Le reste de l&#x27;URL <strong>[param1/param2/…]</strong> est formé de paramètres facultatifs qui seront transmis à l&#x27;action. Le <strong>C</strong> de MVC est ici la chaîne <strong>[Contrôleur principal, Contrôleur / Action]</strong>. Si aucun contrôleur ne peut traiter l&#x27;action demandée, le serveur web répondra que l&#x27;URL demandée n&#x27;a pas été trouvée.</p>
</li>
<li>
<p>2 - traitement</p>
</li>
<li>l&#x27;action choisie <strong>[2a]</strong> peut exploiter les paramètres parami que le <strong>[Contrôleur principal]</strong> lui a transmis. Ceux-ci pourront provenir de deux sources :</li>
<li>du chemin <strong>[/param1/param2/…]</strong> de l&#x27;URL,</li>
<li>de paramètres postés dans le corps de la requête du client ;</li>
<li>dans le traitement de la demande de l&#x27;utilisateur, l&#x27;action peut avoir besoin de la couche <strong>[métier]</strong> <strong>[2b]</strong>. Une fois la demande du client traitée, celle-ci peut appeler diverses réponses. Un exemple classique est :</li>
<li>une réponse d&#x27;erreur si la demande n&#x27;a pu être traitée correctement ;</li>
<li>une réponse de confirmation sinon ;</li>
<li>le <strong>[Contrôleur / Action]</strong> rendra sa réponse <strong>[2c]</strong> au contrôleur principal ainsi qu’un code d’état. Ces codes d’état représenteront de façon unique l’état dans lequel se trouve l’application. Ce sera soit un code de réussite, soit un code d’erreur ;</li>
<li>3 - réponse</li>
<li>selon que le client a demandé une réponse jSON, XML ou HTML, le <strong>[Contrôleur principal]</strong> instanciera <strong>[3a]</strong> le type de réponse appropriée et demandera à celle-ci d’envoyer la réponse au client. Le <strong>[Contrôleur principal]</strong> lui transmettra et la réponse et le code d’état fournis par le <strong>[Contrôleur / Action]</strong> qui a été exécuté ;</li>
<li>si la réponse souhaitée est de type jSON ou XML, la réponse sélectionnée mettra en forme la réponse du <strong>[Contrôleur / Action]</strong> qu’on lui a donnée et l’enverra <strong>[3c]</strong>. Le client capable d’exploiter cette réponse peut être un script console Python ou un script Javascript logé dans une page HTML ;</li>
<li>si la réponse souhaitée est de type HTML, la réponse sélectionnée sélectionnera <strong>[3b]</strong> une des <strong>vues</strong> HTML <strong>[Vuei]</strong> à l’aide du code d’état qu’on lui a donné. C’est le <strong>V</strong> de MVC. A un code d’état correspond une unique vue. Cette vue <strong>V</strong> va afficher la réponse du  <strong>[Contrôleur / Action]</strong> qui a été exécuté. Elle habille avec du HTML, CSS, Javascript les données de cette réponse. On appelle ces données le <strong>modèle de la vue</strong>. C&#x27;est le <strong>M</strong> de MVC. Le client est alors le plus souvent un navigateur ;</li>
</ul>
<h2 id="322-larborescence-des-scripts-du-serveur-html">32.2. L’arborescence des scripts du serveur HTML</h2>
<p><img src="images/10000000000008D200000407B66C2BC6.png" style="width:17.999cm;height:8.218cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, les éléments statiques du serveur HTML ;</li>
<li>en <strong>[2-3]</strong>, les vues V du serveur HTML. Les fragments <strong>[2]</strong> sont des éléments réutilisables dans les vues <strong>[3]</strong> ;</li>
<li>en <strong>[4]</strong>, un dossier qui servira aux tests des vues de façon statique ;</li>
<li>en <strong>[5]</strong>, le dossier des modèles M des vues V, le M de MVC ;</li>
</ul>
<h2 id="323-presentation-des-vues">32.3. Présentation des vues</h2>
<p>L’application web HTML utilise quatre vues. La 1ère vue est la vue d’authentification :</p>
<ul>
<li>l’action qui mène à cette 1ère vue est l’action <strong>[/init-session]</strong> <strong>[1]</strong> ;</li>
</ul>
<p><img src="images/100000000000052F0000035AF3022D8F.png" style="width:15.331cm;height:9.921cm;" alt="Image" /></p>
<ul>
<li>le clic sur le bouton <strong>[Valider]</strong> déclenche l’action <strong>[/authentifier-utilisateur]</strong> avec deux paramètres postés <strong>[2-3]</strong> ;
La vue du calcul de l’impôt :</li>
</ul>
<p><img src="images/1000000000000409000002C28AF2C2B8.png" style="width:11.941cm;height:8.161cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, l’action <strong>[/authentifier-utilisateur]</strong> qui amène cette vue ;</li>
<li>en <strong>[2]</strong>, le clic sur le bouton <strong>[Valider]</strong> déclenche l’exécution de l’action <strong>[/calculer-impot]</strong> avec trois paramètres postés <strong>[2-5]</strong> ;</li>
<li>le clic sur le lien <strong>[6]</strong> déclenche l’action <strong>[/lister-simulations]</strong> sans paramètres ;</li>
<li>le clic sur le lien <strong>[7]</strong> déclenche l’action <strong>[/fin-session]</strong> sans paramètres ;
La 3ième vue est celle des simulations faites par l’utilisateur authentifié :</li>
</ul>
<p><img src="images/100000000000052700000248AB35CBDA.png" style="width:15.221cm;height:6.751cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, l’action <strong>[/lister-simulations]</strong> qui amène cette vue ;</li>
<li>en <strong>[2]</strong>, un clic sur le lien <strong>[Supprimer]</strong> déclenche l’action <strong>[/supprimer-simulation]</strong> avec un paramètre, le n° de la simulation à supprimer dans la liste ;</li>
<li>un clic sur le lien <strong>[3]</strong> déclenche l’action <strong>[/afficher-calcul-impot]</strong> sans paramètres qui réaffiche la vue du calcul de l’impôt ;</li>
<li>
<p>un clic sur le lien <strong>[4]</strong> déclenche l’action <strong>[/fin-session]</strong> sans paramètres ;
La 4ième vue sera appelée la vue des erreurs inattendues :</p>
</li>
<li>
<p>en <strong>[1]</strong> : l’utilisateur a tapé lui-même l’URL. Or dans cet exemple il n’y avait pas de simulations. On reçoit donc le message d’erreur <strong>[2]</strong>. On connaît ce message. On l’avait en jSON / XML. On appellera ce type d’erreur, erreur inattendue, car elle ne peut pas se produire en utilisation normale de l’application. C’est lorsque l’utilisateur tape lui-même les URL qu’elles peuvent de produire ;</p>
</li>
</ul>
<p><img src="images/1000000000000475000002928B5A09FC.png" style="width:13.161cm;height:7.601cm;" alt="Image" /></p>
<ul>
<li>en cas d’erreur inattendue, les liens <strong>[3-5]</strong> permettent de revenir à l’une des trois autres vues ;
Rappelons les différentes URL de service du serveur jSON / XML :</li>
</ul>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>Action</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>Rôle</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>Contexte d’exécution</b></p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">/init-session</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Sert à fixer le type (json, xml, html) des réponses souhaitées</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Requête <b>GET</b></p><p style="margin:0;">Peut être émise à tout moment</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">/authentifier-utilisateur</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Autorise ou non un utilisateur à se connecter</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Requête <b>POST.</b></p><p style="margin:0;">La requête doit avoir deux paramètres postés <b>[user, password]</b></p><p style="margin:0;">Ne peut être émise que si le type de la session (json, xml, html) est connu</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">/calculer-impot</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Fait une simulation de calcul d’impôt</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Requête <b>POST.</b></p><p style="margin:0;">La requête doit avoir trois paramètres postés <b>[marié, enfants, salaire]</b></p><p style="margin:0;">Ne peut être émise que si le type de la session (json, xml, html) est connu et l’utilisateur authentifié</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">/lister-simulations</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Demande à voir la liste des simulations opérées depuis le début de la session</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Requête <b>GET.</b></p><p style="margin:0;">Ne peut être émise que si le type de la session (json, xml, html) est connu et l’utilisateur authentifié</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">/supprimer-simulation/numéro</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Supprime une simulation de la liste des simulations</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Requête <b>GET.</b></p><p style="margin:0;">Ne peut être émise que si le type de la session (json, xml, html) est connu et l’utilisateur authentifié</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">/afficher-calcul-impot</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Affiche la page HTML du calul de l’impôt</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Requête <b>GET</b>.</p><p style="margin:0;">Ne peut être émise que si le type de la session (json, xml, html) est connu et l’utilisateur authentifié</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">/fin-session</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Termine la session de simulations.</p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Techniquement l’ancienne session web est supprimée et une nouvelle session est créée</p><p style="margin:0;">Ne peut être émise que si le type de la session (json, xml, html) est connu et l’utilisateur authentifié</p></td></tr></table>

<p>Ces différentes URL de service seront également utilisées pour le serveur HTML.</p>
<h2 id="324-configuration-des-vues">32.4. Configuration des vues</h2>
<p>Une action est traitée par un contrôleur. Ce contrôleur rend un tuple (résultat, status_code) où :</p>
<ul>
<li><strong>[résultat]</strong> est un dictionnaire de clés <strong>[action, état, réponse]</strong> ;</li>
<li><strong>[status_code]</strong> est le code de statut de la réponse HTTP qui sera faite au client ;
Dans une session HTML, la page affichée suite à une action, dépend du code d’état rendu par le cntrôleur. Cette dépendance est matérialisée dans la configuration <strong>[config]</strong> de la façon suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>        <span class="c1"># les vues HTML et leurs modèles dépendent de l&#39;état rendu par le contrôleur</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>        <span class="s2">&quot;views&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a>            <span class="p">{</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a>                <span class="c1"># vue d&#39;authentification</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a>                    <span class="c1"># /init-session réussite</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>                    <span class="mi">700</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a>                    <span class="c1"># /authentifier-utilisateur échec</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a>                    <span class="mi">201</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>                <span class="p">],</span>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-authentification.html&quot;</span><span class="p">,</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForAuthentificationView</span><span class="p">()</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a>            <span class="p">},</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a>            <span class="p">{</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>                <span class="c1"># vue du calcul de l&#39;impôt</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>                    <span class="c1"># /authentifier-utilisateur réussite</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>                    <span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>                    <span class="c1"># /calculer-impot réussite</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>                    <span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>                    <span class="c1"># /calculer-impot échec</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>                    <span class="mi">301</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>                    <span class="c1"># /afficher-calcul-impot</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>                    <span class="mi">800</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>                <span class="p">],</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-calcul-impot.html&quot;</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForCalculImpotView</span><span class="p">()</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>            <span class="p">},</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>            <span class="p">{</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>                <span class="c1"># vue de la liste des simulations</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>                    <span class="c1"># /lister-simulations</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>                    <span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>                    <span class="c1"># /supprimer-simulation</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>                    <span class="mi">600</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>                <span class="p">],</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-liste-simulations.html&quot;</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForListeSimulationsView</span><span class="p">()</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>            <span class="p">}</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>        <span class="p">],</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>        <span class="c1"># vue des erreurs inattendues</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>        <span class="s2">&quot;view-erreurs&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>            <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-erreurs.html&quot;</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForErreursView</span><span class="p">()</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="p">},</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="c1"># redirections</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="s2">&quot;redirections&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>            <span class="p">{</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>                    <span class="mi">400</span><span class="p">,</span>  <span class="c1"># /fin-session réussite</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>                <span class="p">],</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>                <span class="c1"># redirection vers</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;/init-session/html&quot;</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="p">}</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="p">],</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 2-40 : <strong>[views]</strong> est une liste de vues. Raisonnons sur la vue des lignes 3-13 :</li>
<li>ligne 11 : la vue V affichée ;</li>
<li>ligne 12 : l’instance de classe chargée de générer le modèle M de cette vue ;</li>
<li>lignes 5-10 : les états qui mènent à cette vue ;</li>
<li>lignes 3-13 : la vue d’authentification ;</li>
<li>lignes 14-28 : la vue du calcul de l’impôt ;</li>
<li>lignes 29-39 : la vue de la liste des simulations ;</li>
<li>lignes 42-46 : la vue des erreurs inattendues ;</li>
<li>lignes 49-57 : certains états mènent à une vue via une redirection. C’est le cas de l’état 400 qui est celui de l’action <strong>[/fin-session]</strong> réussie. Il faut alors rediriger le client vers l’action <strong>[http://machine:port/chemin/init-session/html]</strong> ;
Nous présentons maintenant les différentes vues.</li>
</ul>
<h2 id="325-la-vue-dauthentification">32.5. La vue d’authentification</h2>
<p><img src="images/10000000000001AD000001FE58FBD27D.png" style="width:4.95cm;height:5.882cm;" alt="Image" /></p>
<h3 id="3251-presentation-de-la-vue">32.5.1. Présentation de la vue</h3>
<p>La vue d’authentification est la suivante :</p>
<p><img src="images/10000000000004F40000034B67C9D00B.png" style="width:14.651cm;height:9.74cm;" alt="Image" /></p>
<p>La vue est composée de deux éléments qu’on appellera des fragments :</p>
<ul>
<li>le fragment <strong>[1]</strong> est généré par le fragment <strong>[v-bandeau.html]</strong> ;</li>
<li>le fragment <strong>[2]</strong> est généré par le fragment <strong>[v-authentification.html]</strong> ;
La vue d’authentification est générée par la page <strong>[vue-authentification.html]</strong> suivante :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">document</span> <span class="n">HTML</span> <span class="o">--&gt;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">doctype</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">Required</span> <span class="n">meta</span> <span class="n">tags</span> <span class="o">--&gt;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">Bootstrap</span> <span class="n">CSS</span> <span class="o">--&gt;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a>    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Application</span> <span class="n">impôts</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">bandeau</span> <span class="o">--&gt;</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/v-bandeau.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">ligne</span> <span class="n">à</span> <span class="n">deux</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-9&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a>            <span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/v-authentification.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">si</span> <span class="n">erreur</span> <span class="o">-</span> <span class="n">on</span> <span class="n">affiche</span> <span class="n">une</span> <span class="n">alerte</span> <span class="n">d</span><span class="s1">&#39;erreur --&gt;</span>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a>    <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">modèle</span><span class="o">.</span><span class="n">error</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-9&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a>                <span class="n">Les</span> <span class="n">erreurs</span> <span class="n">suivantes</span> <span class="n">se</span> <span class="n">sont</span> <span class="n">produites</span> <span class="p">:</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a>                <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">modèle</span><span class="o">.</span><span class="n">erreurs</span><span class="o">|</span><span class="n">safe</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 2 : un document HTML commence avec cette ligne ;</li>
<li>lignes 3-36 : la page HTML est encapsulée dans les balises &lt;<strong>html</strong>&gt; &lt;<strong>/html</strong>&gt; ;</li>
<li>lignes 4-11 : entête (<strong>head</strong>) du document HTML ;</li>
<li>ligne 6 : la balise &lt;<strong>meta charset</strong>&gt; indique ici que le document est codé en UTF-8 ;</li>
<li>ligne 7 : la balise &lt;<strong>meta name=’viewport’</strong>&gt; fixe l’affichage initial de la vue : sur toute la largeur de l’écran qui l’affiche (width) à sa taille initiale (<strong>initial-scale</strong>) sans redimensionnement pour s’adapter à une taille plus petite d’écran (<strong>shrink-to-fit</strong>) ;</li>
<li>ligne 9 : la balise &lt;<strong>link rel=’stylesheet’</strong>&gt; fixe le fichier CSS qui gouverne l’apparence de la vue. Nous utilisons ici le framework CSS Bootstrap 4.4.1 <strong>[https://getbootstrap.com/docs/4.0/getting-started/introduction/]</strong>    ;</li>
<li>ligne 10 : la balise &lt;<strong>title</strong>&gt; fixe le titre de la page :</li>
</ul>
<p><img src="images/10000000000002D6000000F952B51F6D.png" style="width:8.37cm;height:2.881cm;" alt="Image" /></p>
<ul>
<li>lignes 13-35 : le corps de la page web est encapsulé dans les balises <strong>&lt;body&gt;&lt;/body&gt;</strong> ;</li>
<li>lignes 14-34 : la balise &lt;div&gt; délimite une section de la page affichée. Les attributs <strong>[class]</strong> utilisés dans la vue se réfèrent tous au framework CSS Bootstrap. La balise &lt;<strong>div class=’container’</strong>&gt; (ligne 14) délimite un conteneur Bootstrap ;</li>
<li>ligne 26 : on inclut le fragment <strong>[v-bandeau.html]</strong>. Ce fragment génère le bandeau <strong>[1]</strong> de la page. Nous le décrirons bientôt ;</li>
<li>lignes 18-22 : la balise &lt;<strong>div class=’row’</strong>&gt; délimite une ligne Bootstrap. Ces lignes sont constituées de 12 colonnes ;</li>
<li>ligne 19 : la balise &lt;<strong>div class=’col-md-9’</strong>&gt; délimite une section de 9 colonnes ;</li>
<li>ligne 20 : on inclut le fragment <strong>[v-authentification.html]</strong> qui affiche le formulaire d’authentification <strong>[2]</strong> de la page. Nous le décrirons bientôt ;</li>
<li>lignes 24-33 : le code HTML de ces lignes n’est utilisé que si <strong>[modèle.error]</strong> vaut True. Nous procèderons toujours ainsi : le modèle d’une vue HTML sera encapsulé dans un dictionnaire <strong>[modèle]</strong> ;</li>
<li>lignes 24-33 : l’authentification échoue si l’utilisateur entre des identifiants incorrects. Dans ce cas, la vue d’authentification est réaffichée avec un message d’erreur. L’attribut <strong>[modèle.error]</strong> indique s’il faut afficher ce message d’erreur ;</li>
<li>lignes 27-30 : délimitent une zone à fond rose (<strong>class</strong>=&quot;alert alert-danger&quot;) (ligne 27) ;</li>
</ul>
<p><img src="images/100000010000017D000000911BBB0402.png" style="width:6.411cm;height:2.44cm;" alt="Image" /></p>
<ul>
<li>ligne 28 : un texte ;</li>
<li>
<p>ligne 29 : la balise HTML &lt;<strong>ul</strong>&gt; (unordered list) affiche une liste à puces. Chaque élément de la liste doit avoir la syntaxe <strong>&lt;li&gt;élément&lt;/li&gt;</strong>. On affiche ici la valeur de <strong>[modèle.erreurs]</strong>. Cette valeur est filtrée (présence de |) par le filtre <strong>[safe]</strong>. Par défaut, lorsqu’une chaîne de caractères doit être envoyée au navigateur, Flask ‘neutralise’ toutes les balises HTML qui pourraient s’y trouver afin que le navigateur ne les interprète pas. Mais parfois on veut les interpréter. Ce sera ici le cas où la chaîne <strong>[modèle.erreurs]</strong> contiendra des balises HTML &lt;li&gt; et &lt;/li&gt; qui servent à délimiter un élément de la liste. Dans ce cas, on utilise le filtre <strong>[safe]</strong> qui dit à Flask que la chaîne à afficher est sûre (safe) et que donc il ne doit pas neutraliser les balises HTML qu’il y trouvera ;
Retenons de ce code les éléments dynamiques à définir :</p>
</li>
<li>
<p><strong>[modèle.error]</strong> : pour afficher un message d’erreur ;</p>
</li>
<li><strong>[modèle.erreurs]</strong> : une liste (au sens HTML du terme) de messages d’erreur ;</li>
</ul>
<h3 id="3252-le-fragment-v-bandeauhtml">32.5.2. Le fragment [v-bandeau.html]</h3>
<p>Le fragment <strong>[v-bandeau.html]</strong> affiche le bandeau supérieur de toutes les vues de l’application web :</p>
<p><img src="images/1000000100000346000000B87F0E529F.png" style="width:11.411cm;height:2.5cm;" alt="Image" /></p>
<p>Le code du fragment <strong>[v-bandeau.html]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">Bootstrap</span> <span class="n">Jumbotron</span> <span class="o">--&gt;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;jumbotron&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-4&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a>            <span class="o">&lt;</span><span class="n">img</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;{{ url_for(&#39;static&#39;, filename=&#39;images/logo.jpg&#39;) }}&quot;</span> <span class="n">alt</span><span class="o">=</span><span class="s2">&quot;Cerisier en fleurs&quot;</span><span class="o">/&gt;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a>            <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a>                <span class="n">Calculez</span> <span class="n">votre</span> <span class="n">impôt</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a>            <span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 2-13 : le bandeau est encapsulé dans une section Bootstrap de type Jumbotron <strong>[&lt;div class=&quot;jumbotron&quot;&gt;]</strong>. Cette classe Bootstrap stylise d’une façon particulière le contenu affiché pour le faire ressortir ;</li>
<li>lignes 3-12 : une ligne Bootstrap ;</li>
<li>lignes 4-6 : une image <strong>[img]</strong> est placée dans les quatre premières colonnes de la ligne ;</li>
<li>ligne 5 : la syntaxe :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="p">{{</span> <span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;static&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;images/logo.jpg&#39;</span><span class="p">)</span> <span class="p">}}</span>
</code></pre></div></td></tr></table></div></li>
</ul>
<p>utilise la fonction <strong>[url_for]</strong> de Flask. Ici, sa valeur sera l’URL du fichier <strong>[images/logo.pg]</strong> du dossier <strong>[static]</strong> ;</p>
<ul>
<li>lignes 7-11 : les 8 autres colonnes de la ligne (on rappelle qu’il y en a 12 au total) serviront à placer un texte (ligne 9) en gros caractères (&lt;h1&gt;, lignes 8-10) ;</li>
</ul>
<h3 id="3253-le-fragment-v-authentificationhtml">32.5.3. Le fragment [v-authentification.html]</h3>
<p>Le fragment <strong>[v-authentification.html]</strong> affiche le formulaire d’authentification de l’application web :</p>
<p><img src="images/100000000000026800000129E13D08C5.png" style="width:7.122cm;height:3.432cm;" alt="Image" /></p>
<p>Le code du fragment <strong>[v-authentification.html]</strong> est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span>
<span class="normal"><a href="#__codelineno-4-35">35</a></span>
<span class="normal"><a href="#__codelineno-4-36">36</a></span>
<span class="normal"><a href="#__codelineno-4-37">37</a></span>
<span class="normal"><a href="#__codelineno-4-38">38</a></span>
<span class="normal"><a href="#__codelineno-4-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">formulaire</span> <span class="n">HTML</span> <span class="o">-</span> <span class="n">on</span> <span class="n">poste</span> <span class="n">ses</span> <span class="n">valeurs</span> <span class="n">avec</span> <span class="n">l</span><span class="s1">&#39;action [authentifier-utilisateur] --&gt;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;/authentifier-utilisateur&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">titre</span> <span class="o">--&gt;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert alert-primary&quot;</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a>        <span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">Veuillez</span> <span class="n">vous</span> <span class="n">authentifier</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">formulaire</span> <span class="n">Bootstrap</span> <span class="o">--&gt;</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>    <span class="o">&lt;</span><span class="n">fieldset</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="mi">1</span><span class="n">ère</span> <span class="n">ligne</span> <span class="o">--&gt;</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a>            <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">libellé</span> <span class="o">--&gt;</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>            <span class="o">&lt;</span><span class="n">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;user&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-3 col-form-label&quot;</span><span class="o">&gt;</span><span class="n">Nom</span> <span class="n">d</span><span class="s1">&#39;utilisateur&lt;/label&gt;</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-4&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a>                <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">zone</span> <span class="n">de</span> <span class="n">saisie</span> <span class="n">texte</span> <span class="o">--&gt;</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>                <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;user&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;user&quot;</span>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a>                       <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Nom d&#39;utilisateur&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;{{ modèle.login }}&quot;</span> <span class="n">required</span><span class="o">&gt;</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="mi">2</span><span class="n">ième</span> <span class="n">ligne</span> <span class="o">--&gt;</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a>            <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">libellé</span> <span class="o">--&gt;</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>            <span class="o">&lt;</span><span class="n">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-3 col-form-label&quot;</span><span class="o">&gt;</span><span class="n">Mot</span> <span class="n">de</span> <span class="n">passe</span><span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a>            <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">zone</span> <span class="n">de</span> <span class="n">saisie</span> <span class="n">texte</span> <span class="o">--&gt;</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-4&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a>                <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;password&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;password&quot;</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a>                       <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Mot de passe&quot;</span> <span class="n">required</span><span class="o">&gt;</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">bouton</span> <span class="n">de</span> <span class="nb">type</span> <span class="p">[</span><span class="n">submit</span><span class="p">]</span> <span class="n">sur</span> <span class="n">une</span> <span class="mi">3</span><span class="n">ième</span> <span class="n">ligne</span> <span class="o">--&gt;</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-2&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a>                <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;btn btn-primary&quot;</span><span class="o">&gt;</span><span class="n">Valider</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-4-37" name="__codelineno-4-37"></a>    <span class="o">&lt;/</span><span class="n">fieldset</span><span class="o">&gt;</span>
<a id="__codelineno-4-38" name="__codelineno-4-38"></a>
<a id="__codelineno-4-39" name="__codelineno-4-39"></a><span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 2-39 : la balise &lt;form&gt; délimite un formulaire HTML. Celui-ci a en général les caractéristiques suivantes :</li>
<li>il définit des zones de saisies (balises &lt;<strong>input</strong>&gt; des lignes 17 et 27 ;</li>
<li>il a un bouton de type <strong>[submit]</strong> (ligne 34) qui envoie les valeurs saisies à l’URL indiquée dans l’attribut <strong>[action]</strong> de la balise <strong>[form]</strong> (ligne 2). La méthode HTTP utilisée pour requêter cette URL est précisée dans l’attribut <strong>[method]</strong> de la balise <strong>[form]</strong> (ligne 2) ;</li>
<li>ici, lorsque l’utilisateur va cliquer sur le bouton <strong>[Valider]</strong> (ligne 34), le navigateur va poster (ligne 2) les valeurs saisies dans le formulaire à l’URL <strong>[/authentifier-utilisateur]</strong> (ligne 2) ;</li>
<li>les valeurs postées sont les valeurs saisies par l’utilisateur dans les zones de saisie des lignes 17 et 27. Elles seront postées dans le corps de la requête HTTP que fera le navigateur sous la forme <strong>[x-www-forl-urlencoded]</strong>. Les noms des paramètres <strong>[user, password]</strong> sont ceux des attributs <strong>[name]</strong> des zones de saisie des lignes 17 et 27 ;</li>
<li>ligne 5-7 : une section Bootstrap pour afficher un titre dans un fond bleu :</li>
<li>lignes 10-37 : un formulaire Bootstrap. Tous les éléments du formulaire vont alors être stylisés d’une certaine façon ;</li>
</ul>
<p><img src="images/10000001000001BE0000005C899AAF7D.png" style="width:5.241cm;height:1.08cm;" alt="Image" /></p>
<ul>
<li>lignes 12-20 : définissent la 1re ligne Bootstrap du formulaire :</li>
</ul>
<p><img src="images/10000001000001E200000039C2A52CE5.png" style="width:5.762cm;height:0.682cm;" alt="Image" /></p>
<ul>
<li>la ligne 14 définit le libellé <strong>[1]</strong> sur trois colonnes. L’attribut <strong>[for]</strong> de la balise <strong>[label]</strong> relie le libellé à l’attribut <strong>[id]</strong> de la zone de saisie de la ligne 17 ;</li>
<li>lignes 15-19 : met la zone de saisie dans un ensemble de quatre colonnes ;</li>
<li>lignes 17-18 : la balise HTML <strong>[input]</strong> décrit une zone de saisie. Elle a plusieurs paramètres :</li>
<li><strong>[type=’text’]</strong> : c’est une zone de saisie texte. On peut y taper n’importe quoi ;</li>
<li><strong>[class=’form-control’]</strong> : style Bootstrap pour la zone de saisie ;</li>
<li><strong>[id=’user’]</strong> : identifiant de la zone de saisie. Cet identifiant est en général utilisé par le CSS et le code Javascript ;</li>
<li><strong>[name=’user’]</strong> : nom de la zone de saisie. C’est sous ce nom que la valeur saisie par l’utilisateur sera postée par le navigateur <strong>[user=xx]</strong> ;</li>
<li><strong>[placeholder=’invite’]</strong> : le texte affiché dans la zone de saisie lorsque l’utilisateur n’a encore rien tapé ;</li>
</ul>
<p><img src="images/10000001000001CB00000038BE799AF7.png" style="width:5.43cm;height:0.66cm;" alt="Image" /></p>
<ul>
<li><strong>[value=’valeur’]</strong> : le texte ‘valeur’ sera affiché dans la zone de saisie dès que celle-ci sera affichée, avant donc que l’utilisateur ne saisisse autre chose. Ce mécanisme est utilisé en cas d’erreur pour afficher la saisie qui a provoqué l’erreur. Ici cette valeur sera la valeur de la variable <strong>[modèle.login]</strong> ;</li>
<li><strong>[required]</strong> : exige que l’utilisateur mette une valeur pour que le formulaire puisse être envoyé au serveur :</li>
<li>lignes 21-30 : un code analogue pour la saisie du mot de passe ;</li>
<li>ligne 27 : <strong>[type=’password’]</strong> fait qu’on a une zone de saisie texte (on peut taper n’importe quoi) mais les caractètres tapés sont cachés :</li>
</ul>
<p><img src="images/10000001000001D9000000438BE8B79B.png" style="width:5.58cm;height:0.791cm;" alt="Image" /></p>
<ul>
<li>lignes 32-36 : une 3e ligne Bootstrap pour le bouton <strong>[Valider]</strong> ;</li>
<li>ligne 34 : parce qu’il a l’attribut <strong>[type=submit]</strong>, un clic sur ce bouton déclenche l’envoi au serveur par le navigateur des valeurs saisies comme il a été expliqué précédemment. L’attribut CSS <strong>[class=&quot;btn btn-primary&quot;]</strong> affiche un bouton bleu :</li>
</ul>
<p><img src="images/10000001000000AB0000007F9B5E6B41.png" style="width:2.631cm;height:1.952cm;" alt="Image" /></p>
<p>Il nous reste à expliquer une dernière chose. Ligne 2, l’attribut <strong>[action=&quot;/authentifier-utilisateur&quot;]</strong> définit une URL incomplète (elle ne commence pas par http://machine:port/chemin). Dans notre exemple, toutes les URL de l’application sont de la forme <strong>[http://machine:port/chemin/action/param1/param2/..]</strong> où <strong>[</strong><strong>http://machine:port/chemin</strong><strong>]</strong> est la <strong>racine</strong> des URL de service. Dans <strong>[action=&quot;/authentifier-utilisateur&quot;]</strong> nous avons une URL <strong>absolue</strong> ç-à-d mesurée à partir de la racine des URL. L’URL complète du POST est donc <strong>[</strong><strong>http://machine:port/chemin/authentifier-utilisateur</strong><strong>]</strong> et c’est ce qu’utilisera le navigateur.</p>
<p>On retiendra que ce fragment utilise le modèle <strong>[modèle.login]</strong>.</p>
<h3 id="3254-tests-visuels">32.5.4. Tests visuels</h3>
<p>On peut procéder aux tests des vues bien avant leur intégration dans l’application. Il s’agit ici de tester leur aspect visuel. Nous rassemblerons toutes les vues de test dans le dossier <strong>[tests_views]</strong> du projet :</p>
<p><img src="images/1000000000000166000000A52B04C5B3.png" style="width:5.37cm;height:2.481cm;" alt="Image" /></p>
<p>Pour tester la vue V <strong>[vue-authentification.html]</strong>, il nous faut créer le modèle M de données qu’elle va afficher. On le fait avec le script <strong>[test_vue_authentification.py]</strong> :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">make_response</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="c1"># application Flask</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="s2">&quot;../templates&quot;</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s2">&quot;../static&quot;</span><span class="p">)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="c1"># Home URL</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a>    <span class="c1"># on encapsule les données de la pagé dans modèle</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a>    <span class="n">modèle</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>    <span class="c1"># identifiant utilisateur</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;login&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;albert&quot;</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>    <span class="c1"># liste d&#39;erreurs</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a>    <span class="n">erreurs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;erreur1&quot;</span><span class="p">,</span> <span class="s2">&quot;erreur2&quot;</span><span class="p">]</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a>    <span class="c1"># on construit une liste HTML des erreurs</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>    <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>    <span class="k">for</span> <span class="n">erreur</span> <span class="ow">in</span> <span class="n">erreurs</span><span class="p">:</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a>        <span class="n">content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&lt;/li&gt;&quot;</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;erreurs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a>    <span class="c1"># affichage de la page</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;views/vue-authentification.html&quot;</span><span class="p">,</span> <span class="n">modèle</span><span class="o">=</span><span class="n">modèle</span><span class="p">))</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="c1"># main</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 1-3 : on crée une application Flask dont le seul but est d’afficher la vue <strong>[vue-authentification.html]</strong> (ligne 22) ;</li>
<li>ligne 7 : l’application n’a qu’une unique URL de service ;</li>
<li>lignes 9-20 : la vue d’authentification a des parties dynamiques contrôlées par l’objet <strong>[modèle]</strong>. On appelle cet objet le <strong>modèle de la vue</strong>. Selon l’une des deux définitions données pour le sigle MVC, on a là le M du MVC. Lors de la définition de la vue <strong>[vue-authentification.html]</strong>, nous avions identifié trois valeurs dynamiques :</li>
<li><strong>[modèle.error]</strong> : booléen indiquant s’il faut afficher un message d’erreur ;</li>
<li><strong>[modèle.erreurs]</strong> : une liste HTML de messages d’erreur ;</li>
<li>
<p><strong>[modèle.login]</strong> : le login d’un utilisateur ;
Il nous faut donc définir ces trois valeurs dynamiques.</p>
</li>
<li>
<p>lignes 9-20 : on définit les trois éléments dynamiques de la vue d’authentification ;
Pour faire le test, on lance le script <strong>[tests_views/test_vue_authentification.py]</strong> et on demande l’URL <strong>[/localhost:5000/]</strong> :</p>
</li>
</ul>
<p>On poursuit ces tests visuels jusqu’à être satisfait du résultat.</p>
<p><img src="images/10000000000004DE00000352D1ABD82F.png" style="width:14.371cm;height:9.82cm;" alt="Image" /></p>
<h3 id="3255-calcul-du-modele-de-la-vue">32.5.5. Calcul du modèle de la vue</h3>
<p>Une fois l’aspect visuel de la vue déterminé, on peut procéder au calcul du modèle de la vue en conditions réelles. Les modèles des vues seront générées par des classes rassemblées dans le dossier <strong>[models_for_views]</strong> :</p>
<p><img src="images/10000000000001D60000016E73E0CB38.png" style="width:5.421cm;height:4.231cm;" alt="Image" /></p>
<p>Chaque classe générant un modèle de vue respectera l’interface <strong>[</strong><strong>InterfaceModelForView</strong><strong>]</strong> suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.local</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalProxy</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">InterfaceModelForView</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>    <span class="nd">@abstractmethod</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_for_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">résultat</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a>        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 8-10 : la méthode <strong>[</strong><strong>get_model_for_view</strong><strong>]</strong> est chargée de produire un modèle de vue encapsulé dans un dictionnaire. Elle reçoit pour cela les informations suivantes :</li>
<li><strong>[request, session, config]</strong> sont les mêmes paramètres utilisés par le contrôleur de l’action. Ils sont donc également transmis au modèle ;</li>
<li>le contrôleur a produit un résultat <strong>[résultat]</strong> qui est également transmis au modèle. Ce résultat contient un élément important <strong>[état]</strong> qui indique comme s’est passée l’exécution de l’action en cours. Le modèle va utiliser cette information ;
Nous avons vu que dans la configuration <strong>[config]</strong> de l’application, les codes d’état rendus par les contrôleurs sont utilisés pour désigner la vue HTML à afficher :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span>
<span class="normal"><a href="#__codelineno-7-37">37</a></span>
<span class="normal"><a href="#__codelineno-7-38">38</a></span>
<span class="normal"><a href="#__codelineno-7-39">39</a></span>
<span class="normal"><a href="#__codelineno-7-40">40</a></span>
<span class="normal"><a href="#__codelineno-7-41">41</a></span>
<span class="normal"><a href="#__codelineno-7-42">42</a></span>
<span class="normal"><a href="#__codelineno-7-43">43</a></span>
<span class="normal"><a href="#__codelineno-7-44">44</a></span>
<span class="normal"><a href="#__codelineno-7-45">45</a></span>
<span class="normal"><a href="#__codelineno-7-46">46</a></span>
<span class="normal"><a href="#__codelineno-7-47">47</a></span>
<span class="normal"><a href="#__codelineno-7-48">48</a></span>
<span class="normal"><a href="#__codelineno-7-49">49</a></span>
<span class="normal"><a href="#__codelineno-7-50">50</a></span>
<span class="normal"><a href="#__codelineno-7-51">51</a></span>
<span class="normal"><a href="#__codelineno-7-52">52</a></span>
<span class="normal"><a href="#__codelineno-7-53">53</a></span>
<span class="normal"><a href="#__codelineno-7-54">54</a></span>
<span class="normal"><a href="#__codelineno-7-55">55</a></span>
<span class="normal"><a href="#__codelineno-7-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a>        <span class="c1"># les vues HTML et leurs modèles dépendent de l&#39;état rendu par le contrôleur</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a>        <span class="s2">&quot;views&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>            <span class="p">{</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>                <span class="c1"># vue d&#39;authentification</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>                    <span class="c1"># /init-session réussite</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>                    <span class="mi">700</span><span class="p">,</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>                    <span class="c1"># /authentifier-utilisateur échec</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>                    <span class="mi">201</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>                <span class="p">],</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-authentification.html&quot;</span><span class="p">,</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForAuthentificationView</span><span class="p">()</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>            <span class="p">},</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>            <span class="p">{</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>                <span class="c1"># vue du calcul de l&#39;impôt</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>                    <span class="c1"># /authentifier-utilisateur réussite</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a>                    <span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a>                    <span class="c1"># /calculer-impot réussite</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a>                    <span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a>                    <span class="c1"># /calculer-impot échec</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a>                    <span class="mi">301</span><span class="p">,</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a>                    <span class="c1"># /afficher-calcul-impot</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a>                    <span class="mi">800</span>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a>                <span class="p">],</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-calcul-impot.html&quot;</span><span class="p">,</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForCalculImpotView</span><span class="p">()</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a>            <span class="p">},</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a>            <span class="p">{</span>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a>                <span class="c1"># vue de la liste des simulations</span>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a>                    <span class="c1"># /lister-simulations</span>
<a id="__codelineno-7-33" name="__codelineno-7-33"></a>                    <span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-7-34" name="__codelineno-7-34"></a>                    <span class="c1"># /supprimer-simulation</span>
<a id="__codelineno-7-35" name="__codelineno-7-35"></a>                    <span class="mi">600</span>
<a id="__codelineno-7-36" name="__codelineno-7-36"></a>                <span class="p">],</span>
<a id="__codelineno-7-37" name="__codelineno-7-37"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-liste-simulations.html&quot;</span><span class="p">,</span>
<a id="__codelineno-7-38" name="__codelineno-7-38"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForListeSimulationsView</span><span class="p">()</span>
<a id="__codelineno-7-39" name="__codelineno-7-39"></a>            <span class="p">}</span>
<a id="__codelineno-7-40" name="__codelineno-7-40"></a>        <span class="p">],</span>
<a id="__codelineno-7-41" name="__codelineno-7-41"></a>        <span class="c1"># vue des erreurs inattendues</span>
<a id="__codelineno-7-42" name="__codelineno-7-42"></a>        <span class="s2">&quot;view-erreurs&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-7-43" name="__codelineno-7-43"></a>            <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-erreurs.html&quot;</span><span class="p">,</span>
<a id="__codelineno-7-44" name="__codelineno-7-44"></a>            <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForErreursView</span><span class="p">()</span>
<a id="__codelineno-7-45" name="__codelineno-7-45"></a>        <span class="p">},</span>
<a id="__codelineno-7-46" name="__codelineno-7-46"></a>        <span class="c1"># redirections</span>
<a id="__codelineno-7-47" name="__codelineno-7-47"></a>        <span class="s2">&quot;redirections&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-7-48" name="__codelineno-7-48"></a>            <span class="p">{</span>
<a id="__codelineno-7-49" name="__codelineno-7-49"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-7-50" name="__codelineno-7-50"></a>                    <span class="mi">400</span><span class="p">,</span>  <span class="c1"># /fin-session réussite</span>
<a id="__codelineno-7-51" name="__codelineno-7-51"></a>                <span class="p">],</span>
<a id="__codelineno-7-52" name="__codelineno-7-52"></a>                <span class="c1"># redirection vers</span>
<a id="__codelineno-7-53" name="__codelineno-7-53"></a>                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;/init-session/html&quot;</span><span class="p">,</span>
<a id="__codelineno-7-54" name="__codelineno-7-54"></a>            <span class="p">}</span>
<a id="__codelineno-7-55" name="__codelineno-7-55"></a>        <span class="p">],</span>
<a id="__codelineno-7-56" name="__codelineno-7-56"></a>    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Ce sont donc les codes d’état <strong>[700, 201]</strong> (lignes 7 et 9) qui font afficher la vue d’authentification. Pour retrouver la signification de ces codes, on peut s’aider des tests <strong>[Postman]</strong> réalisés sur l’application jSON :</p>
<ul>
<li><strong>[init-session-json-700]</strong> : 700 est le code d’état à l’issue d’une action <strong>[init-session]</strong> réussie : on présente alors le formulaire d’authentification vide ;</li>
<li><strong>[authentifier-utilisateur-201]</strong> : 201 est le code d’état à l’issue d’une action <strong>[authentifier-utilisateur]</strong> ayant échoué (identifiants non reconnus) : on présente alors le formulaire d’authentification pour qu’il soit corrigé ;
Maintenant que nous savons à quels moments doit être affiché le formulaire d’authentification, on peut calculer son modèle dans <strong>[</strong><strong>ModelForAuthentificationView</strong><strong>]</strong> (ligne 12) :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.local</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalProxy</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceModelForView</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceModelForView</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">ModelForAuthentificationView</span><span class="p">(</span><span class="n">InterfaceModelForView</span><span class="p">):</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_for_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">résultat</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>        <span class="c1"># on encapsule les données de la pagé dans modèle</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>        <span class="n">modèle</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>        <span class="c1"># état de l&#39;application</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>        <span class="n">état</span> <span class="o">=</span> <span class="n">résultat</span><span class="p">[</span><span class="s2">&quot;état&quot;</span><span class="p">]</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>        <span class="c1"># le modèle dépend de l&#39;état</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>        <span class="k">if</span> <span class="n">état</span> <span class="o">==</span> <span class="mi">700</span><span class="p">:</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>            <span class="c1"># cas de l&#39;affichage du formulaire vide</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;login&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a>            <span class="c1"># il n&#39;y pas d&#39;erreur à afficher</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>        <span class="k">elif</span> <span class="n">état</span> <span class="o">==</span> <span class="mi">201</span><span class="p">:</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>            <span class="c1"># authentification erronée</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a>            <span class="c1"># on réaffiche l&#39;utilisateur initialement saisi</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;login&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a>            <span class="c1"># il y a une erreur à afficher</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a>            <span class="c1"># liste HTML de msg d&#39;erreur</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a>            <span class="n">erreurs</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a>            <span class="k">for</span> <span class="n">erreur</span> <span class="ow">in</span> <span class="n">résultat</span><span class="p">[</span><span class="s2">&quot;réponse&quot;</span><span class="p">]:</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a>                <span class="n">erreurs</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&lt;/li&gt;&quot;</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;erreurs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">erreurs</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a>        <span class="c1"># on rend le modèle</span>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a>        <span class="k">return</span> <span class="n">modèle</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 8 : la méthode <strong>[get_model_for_view]</strong> de la vue d’authentification doit fournir un dictionnaire avec trois clés <strong>[error, erreurs, login]</strong>. Ce calcul se fait à partir du code d’état rendu par le contrôleur de l’action ;</li>
<li>ligne 12 : on récupère le code d’état rendu par le contrôleur qui a traité l’action en cours ;</li>
<li>lignes 14-29 : le modèle dépend de ce code d’état ;</li>
<li>lignes 15-18 : cas où on doit afficher un formulaire d’authentification vierge ;</li>
<li>lignes 20-29 : cas de l’authentification erronée : on raffiche l’identifiant saisi pour l’utilisateur et on affiche un message d’erreur. L’utilisateur au clavier peut alors réessayer une autre authentification ;</li>
<li>ligne 22 : l’identifiant initialement saisi par l’utilisateur peut être retrouvé dans la requête du client ;</li>
<li>ligne 24 : on signale qu’il y a des erreurs à afficher ;</li>
<li>lignes 26-29 : en cas d’erreur, résultat<strong>[‘réponse’]</strong> contient une liste d’erreurs ;</li>
</ul>
<h3 id="3256-generation-des-reponses-html">32.5.6. Génération des réponses HTML</h3>
<p>Revenons au modèle MVC de l’application HTML :</p>
<ul>
<li>en 2 (2a, 2b) : le contrôleur exécute une action ;</li>
</ul>
<p><img src="images/10000001000003320000010243F9EAD1.png" style="width:13.831cm;height:4.351cm;" alt="Image" /></p>
<ul>
<li>en 3 (3a, 3b, 3c) : une vue est choisie et envoyée au client ;
En <strong>[3a]</strong>, un type de réponse (jSON, XML, HTML) est choisi. Nous avons vu comment les réponses jSON et XML étaient générées mais pas encore les réponses HTML. Celles-ci sont générées par la classe <strong>[HtmlResponse]</strong> :</li>
</ul>
<p><img src="images/100000000000015B000000ABAE6FBE71.png" style="width:4.01cm;height:1.971cm;" alt="Image" /></p>
<p>Rappelons comment dans le script principal <strong>[main]</strong> le type de réponse à faire à l’utilisateur est déterminé :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span>
<span class="normal"><a href="#__codelineno-9-6">6</a></span>
<span class="normal"><a href="#__codelineno-9-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>        <span class="err">…</span><span class="o">.</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>        <span class="c1"># on construit la réponse à envoyer</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>        <span class="n">response_builder</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;responses&quot;</span><span class="p">][</span><span class="n">type_response</span><span class="p">]</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>        <span class="n">response</span><span class="p">,</span> <span class="n">status_code</span> <span class="o">=</span> <span class="n">response_builder</span> \
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>            <span class="o">.</span><span class="n">build_http_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">status_code</span><span class="p">,</span> <span class="n">résultat</span><span class="p">)</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>        <span class="c1"># on envoie la réponse</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>        <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status_code</span>
</code></pre></div></td></tr></table></div>
<p>où, ligne 3, config<strong>[‘responses’]</strong> est le dictionnaire suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span>
<span class="normal"><a href="#__codelineno-10-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>        <span class="c1"># les différents types de réponse (json, xml, html)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>        <span class="s2">&quot;responses&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>            <span class="s2">&quot;json&quot;</span><span class="p">:</span> <span class="n">JsonResponse</span><span class="p">(),</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>            <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="n">HtmlResponse</span><span class="p">(),</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>            <span class="s2">&quot;xml&quot;</span><span class="p">:</span> <span class="n">XmlResponse</span><span class="p">()</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>        <span class="p">},</span>
</code></pre></div></td></tr></table></div>
<p>C’est donc la classe <strong>[HtmlResponse]</strong> qui génère la réponse HTML. Son code est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span>
<span class="normal"><a href="#__codelineno-11-41">41</a></span>
<span class="normal"><a href="#__codelineno-11-42">42</a></span>
<span class="normal"><a href="#__codelineno-11-43">43</a></span>
<span class="normal"><a href="#__codelineno-11-44">44</a></span>
<span class="normal"><a href="#__codelineno-11-45">45</a></span>
<span class="normal"><a href="#__codelineno-11-46">46</a></span>
<span class="normal"><a href="#__codelineno-11-47">47</a></span>
<span class="normal"><a href="#__codelineno-11-48">48</a></span>
<span class="normal"><a href="#__codelineno-11-49">49</a></span>
<span class="normal"><a href="#__codelineno-11-50">50</a></span>
<span class="normal"><a href="#__codelineno-11-51">51</a></span>
<span class="normal"><a href="#__codelineno-11-52">52</a></span>
<span class="normal"><a href="#__codelineno-11-53">53</a></span>
<span class="normal"><a href="#__codelineno-11-54">54</a></span>
<span class="normal"><a href="#__codelineno-11-55">55</a></span>
<span class="normal"><a href="#__codelineno-11-56">56</a></span>
<span class="normal"><a href="#__codelineno-11-57">57</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># dictionnaire des réponses HTML selon l&#39;état contenu dans le résultat</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">render_template</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask.wrappers</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.local</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalProxy</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceResponse</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceResponse</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">HtmlResponse</span><span class="p">(</span><span class="n">InterfaceResponse</span><span class="p">):</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">build_http_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">status_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a>                            <span class="n">résultat</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">Response</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a>        <span class="c1"># la réponse HTML dépend du code d&#39;état rendu par le contrôleur</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a>        <span class="n">état</span> <span class="o">=</span> <span class="n">résultat</span><span class="p">[</span><span class="s2">&quot;état&quot;</span><span class="p">]</span>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a>        <span class="c1"># faut-il faire une redirection ?</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a>        <span class="k">for</span> <span class="n">redirection</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;redirections&quot;</span><span class="p">]:</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a>            <span class="c1"># états nécessitant une redirection</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a>            <span class="n">états</span> <span class="o">=</span> <span class="n">redirection</span><span class="p">[</span><span class="s2">&quot;états&quot;</span><span class="p">]</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a>            <span class="k">if</span> <span class="n">état</span> <span class="ow">in</span> <span class="n">états</span><span class="p">:</span>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a>                <span class="c1"># il faut faire une redirection</span>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a>                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/</span><span class="si">{</span><span class="n">redirection</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_302_FOUND</span>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a>        <span class="c1"># à un état, correspond une vue</span>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a>        <span class="c1"># on cherche celle-ci dans la liste des vues</span>
<a id="__codelineno-11-26" name="__codelineno-11-26"></a>        <span class="n">views_configs</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;views&quot;</span><span class="p">]</span>
<a id="__codelineno-11-27" name="__codelineno-11-27"></a>        <span class="n">trouvé</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-11-28" name="__codelineno-11-28"></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-11-29" name="__codelineno-11-29"></a>        <span class="c1"># on parcourt la liste des vues</span>
<a id="__codelineno-11-30" name="__codelineno-11-30"></a>        <span class="n">nb_views</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">views_configs</span><span class="p">)</span>
<a id="__codelineno-11-31" name="__codelineno-11-31"></a>        <span class="k">while</span> <span class="ow">not</span> <span class="n">trouvé</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nb_views</span><span class="p">:</span>
<a id="__codelineno-11-32" name="__codelineno-11-32"></a>            <span class="c1"># vue n° i</span>
<a id="__codelineno-11-33" name="__codelineno-11-33"></a>            <span class="n">view_config</span> <span class="o">=</span> <span class="n">views_configs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-11-34" name="__codelineno-11-34"></a>            <span class="c1"># états associés à la vue n° i</span>
<a id="__codelineno-11-35" name="__codelineno-11-35"></a>            <span class="n">états</span> <span class="o">=</span> <span class="n">view_config</span><span class="p">[</span><span class="s2">&quot;états&quot;</span><span class="p">]</span>
<a id="__codelineno-11-36" name="__codelineno-11-36"></a>            <span class="c1"># est-ce que l&#39;état cherché se trouve dans les états associés à la vue n° i</span>
<a id="__codelineno-11-37" name="__codelineno-11-37"></a>            <span class="k">if</span> <span class="n">état</span> <span class="ow">in</span> <span class="n">états</span><span class="p">:</span>
<a id="__codelineno-11-38" name="__codelineno-11-38"></a>                <span class="n">trouvé</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-11-39" name="__codelineno-11-39"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-11-40" name="__codelineno-11-40"></a>                <span class="c1"># vue suivante</span>
<a id="__codelineno-11-41" name="__codelineno-11-41"></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-11-42" name="__codelineno-11-42"></a>        <span class="c1"># trouvé ?</span>
<a id="__codelineno-11-43" name="__codelineno-11-43"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">trouvé</span><span class="p">:</span>
<a id="__codelineno-11-44" name="__codelineno-11-44"></a>            <span class="c1"># si aucune vue n&#39;existe pour l&#39;état actuel de l&#39;application</span>
<a id="__codelineno-11-45" name="__codelineno-11-45"></a>            <span class="c1"># on rend la vue d&#39;erreurs</span>
<a id="__codelineno-11-46" name="__codelineno-11-46"></a>            <span class="n">view_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;view-erreurs&quot;</span><span class="p">]</span>
<a id="__codelineno-11-47" name="__codelineno-11-47"></a>
<a id="__codelineno-11-48" name="__codelineno-11-48"></a>        <span class="c1"># on calcule le modèle de la vue à afficher</span>
<a id="__codelineno-11-49" name="__codelineno-11-49"></a>        <span class="n">model_for_view</span> <span class="o">=</span> <span class="n">view_config</span><span class="p">[</span><span class="s2">&quot;model_for_view&quot;</span><span class="p">]</span>
<a id="__codelineno-11-50" name="__codelineno-11-50"></a>        <span class="n">modèle</span> <span class="o">=</span> <span class="n">model_for_view</span><span class="o">.</span><span class="n">get_model_for_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">résultat</span><span class="p">)</span>
<a id="__codelineno-11-51" name="__codelineno-11-51"></a>        <span class="c1"># on génère le code HTML de la réponse</span>
<a id="__codelineno-11-52" name="__codelineno-11-52"></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">render_template</span><span class="p">(</span><span class="n">view_config</span><span class="p">[</span><span class="s2">&quot;view_name&quot;</span><span class="p">],</span> <span class="n">modèle</span><span class="o">=</span><span class="n">modèle</span><span class="p">)</span>
<a id="__codelineno-11-53" name="__codelineno-11-53"></a>        <span class="c1"># on construit la réponse HTTP</span>
<a id="__codelineno-11-54" name="__codelineno-11-54"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
<a id="__codelineno-11-55" name="__codelineno-11-55"></a>        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;text/html; charset=utf-8&#39;</span>
<a id="__codelineno-11-56" name="__codelineno-11-56"></a>        <span class="c1"># on rend le résultat</span>
<a id="__codelineno-11-57" name="__codelineno-11-57"></a>        <span class="k">return</span> <span class="n">response</span><span class="p">,</span> <span class="n">status_code</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>line 11 : la méthode <strong>[</strong><strong>build_http_response</strong><strong>]</strong> chargée de générer la réponse HTML reçoit les paramètres suivants :</li>
<li><strong>[request, session, dict]</strong> : ce sont les paramètres utilisés par le contrôleur pour traiter l’action en cours ;</li>
<li><strong>[status_code, résultat]</strong> sont les deux résultats produits par ce même contrôleur ;</li>
<li>ligne 14 : comme nous l’avons dit, la réponse HTML du serveur dépend du code d’état contenu dans le dictionnaire <strong>[résultat]</strong> ;</li>
<li>lignes 16-22 : on gère d’abord les redirections. Pour l’instant nous allons ignorer ce cas jusqu’au moment où on rencontrera un exemple de redirection. On notera que les redirections sont typiquement un cas d’usage du serveur HTML. On ne rencontre pas ce cas avec les serveurs jSON ouXML ;</li>
<li>lignes 24-41 : on cherche parmi les vues celle dont la liste <strong>[états]</strong> contient l’état recherché ;</li>
<li>
<p>lignes 42-46 : si aucune vue n’a été trouvée, il s’agit d’une erreur inattendue. Prenons un exemple. Dans le fonctionnement normal de l’application, l’action <strong>[/supprimer-simulation]</strong> ne doit jamais boguer. En effet, nous allons voir que cette suppression de simulations se fait à partir de liens générés par le code. Ces liens sont corrects et ne peuvent mener à une erreur. Cependant, nous l’avons vu, l’utilisateur peut taper directement l’URL <strong>[/supprimer-simulation/id]</strong> et provoquer ainsi une erreur. Dans ce cas, le contrôleur <strong>[SupprimerSimulationController]</strong> rend un code d’état 601. Or ce code d’état ne se trouve pas dans la liste des codes d’état menant à l’affichage d’une page HTML. Ce sera donc la vue d’erreur qui sera affichée. Elle est définie ainsi dans la configuration :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a>        <span class="c1"># vue des erreurs inattendues</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>        <span class="s2">&quot;view-erreurs&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>            <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-erreurs.html&quot;</span><span class="p">,</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>            <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForErreursView</span><span class="p">()</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>        <span class="p">},</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>ligne 49 : une fois qu’on connaît la vue à afficher, on récupère la classe générant son modèle. Elle aussi se trouve dans la configuration <strong>[config]</strong> ;</p>
</li>
<li>ligne 50 : une fois cette classe trouvée, on génère le modèle de la vue ;</li>
<li>ligne 52 : une fois le modèle M de la vue V calculé, on peut générer le code HTML de la vue ;</li>
<li>lignes 54-55 : on construit la réponse HTTP de la réponse avec un corps HTML ;</li>
<li>lignes 56-57 : on rend la réponse HTTP avec son code de statut ;</li>
</ul>
<h3 id="3257-tests-postman">32.5.7. Tests [Postman]</h3>
<p>Nous allons exécuter des requêtes produidant les codes <strong>[700, 201]</strong> qui affichent la vue d’authentification :</p>
<ul>
<li><strong>[init-session-html-700]</strong> : 700 est le code d’état à l’issue d’une action <strong>[init-session]</strong> réussie : on présente alors le formulaire d’authentification vide ;</li>
<li><strong>[authentifier-utilisateur-201]</strong> : 201 est le code d’état à l’issue d’une action <strong>[authentifier-utilisateur]</strong> ayant échoué (identifiants non reconnus) : on présente alors le formulaire d’authentification pour qu’il soit corrigé ;
Il suffit de les réutiliser et de voir s’ils affichent bien la vue d’authentification. On montre ici deux cas :</li>
</ul>
<p><u><strong>Cas 1</strong></u><strong> :</strong><strong> [init-session-html-700]</strong>, début d’une session HTML ;</p>
<p><img src="images/10000000000003E7000001833B26F77E.png" style="width:11.51cm;height:4.462cm;" alt="Image" /></p>
<p>La réponse est la suivante :</p>
<p><img src="images/10000000000003B4000002577D92D072.png" style="width:10.962cm;height:6.921cm;" alt="Image" /></p>
<ul>
<li>en <strong>[5]</strong>, le mode <strong>[Preview]</strong> permet de visualiser la page HTML reçue ;</li>
<li>en <strong>[6]</strong>, on a bien le formulaire vide attendu ;</li>
<li>en <strong>[7]</strong>, Postman n’a pas suivi le lien de l’image de la page ;</li>
<li>en <strong>[8]</strong>, le mode <strong>[Raw]</strong> donne accès au HTML reçu ;</li>
</ul>
<p><img src="images/10000000000003FA000002627F66B000.png" style="width:11.741cm;height:7.04cm;" alt="Image" /></p>
<ul>
<li>en <strong>[3]</strong>, le lien que Postman n’a pas chargé. Il a affiché la valeur de l’attribut <strong>[alt=alternative]</strong> qui est affichée lorsque l’image ne peut être chargée. Ici c’est plutôt que Postman n’a pas voulu la charger. On peut le vérifier en demandant l’URL <strong>[http://localhost :5000/static/images.logo.jpg]</strong> avec Postman :
<u><strong>Cas 2</strong></u> : <strong>[authentifier-utilisateur-201]</strong>, authentification erronée</li>
</ul>
<p><img src="images/100000000000020D000001DA0B11771A.png" style="width:6.061cm;height:5.471cm;" alt="Image" /></p>
<p>Maintenant, faisons une authentification erronée, après avoit fait une initialisation de session HTML réussie :</p>
<p><img src="images/1000000000000376000001F3794A6242.png" style="width:10.221cm;height:5.751cm;" alt="Image" /></p>
<p>Ci-dessus :</p>
<ul>
<li>en <strong>[4,7]</strong> : la requête poste la chaîne <strong>[user=bernard&amp;password=thibault]</strong> ;
La réponse est la suivante :</li>
</ul>
<p><img src="images/1000000000000399000002EA1318A5ED.png" style="width:10.651cm;height:8.621cm;" alt="Image" /></p>
<ul>
<li>en <strong>[4]</strong>, un message d’erreur est affiché ;</li>
<li>en <strong>[3]</strong>, l’utilisateur erroné a été réaffiché ;</li>
</ul>
<h3 id="3258-conclusion">32.5.8. Conclusion</h3>
<p>Nous avons pu tester la vue <strong>[vue-authentification.html]</strong> sans avoir écrit les autres vues. Cela a été possible parce que :</p>
<ul>
<li>tous les contrôleurs sont écrits ;</li>
<li><strong>[Postman]</strong> nous permet d’émettre des requêtes vers le serveur sans avoir besoin de toutes les vues. Lorsqu’on écrit les contrôleurs, il faut être prêt à traiter des requêtes qu’aucune vue ne permettrait. On ne doit jamais se dire a priori « cette requête est impossible » . Il faut vérifier ;</li>
</ul>
<h2 id="326-la-vue-de-calcul-de-limpot">32.6. La vue de calcul de l’impôt</h2>
<p><img src="images/10000000000001AA000001C5856996CF.png" style="width:4.911cm;height:5.231cm;" alt="Image" /></p>
<h3 id="3261-presentation-de-la-vue">32.6.1. Présentation de la vue</h3>
<p>La vue de calcul de l’impôt est la suivante :</p>
<p><img src="images/100000000000058F000002ED0FA4DBF4.png" style="width:16.421cm;height:8.64cm;" alt="Image" /></p>
<p>La vue a trois parties :</p>
<ul>
<li>1 : le bandeau supérieur est généré par le fragment <strong>[v-bandeau.html]</strong> déjà présenté ;</li>
<li>2 : le formulaire de calcul de l’impôt généré par le fragment <strong>[v-calcul-impot.html]</strong> ;</li>
<li>3 : un menu présentant deux liens, généré par le fragment <strong>[v-menu.html]</strong> ;
La vue de calcul de l’impôt est générée par le code <strong>[vue-calcul-impot.html]</strong> suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span>
<span class="normal"><a href="#__codelineno-13-14">14</a></span>
<span class="normal"><a href="#__codelineno-13-15">15</a></span>
<span class="normal"><a href="#__codelineno-13-16">16</a></span>
<span class="normal"><a href="#__codelineno-13-17">17</a></span>
<span class="normal"><a href="#__codelineno-13-18">18</a></span>
<span class="normal"><a href="#__codelineno-13-19">19</a></span>
<span class="normal"><a href="#__codelineno-13-20">20</a></span>
<span class="normal"><a href="#__codelineno-13-21">21</a></span>
<span class="normal"><a href="#__codelineno-13-22">22</a></span>
<span class="normal"><a href="#__codelineno-13-23">23</a></span>
<span class="normal"><a href="#__codelineno-13-24">24</a></span>
<span class="normal"><a href="#__codelineno-13-25">25</a></span>
<span class="normal"><a href="#__codelineno-13-26">26</a></span>
<span class="normal"><a href="#__codelineno-13-27">27</a></span>
<span class="normal"><a href="#__codelineno-13-28">28</a></span>
<span class="normal"><a href="#__codelineno-13-29">29</a></span>
<span class="normal"><a href="#__codelineno-13-30">30</a></span>
<span class="normal"><a href="#__codelineno-13-31">31</a></span>
<span class="normal"><a href="#__codelineno-13-32">32</a></span>
<span class="normal"><a href="#__codelineno-13-33">33</a></span>
<span class="normal"><a href="#__codelineno-13-34">34</a></span>
<span class="normal"><a href="#__codelineno-13-35">35</a></span>
<span class="normal"><a href="#__codelineno-13-36">36</a></span>
<span class="normal"><a href="#__codelineno-13-37">37</a></span>
<span class="normal"><a href="#__codelineno-13-38">38</a></span>
<span class="normal"><a href="#__codelineno-13-39">39</a></span>
<span class="normal"><a href="#__codelineno-13-40">40</a></span>
<span class="normal"><a href="#__codelineno-13-41">41</a></span>
<span class="normal"><a href="#__codelineno-13-42">42</a></span>
<span class="normal"><a href="#__codelineno-13-43">43</a></span>
<span class="normal"><a href="#__codelineno-13-44">44</a></span>
<span class="normal"><a href="#__codelineno-13-45">45</a></span>
<span class="normal"><a href="#__codelineno-13-46">46</a></span>
<span class="normal"><a href="#__codelineno-13-47">47</a></span>
<span class="normal"><a href="#__codelineno-13-48">48</a></span>
<span class="normal"><a href="#__codelineno-13-49">49</a></span>
<span class="normal"><a href="#__codelineno-13-50">50</a></span>
<span class="normal"><a href="#__codelineno-13-51">51</a></span>
<span class="normal"><a href="#__codelineno-13-52">52</a></span>
<span class="normal"><a href="#__codelineno-13-53">53</a></span>
<span class="normal"><a href="#__codelineno-13-54">54</a></span>
<span class="normal"><a href="#__codelineno-13-55">55</a></span>
<span class="normal"><a href="#__codelineno-13-56">56</a></span>
<span class="normal"><a href="#__codelineno-13-57">57</a></span>
<span class="normal"><a href="#__codelineno-13-58">58</a></span>
<span class="normal"><a href="#__codelineno-13-59">59</a></span>
<span class="normal"><a href="#__codelineno-13-60">60</a></span>
<span class="normal"><a href="#__codelineno-13-61">61</a></span>
<span class="normal"><a href="#__codelineno-13-62">62</a></span>
<span class="normal"><a href="#__codelineno-13-63">63</a></span>
<span class="normal"><a href="#__codelineno-13-64">64</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">document</span> <span class="n">HTML</span> <span class="o">--&gt;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">doctype</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">Required</span> <span class="n">meta</span> <span class="n">tags</span> <span class="o">--&gt;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">Bootstrap</span> <span class="n">CSS</span> <span class="o">--&gt;</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a>    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a>    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Application</span> <span class="n">impôts</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-15" name="__codelineno-13-15"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">bandeau</span> <span class="o">--&gt;</span>
<a id="__codelineno-13-16" name="__codelineno-13-16"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/v-bandeau.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-13-17" name="__codelineno-13-17"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">ligne</span> <span class="n">à</span> <span class="n">deux</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-13-18" name="__codelineno-13-18"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-19" name="__codelineno-13-19"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">le</span> <span class="n">menu</span> <span class="o">--&gt;</span>
<a id="__codelineno-13-20" name="__codelineno-13-20"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-3&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-21" name="__codelineno-13-21"></a>            <span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/v-menu.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-13-22" name="__codelineno-13-22"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-23" name="__codelineno-13-23"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">le</span> <span class="n">formulaire</span> <span class="n">de</span> <span class="n">calcul</span> <span class="o">--&gt;</span>
<a id="__codelineno-13-24" name="__codelineno-13-24"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-9&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-25" name="__codelineno-13-25"></a>            <span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/v-calcul-impot.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-13-26" name="__codelineno-13-26"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-27" name="__codelineno-13-27"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-28" name="__codelineno-13-28"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">cas</span> <span class="n">du</span> <span class="n">succès</span> <span class="o">--&gt;</span>
<a id="__codelineno-13-29" name="__codelineno-13-29"></a>
<a id="__codelineno-13-30" name="__codelineno-13-30"></a>    <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">modèle</span><span class="o">.</span><span class="n">success</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-13-31" name="__codelineno-13-31"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">on</span> <span class="n">affiche</span> <span class="n">une</span> <span class="n">alerte</span> <span class="n">de</span> <span class="n">réussite</span> <span class="o">--&gt;</span>
<a id="__codelineno-13-32" name="__codelineno-13-32"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-33" name="__codelineno-13-33"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-3&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-34" name="__codelineno-13-34"></a>
<a id="__codelineno-13-35" name="__codelineno-13-35"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-36" name="__codelineno-13-36"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-9&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-37" name="__codelineno-13-37"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert alert-success&quot;</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-38" name="__codelineno-13-38"></a>                <span class="p">{{</span><span class="n">modèle</span><span class="o">.</span><span class="n">impôt</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">br</span><span class="o">&gt;</span>
<a id="__codelineno-13-39" name="__codelineno-13-39"></a>                <span class="p">{{</span><span class="n">modèle</span><span class="o">.</span><span class="n">décôte</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">br</span><span class="o">&gt;</span>
<a id="__codelineno-13-40" name="__codelineno-13-40"></a>                <span class="p">{{</span><span class="n">modèle</span><span class="o">.</span><span class="n">réduction</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">br</span><span class="o">&gt;</span>
<a id="__codelineno-13-41" name="__codelineno-13-41"></a>                <span class="p">{{</span><span class="n">modèle</span><span class="o">.</span><span class="n">surcôte</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">br</span><span class="o">&gt;</span>
<a id="__codelineno-13-42" name="__codelineno-13-42"></a>                <span class="p">{{</span><span class="n">modèle</span><span class="o">.</span><span class="n">taux</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">br</span><span class="o">&gt;</span>
<a id="__codelineno-13-43" name="__codelineno-13-43"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-44" name="__codelineno-13-44"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-45" name="__codelineno-13-45"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-46" name="__codelineno-13-46"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-13-47" name="__codelineno-13-47"></a>
<a id="__codelineno-13-48" name="__codelineno-13-48"></a>    <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">modèle</span><span class="o">.</span><span class="n">error</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-13-49" name="__codelineno-13-49"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">liste</span> <span class="n">des</span> <span class="n">erreurs</span> <span class="n">sur</span> <span class="mi">9</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-13-50" name="__codelineno-13-50"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-51" name="__codelineno-13-51"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-3&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-52" name="__codelineno-13-52"></a>
<a id="__codelineno-13-53" name="__codelineno-13-53"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-54" name="__codelineno-13-54"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-9&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-55" name="__codelineno-13-55"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-13-56" name="__codelineno-13-56"></a>                <span class="n">Les</span> <span class="n">erreurs</span> <span class="n">suivantes</span> <span class="n">se</span> <span class="n">sont</span> <span class="n">produites</span> <span class="p">:</span>
<a id="__codelineno-13-57" name="__codelineno-13-57"></a>                <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">modèle</span><span class="o">.</span><span class="n">erreurs</span> <span class="o">|</span> <span class="n">safe</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
<a id="__codelineno-13-58" name="__codelineno-13-58"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-59" name="__codelineno-13-59"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-60" name="__codelineno-13-60"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-61" name="__codelineno-13-61"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-13-62" name="__codelineno-13-62"></a><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-13-63" name="__codelineno-13-63"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-13-64" name="__codelineno-13-64"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>nous ne commentons que des nouveautés encore non rencontrées ;</li>
<li>ligne 16 : inclusion du bandeau supérieur de la vue dans la première ligne Bootstrap de la vue ;</li>
<li>ligne 21 : inclusion du menu qui occupera trois colonnes de la seconde ligne Bootstrap de la vue (lignes 18, 20) ;</li>
<li>ligne 25 : inclusion du formulaire de calcul d’impôt qui occupera neuf colonnes (ligne 24) de la seconde ligne Bootstrap de la vue (ligne 18) ;</li>
<li>lignes 30-46 : si le calcul de l’impôt réussit <strong>[modèle.success=True]</strong>, alors le résultat du calcul de l’impôt est affiché dans un cadre vert (lignes 37-43). Ce cadre est dans la troisième ligne Bootstrap de la vue (ligne 32) et occupe neuf colonnes (ligne 36) à droite de trois colonnes vides (lignes 33-35). Ce cadre sera donc sous le formulaire de calcul de l’impôt ;</li>
<li>lignes 48-61 : si le calcul de l’impôt échoue <strong>[modèle.error=True]</strong>, alors un message d’erreur est affiché dans un cadre rose (lignes 55-58). Ce cadre est dans la troisième ligne Bootstrap de la vue (ligne 50) et occupe neuf colonnes (ligne 54) à droite de trois colonnes vides (lignes 51-53). Ce cadre sera donc lui aussi sous le formulaire de calcul de l’impôt ;</li>
</ul>
<h3 id="3262-le-fragment-v-calcul-impothtml">32.6.2. Le fragment [v-calcul-impot.html]</h3>
<p>Le fragment <strong>[v-calcul-impot.html]</strong> affiche le formulaire de calcul de l’impôt de l’application web :</p>
<p>Le code du fragment <strong>[v-calcul-impot.html]</strong> est le suivant :</p>
<p><img src="images/100000000000032E000001882D8EB473.png" style="width:9.39cm;height:4.53cm;" alt="Image" /></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span>
<span class="normal"><a href="#__codelineno-14-32">32</a></span>
<span class="normal"><a href="#__codelineno-14-33">33</a></span>
<span class="normal"><a href="#__codelineno-14-34">34</a></span>
<span class="normal"><a href="#__codelineno-14-35">35</a></span>
<span class="normal"><a href="#__codelineno-14-36">36</a></span>
<span class="normal"><a href="#__codelineno-14-37">37</a></span>
<span class="normal"><a href="#__codelineno-14-38">38</a></span>
<span class="normal"><a href="#__codelineno-14-39">39</a></span>
<span class="normal"><a href="#__codelineno-14-40">40</a></span>
<span class="normal"><a href="#__codelineno-14-41">41</a></span>
<span class="normal"><a href="#__codelineno-14-42">42</a></span>
<span class="normal"><a href="#__codelineno-14-43">43</a></span>
<span class="normal"><a href="#__codelineno-14-44">44</a></span>
<span class="normal"><a href="#__codelineno-14-45">45</a></span>
<span class="normal"><a href="#__codelineno-14-46">46</a></span>
<span class="normal"><a href="#__codelineno-14-47">47</a></span>
<span class="normal"><a href="#__codelineno-14-48">48</a></span>
<span class="normal"><a href="#__codelineno-14-49">49</a></span>
<span class="normal"><a href="#__codelineno-14-50">50</a></span>
<span class="normal"><a href="#__codelineno-14-51">51</a></span>
<span class="normal"><a href="#__codelineno-14-52">52</a></span>
<span class="normal"><a href="#__codelineno-14-53">53</a></span>
<span class="normal"><a href="#__codelineno-14-54">54</a></span>
<span class="normal"><a href="#__codelineno-14-55">55</a></span>
<span class="normal"><a href="#__codelineno-14-56">56</a></span>
<span class="normal"><a href="#__codelineno-14-57">57</a></span>
<span class="normal"><a href="#__codelineno-14-58">58</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">formulaire</span> <span class="n">HTML</span> <span class="n">posté</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;/calculer-impot&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">message</span> <span class="n">sur</span> <span class="mi">12</span> <span class="n">colonnes</span> <span class="n">sur</span> <span class="n">fond</span> <span class="n">bleu</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-12&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert alert-primary&quot;</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a>            <span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">Remplissez</span> <span class="n">le</span> <span class="n">formulaire</span> <span class="n">ci</span><span class="o">-</span><span class="n">dessous</span> <span class="n">puis</span> <span class="n">validez</span><span class="o">-</span><span class="n">le</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">éléments</span> <span class="n">du</span> <span class="n">formulaire</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a>    <span class="o">&lt;</span><span class="n">fieldset</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">première</span> <span class="n">ligne</span> <span class="n">sur</span> <span class="mi">9</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a>            <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">libellé</span> <span class="n">sur</span> <span class="mi">4</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a>            <span class="o">&lt;</span><span class="n">legend</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-form-label col-md-4 pt-0&quot;</span><span class="o">&gt;</span><span class="n">Etes</span><span class="o">-</span><span class="n">vous</span> <span class="n">marié</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="n">ou</span> <span class="n">pacsé</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="err">?</span><span class="o">&lt;/</span><span class="n">legend</span><span class="o">&gt;</span>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a>            <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">boutons</span> <span class="n">radio</span> <span class="n">sur</span> <span class="mi">5</span> <span class="n">colonnes</span><span class="o">--&gt;</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-5&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-check&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a>                    <span class="o">&lt;</span><span class="nb">input</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-check-input&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;radio&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;marié&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;gridRadios1&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;oui&quot;</span> <span class="p">{{</span><span class="n">modèle</span><span class="o">.</span><span class="n">checkedOui</span><span class="p">}}</span><span class="o">&gt;</span>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a>                    <span class="o">&lt;</span><span class="n">label</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-check-label&quot;</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;gridRadios1&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a>                        <span class="n">Oui</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>                    <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a>                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a>                <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-check&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a>                    <span class="o">&lt;</span><span class="nb">input</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-check-input&quot;</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;radio&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;marié&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;gridRadios2&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;non&quot;</span> <span class="p">{{</span><span class="n">modèle</span><span class="o">.</span><span class="n">checkedNon</span><span class="p">}}</span><span class="o">&gt;</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a>                    <span class="o">&lt;</span><span class="n">label</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-check-label&quot;</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;gridRadios2&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a>                        <span class="n">Non</span>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a>                    <span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a>                <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">deuxième</span> <span class="n">ligne</span> <span class="n">sur</span> <span class="mi">9</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a>            <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">libellé</span> <span class="n">sur</span> <span class="mi">4</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a>            <span class="o">&lt;</span><span class="n">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;enfants&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-4 col-form-label&quot;</span><span class="o">&gt;</span><span class="n">Nombre</span> <span class="n">d</span><span class="s1">&#39;enfants à charge&lt;/label&gt;</span>
<a id="__codelineno-14-35" name="__codelineno-14-35"></a>            <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">zone</span> <span class="n">de</span> <span class="n">saisie</span> <span class="n">numérique</span> <span class="n">du</span> <span class="n">nombre</span> <span class="n">d</span><span class="s1">&#39;enfants sur 5 colonnes --&gt;</span>
<a id="__codelineno-14-36" name="__codelineno-14-36"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-5&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-37" name="__codelineno-14-37"></a>                <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;number&quot;</span> <span class="nb">min</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">step</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;enfants&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;enfants&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Nombre d&#39;enfants à charge&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;{{modèle.enfants}}&quot;</span> <span class="n">required</span><span class="o">&gt;</span>
<a id="__codelineno-14-38" name="__codelineno-14-38"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-39" name="__codelineno-14-39"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-40" name="__codelineno-14-40"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">troisème</span> <span class="n">ligne</span> <span class="n">sur</span> <span class="mi">9</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-41" name="__codelineno-14-41"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-42" name="__codelineno-14-42"></a>            <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">libellé</span> <span class="n">sur</span> <span class="mi">4</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-43" name="__codelineno-14-43"></a>            <span class="o">&lt;</span><span class="n">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;salaire&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-4 col-form-label&quot;</span><span class="o">&gt;</span><span class="n">Salaire</span> <span class="n">annuel</span> <span class="n">net</span> <span class="n">imposable</span><span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
<a id="__codelineno-14-44" name="__codelineno-14-44"></a>            <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">zone</span> <span class="n">de</span> <span class="n">saisie</span> <span class="n">numérique</span> <span class="n">pour</span> <span class="n">le</span> <span class="n">salaire</span> <span class="n">sur</span> <span class="mi">5</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-45" name="__codelineno-14-45"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-5&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-46" name="__codelineno-14-46"></a>                <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;number&quot;</span> <span class="nb">min</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">step</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-control&quot;</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;salaire&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;salaire&quot;</span> <span class="n">placeholder</span><span class="o">=</span><span class="s2">&quot;Salaire annuel net imposable&quot;</span> <span class="n">aria</span><span class="o">-</span><span class="n">describedby</span><span class="o">=</span><span class="s2">&quot;salaireHelp&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;{{modèle.salaire}}&quot;</span> <span class="n">required</span><span class="o">&gt;</span>
<a id="__codelineno-14-47" name="__codelineno-14-47"></a>                <span class="o">&lt;</span><span class="n">small</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;salaireHelp&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-text text-muted&quot;</span><span class="o">&gt;</span><span class="n">Arrondissez</span> <span class="n">à</span> <span class="n">l</span><span class="s1">&#39;euro inférieur&lt;/small&gt;</span>
<a id="__codelineno-14-48" name="__codelineno-14-48"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-49" name="__codelineno-14-49"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-50" name="__codelineno-14-50"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">quatrième</span> <span class="n">ligne</span><span class="p">,</span> <span class="n">bouton</span> <span class="p">[</span><span class="n">submit</span><span class="p">]</span> <span class="n">sur</span> <span class="mi">5</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-14-51" name="__codelineno-14-51"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-group row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-52" name="__codelineno-14-52"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-5&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-14-53" name="__codelineno-14-53"></a>                <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;btn btn-primary&quot;</span><span class="o">&gt;</span><span class="n">Valider</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>
<a id="__codelineno-14-54" name="__codelineno-14-54"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-55" name="__codelineno-14-55"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-14-56" name="__codelineno-14-56"></a>    <span class="o">&lt;/</span><span class="n">fieldset</span><span class="o">&gt;</span>
<a id="__codelineno-14-57" name="__codelineno-14-57"></a>
<a id="__codelineno-14-58" name="__codelineno-14-58"></a><span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 2 : le formulaire HTML sera posté (attribut <strong>[method]</strong>) à l’URL <strong>[/calculer-impot]</strong> (attribut <strong>[action]</strong>). Les valeurs postées seront les valeurs des zones de saisie :</li>
<li>la valeur du bouton radio coché sous la forme :</li>
<li><strong>[marié=oui]</strong> si le bouton radio <strong>[Oui]</strong> est coché (lignes 17-22). <strong>[marié]</strong> est la valeur de l’attribut <strong>[name]</strong> de la ligne 18, <strong>[oui]</strong> la valeur de l’attribut <strong>[value]</strong> de la ligne 18 ;</li>
<li><strong>[marié=non]</strong> si le bouton radio <strong>[Non]</strong> est coché (lignes 23-28). <strong>[marié]</strong> est la valeur de l’attribut <strong>[name]</strong> de la ligne 24, <strong>[non]</strong> la valeur de l’attribut <strong>[value]</strong> de la ligne 24 ;</li>
<li>la valeur de la zone de saisie numérique de la ligne 37 sous la forme <strong>[enfants=xx]</strong> où <strong>[enfants]</strong> est la valeur de l’attribut <strong>[name]</strong> de la ligne 37, et <strong>[xx]</strong> la valeur saisie par l’utilisateur au clavier ;</li>
<li>
<p>la valeur de la zone de saisie numérique de la ligne 46 sous la forme <strong>[salaire=xx]</strong> où <strong>[salaire]</strong> est la valeur de l’attribut <strong>[name]</strong> de la ligne 46, et <strong>[xx]</strong> la valeur saisie par l’utilisateur au clavier ;
Finalement, la valeur postée aura la forme <strong>[marié=xx&amp;enfants=yy&amp;salaire=zz]</strong>.</p>
</li>
<li>
<p>les valeurs saisies seront postées lorsque l’utilisateur cliquera sur le bouton de type <strong>[submit]</strong> de la ligne 53 ;</p>
</li>
<li>lignes 16-30 : les deux boutons radio :</li>
</ul>
<p><img src="images/10000000000002050000004819309F12.png" style="width:5.972cm;height:0.832cm;" alt="Image" /></p>
<p>Les deux boutons radio font partie du même groupe de boutons radio car ils ont le même attribut <strong>[name]</strong> (lignes 18, 24). Le navigateur s’assure que dans un groupe de boutons radio, un seul est coché à un moment donné. Donc cliquer sur l’un désactive celui qui était coché auparavant ;</p>
<ul>
<li>ce sont des boutons radio à cause de l’attribut <strong>[type=&quot;radio&quot;]</strong> (lignes 18, 24) ;</li>
<li>à l’affichage du formulaire (avant saisie), l’un des boutons radio devra être coché : il suffit pour cela d’ajouter l’attribut <strong>[checked=’checked’]</strong> à la balise &lt;input <strong>type=</strong>&quot;radio&quot;&gt; concernée. Cela est réalisé avec des variables dynamiques :</li>
<li><strong>[modèle.checkedOui]</strong> à la ligne 18 ;</li>
<li>
<p><strong>[modèle-&gt;checkedNon]</strong> à la ligne 24 ;
Ces variables feront partie du modèle de la vue.</p>
</li>
<li>
<p>ligne 37 : une zone de saisie numérique <strong>[type=&quot;number&quot;]</strong> avec une valeur minimale de 0 <strong>[min=&quot;0&quot;]</strong>. Dans les navigateurs récents, cela signifie que l’utilisateur ne pourra saisir qu’un nombre &gt;=0. Sur ces mêmes navigateurs récents, la saisie peut être faite avec un variateur qu’on peut cliquer à la hausse ou à la baisse. L’attribut <strong>[step=&quot;1&quot;]</strong> de la ligne 37 indique que le variateur opèrera avec des sauts de 1 unité. Cela a pour conséquence que le variateur ne prendra pour valeur que des entiers progressant de 0 à n avec un pas de 1. Pour la saisie manuelle, cela signifie que les nombres avec virgule ne seront pas acceptés ;</p>
</li>
<li>ligne 37 : lors de certains affichages, la zone de saisie des enfants devra être préremplie avec la dernière saisie faite dans cette zone. On utilise pour cela l’attribut <strong>[value]</strong> qui fixe la valeur à afficher dans la zone de saisie. Cette valeur sera dynamique et générée par la variable <strong>[modèle.enfants]</strong> ;</li>
</ul>
<p><img src="images/10000000000002C6000000352779FFD5.png" style="width:8.191cm;height:0.611cm;" alt="Image" /></p>
<ul>
<li>ligne 37 : l’attribut <strong>[required]</strong> force l’utilisateur à saisir une donnée pour que le formulaire soit validé ;</li>
<li>ligne 46 : mêmes explications pour la saisie du salaire que pour celle des enfants ;</li>
<li>ligne 53 : le bouton de type <strong>[submit]</strong> qui déclenche le POST des valeurs saisies à l’URL <strong>[/calculer-impot]</strong> (ligne 2) ;</li>
</ul>
<p><img src="images/10000000000000710000005EBB2E0843.png" style="width:1.311cm;height:1.08cm;" alt="Image" /></p>
<h3 id="3263-le-fragment-v-menuhtml">32.6.3. Le fragment [v-menu.html]</h3>
<p>Ce fragment affiche un menu à gauche du formulaire de calcul de l’impôt :</p>
<p><img src="images/100000000000017C000001142B3219CB.png" style="width:4.391cm;height:3.181cm;" alt="Image" /></p>
<p>Le code de ce fragment est le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span>
<span class="normal"><a href="#__codelineno-15-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">menu</span> <span class="n">Bootstrap</span> <span class="o">--&gt;</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="o">&lt;</span><span class="n">nav</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;nav flex-column&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">affichage</span> <span class="n">d</span><span class="s1">&#39;une liste de liens HTML --&gt;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>    <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">optionMenu</span> <span class="ow">in</span> <span class="n">modèle</span><span class="o">.</span><span class="n">optionsMenu</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>      <span class="o">&lt;</span><span class="n">a</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;nav-link&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;{{optionMenu.url}}&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">optionMenu</span><span class="o">.</span><span class="n">text</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="o">&lt;/</span><span class="n">nav</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 2-7 : la balise HTML <strong>[nav]</strong> encadre une portion de document HTML présentant des liens de navigation vers d’autres documents ;</li>
<li>ligne 5 : la balise HTML <strong>[a]</strong> introduit un lien de navigation :</li>
<li>
<p><strong>[</strong><strong>optionMenu.url</strong><strong>]</strong> : est l’URL vers laquelle on navigue lorsqu’on clique sur le lien <strong>[</strong><strong>optionMenu.text</strong><strong>]</strong>. C’est alors une opération <strong>[GET </strong><strong>optionMenu.url</strong><strong>]</strong> qui est faite par le navigateur. <strong>[</strong><strong>optionMenu.url</strong><strong>]</strong> sera une URL absolue mesurée à partir de la racine <strong>[http://machine :port/chemin]</strong> de l’application. Ainsi en <strong>[1]</strong>, on créera le lien :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="err">’</span><span class="o">/</span><span class="n">lister</span><span class="o">-</span><span class="n">simulations</span><span class="err">’</span><span class="o">&gt;</span><span class="n">Liste</span> <span class="n">des</span> <span class="n">simulations</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>ligne 5 : le modèle <strong>[modèle.optionsMenu]</strong> du fragment sera une liste de la forme :
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="p">[</span><span class="err">‘</span><span class="n">Liste</span> <span class="n">des</span> <span class="n">simulations</span><span class="err">’</span><span class="p">:</span><span class="err">’</span><span class="o">/</span><span class="n">liste</span><span class="o">-</span><span class="n">simulations</span><span class="err">’</span><span class="p">,</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="err">‘</span><span class="n">Fin</span> <span class="n">de</span> <span class="n">session</span><span class="err">’</span><span class="p">:</span><span class="err">’</span><span class="o">/</span><span class="n">fin</span><span class="o">-</span><span class="n">session</span><span class="err">’</span><span class="p">]</span>
</code></pre></div></td></tr></table></div></p>
</li>
<li>
<p>lignes 2, 7 : les classes CSS <strong>[nav, flex-column, nav-link]</strong> sont des classes Bootstrap qui donnent son apparence au menu ;</p>
</li>
</ul>
<h3 id="3264-test-visuel">32.6.4. Test visuel</h3>
<p>Nous rassemblons ces différents éléments dans le dossier <strong>[Tests]</strong> et nous créons un modèle de test pour la vue <strong>[vue-calcul-impot.html]</strong> :</p>
<p><img src="images/100000000000018F000000AEA1F5B5FB.png" style="width:4.601cm;height:2.012cm;" alt="Image" /></p>
<p>Le script de test <strong>[test_vue_calcul_impot]</strong> sera le suivant :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span>
<span class="normal"><a href="#__codelineno-18-25">25</a></span>
<span class="normal"><a href="#__codelineno-18-26">26</a></span>
<span class="normal"><a href="#__codelineno-18-27">27</a></span>
<span class="normal"><a href="#__codelineno-18-28">28</a></span>
<span class="normal"><a href="#__codelineno-18-29">29</a></span>
<span class="normal"><a href="#__codelineno-18-30">30</a></span>
<span class="normal"><a href="#__codelineno-18-31">31</a></span>
<span class="normal"><a href="#__codelineno-18-32">32</a></span>
<span class="normal"><a href="#__codelineno-18-33">33</a></span>
<span class="normal"><a href="#__codelineno-18-34">34</a></span>
<span class="normal"><a href="#__codelineno-18-35">35</a></span>
<span class="normal"><a href="#__codelineno-18-36">36</a></span>
<span class="normal"><a href="#__codelineno-18-37">37</a></span>
<span class="normal"><a href="#__codelineno-18-38">38</a></span>
<span class="normal"><a href="#__codelineno-18-39">39</a></span>
<span class="normal"><a href="#__codelineno-18-40">40</a></span>
<span class="normal"><a href="#__codelineno-18-41">41</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">make_response</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="c1"># application Flask</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="s2">&quot;../templates&quot;</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s2">&quot;../static&quot;</span><span class="p">)</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="c1"># Home URL</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>    <span class="c1"># on encapsule les données de la pagé dans modèle</span>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>    <span class="n">modèle</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a>    <span class="c1"># formulaire</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;checkedOui&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;checkedNon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;checked=&quot;checked&quot;&#39;</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;enfants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;salaire&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300000</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>    <span class="c1"># message de réussite</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;impôt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Montant de l&#39;impôt : 1000 euros&quot;</span>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;décôte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Décôte : 15 euros&quot;</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;réduction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Réduction : 20 euros&quot;</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;surcôte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Surcôte : 0 euros&quot;</span>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;taux&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Taux d&#39;imposition : 14 %&quot;</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a>    <span class="c1"># message d&#39;erreur</span>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-18-25" name="__codelineno-18-25"></a>    <span class="n">erreurs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;erreur1&quot;</span><span class="p">,</span> <span class="s2">&quot;erreur2&quot;</span><span class="p">]</span>
<a id="__codelineno-18-26" name="__codelineno-18-26"></a>    <span class="c1"># on construit une liste HTML des erreurs</span>
<a id="__codelineno-18-27" name="__codelineno-18-27"></a>    <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-18-28" name="__codelineno-18-28"></a>    <span class="k">for</span> <span class="n">erreur</span> <span class="ow">in</span> <span class="n">erreurs</span><span class="p">:</span>
<a id="__codelineno-18-29" name="__codelineno-18-29"></a>        <span class="n">content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&lt;/li&gt;&quot;</span>
<a id="__codelineno-18-30" name="__codelineno-18-30"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;erreurs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
<a id="__codelineno-18-31" name="__codelineno-18-31"></a>    <span class="c1"># menu</span>
<a id="__codelineno-18-32" name="__codelineno-18-32"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;optionsMenu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-18-33" name="__codelineno-18-33"></a>        <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s1">&#39;Liste des simulations&#39;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/lister-simulations&#39;</span><span class="p">},</span>
<a id="__codelineno-18-34" name="__codelineno-18-34"></a>        <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s1">&#39;Fin de session&#39;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/fin-session&#39;</span><span class="p">}]</span>
<a id="__codelineno-18-35" name="__codelineno-18-35"></a>    <span class="c1"># affichage de la page</span>
<a id="__codelineno-18-36" name="__codelineno-18-36"></a>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;views/vue-calcul-impot.html&quot;</span><span class="p">,</span> <span class="n">modèle</span><span class="o">=</span><span class="n">modèle</span><span class="p">))</span>
<a id="__codelineno-18-37" name="__codelineno-18-37"></a>
<a id="__codelineno-18-38" name="__codelineno-18-38"></a><span class="c1"># main</span>
<a id="__codelineno-18-39" name="__codelineno-18-39"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-18-40" name="__codelineno-18-40"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-18-41" name="__codelineno-18-41"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 9-34 : on initialise toutes les parties dynamiques de la vue <strong>[vue-calcul-impot.html]</strong> et des fragments <strong>[v-calcul-impot.html]</strong> et <strong>[v-menu.html]</strong> ;</li>
<li>ligne 36 : on affiche la vue <strong>[vue-calcul-impot.html]</strong> ;
Lorsqu’on exécute le script de test <strong>[test_vue_calcul_impot]</strong>, on obtient le résultat suivant :</li>
</ul>
<p>On travaille sur cette vue jusqu’à ce que le résultat obtenu visuellement nous convienne. On peut ensuite passer à l’intégration de la vue dans l’application web en cours d’écriture.</p>
<p><img src="images/100000000000058F000004020228DFE9.png" style="width:16.431cm;height:11.84cm;" alt="Image" /></p>
<h3 id="3265-calcul-du-modele-de-la-vue">32.6.5. Calcul du modèle de la vue</h3>
<p>Une fois l’aspect visuel de la vue déterminé, on peut procéder au calcul du modèle de la vue en conditions réelles. Rappelons les codes d’état qui mènent à cette vue. On les trouve dans le fichier de configuration :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a>            <span class="p">{</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>                <span class="c1"># vue du calcul de l&#39;impôt</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>                    <span class="c1"># /authentifier-utilisateur réussite</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>                    <span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>                    <span class="c1"># /calculer-impot réussite</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>                    <span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>                    <span class="c1"># /calculer-impot échec</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>                    <span class="mi">301</span><span class="p">,</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>                    <span class="c1"># /afficher-calcul-impot</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>                    <span class="mi">800</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>                <span class="p">],</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-calcul-impot.html&quot;</span><span class="p">,</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForCalculImpotView</span><span class="p">()</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a>            <span class="p">},</span>
</code></pre></div></td></tr></table></div>
<p>Ce sont donc les codes d’état <strong>[200, 300, 301, 800]</strong> qui font afficher la vue de calcul de l’impôt. Pour retrouver la signification de ces codes, on peut s’aider des tests <strong>[Postman]</strong> réalisés sur l’application jSON :</p>
<ul>
<li><strong>[authentifier-utilisateur-200]</strong> : 200 est le code d’état à l’issue d’une action <strong>[authentifier-utilisateur]</strong> réussie : on présente alors le formulaire de calcul d’impôt vide ;</li>
<li><strong>[calculer-impot-300]</strong> : 300 est le code d’état à l’issue d’une action <strong>[calculer-impot]</strong> réussie. On affiche alors le formulaire de calcul avec les données qui y ont été saisies et le montant de l’impôt. L’utilisateur peut alors refaire un autre calcul ;</li>
<li>le code d’état <strong>[301]</strong> est celui obtenu pour un calcul d’impôt erroné ;</li>
<li>le code d’état <strong>[800]</strong> sera présenté ultérieurement. Nous ne l’avons pas encore rencontré ;
Maintenant que nous savons à quels moments doit être affiché le formulaire de calcul de l’impôt, on peut calculer son modèle dans la classe <strong>[</strong><strong>ModelForCalculImpotView</strong><strong>]</strong> :</li>
</ul>
<p><img src="images/10000000000001A4000000C97AD972D6.png" style="width:4.841cm;height:2.32cm;" alt="Image" /></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span>
<span class="normal"><a href="#__codelineno-20-30">30</a></span>
<span class="normal"><a href="#__codelineno-20-31">31</a></span>
<span class="normal"><a href="#__codelineno-20-32">32</a></span>
<span class="normal"><a href="#__codelineno-20-33">33</a></span>
<span class="normal"><a href="#__codelineno-20-34">34</a></span>
<span class="normal"><a href="#__codelineno-20-35">35</a></span>
<span class="normal"><a href="#__codelineno-20-36">36</a></span>
<span class="normal"><a href="#__codelineno-20-37">37</a></span>
<span class="normal"><a href="#__codelineno-20-38">38</a></span>
<span class="normal"><a href="#__codelineno-20-39">39</a></span>
<span class="normal"><a href="#__codelineno-20-40">40</a></span>
<span class="normal"><a href="#__codelineno-20-41">41</a></span>
<span class="normal"><a href="#__codelineno-20-42">42</a></span>
<span class="normal"><a href="#__codelineno-20-43">43</a></span>
<span class="normal"><a href="#__codelineno-20-44">44</a></span>
<span class="normal"><a href="#__codelineno-20-45">45</a></span>
<span class="normal"><a href="#__codelineno-20-46">46</a></span>
<span class="normal"><a href="#__codelineno-20-47">47</a></span>
<span class="normal"><a href="#__codelineno-20-48">48</a></span>
<span class="normal"><a href="#__codelineno-20-49">49</a></span>
<span class="normal"><a href="#__codelineno-20-50">50</a></span>
<span class="normal"><a href="#__codelineno-20-51">51</a></span>
<span class="normal"><a href="#__codelineno-20-52">52</a></span>
<span class="normal"><a href="#__codelineno-20-53">53</a></span>
<span class="normal"><a href="#__codelineno-20-54">54</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.local</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalProxy</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceModelForView</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceModelForView</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">ModelForCalculImpotView</span><span class="p">(</span><span class="n">InterfaceModelForView</span><span class="p">):</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_for_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">résultat</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>        <span class="c1"># on encapsule les données de la vue dans modèle</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a>        <span class="n">modèle</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a>        <span class="c1"># état de l&#39;application</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>        <span class="n">état</span> <span class="o">=</span> <span class="n">résultat</span><span class="p">[</span><span class="s2">&quot;état&quot;</span><span class="p">]</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>        <span class="c1"># le modèle dépend de l&#39;état</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>        <span class="k">if</span> <span class="n">état</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">800</span><span class="p">]:</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a>            <span class="c1"># affichage initial d&#39;un formulaire vide</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;checkedNon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;checked=&quot;checked&quot;&#39;</span>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;checkedOui&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;enfants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;salaire&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a>        <span class="k">elif</span> <span class="n">état</span> <span class="o">==</span> <span class="mi">300</span><span class="p">:</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a>            <span class="c1"># réussite du calcul - affichage du résultat</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;impôt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Montant de l&#39;impôt : </span><span class="si">{</span><span class="n">résultat</span><span class="p">[</span><span class="s1">&#39;réponse&#39;</span><span class="p">][</span><span class="s1">&#39;impôt&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> euros&quot;</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;décôte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Décôte : </span><span class="si">{</span><span class="n">résultat</span><span class="p">[</span><span class="s2">&quot;réponse&quot;</span><span class="p">][</span><span class="s2">&quot;décôte&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> euros&#39;</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;réduction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Réduction : </span><span class="si">{</span><span class="n">résultat</span><span class="p">[</span><span class="s1">&#39;réponse&#39;</span><span class="p">][</span><span class="s1">&#39;réduction&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> euros&quot;</span>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;surcôte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Surcôte : </span><span class="si">{</span><span class="n">résultat</span><span class="p">[</span><span class="s2">&quot;réponse&quot;</span><span class="p">][</span><span class="s2">&quot;surcôte&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> euros&#39;</span>
<a id="__codelineno-20-30" name="__codelineno-20-30"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;taux&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Taux d&#39;imposition :  </span><span class="si">{</span><span class="n">résultat</span><span class="p">[</span><span class="s1">&#39;réponse&#39;</span><span class="p">][</span><span class="s1">&#39;taux&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">}</span><span class="s2"> %&quot;</span>
<a id="__codelineno-20-31" name="__codelineno-20-31"></a>            <span class="c1"># formulaire rétabli avec les valeurs saisies</span>
<a id="__codelineno-20-32" name="__codelineno-20-32"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;checkedOui&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;checked=&quot;checked&quot;&#39;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;marié&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;oui&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-20-33" name="__codelineno-20-33"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;checkedNon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;checked=&quot;checked&quot;&#39;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;marié&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;non&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-20-34" name="__codelineno-20-34"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;enfants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enfants&quot;</span><span class="p">)</span>
<a id="__codelineno-20-35" name="__codelineno-20-35"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;salaire&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;salaire&quot;</span><span class="p">)</span>
<a id="__codelineno-20-36" name="__codelineno-20-36"></a>        <span class="k">elif</span> <span class="n">état</span> <span class="o">==</span> <span class="mi">301</span><span class="p">:</span>
<a id="__codelineno-20-37" name="__codelineno-20-37"></a>            <span class="c1"># erreur rencontrée - formulaire rétabli avec les valeurs saisies</span>
<a id="__codelineno-20-38" name="__codelineno-20-38"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;checkedOui&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;checked=&quot;checked&quot;&#39;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;marié&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;oui&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-20-39" name="__codelineno-20-39"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;checkedNon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;checked=&quot;checked&quot;&#39;</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;marié&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;non&quot;</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-20-40" name="__codelineno-20-40"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;enfants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enfants&quot;</span><span class="p">)</span>
<a id="__codelineno-20-41" name="__codelineno-20-41"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;salaire&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;salaire&quot;</span><span class="p">)</span>
<a id="__codelineno-20-42" name="__codelineno-20-42"></a>            <span class="c1"># erreur</span>
<a id="__codelineno-20-43" name="__codelineno-20-43"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-20-44" name="__codelineno-20-44"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-20-45" name="__codelineno-20-45"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;erreurs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-20-46" name="__codelineno-20-46"></a>            <span class="k">for</span> <span class="n">erreur</span> <span class="ow">in</span> <span class="n">résultat</span><span class="p">[</span><span class="s1">&#39;réponse&#39;</span><span class="p">]:</span>
<a id="__codelineno-20-47" name="__codelineno-20-47"></a>                <span class="n">modèle</span><span class="p">[</span><span class="s1">&#39;erreurs&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&lt;/li&gt;&quot;</span>
<a id="__codelineno-20-48" name="__codelineno-20-48"></a>
<a id="__codelineno-20-49" name="__codelineno-20-49"></a>        <span class="c1"># options du menu</span>
<a id="__codelineno-20-50" name="__codelineno-20-50"></a>        <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;optionsMenu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-20-51" name="__codelineno-20-51"></a>            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s1">&#39;Liste des simulations&#39;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/lister-simulations&#39;</span><span class="p">},</span>
<a id="__codelineno-20-52" name="__codelineno-20-52"></a>            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s1">&#39;Fin de session&#39;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/fin-session&#39;</span><span class="p">}]</span>
<a id="__codelineno-20-53" name="__codelineno-20-53"></a>        <span class="c1"># on rend le modèle</span>
<a id="__codelineno-20-54" name="__codelineno-20-54"></a>        <span class="k">return</span> <span class="n">modèle</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 12 : la vue à afficher dépend du code d’état rendu par le contrôleur ;</li>
<li>lignes 14-21 : affichage d’un formulaire vide ;</li>
<li>lignes 22-35 : cas du calcul d’impôt réussi. On réaffiche les valeurs saisies ainsi que le montant de l’impôt ;</li>
<li>lignes 36-47 : cas de l’échec du calcul d’impôt ;</li>
<li>lignes 49-52 : calcul des deux options du menu ;</li>
</ul>
<h3 id="3266-tests-postman">32.6.6. Tests [Postman]</h3>
<p>On initialise une session HTML avec la requête <strong>[init-session-html-700]</strong> puis on s’authentifie avec la requête <strong>[authentifier-utilisateur-200]</strong>. Puis nous utilisons la requête <strong>[calculer-impot-300]</strong> suivante :</p>
<p>La réponse du serveur est la suivante :</p>
<p><img src="images/10000000000003E5000001AC3580456F.png" style="width:11.51cm;height:4.941cm;" alt="Image" /></p>
<p><img src="images/1000000000000473000002B95850230D.png" style="width:13.151cm;height:8.041cm;" alt="Image" /></p>
<p>Maintenant essayons la requête <strong>[calculer-impot-301]</strong> suivante :</p>
<p>La réponse du serveur est la suivante :</p>
<p><img src="images/10000000000003E500000219D20DA03D.png" style="width:11.501cm;height:6.19cm;" alt="Image" /></p>
<p>Maintenant essayons un cas inattendu, celui où il manque des paramètres au POST. Ce cas n’est pas possible dans le fonctionneent normal de l’application. Mais n’importe qui peut ‘bricoler’ une requête HTTP comme nous le faisons maintenant :</p>
<p><img src="images/1000000000000472000002C59D6DDEB1.png" style="width:13.14cm;height:8.191cm;" alt="Image" /></p>
<p><img src="images/10000000000003E4000001B651159A85.png" style="width:11.501cm;height:5.07cm;" alt="Image" /></p>
<ul>
<li>
<p>en <strong>[6]</strong>, nous avons décoché le paramètre posté <strong>[marié]</strong> ;
La réponse du serveur est la suivante :</p>
</li>
<li>
<p>en <strong>[3]</strong>, le message d’erreur du serveur ;</p>
</li>
</ul>
<p><img src="images/100000000000047200000266A89B21C3.png" style="width:13.14cm;height:7.092cm;" alt="Image" /></p>
<p>Dans cette application, nous avions le choix. Nous pouvions donner à ce cas d’erreur un code d’état qui envoie la page des erreurs inattendues. Nous avons dans cette application choisi pour chaque contrôleur deux codes d’état :</p>
<ul>
<li><strong>[xx0]</strong> : pour une réussite ;</li>
<li>
<p><strong>[xx1]</strong> : pour un échec ;
Pour les cas d’échec on peut diversifier les codes d’état pour avoir une gestion plus fine des erreurs. Nous aurions pu avoir par exemple :</p>
</li>
<li>
<p><strong>[xx1]</strong> : pour des erreurs à afficher sur la page qui a provoqué l’erreur ;</p>
</li>
<li><strong>[xx2]</strong> : pour des erreurs inattendues dans le cadre d’une utilisation normale de l’application ;</li>
</ul>
<h2 id="327-la-vue-de-la-liste-des-simulations">32.7. La vue de la liste des simulations</h2>
<p><img src="images/10000000000001760000018531656195.png" style="width:4.321cm;height:4.481cm;" alt="Image" /></p>
<h3 id="3271-presentation-de-la-vue">32.7.1. Présentation de la vue</h3>
<p>La vue qui présente la liste des simulations est la suivante :</p>
<p><img src="images/1000000000000473000001EEE8F5E474.png" style="width:13.151cm;height:5.7cm;" alt="Image" /></p>
<p>La vue générée par le code <strong>[vue-liste-simulations.html]</strong> a trois parties :</p>
<ul>
<li>1 : le bandeau supérieur est généré par le fragment <strong>[v-bandeau.html]</strong> déjà présenté ;</li>
<li>3 : le tableau des simulations généré par le fragment <strong>[v-liste-simulations.html]</strong> ;</li>
<li>2 : un menu présentant deux liens, généré par le fragment <strong>[v-menu.html]</strong> déjà présenté ;
La vue des simulations est générée par le code <strong>[vue-liste-simulations.html]</strong> suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span>
<span class="normal"><a href="#__codelineno-21-21">21</a></span>
<span class="normal"><a href="#__codelineno-21-22">22</a></span>
<span class="normal"><a href="#__codelineno-21-23">23</a></span>
<span class="normal"><a href="#__codelineno-21-24">24</a></span>
<span class="normal"><a href="#__codelineno-21-25">25</a></span>
<span class="normal"><a href="#__codelineno-21-26">26</a></span>
<span class="normal"><a href="#__codelineno-21-27">27</a></span>
<span class="normal"><a href="#__codelineno-21-28">28</a></span>
<span class="normal"><a href="#__codelineno-21-29">29</a></span>
<span class="normal"><a href="#__codelineno-21-30">30</a></span>
<span class="normal"><a href="#__codelineno-21-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">document</span> <span class="n">HTML</span> <span class="o">--&gt;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">doctype</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">Required</span> <span class="n">meta</span> <span class="n">tags</span> <span class="o">--&gt;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">Bootstrap</span> <span class="n">CSS</span> <span class="o">--&gt;</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Application</span> <span class="n">impôts</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">bandeau</span> <span class="o">--&gt;</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/v-bandeau.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">ligne</span> <span class="n">à</span> <span class="n">deux</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">menu</span> <span class="n">sur</span> <span class="n">trois</span> <span class="n">colonnes</span><span class="o">--&gt;</span>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-3&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-21-21" name="__codelineno-21-21"></a>            <span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/v-menu.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-21-22" name="__codelineno-21-22"></a>
<a id="__codelineno-21-23" name="__codelineno-21-23"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-21-24" name="__codelineno-21-24"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">liste</span> <span class="n">des</span> <span class="n">simulations</span> <span class="n">sur</span> <span class="mi">9</span> <span class="n">colonnes</span><span class="o">--&gt;</span>
<a id="__codelineno-21-25" name="__codelineno-21-25"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-9&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-21-26" name="__codelineno-21-26"></a>            <span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/v-liste-simulations.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-21-27" name="__codelineno-21-27"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-21-28" name="__codelineno-21-28"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-21-29" name="__codelineno-21-29"></a><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-21-30" name="__codelineno-21-30"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-21-31" name="__codelineno-21-31"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 16 : inclusion du bandeau de l’application <strong>[1]</strong> ;</li>
<li>ligne 21 : inclusion du menu <strong>[2]</strong>. Il sera affiché sur trois colonnes sous le bandeau ;</li>
<li>
<p>ligne 26 : inclusion du tableau des simulations <strong>[3]</strong>. Il sera affiché sur neuf colonnes sous le bandeau et à droite du menu ;
Nous avons déjà commenté deux des trois fragments de cette vue :</p>
</li>
<li>
<p><strong>[v-bandeau.html]</strong> : au paragraphe <a href="#_Le_fragment_[v-bandeau.html]"><u><u>lien</u></u></a> ;</p>
</li>
<li><strong>[v-menu.html]</strong> : au paragraphe <a href="#_Le_fragment_[v-menu.html]"><u><u>lien</u></u></a> ;
Le fragment <strong>[v-liste-simulations.html]</strong> est le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span>
<span class="normal"><a href="#__codelineno-22-27">27</a></span>
<span class="normal"><a href="#__codelineno-22-28">28</a></span>
<span class="normal"><a href="#__codelineno-22-29">29</a></span>
<span class="normal"><a href="#__codelineno-22-30">30</a></span>
<span class="normal"><a href="#__codelineno-22-31">31</a></span>
<span class="normal"><a href="#__codelineno-22-32">32</a></span>
<span class="normal"><a href="#__codelineno-22-33">33</a></span>
<span class="normal"><a href="#__codelineno-22-34">34</a></span>
<span class="normal"><a href="#__codelineno-22-35">35</a></span>
<span class="normal"><a href="#__codelineno-22-36">36</a></span>
<span class="normal"><a href="#__codelineno-22-37">37</a></span>
<span class="normal"><a href="#__codelineno-22-38">38</a></span>
<span class="normal"><a href="#__codelineno-22-39">39</a></span>
<span class="normal"><a href="#__codelineno-22-40">40</a></span>
<span class="normal"><a href="#__codelineno-22-41">41</a></span>
<span class="normal"><a href="#__codelineno-22-42">42</a></span>
<span class="normal"><a href="#__codelineno-22-43">43</a></span>
<span class="normal"><a href="#__codelineno-22-44">44</a></span>
<span class="normal"><a href="#__codelineno-22-45">45</a></span>
<span class="normal"><a href="#__codelineno-22-46">46</a></span>
<span class="normal"><a href="#__codelineno-22-47">47</a></span>
<span class="normal"><a href="#__codelineno-22-48">48</a></span>
<span class="normal"><a href="#__codelineno-22-49">49</a></span>
<span class="normal"><a href="#__codelineno-22-50">50</a></span>
<span class="normal"><a href="#__codelineno-22-51">51</a></span>
<span class="normal"><a href="#__codelineno-22-52">52</a></span>
<span class="normal"><a href="#__codelineno-22-53">53</a></span>
<span class="normal"><a href="#__codelineno-22-54">54</a></span>
<span class="normal"><a href="#__codelineno-22-55">55</a></span>
<span class="normal"><a href="#__codelineno-22-56">56</a></span>
<span class="normal"><a href="#__codelineno-22-57">57</a></span>
<span class="normal"><a href="#__codelineno-22-58">58</a></span>
<span class="normal"><a href="#__codelineno-22-59">59</a></span>
<span class="normal"><a href="#__codelineno-22-60">60</a></span>
<span class="normal"><a href="#__codelineno-22-61">61</a></span>
<span class="normal"><a href="#__codelineno-22-62">62</a></span>
<span class="normal"><a href="#__codelineno-22-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">modèle</span><span class="o">.</span><span class="n">simulations</span> <span class="ow">is</span> <span class="n">undefined</span> <span class="ow">or</span> <span class="n">modèle</span><span class="o">.</span><span class="n">simulations</span><span class="o">|</span><span class="n">length</span><span class="o">==</span><span class="mi">0</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">message</span> <span class="n">sur</span> <span class="n">fond</span> <span class="n">bleu</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert alert-primary&quot;</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>    <span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">Votre</span> <span class="n">liste</span> <span class="n">de</span> <span class="n">simulations</span> <span class="n">est</span> <span class="n">vide</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">modèle</span><span class="o">.</span><span class="n">simulations</span> <span class="ow">is</span> <span class="n">defined</span> <span class="ow">and</span> <span class="n">modèle</span><span class="o">.</span><span class="n">simulations</span><span class="o">|</span><span class="n">length</span><span class="o">!=</span><span class="mi">0</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">message</span> <span class="n">sur</span> <span class="n">fond</span> <span class="n">bleu</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert alert-primary&quot;</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>    <span class="o">&lt;</span><span class="n">h4</span><span class="o">&gt;</span><span class="n">Liste</span> <span class="n">de</span> <span class="n">vos</span> <span class="n">simulations</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">tableau</span> <span class="n">des</span> <span class="n">simulations</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="o">&lt;</span><span class="n">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;table table-sm table-hover table-striped&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">entêtes</span> <span class="n">des</span> <span class="n">six</span> <span class="n">colonnes</span> <span class="n">du</span> <span class="n">tableau</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a>    <span class="o">&lt;</span><span class="n">thead</span><span class="o">&gt;</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a>    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;</span><span class="c1">#&lt;/th&gt;</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;</span><span class="n">Marié</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;</span><span class="n">Nombre</span> <span class="n">d</span><span class="s1">&#39;enfants&lt;/th&gt;</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;</span><span class="n">Salaire</span> <span class="n">annuel</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;</span><span class="n">Montant</span> <span class="n">impôt</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;</span><span class="n">Surcôte</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;</span><span class="n">Décôte</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;</span><span class="n">Réduction</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;</span><span class="n">Taux</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-22-28" name="__codelineno-22-28"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;col&quot;</span><span class="o">&gt;&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-22-29" name="__codelineno-22-29"></a>    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-22-30" name="__codelineno-22-30"></a>    <span class="o">&lt;/</span><span class="n">thead</span><span class="o">&gt;</span>
<a id="__codelineno-22-31" name="__codelineno-22-31"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">corps</span> <span class="n">du</span> <span class="n">tableau</span> <span class="p">(</span><span class="n">données</span> <span class="n">affichées</span><span class="p">)</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-32" name="__codelineno-22-32"></a>    <span class="o">&lt;</span><span class="n">tbody</span><span class="o">&gt;</span>
<a id="__codelineno-22-33" name="__codelineno-22-33"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">on</span> <span class="n">affiche</span> <span class="n">chaque</span> <span class="n">simulation</span> <span class="n">en</span> <span class="n">parcourant</span> <span class="n">le</span> <span class="n">tableau</span> <span class="n">des</span> <span class="n">simulations</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-34" name="__codelineno-22-34"></a>    <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">simulation</span> <span class="ow">in</span> <span class="n">modèle</span><span class="o">.</span><span class="n">simulations</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-22-35" name="__codelineno-22-35"></a>
<a id="__codelineno-22-36" name="__codelineno-22-36"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">affichage</span> <span class="n">d</span><span class="s1">&#39;une ligne du tableau avec 6 colonnes - balise &lt;tr&gt; --&gt;</span>
<a id="__codelineno-22-37" name="__codelineno-22-37"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">colonne</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">entête</span> <span class="n">ligne</span> <span class="p">(</span><span class="n">n</span><span class="err">°</span> <span class="n">simulation</span><span class="p">)</span> <span class="o">-</span> <span class="n">balise</span> <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s1">&#39;row&#39;</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-38" name="__codelineno-22-38"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">colonne</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">valeur</span> <span class="n">paramètre</span> <span class="p">[</span><span class="n">marié</span><span class="p">]</span> <span class="o">-</span> <span class="n">balise</span> <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-39" name="__codelineno-22-39"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">colonne</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">valeur</span> <span class="n">paramètre</span> <span class="p">[</span><span class="n">enfants</span><span class="p">]</span> <span class="o">-</span> <span class="n">balise</span> <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-40" name="__codelineno-22-40"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">colonne</span> <span class="mi">4</span> <span class="p">:</span> <span class="n">valeur</span> <span class="n">paramètre</span> <span class="p">[</span><span class="n">salaire</span><span class="p">]</span> <span class="o">-</span> <span class="n">balise</span> <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-41" name="__codelineno-22-41"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">colonne</span> <span class="mi">5</span> <span class="p">:</span> <span class="n">valeur</span> <span class="n">paramètre</span> <span class="p">[</span><span class="n">impôt</span><span class="p">]</span> <span class="p">(</span><span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt) - balise &lt;td&gt; --&gt;</span>
<a id="__codelineno-22-42" name="__codelineno-22-42"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">colonne</span> <span class="mi">6</span> <span class="p">:</span> <span class="n">valeur</span> <span class="n">paramètre</span> <span class="p">[</span><span class="n">surcôte</span><span class="p">]</span> <span class="o">-</span> <span class="n">balise</span> <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-43" name="__codelineno-22-43"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">colonne</span> <span class="mi">7</span> <span class="p">:</span> <span class="n">valeur</span> <span class="n">paramètre</span> <span class="p">[</span><span class="n">décôte</span><span class="p">]</span> <span class="o">-</span> <span class="n">balise</span> <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-44" name="__codelineno-22-44"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">colonne</span> <span class="mi">8</span> <span class="p">:</span> <span class="n">valeur</span> <span class="n">paramètre</span> <span class="p">[</span><span class="n">réduction</span><span class="p">]</span> <span class="o">-</span> <span class="n">balise</span> <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-45" name="__codelineno-22-45"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">colonne</span> <span class="mi">9</span> <span class="p">:</span> <span class="n">valeur</span> <span class="n">paramètre</span> <span class="p">[</span><span class="n">taux</span><span class="p">]</span> <span class="p">(</span><span class="n">de</span> <span class="n">l</span><span class="s1">&#39;impôt) - balise &lt;td&gt; --&gt;</span>
<a id="__codelineno-22-46" name="__codelineno-22-46"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">colonne</span> <span class="mi">10</span> <span class="p">:</span> <span class="n">lien</span> <span class="n">de</span> <span class="n">suppression</span> <span class="n">de</span> <span class="n">la</span> <span class="n">simulation</span> <span class="o">-</span> <span class="n">balise</span> <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span> <span class="o">--&gt;</span>
<a id="__codelineno-22-47" name="__codelineno-22-47"></a>    <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-22-48" name="__codelineno-22-48"></a>        <span class="o">&lt;</span><span class="n">th</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">id</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
<a id="__codelineno-22-49" name="__codelineno-22-49"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">marié</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-22-50" name="__codelineno-22-50"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">enfants</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-22-51" name="__codelineno-22-51"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">salaire</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-22-52" name="__codelineno-22-52"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">impôt</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-22-53" name="__codelineno-22-53"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">surcôte</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-22-54" name="__codelineno-22-54"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">décôte</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-22-55" name="__codelineno-22-55"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">réduction</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-22-56" name="__codelineno-22-56"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">simulation</span><span class="o">.</span><span class="n">taux</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-22-57" name="__codelineno-22-57"></a>        <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/supprimer-simulation/{{simulation.id}}&quot;</span><span class="o">&gt;</span><span class="n">Supprimer</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
<a id="__codelineno-22-58" name="__codelineno-22-58"></a>    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-22-59" name="__codelineno-22-59"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-22-60" name="__codelineno-22-60"></a>    <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
<a id="__codelineno-22-61" name="__codelineno-22-61"></a>    <span class="o">&lt;/</span><span class="n">tbody</span><span class="o">&gt;</span>
<a id="__codelineno-22-62" name="__codelineno-22-62"></a><span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>
<a id="__codelineno-22-63" name="__codelineno-22-63"></a><span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>un tableau HTML est réalisé avec la balise &lt;table&gt; (lignes 15 et 62) ;</li>
<li>les entêtes des colonnes du tableau se font à l’intérieur d’une balise &lt;thead&gt; (table head, lignes 17, 30). La balise &lt;tr&gt; (table row, lignes 18 et 29) délimitent une ligne. Lignes 19-28, la balise &lt;th&gt; (table header) définit un entête de colonne. Il y en a donc dix. <strong>[scope=&quot;col&quot;]</strong> indique que l’entête s’applique à la colonne. <strong>[scope=&quot;row&quot;]</strong> indique que l’entête s’applique à la ligne ;</li>
<li>lignes 32-61 : la balise &lt;tbody&gt; encadre les données affichées par le tableau ;</li>
<li>lignes 47-58 : la balise &lt;tr&gt; encadre une ligne du tableau ;</li>
<li>ligne 48 : la balise &lt;th scope=’row’&gt; définit l’entête de la ligne. le navigateur fait ressortir cet entête ;</li>
<li>lignes 49-57 : chaque balise &lt;td&gt; (table data) définit une colonne de la ligne ;</li>
<li>ligne 34 : la liste des simulations sera trouvée dans le modèle <strong>[modèle.simulations]</strong> qui est une liste de dictionnaires ;</li>
<li>ligne 57 : un lien pour supprimer la simulation. L’URL utilise le n° de la simulation affichée dans la ligne ;</li>
</ul>
<h3 id="3272-test-visuel">32.7.2. Test visuel</h3>
<p>Nous créons un script de test pour la vue <strong>[vue-liste-simulations.html]</strong> :</p>
<p>Le script <strong>[test_vue_liste_simulations]</strong> est le suivant :</p>
<p><img src="images/10000000000001BB00000128B2811292.png" style="width:5.111cm;height:3.41cm;" alt="Image" /></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span>
<span class="normal"><a href="#__codelineno-23-44">44</a></span>
<span class="normal"><a href="#__codelineno-23-45">45</a></span>
<span class="normal"><a href="#__codelineno-23-46">46</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">make_response</span><span class="p">,</span> <span class="n">render_template</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="c1"># application Flask</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="s2">&quot;../templates&quot;</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s2">&quot;../static&quot;</span><span class="p">)</span>
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>
<a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="c1"># Home URL</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>    <span class="c1"># on encapsule les données de la pagé dans modèle</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>    <span class="n">modèle</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>    <span class="c1"># on met les simulations au format attendu par la page</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;simulations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a>        <span class="p">{</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a>            <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;oui&quot;</span><span class="p">,</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>            <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>            <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">60000</span><span class="p">,</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a>            <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">448</span><span class="p">,</span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a>            <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a>            <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a>            <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a>            <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.14</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a>        <span class="p">},</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a>        <span class="p">{</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a>            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a>            <span class="s2">&quot;marié&quot;</span><span class="p">:</span> <span class="s2">&quot;non&quot;</span><span class="p">,</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a>            <span class="s2">&quot;enfants&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a>            <span class="s2">&quot;salaire&quot;</span><span class="p">:</span> <span class="mi">200000</span><span class="p">,</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a>            <span class="s2">&quot;impôt&quot;</span><span class="p">:</span> <span class="mi">25600</span><span class="p">,</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a>            <span class="s2">&quot;décôte&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a>            <span class="s2">&quot;réduction&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a>            <span class="s2">&quot;surcôte&quot;</span><span class="p">:</span> <span class="mi">8400</span><span class="p">,</span>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>            <span class="s2">&quot;taux&quot;</span><span class="p">:</span> <span class="mf">0.45</span>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a>        <span class="p">}</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a>    <span class="p">]</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a>    <span class="c1"># menu</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;optionsMenu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a>        <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Calcul de l&#39;impôt&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/afficher-calcul-impot&#39;</span><span class="p">},</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a>        <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s1">&#39;Fin de session&#39;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/fin-session&#39;</span><span class="p">}]</span>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a>    <span class="c1"># affichage de la page</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;views/vue-liste-simulations.html&quot;</span><span class="p">,</span> <span class="n">modèle</span><span class="o">=</span><span class="n">modèle</span><span class="p">))</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a><span class="c1"># main</span>
<a id="__codelineno-23-44" name="__codelineno-23-44"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-23-45" name="__codelineno-23-45"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-23-46" name="__codelineno-23-46"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 12-35 : on met deux simulations dans le modèle</li>
<li>lignes 37-39 : le tableau des options de menu ;
Affichons cette vue en exécutant ce script. On obtient le résultat suivant :</li>
</ul>
<p><img src="images/1000000000000472000001E0EDDB4227.png" style="width:13.14cm;height:5.541cm;" alt="Image" /></p>
<p>On travaille sur cette vue jusqu’à ce que le résultat obtenu visuellement nous convienne. On peut ensuite passer à l’intégration de la vue dans l’application web en cours d’écriture.</p>
<h3 id="3273-calcul-du-modele-de-la-vue">32.7.3. Calcul du modèle de la vue</h3>
<p>Une fois l’aspect visuel de la vue déterminé, on peut procéder au calcul du modèle de la vue en conditions réelles. Rappelons les codes d’état qui mènent à cette vue. On les trouve dans le fichier de configuration :</p>
<p><img src="images/10000000000001BB0000011328AF0953.png" style="width:5.121cm;height:3.17cm;" alt="Image" /></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>            <span class="p">{</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>                <span class="c1"># vue de la liste des simulations</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>                    <span class="c1"># /lister-simulations</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>                    <span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a>                    <span class="c1"># /supprimer-simulation</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>                    <span class="mi">600</span>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>                <span class="p">],</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-liste-simulations.html&quot;</span><span class="p">,</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForListeSimulationsView</span><span class="p">()</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a>            <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Ce sont donc les codes d’état <strong>[500, 600]</strong> qui font afficher la vue des simulations. Pour retrouver la signification de ces codes, on peut s’aider des tests <strong>[Postman]</strong> réalisés sur l’application jSON :</p>
<ul>
<li><strong>[lister-simulations-500]</strong> : 500 est le code d’état à l’issue d’une action <strong>[lister-simulations]</strong> réussie : on présente alors la liste des simulations réalisées par l’utilisateur ;</li>
<li><strong>[supprimer-simulation-600]</strong> : 600 est le code d’état à l’issue d’une action <strong>[supprimer-simulation]</strong> réussie. On présente alors la nouvelle liste des simulations obtenue après cette suppression ;
Maintenant que nous savons à quels moments doit être affichée la liste des simulations, on peut calculer son modèle dans la classe <strong>[</strong><strong>ModelForListeSimulationsView</strong><strong>]</strong> :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-25-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-25-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-25-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-25-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-25-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-25-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-25-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-25-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-25-10">10</a></span>
<span class="normal"><a href="#__codelineno-25-11">11</a></span>
<span class="normal"><a href="#__codelineno-25-12">12</a></span>
<span class="normal"><a href="#__codelineno-25-13">13</a></span>
<span class="normal"><a href="#__codelineno-25-14">14</a></span>
<span class="normal"><a href="#__codelineno-25-15">15</a></span>
<span class="normal"><a href="#__codelineno-25-16">16</a></span>
<span class="normal"><a href="#__codelineno-25-17">17</a></span>
<span class="normal"><a href="#__codelineno-25-18">18</a></span>
<span class="normal"><a href="#__codelineno-25-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.local</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalProxy</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceModelForView</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceModelForView</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>
<a id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">ModelForListeSimulationsView</span><span class="p">(</span><span class="n">InterfaceModelForView</span><span class="p">):</span>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_for_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">résultat</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-25-9" name="__codelineno-25-9"></a>        <span class="c1"># on encapsule les données de la pagé dans modèle</span>
<a id="__codelineno-25-10" name="__codelineno-25-10"></a>        <span class="n">modèle</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-25-11" name="__codelineno-25-11"></a>        <span class="c1"># les simulations sont trouvées dans la réponse du contrôleur qui a exécuté l&#39;action</span>
<a id="__codelineno-25-12" name="__codelineno-25-12"></a>        <span class="c1"># sous la forme d&#39;un tableau de dictionnaires TaxPayer</span>
<a id="__codelineno-25-13" name="__codelineno-25-13"></a>        <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;simulations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">résultat</span><span class="p">[</span><span class="s2">&quot;réponse&quot;</span><span class="p">]</span>
<a id="__codelineno-25-14" name="__codelineno-25-14"></a>        <span class="c1"># menu</span>
<a id="__codelineno-25-15" name="__codelineno-25-15"></a>        <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;optionsMenu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-25-16" name="__codelineno-25-16"></a>            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Calcul de l&#39;impôt&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/afficher-calcul-impot&#39;</span><span class="p">},</span>
<a id="__codelineno-25-17" name="__codelineno-25-17"></a>            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s1">&#39;Fin de session&#39;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/fin-session&#39;</span><span class="p">}]</span>
<a id="__codelineno-25-18" name="__codelineno-25-18"></a>        <span class="c1"># on rend le modèle</span>
<a id="__codelineno-25-19" name="__codelineno-25-19"></a>        <span class="k">return</span> <span class="n">modèle</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 13 : les simulations à afficher sont trouvées dans <strong>[</strong><strong>résultat[</strong><strong>&quot;réponse&quot;</strong><strong>]</strong>] ;</li>
<li>lignes 15-17 : les options du menu à afficher ;</li>
</ul>
<h3 id="3274-tests-postman">32.7.4. Tests [Postman]</h3>
<p>On</p>
<ul>
<li>initialise une session HTML ;</li>
<li>s’authentifie ;</li>
<li>fait trois calculs d’impôt ;
Le test <strong>[lister-simulations-500]</strong> nous permet d’avoir le code d’état 500. Il correspond à une demande pour voir les simulations :</li>
</ul>
<p><img src="images/10000000000002D40000010B554CB863.png" style="width:8.37cm;height:3.081cm;" alt="Image" /></p>
<p>La réponse du serveur est la suivante :</p>
<p><img src="images/1000000000000547000002E0287DD2D6.png" style="width:15.601cm;height:8.49cm;" alt="Image" /></p>
<p>Le test <strong>[supprimer-simulation-600]</strong> nous permet d’avoir le code d’état 600. On va ici supprimer la simulation n° 2.</p>
<p>Le résultat renvoyé est une liste de simulations avec une simulation en moins :</p>
<p><img src="images/100000000000026E00000113514B4CA9.png" style="width:7.182cm;height:3.17cm;" alt="Image" /></p>
<p><img src="images/1000000000000555000002B3D9EB2B5E.png" style="width:15.781cm;height:7.981cm;" alt="Image" /></p>
<h2 id="328-la-vue-des-erreurs-inattendues">32.8. La vue des erreurs inattendues</h2>
<p>On appelle ici, erreur inattendue, une erreur qui n’aurait pas dû se produire dans le cadre d’une utilisation normale de l’application web. Par exemple, le fait de demander un calcul d’impôt sans être authentifié. Rien n’empêche un utilisateur de taper directement l’URL <strong>[/calcul-impot]</strong> dans son navigateur. Par ailleurs, comme nous l’avons vu, il peut faire un POST sur l’URL <strong>[/calcul-impot]</strong> en n’envoyant pas les paramètres attendus. On a vu que notre application web savait répondre correctement à cette requête. On appellera, <strong>erreur inattendue</strong>, une erreur qui ne devrait pas se produire dans le cadre de l’application HTML. Si elle se produit, c’est que probablement quelqu’un essaie de ‘hacker’ l’application. Par souci de pédagogie, on a décidé d’afficher une vue d’erreurs pour ces cas. Dans la réalité, on pourrait réafficher la dernière page envoyée au client. Il suffit pour cela d’enregistrer en session, la dernière réponse HTML envoyée. En cas d’erreur inattendue, on renvoie cette réponse. Ainsi l’utilisateur aura l’impression que le serveur ne répond pas à ses erreurs puisque la page affichée ne change pas.</p>
<h3 id="3281-presentation-de-la-vue">32.8.1. Présentation de la vue</h3>
<p><img src="images/10000000000001BA0000019C1B7C0433.png" style="width:5.111cm;height:4.762cm;" alt="Image" /></p>
<p>La vue qui présente les erreurs inattendues est la suivante :</p>
<p><img src="images/1000000000000556000001FFA136C18B.png" style="width:15.781cm;height:5.901cm;" alt="Image" /></p>
<p>La vue générée par le code <strong>[vue-erreurs.html]</strong> a trois parties :</p>
<ul>
<li>1 : le bandeau supérieur est généré par le fragment <strong>[v-bandeau.html]</strong> déjà présenté ;</li>
<li>2 : la ou les erreurs inattendues ;</li>
<li>3 : un menu présentant trois liens, généré par le fragment <strong>[v-menu.html]</strong> déjà présenté ;
La vue des erreurs inattendues est générée par le script <strong>[vue-erreurs.html]</strong> suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span>
<span class="normal"><a href="#__codelineno-26-20">20</a></span>
<span class="normal"><a href="#__codelineno-26-21">21</a></span>
<span class="normal"><a href="#__codelineno-26-22">22</a></span>
<span class="normal"><a href="#__codelineno-26-23">23</a></span>
<span class="normal"><a href="#__codelineno-26-24">24</a></span>
<span class="normal"><a href="#__codelineno-26-25">25</a></span>
<span class="normal"><a href="#__codelineno-26-26">26</a></span>
<span class="normal"><a href="#__codelineno-26-27">27</a></span>
<span class="normal"><a href="#__codelineno-26-28">28</a></span>
<span class="normal"><a href="#__codelineno-26-29">29</a></span>
<span class="normal"><a href="#__codelineno-26-30">30</a></span>
<span class="normal"><a href="#__codelineno-26-31">31</a></span>
<span class="normal"><a href="#__codelineno-26-32">32</a></span>
<span class="normal"><a href="#__codelineno-26-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">document</span> <span class="n">HTML</span> <span class="o">--&gt;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="o">&lt;</span><span class="err">!</span><span class="n">doctype</span> <span class="n">html</span><span class="o">&gt;</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="o">&lt;</span><span class="n">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;fr&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="o">&lt;</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">Required</span> <span class="n">meta</span> <span class="n">tags</span> <span class="o">--&gt;</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">charset</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>    <span class="o">&lt;</span><span class="n">meta</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;viewport&quot;</span> <span class="n">content</span><span class="o">=</span><span class="s2">&quot;width=device-width, initial-scale=1, shrink-to-fit=no&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">Bootstrap</span> <span class="n">CSS</span> <span class="o">--&gt;</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>    <span class="o">&lt;</span><span class="n">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a>    <span class="o">&lt;</span><span class="n">title</span><span class="o">&gt;</span><span class="n">Application</span> <span class="n">impôts</span><span class="o">&lt;/</span><span class="n">title</span><span class="o">&gt;</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="o">&lt;/</span><span class="n">head</span><span class="o">&gt;</span>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">bandeau</span> <span class="n">sur</span> <span class="mi">12</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a>    <span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/v-bandeau.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a>    <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">ligne</span> <span class="n">à</span> <span class="n">deux</span> <span class="n">sections</span> <span class="o">--&gt;</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a>    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">menu</span> <span class="n">sur</span> <span class="mi">3</span> <span class="n">colonnes</span><span class="o">--&gt;</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-3&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a>            <span class="p">{</span><span class="o">%</span> <span class="n">include</span> <span class="s2">&quot;fragments/v-menu.html&quot;</span> <span class="o">%</span><span class="p">}</span>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-23" name="__codelineno-26-23"></a>        <span class="o">&lt;</span><span class="err">!</span><span class="o">--</span> <span class="n">liste</span> <span class="n">des</span> <span class="n">erreurs</span> <span class="n">sur</span> <span class="mi">9</span> <span class="n">colonnes</span> <span class="o">--&gt;</span>
<a id="__codelineno-26-24" name="__codelineno-26-24"></a>        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;col-md-9&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-25" name="__codelineno-26-25"></a>            <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;alert alert-danger&quot;</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;alert&quot;</span><span class="o">&gt;</span>
<a id="__codelineno-26-26" name="__codelineno-26-26"></a>                <span class="n">Les</span> <span class="n">erreurs</span> <span class="n">inattendues</span> <span class="n">suivantes</span> <span class="n">se</span> <span class="n">sont</span> <span class="n">produites</span> <span class="p">:</span>
<a id="__codelineno-26-27" name="__codelineno-26-27"></a>                <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span><span class="p">{{</span><span class="n">modèle</span><span class="o">.</span><span class="n">erreurs</span><span class="o">|</span><span class="n">safe</span><span class="p">}}</span><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
<a id="__codelineno-26-28" name="__codelineno-26-28"></a>            <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-29" name="__codelineno-26-29"></a>        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-30" name="__codelineno-26-30"></a>    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-31" name="__codelineno-26-31"></a><span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<a id="__codelineno-26-32" name="__codelineno-26-32"></a><span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
<a id="__codelineno-26-33" name="__codelineno-26-33"></a><span class="o">&lt;/</span><span class="n">html</span><span class="o">&gt;</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 16 : inclusion du bandeau de l’application <strong>[1]</strong> ;</li>
<li>ligne 21 : inclusion du menu <strong>[3]</strong>. Il sera affiché sur trois colonnes sous le bandeau ;</li>
<li>lignes 24-29 : affichage de la zone d’erreurs sur neuf colonnes ;</li>
<li>ligne 25 : cet affichage se fera dans un cadre Bootstrap à fond rose ;</li>
<li>ligne 26 : un texte de présentation ;</li>
<li>
<p>ligne 27 : la balise &lt;ul&gt; encadre une liste à puces. Cette liste à puces est fournie par le modèle <strong>[modèle.erreurs]</strong> ;
Nous avons déjà commenté les deux fragments de cette vue :</p>
</li>
<li>
<p><strong>[v-bandeau.html]</strong> : au paragraphe <a href="#_Le_fragment_[v-bandeau.php]"><u><u>lien</u></u></a> ;</p>
</li>
<li><strong>[v-menu.html]</strong> : au paragraphe <a href="#_Le_fragment_[v-menu.php]"><u><u>lien</u></u></a> ;</li>
</ul>
<h3 id="3282-test-visuel">32.8.2. Test visuel</h3>
<p>Nous créons un script de test pour la vue <strong>[vue-erreurs.html]</strong> :</p>
<p><img src="images/100000000000017C000000E47829F1F3.png" style="width:4.391cm;height:2.631cm;" alt="Image" /></p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span>
<span class="normal"><a href="#__codelineno-27-17">17</a></span>
<span class="normal"><a href="#__codelineno-27-18">18</a></span>
<span class="normal"><a href="#__codelineno-27-19">19</a></span>
<span class="normal"><a href="#__codelineno-27-20">20</a></span>
<span class="normal"><a href="#__codelineno-27-21">21</a></span>
<span class="normal"><a href="#__codelineno-27-22">22</a></span>
<span class="normal"><a href="#__codelineno-27-23">23</a></span>
<span class="normal"><a href="#__codelineno-27-24">24</a></span>
<span class="normal"><a href="#__codelineno-27-25">25</a></span>
<span class="normal"><a href="#__codelineno-27-26">26</a></span>
<span class="normal"><a href="#__codelineno-27-27">27</a></span>
<span class="normal"><a href="#__codelineno-27-28">28</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">make_response</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="c1"># application Flask</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">template_folder</span><span class="o">=</span><span class="s2">&quot;../templates&quot;</span><span class="p">,</span> <span class="n">static_folder</span><span class="o">=</span><span class="s2">&quot;../static&quot;</span><span class="p">)</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="c1"># Home URL</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">():</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a>    <span class="c1"># on encapsule les données de la pagé dans modèle</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a>    <span class="n">modèle</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a>    <span class="c1"># on construit une liste HTML des erreurs</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a>    <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a>    <span class="k">for</span> <span class="n">erreur</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;erreur1&quot;</span><span class="p">,</span> <span class="s2">&quot;erreur2&quot;</span><span class="p">]:</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a>        <span class="n">content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&lt;/li&gt;&quot;</span>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;erreurs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
<a id="__codelineno-27-16" name="__codelineno-27-16"></a>    <span class="c1"># options du menu</span>
<a id="__codelineno-27-17" name="__codelineno-27-17"></a>    <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;optionsMenu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-27-18" name="__codelineno-27-18"></a>        <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Calcul de l&#39;impôt&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/calculer-impot&#39;</span><span class="p">},</span>
<a id="__codelineno-27-19" name="__codelineno-27-19"></a>        <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s1">&#39;Liste des simulations&#39;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/lister-simulations&#39;</span><span class="p">},</span>
<a id="__codelineno-27-20" name="__codelineno-27-20"></a>        <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s1">&#39;Fin de session&#39;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/fin-session&#39;</span><span class="p">}]</span>
<a id="__codelineno-27-21" name="__codelineno-27-21"></a>
<a id="__codelineno-27-22" name="__codelineno-27-22"></a>    <span class="c1"># affichage de la page</span>
<a id="__codelineno-27-23" name="__codelineno-27-23"></a>    <span class="k">return</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;views/vue-erreurs.html&quot;</span><span class="p">,</span> <span class="n">modèle</span><span class="o">=</span><span class="n">modèle</span><span class="p">))</span>
<a id="__codelineno-27-24" name="__codelineno-27-24"></a>
<a id="__codelineno-27-25" name="__codelineno-27-25"></a><span class="c1"># main</span>
<a id="__codelineno-27-26" name="__codelineno-27-26"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-27-27" name="__codelineno-27-27"></a>    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ENV</span><span class="o">=</span><span class="s2">&quot;development&quot;</span><span class="p">,</span> <span class="n">DEBUG</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-27-28" name="__codelineno-27-28"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 11-15 : construction de la liste HTML des erreurs ;</li>
<li>lignes 17-20 : le tableau des options de menu ;
Exécutons ce script. On obtient le résultat suivant :</li>
</ul>
<p>On travaille sur cette vue jusqu’à ce que le résultat obtenu visuellement nous convienne. On peut ensuite passer à l’intégration de la vue dans l’application web en cours d’écriture.</p>
<p><img src="images/1000000000000555000002A598BD1A27.png" style="width:15.77cm;height:7.811cm;" alt="Image" /></p>
<h3 id="3283-calcul-du-modele-de-la-vue">32.8.3. Calcul du modèle de la vue</h3>
<p><img src="images/10000000000001BB0000010688D09B8D.png" style="width:5.111cm;height:3.031cm;" alt="Image" /></p>
<p>Une fois l’aspect visuel de la vue déterminé, on peut procéder au calcul du modèle de la vue en conditions réelles. Rappelons les codes d’état qui mènent à cette vue. On les trouve dans le fichier de configuration :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span>
<span class="normal"><a href="#__codelineno-28-16">16</a></span>
<span class="normal"><a href="#__codelineno-28-17">17</a></span>
<span class="normal"><a href="#__codelineno-28-18">18</a></span>
<span class="normal"><a href="#__codelineno-28-19">19</a></span>
<span class="normal"><a href="#__codelineno-28-20">20</a></span>
<span class="normal"><a href="#__codelineno-28-21">21</a></span>
<span class="normal"><a href="#__codelineno-28-22">22</a></span>
<span class="normal"><a href="#__codelineno-28-23">23</a></span>
<span class="normal"><a href="#__codelineno-28-24">24</a></span>
<span class="normal"><a href="#__codelineno-28-25">25</a></span>
<span class="normal"><a href="#__codelineno-28-26">26</a></span>
<span class="normal"><a href="#__codelineno-28-27">27</a></span>
<span class="normal"><a href="#__codelineno-28-28">28</a></span>
<span class="normal"><a href="#__codelineno-28-29">29</a></span>
<span class="normal"><a href="#__codelineno-28-30">30</a></span>
<span class="normal"><a href="#__codelineno-28-31">31</a></span>
<span class="normal"><a href="#__codelineno-28-32">32</a></span>
<span class="normal"><a href="#__codelineno-28-33">33</a></span>
<span class="normal"><a href="#__codelineno-28-34">34</a></span>
<span class="normal"><a href="#__codelineno-28-35">35</a></span>
<span class="normal"><a href="#__codelineno-28-36">36</a></span>
<span class="normal"><a href="#__codelineno-28-37">37</a></span>
<span class="normal"><a href="#__codelineno-28-38">38</a></span>
<span class="normal"><a href="#__codelineno-28-39">39</a></span>
<span class="normal"><a href="#__codelineno-28-40">40</a></span>
<span class="normal"><a href="#__codelineno-28-41">41</a></span>
<span class="normal"><a href="#__codelineno-28-42">42</a></span>
<span class="normal"><a href="#__codelineno-28-43">43</a></span>
<span class="normal"><a href="#__codelineno-28-44">44</a></span>
<span class="normal"><a href="#__codelineno-28-45">45</a></span>
<span class="normal"><a href="#__codelineno-28-46">46</a></span>
<span class="normal"><a href="#__codelineno-28-47">47</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a>        <span class="c1"># les vues HTML et leurs modèles dépendent de l&#39;état rendu par le contrôleur</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>        <span class="s2">&quot;views&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a>            <span class="p">{</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a>                <span class="c1"># vue d&#39;authentification</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a>                    <span class="c1"># /init-session réussite</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a>                    <span class="mi">700</span><span class="p">,</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a>                    <span class="c1"># /fin-session</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a>                    <span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a>                    <span class="c1"># /authentifier-utilisateur échec</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a>                    <span class="mi">201</span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a>                <span class="p">],</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-authentification.html&quot;</span><span class="p">,</span>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForAuthentificationView</span><span class="p">()</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a>            <span class="p">},</span>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a>            <span class="p">{</span>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a>                <span class="c1"># vue du calcul de l&#39;impôt</span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-28-19" name="__codelineno-28-19"></a>                    <span class="c1"># /authentifier-utilisateur réussite</span>
<a id="__codelineno-28-20" name="__codelineno-28-20"></a>                    <span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-28-21" name="__codelineno-28-21"></a>                    <span class="c1"># /calculer-impot réussite</span>
<a id="__codelineno-28-22" name="__codelineno-28-22"></a>                    <span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-28-23" name="__codelineno-28-23"></a>                    <span class="c1"># /calculer-impot échec</span>
<a id="__codelineno-28-24" name="__codelineno-28-24"></a>                    <span class="mi">301</span><span class="p">,</span>
<a id="__codelineno-28-25" name="__codelineno-28-25"></a>                    <span class="c1"># /afficher-calcul-impot</span>
<a id="__codelineno-28-26" name="__codelineno-28-26"></a>                    <span class="mi">800</span>
<a id="__codelineno-28-27" name="__codelineno-28-27"></a>                <span class="p">],</span>
<a id="__codelineno-28-28" name="__codelineno-28-28"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-calcul-impot.html&quot;</span><span class="p">,</span>
<a id="__codelineno-28-29" name="__codelineno-28-29"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForCalculImpotView</span><span class="p">()</span>
<a id="__codelineno-28-30" name="__codelineno-28-30"></a>            <span class="p">},</span>
<a id="__codelineno-28-31" name="__codelineno-28-31"></a>            <span class="p">{</span>
<a id="__codelineno-28-32" name="__codelineno-28-32"></a>                <span class="c1"># vue de la liste des simulations</span>
<a id="__codelineno-28-33" name="__codelineno-28-33"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-28-34" name="__codelineno-28-34"></a>                    <span class="c1"># /lister-simulations</span>
<a id="__codelineno-28-35" name="__codelineno-28-35"></a>                    <span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-28-36" name="__codelineno-28-36"></a>                    <span class="c1"># /supprimer-simulation</span>
<a id="__codelineno-28-37" name="__codelineno-28-37"></a>                    <span class="mi">600</span>
<a id="__codelineno-28-38" name="__codelineno-28-38"></a>                <span class="p">],</span>
<a id="__codelineno-28-39" name="__codelineno-28-39"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-liste-simulations.html&quot;</span><span class="p">,</span>
<a id="__codelineno-28-40" name="__codelineno-28-40"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForListeSimulationsView</span><span class="p">()</span>
<a id="__codelineno-28-41" name="__codelineno-28-41"></a>            <span class="p">}</span>
<a id="__codelineno-28-42" name="__codelineno-28-42"></a>        <span class="p">],</span>
<a id="__codelineno-28-43" name="__codelineno-28-43"></a>        <span class="c1"># vue des erreurs inattendues</span>
<a id="__codelineno-28-44" name="__codelineno-28-44"></a>        <span class="s2">&quot;view-erreurs&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-28-45" name="__codelineno-28-45"></a>            <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-erreurs.html&quot;</span><span class="p">,</span>
<a id="__codelineno-28-46" name="__codelineno-28-46"></a>            <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForErreursView</span><span class="p">()</span>
<a id="__codelineno-28-47" name="__codelineno-28-47"></a>        <span class="p">},</span>
</code></pre></div></td></tr></table></div>
<p>Ce sont les codes d’état qui ne mènent pas à une vue HTML des lignes 3-41 qui font afficher la vue des erreurs inattendues.</p>
<p>Le calcul du modèle de la vue <strong>[vue-erreurs.html]</strong> est fait par la classe <strong>[</strong><strong>ModelForErreursView</strong><strong>]</strong> suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span>
<span class="normal"><a href="#__codelineno-29-12">12</a></span>
<span class="normal"><a href="#__codelineno-29-13">13</a></span>
<span class="normal"><a href="#__codelineno-29-14">14</a></span>
<span class="normal"><a href="#__codelineno-29-15">15</a></span>
<span class="normal"><a href="#__codelineno-29-16">16</a></span>
<span class="normal"><a href="#__codelineno-29-17">17</a></span>
<span class="normal"><a href="#__codelineno-29-18">18</a></span>
<span class="normal"><a href="#__codelineno-29-19">19</a></span>
<span class="normal"><a href="#__codelineno-29-20">20</a></span>
<span class="normal"><a href="#__codelineno-29-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.local</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalProxy</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceModelForView</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceModelForView</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">ModelForErreursView</span><span class="p">(</span><span class="n">InterfaceModelForView</span><span class="p">):</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_for_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">résultat</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-29-9" name="__codelineno-29-9"></a>        <span class="c1"># le modèle</span>
<a id="__codelineno-29-10" name="__codelineno-29-10"></a>        <span class="n">modèle</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-29-11" name="__codelineno-29-11"></a>        <span class="c1"># les erreurs</span>
<a id="__codelineno-29-12" name="__codelineno-29-12"></a>        <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;erreurs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<a id="__codelineno-29-13" name="__codelineno-29-13"></a>        <span class="k">for</span> <span class="n">erreur</span> <span class="ow">in</span> <span class="n">résultat</span><span class="p">[</span><span class="s1">&#39;réponse&#39;</span><span class="p">]:</span>
<a id="__codelineno-29-14" name="__codelineno-29-14"></a>            <span class="n">modèle</span><span class="p">[</span><span class="s1">&#39;erreurs&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;&lt;li&gt;</span><span class="si">{</span><span class="n">erreur</span><span class="si">}</span><span class="s2">&lt;/li&gt;&quot;</span>
<a id="__codelineno-29-15" name="__codelineno-29-15"></a>        <span class="c1"># menu</span>
<a id="__codelineno-29-16" name="__codelineno-29-16"></a>        <span class="n">modèle</span><span class="p">[</span><span class="s2">&quot;optionsMenu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-29-17" name="__codelineno-29-17"></a>            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Calcul de l&#39;impôt&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/afficher-calcul-impot&#39;</span><span class="p">},</span>
<a id="__codelineno-29-18" name="__codelineno-29-18"></a>            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s1">&#39;Liste des simulations&#39;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/lister-simulations&#39;</span><span class="p">},</span>
<a id="__codelineno-29-19" name="__codelineno-29-19"></a>            <span class="p">{</span><span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s1">&#39;Fin de session&#39;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s1">&#39;/fin-session&#39;</span><span class="p">}]</span>
<a id="__codelineno-29-20" name="__codelineno-29-20"></a>        <span class="c1"># on rend le modèle</span>
<a id="__codelineno-29-21" name="__codelineno-29-21"></a>        <span class="k">return</span> <span class="n">modèle</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>lignes 11-14 : calcul du modèle <strong>[modèle.erreurs]</strong> utilisé par la vue <strong>[vue-erreurs.html]</strong> ;</li>
<li>lignes 16-197 : calcul du modèle <strong>[modèle.optionsMenu]</strong> utilisé par le fragment <strong>[v-menu.html]</strong> ;</li>
</ul>
<h3 id="3284-tests-postman">32.8.4. Tests [Postman]</h3>
<p>On fait :</p>
<ul>
<li>l’action <strong>[/init-session/html]</strong> ;</li>
<li>puis l’action <strong>[/init-session/x]</strong> ;
La réponse HTML est alors la suivante :</li>
</ul>
<p><img src="images/10000000000004A00000028C171E3A1A.png" style="width:12.322cm;height:6.79cm;" alt="Image" /></p>
<h2 id="329-implementation-des-actions-du-menu-de-lapplication">32.9. Implémentation des actions du menu de l’application</h2>
<p>Nous allons ici traiter de l’implémentation des actions du menu. Rappelons la signification des liens que nous avons rencontrés</p>
<table class="odt-table" style="border-collapse: collapse; width: 100%; margin-bottom: 1em;"><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>Vue</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>Lien</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>Cible</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>Rôle</b></p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;" rowspan="2"><p style="margin:0;"><b>Calcul de l’impôt</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[Liste des simulations]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[/lister-simulations]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Demander la liste des simulations</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[Fin de session]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[/fin-session]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Demander la fin de la session</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;" rowspan="2"><p style="margin:0;"><b>Liste des simulations</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[Calcul de l’impôt]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[/afficher-calcul-impot]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Afficher la vue du calcul d’impôt</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[Fin de session]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[/fin-session]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Demander la fin de la session</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;" rowspan="3"><p style="margin:0;"><b>Erreurs inattendues</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[Calcul de l’impôt]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[/afficher-calcul-impot]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Afficher la vue du calcul d’impôt</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[Liste des simulations]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[/lister-simulations]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Demander la liste des simulations</p></td></tr><tr><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[Fin de session]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;"><b>[/fin-session]</b></p></td><td style="border: 1px solid #ddd; padding: 8px; vertical-align: top;"><p style="margin:0;">Demander la fin de la session</p></td></tr></table>

<p>Il faut rappeler qu’un clic sur un lien provoque un GET vers la cible du lien. Les actions <strong>[/lister-simulations, /fin-session]</strong> ont été implémentées avec une opération GET, ce qui nous permet de les mettre comme cibles de liens. Lorsque l’action se fait par un POST, l’utilisation d’un lien n’est plus possible sauf à l’associer avec du Javascript.</p>
<h3 id="3291-laction-afficher-calcul-impot">32.9.1. L’action [/afficher-calcul-impot]</h3>
<p>Des actions ci-dessus, il apparaît que l’action <strong>[/afficher-calcul-impot]</strong> n’a pas encore été implémentée. C’est une opération de navigation entre deux vues : le serveur jSON ou XML n’a aucune raison de l’implémenter car ils n’ont pas la notion de vue. C’est le serveur HTML qui introduit cette notion.</p>
<p>Il nous faut donc implémenter l’action <strong>[/afficher-calcul-impot]</strong>. Cela va nous permettre de réviser le mode opératoire de l’implémentation d’une action au sein du serveur.</p>
<p>Tout d’abord, il nous faut ajouter un nouveau contrôleur secondaire. Nous l’appellerons <strong>[AfficherCalculImpotController]</strong> :</p>
<p><img src="images/10000000000001D5000001B27C9E6E5C.png" style="width:5.411cm;height:5.001cm;" alt="Image" /></p>
<p>Ce contrôleur doit être ajouté dans le fichier de configuration <strong>[config]</strong> :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span>
<span class="normal"><a href="#__codelineno-30-18">18</a></span>
<span class="normal"><a href="#__codelineno-30-19">19</a></span>
<span class="normal"><a href="#__codelineno-30-20">20</a></span>
<span class="normal"><a href="#__codelineno-30-21">21</a></span>
<span class="normal"><a href="#__codelineno-30-22">22</a></span>
<span class="normal"><a href="#__codelineno-30-23">23</a></span>
<span class="normal"><a href="#__codelineno-30-24">24</a></span>
<span class="normal"><a href="#__codelineno-30-25">25</a></span>
<span class="normal"><a href="#__codelineno-30-26">26</a></span>
<span class="normal"><a href="#__codelineno-30-27">27</a></span>
<span class="normal"><a href="#__codelineno-30-28">28</a></span>
<span class="normal"><a href="#__codelineno-30-29">29</a></span>
<span class="normal"><a href="#__codelineno-30-30">30</a></span>
<span class="normal"><a href="#__codelineno-30-31">31</a></span>
<span class="normal"><a href="#__codelineno-30-32">32</a></span>
<span class="normal"><a href="#__codelineno-30-33">33</a></span>
<span class="normal"><a href="#__codelineno-30-34">34</a></span>
<span class="normal"><a href="#__codelineno-30-35">35</a></span>
<span class="normal"><a href="#__codelineno-30-36">36</a></span>
<span class="normal"><a href="#__codelineno-30-37">37</a></span>
<span class="normal"><a href="#__codelineno-30-38">38</a></span>
<span class="normal"><a href="#__codelineno-30-39">39</a></span>
<span class="normal"><a href="#__codelineno-30-40">40</a></span>
<span class="normal"><a href="#__codelineno-30-41">41</a></span>
<span class="normal"><a href="#__codelineno-30-42">42</a></span>
<span class="normal"><a href="#__codelineno-30-43">43</a></span>
<span class="normal"><a href="#__codelineno-30-44">44</a></span>
<span class="normal"><a href="#__codelineno-30-45">45</a></span>
<span class="normal"><a href="#__codelineno-30-46">46</a></span>
<span class="normal"><a href="#__codelineno-30-47">47</a></span>
<span class="normal"><a href="#__codelineno-30-48">48</a></span>
<span class="normal"><a href="#__codelineno-30-49">49</a></span>
<span class="normal"><a href="#__codelineno-30-50">50</a></span>
<span class="normal"><a href="#__codelineno-30-51">51</a></span>
<span class="normal"><a href="#__codelineno-30-52">52</a></span>
<span class="normal"><a href="#__codelineno-30-53">53</a></span>
<span class="normal"><a href="#__codelineno-30-54">54</a></span>
<span class="normal"><a href="#__codelineno-30-55">55</a></span>
<span class="normal"><a href="#__codelineno-30-56">56</a></span>
<span class="normal"><a href="#__codelineno-30-57">57</a></span>
<span class="normal"><a href="#__codelineno-30-58">58</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a>    <span class="c1"># les contrôleurs</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">AfficherCalculImpotController</span><span class="w"> </span><span class="kn">import</span> <span class="n">AfficherCalculImpotController</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">AuthentifierUtilisateurController</span><span class="w"> </span><span class="kn">import</span> <span class="n">AuthentifierUtilisateurController</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">CalculerImpotController</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalculerImpotController</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">CalculerImpotsController</span><span class="w"> </span><span class="kn">import</span> <span class="n">CalculerImpotsController</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">FinSessionController</span><span class="w"> </span><span class="kn">import</span> <span class="n">FinSessionController</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">GetAdminDataController</span><span class="w"> </span><span class="kn">import</span> <span class="n">GetAdminDataController</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a>    <span class="err">…</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a>        <span class="c1"># actions autorisées et leurs contrôleurs</span>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a>        <span class="s2">&quot;controllers&quot;</span><span class="p">:</span> <span class="p">{</span>
<a id="__codelineno-30-13" name="__codelineno-30-13"></a>            <span class="c1"># initialisation d&#39;une session de calcul</span>
<a id="__codelineno-30-14" name="__codelineno-30-14"></a>            <span class="s2">&quot;init-session&quot;</span><span class="p">:</span> <span class="n">InitSessionController</span><span class="p">(),</span>
<a id="__codelineno-30-15" name="__codelineno-30-15"></a>            <span class="c1"># authentification d&#39;un utilisateur</span>
<a id="__codelineno-30-16" name="__codelineno-30-16"></a>            <span class="s2">&quot;authentifier-utilisateur&quot;</span><span class="p">:</span> <span class="n">AuthentifierUtilisateurController</span><span class="p">(),</span>
<a id="__codelineno-30-17" name="__codelineno-30-17"></a>            <span class="c1"># calcul de l&#39;impôt en mode individuel</span>
<a id="__codelineno-30-18" name="__codelineno-30-18"></a>            <span class="s2">&quot;calculer-impot&quot;</span><span class="p">:</span> <span class="n">CalculerImpotController</span><span class="p">(),</span>
<a id="__codelineno-30-19" name="__codelineno-30-19"></a>            <span class="c1"># calcul de l&#39;impôt en mode lots</span>
<a id="__codelineno-30-20" name="__codelineno-30-20"></a>            <span class="s2">&quot;calculer-impots&quot;</span><span class="p">:</span> <span class="n">CalculerImpotsController</span><span class="p">(),</span>
<a id="__codelineno-30-21" name="__codelineno-30-21"></a>            <span class="c1"># liste des simulations</span>
<a id="__codelineno-30-22" name="__codelineno-30-22"></a>            <span class="s2">&quot;lister-simulations&quot;</span><span class="p">:</span> <span class="n">ListerSimulationsController</span><span class="p">(),</span>
<a id="__codelineno-30-23" name="__codelineno-30-23"></a>            <span class="c1"># suppression d&#39;une simulation</span>
<a id="__codelineno-30-24" name="__codelineno-30-24"></a>            <span class="s2">&quot;supprimer-simulation&quot;</span><span class="p">:</span> <span class="n">SupprimerSimulationController</span><span class="p">(),</span>
<a id="__codelineno-30-25" name="__codelineno-30-25"></a>            <span class="c1"># fin de la session de calcul</span>
<a id="__codelineno-30-26" name="__codelineno-30-26"></a>            <span class="s2">&quot;fin-session&quot;</span><span class="p">:</span> <span class="n">FinSessionController</span><span class="p">(),</span>
<a id="__codelineno-30-27" name="__codelineno-30-27"></a>            <span class="c1"># affichage de la vue de calcul de l&#39;impôt</span>
<a id="__codelineno-30-28" name="__codelineno-30-28"></a>            <span class="s2">&quot;afficher-calcul-impot&quot;</span><span class="p">:</span> <span class="n">AfficherCalculImpotController</span><span class="p">(),</span>
<a id="__codelineno-30-29" name="__codelineno-30-29"></a>            <span class="c1"># obtention des données de l&#39;administration fiscale</span>
<a id="__codelineno-30-30" name="__codelineno-30-30"></a>            <span class="s2">&quot;get-admindata&quot;</span><span class="p">:</span> <span class="n">GetAdminDataController</span><span class="p">(),</span>
<a id="__codelineno-30-31" name="__codelineno-30-31"></a>            <span class="c1"># main controller</span>
<a id="__codelineno-30-32" name="__codelineno-30-32"></a>            <span class="s2">&quot;main-controller&quot;</span><span class="p">:</span> <span class="n">MainController</span><span class="p">()</span>
<a id="__codelineno-30-33" name="__codelineno-30-33"></a>        <span class="p">},</span>
<a id="__codelineno-30-34" name="__codelineno-30-34"></a><span class="err">…</span>
<a id="__codelineno-30-35" name="__codelineno-30-35"></a>       <span class="c1"># les vues HTML et leurs modèles dépendent de l&#39;état rendu par le contrôleur</span>
<a id="__codelineno-30-36" name="__codelineno-30-36"></a>        <span class="s2">&quot;views&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-30-37" name="__codelineno-30-37"></a>            <span class="p">{</span>
<a id="__codelineno-30-38" name="__codelineno-30-38"></a>                <span class="c1"># vue d&#39;authentification</span>
<a id="__codelineno-30-39" name="__codelineno-30-39"></a>                <span class="err">…</span>
<a id="__codelineno-30-40" name="__codelineno-30-40"></a>            <span class="p">},</span>
<a id="__codelineno-30-41" name="__codelineno-30-41"></a>            <span class="p">{</span>
<a id="__codelineno-30-42" name="__codelineno-30-42"></a>                <span class="c1"># vue du calcul de l&#39;impôt</span>
<a id="__codelineno-30-43" name="__codelineno-30-43"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-30-44" name="__codelineno-30-44"></a>                    <span class="c1"># /authentifier-utilisateur réussite</span>
<a id="__codelineno-30-45" name="__codelineno-30-45"></a>                    <span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-30-46" name="__codelineno-30-46"></a>                    <span class="c1"># /calculer-impot réussite</span>
<a id="__codelineno-30-47" name="__codelineno-30-47"></a>                    <span class="mi">300</span><span class="p">,</span>
<a id="__codelineno-30-48" name="__codelineno-30-48"></a>                    <span class="c1"># /calculer-impot échec</span>
<a id="__codelineno-30-49" name="__codelineno-30-49"></a>                    <span class="mi">301</span><span class="p">,</span>
<a id="__codelineno-30-50" name="__codelineno-30-50"></a>                    <span class="c1"># /afficher-calcul-impot</span>
<a id="__codelineno-30-51" name="__codelineno-30-51"></a>                    <span class="mi">800</span>
<a id="__codelineno-30-52" name="__codelineno-30-52"></a>                <span class="p">],</span>
<a id="__codelineno-30-53" name="__codelineno-30-53"></a>                <span class="s2">&quot;view_name&quot;</span><span class="p">:</span> <span class="s2">&quot;views/vue-calcul-impot.html&quot;</span><span class="p">,</span>
<a id="__codelineno-30-54" name="__codelineno-30-54"></a>                <span class="s2">&quot;model_for_view&quot;</span><span class="p">:</span> <span class="n">ModelForCalculImpotView</span><span class="p">()</span>
<a id="__codelineno-30-55" name="__codelineno-30-55"></a>            <span class="p">},</span>
<a id="__codelineno-30-56" name="__codelineno-30-56"></a>            <span class="p">{</span><span class="err">…</span>
<a id="__codelineno-30-57" name="__codelineno-30-57"></a>            <span class="p">}</span>
<a id="__codelineno-30-58" name="__codelineno-30-58"></a>        <span class="p">],</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>ligne 2 : le nouveau contrôleur ;</li>
<li>ligne 28 : la nouvelle action et son contrôleur ;</li>
<li>ligne 51 : le nouveau contrôleur rendra le code d’état 800. Sur un changement de vues, il ne peut y avoir d’erreur. La vue affichée est la vue <strong>[vue-calcul-impot.html]</strong> que nous avons étudiée, expliquée et testée ;
Le contrôleur <strong>[AfficherCalculImpotController]</strong> sera le suivant :</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask_api</span><span class="w"> </span><span class="kn">import</span> <span class="n">status</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">werkzeug.local</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalProxy</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">InterfaceController</span><span class="w"> </span><span class="kn">import</span> <span class="n">InterfaceController</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">AfficherCalculImpotController</span><span class="p">(</span><span class="n">InterfaceController</span><span class="p">):</span>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a>        <span class="c1"># on récupère les éléments du path</span>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a>        <span class="n">dummy</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a>        <span class="c1"># changement de vue - juste un code d&#39;état à positionner</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span> <span class="s2">&quot;état&quot;</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span> <span class="s2">&quot;réponse&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_200_OK</span>
</code></pre></div></td></tr></table></div>
<p><strong>Commentaires</strong></p>
<ul>
<li>ligne 6 : comme les autres contrôleurs secondaires, le nouveau contrôleur implémente l’interface <strong>[InterfaceController]</strong> ;</li>
<li>ligne 13 : les changements de vue sont simples à implémenter : il suffit de rendre un code d’état associé à la vue cible, ici le code 800 comme il a été vu plus haut ;</li>
</ul>
<h3 id="3292-laction-fin-session">32.9.2. L’action [/fin-session]</h3>
<p>L’action <strong>[/fin-session]</strong> est particulière. Elle n’amène pas directement à une vue mais à une redirection. Rappelons que les redirections sont configurées dans la configuration <strong>[config]</strong> de la façon suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a>        <span class="c1"># redirections</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>        <span class="s2">&quot;redirections&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a>            <span class="p">{</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>                <span class="s2">&quot;états&quot;</span><span class="p">:</span> <span class="p">[</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>                    <span class="mi">400</span><span class="p">,</span>  <span class="c1"># /fin-session réussi</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>                <span class="p">],</span>
<a id="__codelineno-32-7" name="__codelineno-32-7"></a>                <span class="c1"># redirection vers</span>
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>                <span class="s2">&quot;to&quot;</span><span class="p">:</span> <span class="s2">&quot;/init-session/html&quot;</span><span class="p">,</span>
<a id="__codelineno-32-9" name="__codelineno-32-9"></a>            <span class="p">}</span>
<a id="__codelineno-32-10" name="__codelineno-32-10"></a>        <span class="p">],</span>
</code></pre></div></td></tr></table></div>
<p>Il n’y a qu’une redirection dans l’application :</p>
<ul>
<li>lorsque le contrôleur rend le code d’état <strong>[400]</strong> (ligne 5), il faut rediriger le client vers l’URL <strong>[http://machine:port/chemin/init-session/html]</strong> (ligne 8) ;
Le code d’état <strong>[400]</strong> est le code rendu suite à une action <strong>[/fin-session]</strong> réussie. Pourquoi faut-il alors rediriger le client l’URL <strong>[/init-session/html]</strong> ? Parce que le code de l’action <strong>[/fin-session]</strong> supprime le type de la session présent dans la session web. On ne sait plus alors qu’on est dans une session html. Il faut le redire. On le fait à l’aide de l’action <strong>[/init-session/html]</strong>.</li>
</ul>
<p>Les redirections HTML sont gérées par la classe <strong>[HtmlResponse]</strong> :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a>   <span class="k">def</span><span class="w"> </span><span class="nf">build_http_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">LocalProxy</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">status_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>                            <span class="n">résultat</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">Response</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a>        <span class="c1"># la réponse HTML dépend du code d&#39;état rendu par le contrôleur</span>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>        <span class="n">état</span> <span class="o">=</span> <span class="n">résultat</span><span class="p">[</span><span class="s2">&quot;état&quot;</span><span class="p">]</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a>        <span class="c1"># faut-il faire une redirection ?</span>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a>        <span class="k">for</span> <span class="n">redirection</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;redirections&quot;</span><span class="p">]:</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a>            <span class="c1"># états nécessitant une redirection</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a>            <span class="n">états</span> <span class="o">=</span> <span class="n">redirection</span><span class="p">[</span><span class="s2">&quot;états&quot;</span><span class="p">]</span>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a>            <span class="k">if</span> <span class="n">état</span> <span class="ow">in</span> <span class="n">états</span><span class="p">:</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a>                <span class="c1"># il faut faire une redirection</span>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a>                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">redirection</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_302_FOUND</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a>        <span class="c1"># à un état, correspond une vue</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a>        <span class="c1"># on cherche celle-ci dans la liste des vues</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a> <span class="o">..</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>les lignes 6-12 traitent les redirections ;</li>
<li>ligne 7 : config<strong>[‘redirections’]</strong> est une liste de redirections. Chaque redirection est un dictionnaire avec les clés :</li>
<li><strong>[états]</strong> : les états rendus par le contrôleur qui mènent à une redirection ;</li>
<li><strong>[to]</strong> : l’adresse de redirection ;</li>
<li>lignes 7-12 : on parcourt la liste des redirections ;</li>
<li>ligne 9 : pour chaque redirection, on récupère les états qui y mènent ;</li>
<li>ligne 10 : si l’état testé est dans cette liste, alors on fait la redirection, ligne 12 ;</li>
<li>ligne 12 : on rappelle que la méthode <strong>[</strong><strong>build_http_response</strong><strong>]</strong> doit rendre un tuple à deux éléments :</li>
<li><strong>[response]</strong> : la réponse HTTP à faire. Celle-ci est construite avec la fonction <strong>[redirect]</strong> dont le paramètre est l’adresse de redirection ;</li>
<li>
<p><strong>[status_code]</strong> : le code de statut de la réponse HTTP, ici le code <strong>[</strong><strong>status.HTTP_302_FOUND</strong><strong>]</strong> qui indique au client qu’il doit se rediriger ;
Faisons un test <strong>[Postman]</strong>. On :</p>
</li>
<li>
<p>initialise une session HTML <strong>[init-session/html]</strong> ;</p>
</li>
<li>s’authentifie <strong>[/authentifier-utilisateur]</strong> ;</li>
<li>termine la session <strong>[/fin-session]</strong> ;</li>
</ul>
<p><img src="images/10000000000002390000013BE13560F9.png" style="width:6.561cm;height:3.631cm;" alt="Image" /></p>
<p>La réponse du serveur est la suivante :</p>
<p><img src="images/1000000000000471000003013FEEEC51.png" style="width:13.14cm;height:8.871cm;" alt="Image" /></p>
<p>On a obtenu la vue d’authentification. C’est bien elle qu’on attendait. Maintenant, voyons comment elle a été obtenue. Passons sur la console <strong>[Postman]</strong> (Ctrl-Alt-C) :</p>
<p><img src="images/1000000000000533000000AF4A994D1D.png" style="width:15.361cm;height:2.02cm;" alt="Image" /></p>
<ul>
<li>en <strong>[1]</strong>, l’action <strong>[/fin-session]</strong> ;</li>
<li>en <strong>[2-3]</strong>, le code 302 de statut HTTP rendu par le serveur indique au client qu’il dit se rediriger ;</li>
<li>en <strong>[4]</strong>, le client <strong>[Postman]</strong> suit la redirection ;</li>
</ul>
<h2 id="3210-tests-de-lapplication-html-en-conditions-reelles">32.10. Tests de l’application HTML en conditions réelles</h2>
<p>Le code a été écrit et chaque action testée avec <strong>[Postman]</strong>. Il nous reste à tester l’enchaînement des vues en situation réelle. Il nous faut un moyen d’initialiser la session HTML. On sait qu’il faut envoyer au serveur la requête <strong>[/init-session/html]</strong>. Ce n’est pas une URL très pratique. On préfèrerait démarrer avec l’URL <strong>[/]</strong>.</p>
<p>Nous avons écrit dans le script principal <strong>[main]</strong> la route suivante :</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">request</span><span class="p">,</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">redirect</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="err">…</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="err">…</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">index</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a>    <span class="c1"># redirection vers /init-session/html</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a>    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s2">&quot;init_session&quot;</span><span class="p">,</span> <span class="n">type_response</span><span class="o">=</span><span class="s2">&quot;html&quot;</span><span class="p">),</span> <span class="n">status</span><span class="o">.</span><span class="n">HTTP_302_FOUND</span><span class="p">)</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="err">…</span>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="c1"># init-session</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/init-session/&lt;string:type_response&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">init_session</span><span class="p">(</span><span class="n">type_response</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a>    <span class="c1"># on exécute le contrôleur associé à l&#39;action</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a>    <span class="k">return</span> <span class="n">front_controller</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>lignes 4-7 : gestion de la route <strong>[/]</strong>. Le point d’entrée de l’application web sera l’URL<strong>[/init-session/html]</strong> (ligne 10). Aussi ligne 7, nous redirigeons le client vers cette URL :</li>
<li>la fonction <strong>[url_for]</strong> est importée ligne 1. Elle a ici deux paramètres (ligne 7) :</li>
<li>le 1er paramètre est le nom d’une des fonctions de routage, ici celle de la ligne 11. On voit que cette fonction attend un paramètre <strong>[type_response]</strong> qui est le type (json, xml, html) de réponse souhaité par le client ;</li>
<li>le 2ième paramètre reprend le nom du paramètre de la ligne 11, <strong>[type_response]</strong>, et lui donne une valeur. S’il y avait d’autres paramètres, on répéterait l’opération pour chacun d’eux ;</li>
<li>elle rend l’URL associée à la fonction désignée par les deux paramètres qui lui ont été donnés. Ici cela donnera l’URL de la ligne 10 où le paramètre est remplacé par sa valeur <strong>[/init-session/html]</strong> ;</li>
<li>la fonction <strong>[redirect]</strong> a été importée ligne 1. Elle a pour rôle d’envoyer un entête HTTP de redirection au client :</li>
<li>le 1er paramètre est l’URL vers laquelle le client doit être redirigé ;</li>
<li>le 2ième paramètre est le code de statut de la réponse HTTP faite au client. Le code <strong>[</strong><strong>status.HTTP_302_FOUND</strong><strong>]</strong> correspond à une redirection HTTP ;
Nous sommes prêts. Nous présentons maintenant quelques enchaînements de vues.</li>
</ul>
<p>Dans notre navigateur, nous activons le suivi des requêtes (F12 sur Chrome, Firefox, Edge) et nous demandons l’URL de démarrage <strong>[http://localhost:5000/]</strong>. La réponse du serveur est la suivante :</p>
<p><img src="images/1000000000000472000002C19BB8233D.png" style="width:13.14cm;height:8.131cm;" alt="Image" /></p>
<p>Si on regarde les échanges réseau qui ont eu lieu entre le client et le serveur :</p>
<p><img src="images/100000000000031B000002B7F28AEC25.png" style="width:9.191cm;height:8.041cm;" alt="Image" /></p>
<ul>
<li>on voit qu’en <strong>[4, 5]</strong>, le navigateur a reçu une demande de redirection vers l’URL <strong>[/init-session/html]</strong> ;
Remplissons le formulaire que nous avons reçu ;</li>
</ul>
<p><img src="images/10000000000003B70000027C5295D476.png" style="width:10.962cm;height:7.34cm;" alt="Image" /></p>
<p>Puis faisons quelques simulations :</p>
<p><img src="images/100000000000058C000003D49409373A.png" style="width:16.421cm;height:11.321cm;" alt="Image" /></p>
<p><img src="images/100000000000058F0000038458674965.png" style="width:16.428cm;height:10.39cm;" alt="Image" /></p>
<p>Demandons la liste des simulations :</p>
<p><img src="images/100000000000058F0000025D621119B4.png" style="width:16.431cm;height:6.98cm;" alt="Image" /></p>
<p>Supprimons la 1re simulation :</p>
<p><img src="images/100000000000059000000239A9ED6C37.png" style="width:16.431cm;height:6.571cm;" alt="Image" /></p>
<p>Terminons la session :</p>
<p><img src="images/10000000000005950000033B79A7D0FD.png" style="width:16.481cm;height:9.531cm;" alt="Image" /></p>
<p>Le lecteur est invité à faire d’autres tests.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner">

      <div>
        <a href="https://tahe.developpez.com" target="_blank">
          https://tahe.developpez.com
        </a>
        <br>
        Ce cours tutoriel écrit par <strong>Serge Tahé</strong> est mis à disposition du public selon les termes de la
        <em>Licence Creative Commons Attribution – Pas d’Utilisation Commerciale –
        Partage dans les Mêmes Conditions 3.0 non transposé</em>.
      </div>

    </div>
  </div>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": ["navigation.sections", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="javascripts/focus.js"></script>
      
    
  </body>
</html>